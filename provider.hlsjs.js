/*!
   JW Player version 8.22.1
   Copyright (c) 2021, JW Player, All Rights Reserved
   This source code and its use and distribution is subject to the terms
   and conditions of the applicable license agreement.
   https://www.jwplayer.com/tos/
   This product includes portions of other software. For the full text of licenses, see
   https://ssl.p.jwpcdn.com/player/v/8.22.1/notice.txt
   */ (window.webpackJsonpjwplayer=window.webpackJsonpjwplayer||[]).push([[14],{124:function(c,a,b){"use strict";function d(a){return a&&a.length?a.end(a.length-1):0}b.d(a,"a",function(){return d})},126:function(c,b,a){"use strict";var d=a(88),e=a(87),f={TIT2:"title",TT2:"title",WXXX:"url",TPE1:"artist",TP1:"artist",TALB:"album",TAL:"album"};function g(b,g){for(var a,d,f,h=b.length,e="",c=g||0;c<h;)if(0!==(a=b[c++])&&3!==a)switch(a>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:e+=String.fromCharCode(a);break;case 12:case 13:d=b[c++],e+=String.fromCharCode((31&a)<<6|63&d);break;case 14:d=b[c++],f=b[c++],e+=String.fromCharCode((15&a)<<12|(63&d)<<6|(63&f)<<0)}return e}function h(b){var a=function(b){for(var c="0x",a=0;a<b.length;a++)b[a]<16&&(c+="0"),c+=b[a].toString(16);return parseInt(c)}(b);return 127&a|(32512&a)>>1|(8323072&a)>>2|(2130706432&a)>>3}var i=a(5),j=a(3),k=a(0);function l(){var c=this.video.textTracks,d=Object(k.k)(c,function(a){return(a.inuse||!a._id)&&r(a.kind)});if(this._textTracks&&!m.call(this,d)){for(var b=-1,a=0;a<this._textTracks.length;a++)if("showing"===this._textTracks[a].mode){b=a;break}b!==this._currentTextTrackIndex&&this.setSubtitlesTrack(b+1)}else this.setTextTracks(c)}function m(a){var d=this._textTracks,e=this._tracksById;if(a.length>d.length)return!0;for(var b=0;b<a.length;b++){var c=a[b];if(!c._id||!e[c._id])return!0}return!1}function n(b){var a=b.track;a&&a._id||this.setTextTracks(this.video.textTracks)}function o(g){var c=g.target,d=c.activeCues,b=c.cues,a=c._id,e=this._cues,f=this._activeCues;if(b&&b.length){var h=e[a];e[a]=Array.prototype.slice.call(b),this.parseNativeID3Cues(b,h)}else delete e[a];if(d&&d.length){var i=f[a],j=f[a]=Array.prototype.slice.call(d);this.triggerActiveCues(j,i)}else delete f[a]}function p(d,b,a){if(i.Browser.ie){var c=a;(d||"metadata"===b.kind)&&(c=new window.TextTrackCue(a.startTime,a.endTime,a.text),a.value&&(c.value=a.value)),function(a,d){var e=[],f=a.mode;a.mode="hidden";var b=a.cues;if(b)for(var c=b.length-1;c>=0&&b[c].startTime>d.startTime;c--)e.unshift(b[c]),a.removeCue(b[c]);try{a.addCue(d),e.forEach(function(b){return a.addCue(b)})}catch(g){console.error(g)}a.mode=f}(b,c)}else try{b.addCue(a)}catch(e){console.error(e)}}function q(b,a,c){a&&a.length&&Object(k.i)(a,function(a){var e=a._id||"";if(c&&(a._id=void 0),!i.Browser.ie&&!i.Browser.safari||!b||!/^(native|subtitle|cc)/.test(e)){if(i.Browser.ie&&"disabled"===a.mode||(a.mode="disabled",a.mode="hidden"),a.cues)for(var d=a.cues.length;d--;)a.removeCue(a.cues[d]);a.embedded||(a.mode="disabled"),a.inuse=!1}})}function r(a){return"captions"===a||"subtitles"===a}function s(a){return/^native(?:captions|subtitles)/.test(a)}function t(b){var a,c=(void 0===(a=b)&&(a=[]),a.reduce(function(d,a){if(!("value"in a)&&"data"in a&&a.data instanceof ArrayBuffer){var b=new Uint8Array(a.data),n=b.length;a={value:{key:"",data:""}};for(var e=10;e<14&&e<b.length&&0!==b[e];)a.value.key+=String.fromCharCode(b[e]),e++;var c=19,i=b[c];3!==i&&0!==i||(i=b[++c],n--);var l=0;if(1!==i&&2!==i){for(var k=c+1;k<n;k++)if(0===b[k]){l=k-c;break}}if(l>0){var m=g(b.subarray(c,c+=l),0);if("PRIV"===a.value.key){if("com.apple.streaming.transportStreamTimestamp"===m){var p=1&h(b.subarray(c,c+=4)),q=h(b.subarray(c,c+=4))+(p?4294967296:0);a.value.data=q}else a.value.data=g(b,c+1);a.value.info=m}else a.value.info=m,a.value.data=g(b,c+1)}else{var o=b[c];a.value.data=1===o||2===o?function(b,d){for(var e=b.length-1,c="",a=d||0;a<e;)254===b[a]&&255===b[a+1]||(c+=String.fromCharCode((b[a]<<8)+b[a+1])),a+=2;return c}(b,c+1):g(b,c+1)}}if(f.hasOwnProperty(a.value.key)&&(d[f[a.value.key]]=a.value.data),a.value.info){var j=d[a.value.key];j!==Object(j)&&(j={},d[a.value.key]=j),j[a.value.info]=a.value.data}else d[a.value.key]=a.value.data;return d},{}));return{metadataType:"id3",metadataTime:b[0].startTime,metadata:c}}function u(a,b){return a.startTime===b.startTime&&a.endTime===b.endTime&&a.text===b.text&&a.data===b.data&&JSON.stringify(a.value)===JSON.stringify(b.value)}b.a={_itemTracks:null,_textTracks:null,_currentTextTrackIndex:-1,_tracksById:null,_cuesByTrackId:null,_cachedVTTCues:null,_metaCuesByTextTime:null,_unknownCount:0,_activeCues:null,_cues:null,textTrackChangeHandler:null,addTrackHandler:null,cueChangeHandler:null,renderNatively:!1,_initTextTracks:function(){this._textTracks=[],this._tracksById={},this._metaCuesByTextTime={},this._cuesByTrackId={},this._cachedVTTCues={},this._cues={},this._activeCues={},this._unknownCount=0},addTracksListener:function(a,b,c){a&&(this.removeTracksListener(a,b,c),this.instreamMode||(a.addEventListener?a.addEventListener(b,c):a["on"+b]=c))},removeTracksListener:function(a,b,c){a&&(a.removeEventListener&&c?a.removeEventListener(b,c):a["on"+b]=null)},clearTracks:function(){var c=this;Object(d.a)(this._itemTracks);var a=this._tracksById;if(a&&Object.keys(a).forEach(function(b){if(0===b.indexOf("nativemetadata")){var d=a[b];c.cueChangeHandler&&d.removeEventListener("cuechange",c.cueChangeHandler),q(c.renderNatively,[d],!0)}}),this._itemTracks=null,this._textTracks=null,this._tracksById=null,this._cuesByTrackId=null,this._metaCuesByTextTime=null,this._unknownCount=0,this._currentTextTrackIndex=-1,this._activeCues={},this._cues={},this.renderNatively){var b=this.video.textTracks;this.textTrackChangeHandler&&this.removeTracksListener(b,"change",this.textTrackChangeHandler),q(this.renderNatively,b,!0)}},clearMetaCues:function(){var c=this,a=this._tracksById,b=this._cachedVTTCues;a&&b&&Object.keys(a).forEach(function(e){if(0===e.indexOf("nativemetadata")){var d=a[e];q(c.renderNatively,[d],!1),d.mode="hidden",d.inuse=!0,d._id&&(b[d._id]={})}})},clearCueData:function(a){var b=this._cachedVTTCues;b&&b[a]&&(b[a]={},this._tracksById&&(this._tracksById[a].data=[]))},disableTextTrack:function(){var a=this.getCurrentTextTrack();if(a){a.mode="disabled";var b=a._id;(b&&s(b)||this.renderNatively&&i.OS.iOS)&&(a.mode="hidden")}},enableTextTrack:function(){var a=this.getCurrentTextTrack();a&&(a.mode="showing")},getCurrentTextTrack:function(){if(this._textTracks)return this._textTracks[this._currentTextTrackIndex]},getSubtitlesTrack:function(){return this._currentTextTrackIndex},addTextTracks:function(a){var c=this,b=[];return a&&(this._textTracks||this._initTextTracks(),a.forEach(function(a){if(!(a.includedInManifest||a.kind&&!r(a.kind))){var e=c._createTrack(a);c._addTrackToList(e),b.push(e),a.file&&(a.data=[],Object(d.b)(a,function(a){e.sideloaded=!0,c.addVTTCuesToTrack(e,a)},function(a){c.trigger(j.ub,a)}))}}),this._textTracks&&this._textTracks.length&&this.trigger(j.rb,{tracks:this._textTracks})),b},setTextTracks:function(c){var q=this;if(this._currentTextTrackIndex=-1,c){if(this._textTracks){var t=this._tracksById;this._activeCues={},this._cues={},this._unknownCount=0,this._textTracks=this._textTracks.filter(function(b){var a=b._id;return q.renderNatively&&a&&s(a)?(delete t[a],!1):(b.name&&0===b.name.indexOf("Unknown")&&q._unknownCount++,0===a.indexOf("nativemetadata")&&"com.apple.streaming"===b.inBandMetadataTrackDispatchType&&delete t[a],!0)},this)}else this._initTextTracks();if(c.length)for(var d=0,m=c.length,g=this._tracksById,f=this._cuesByTrackId;d<m;d++){var a=c[d],b=a._id||"";if(!b){if(!1===a.inuse&&r(a.kind)&&this.renderNatively){a._id="native"+a.kind+d;continue}if(r(a.kind)||"metadata"===a.kind){if(b=a._id="native"+a.kind+d,!a.label&&"captions"===a.kind){var i=Object(e.b)(a,this._unknownCount);a.name=i.label,this._unknownCount=i.unknownCount}}else b=a._id=Object(e.a)(a,this._textTracks?this._textTracks.length:0);if(g[b])continue;a.inuse=!0}if(a.inuse&&!g[b]){if("metadata"===a.kind){a.mode="hidden";var k=this.cueChangeHandler=this.cueChangeHandler||o.bind(this);a.removeEventListener("cuechange",k),a.addEventListener("cuechange",k),g[b]=a}else if(r(a.kind)){var h=a.mode,l=void 0;if(a.mode="hidden",(!a.cues||!a.cues.length)&&a.embedded)continue;if(("disabled"!==h||s(b))&&(a.mode=h),f[b]&&!f[b].loaded){for(var n=f[b].cues;l=n.shift();)p(this.renderNatively,a,l);a.mode=h,f[b].loaded=!0}this._addTrackToList(a)}}}this.renderNatively&&this.addTrackListeners(c),this._textTracks&&this._textTracks.length&&this.trigger(j.rb,{tracks:this._textTracks})}},addTrackListeners:function(b){var a=this.textTrackChangeHandler=this.textTrackChangeHandler||l.bind(this);this.removeTracksListener(b,"change",a),this.addTracksListener(b,"change",a),(i.Browser.edge&&i.Browser.ie||i.Browser.firefox)&&(a=this.addTrackHandler=this.addTrackHandler||n.bind(this),this.removeTracksListener(b,"addtrack",a),this.addTracksListener(b,"addtrack",a))},setupSideloadedTracks:function(a){if(this.renderNatively){var b=(a=a||null)===this._itemTracks;b||Object(d.a)(this._itemTracks),this._itemTracks=a,a&&(b||(this.disableTextTrack(),this._clearSideloadedTextTracks(),this.addTextTracks(a)))}},setSubtitlesTrack:function(a){if(this.renderNatively){if(this._textTracks&&(0===a&&this._textTracks.forEach(function(a){a.mode=a.embedded?"hidden":"disabled"}),this._currentTextTrackIndex!==a-1)){this.disableTextTrack(),this._currentTextTrackIndex=a-1;var b=this.getCurrentTextTrack();b&&(b.mode="showing"),this.trigger(j.sb,{currentTrack:this._currentTextTrackIndex+1,tracks:this._textTracks})}}else this.setCurrentSubtitleTrack&&this.setCurrentSubtitleTrack(a-1)},createCue:function(a,b,c){return new(window.VTTCue||window.TextTrackCue)(a,Math.max(b||0,a+.25),c)},addVTTCue:function(b,g){this._tracksById||this._initTextTracks();var e=b.track?b.track:"native"+b.type,a=this._tracksById[e],h="captions"===b.type?"Unknown CC":"ID3 Metadata",c=b.cue;if(!a){var d={kind:b.type,_id:e,label:h,default:!1};this.renderNatively||"metadata"===d.kind?((a=this._createTrack(d)).embedded=!0,this.setTextTracks(this.video.textTracks)):a=this.addTextTracks([d])[0]}if(this._cacheVTTCue(a,c,g)){var f=this.renderNatively||"metadata"===a.kind;return f?p(f,a,c):a.data.push(c),c}return null},addVTTCuesToTrack:function(f,c){if(this.renderNatively){var d,b=f._id,g=this._tracksById,a=this._cuesByTrackId,e=g[b];if(!e)return a||(a=this._cuesByTrackId={}),void(a[b]={cues:c,loaded:!1});if(!a[b]||!a[b].loaded)for(a[b]={cues:c,loaded:!0};d=c.shift();)p(this.renderNatively,e,d)}},parseNativeID3Cues:function(c,f){var m=c[c.length-1];if(!f||f.length!==c.length|| !m._parsed&&!u(f[f.length-1],m)){for(var h=[],d=[],e=-1,b=-1,n=-1,i=0;i<c.length;i++){var a=c[i];if(!a._extended&&(a.data||a.value)){if(a.startTime!==b||null===a.endTime){n=b,b=a.startTime;var k=h[e];if(h[++e]=[],d[e]=[],k&&b-n>0)for(var l=0;l<k.length;l++){var o=k[l];o.endTime=b,o._extended=!0}}h[e].push(a),a._parsed||(d[e].push(a),a.endTime-b<.25&&(a.endTime=b+.25),a._parsed=!0)}}for(var g=0;g<d.length;g++)if(d[g].length){var p=t(d[g]);this.trigger(j.L,p)}}},triggerActiveCues:function(b,d){var e=this,a=b.filter(function(b){if(d&&d.some(function(a){return u(b,a)}))return!1;if(b.data)return!0;var a=b.text?function(b){try{a=JSON.parse(b.text)}catch(d){return null}var a,c={metadataType:a.metadataType,metadataTime:b.startTime,metadata:a};return a.programDateTime&&(c.programDateTime=a.programDateTime),c}(b):null;if(a)"emsg"===a.metadataType&&(a.metadata=a.metadata||{},a.metadata.messageData=b.value),e.trigger(j.K,a);else if(b.value)return!0;return!1});if(a.length){var c=t(a);this.trigger(j.K,c)}},ensureMetaTracksActive:function(){for(var c=this.video.textTracks,d=c.length,a=0;a<d;a++){var b=c[a];"metadata"===b.kind&&"disabled"===b.mode&&(b.mode="hidden")}},_cacheVTTCue:function(g,a,h){var k=g.kind,e=g._id,f=this._cachedVTTCues;f[e]||(f[e]={});var b,c=f[e];switch(k){case"captions":case"subtitles":b=h||Math.floor(20*a.startTime);var d="_"+(a.line||"auto"),i=Math.floor(20*a.endTime),j=c[b+d]||c[b+1+d]||c[b-1+d];return!(j&&1>=Math.abs(j-i))&&(c[b+d]=i,!0);case"metadata":var l=a.data?new Uint8Array(a.data).join(""):a.text;return!c[b=h||a.startTime+l]&&(c[b]=a.endTime,!0);default:return!1}},_addTrackToList:function(a){this._textTracks.push(a),this._tracksById[a._id]=a},_createTrack:function(b){var a,c=Object(e.b)(b,this._unknownCount),d=c.label;if(this._unknownCount=c.unknownCount,this.renderNatively||"metadata"===b.kind){var f=this.video.textTracks;(a=Object(k.m)(f,{label:d}))||(a=this.video.addTextTrack(b.kind,d,b.language||"")),a.default=b.default,a.mode="disabled",a.inuse=!0}else(a=b).data=a.data||[];return a._id||(a._id=Object(e.a)(b,this._textTracks?this._textTracks.length:0)),a},_clearSideloadedTextTracks:function(){if(this._textTracks){var a=this._textTracks.filter(function(a){return a.embedded||"subs"===a.groupid});this._initTextTracks();var b=this._tracksById;a.forEach(function(a){b[a._id]=a}),this._textTracks=a}}}},147:function(c,a,b){"use strict";function d(a){return{bitrate:a.bitrate,label:a.label,width:a.width,height:a.height}}b.d(a,"a",function(){return d})},148:function(c,b,a){"use strict";var d=a(3),e=a(52);b.a={canplay:function(){this.renderNatively&&this.setTextTracks(this.video.textTracks),this.trigger(d.E)},play:function(){this.stallTime=-1,this.video.paused||this.state===d.pb||this.setState(d.nb)},loadedmetadata:function(){var a={metadataType:"media",duration:this.getDuration(),height:this.video.videoHeight,width:this.video.videoWidth,seekRange:this.getSeekRange()},b=this.drmUsed;b&&(a.drm=b),this.trigger(d.K,a)},timeupdate:function(){var a=this.video.currentTime,g=this.getCurrentTime(),c=this.getDuration();if(!isNaN(c)){this.seeking||this.video.paused||this.state!==d.qb&&this.state!==d.nb||this.stallTime===a||(this.stallTime=-1,this.setState(d.pb),this.trigger(d.fb));var b={position:g,duration:c,currentTime:a,seekRange:this.getSeekRange(),metadata:{currentTime:a}},e=this.getLiveLatency();if(null!==e&&(b.latency=e,this.getTargetLatency)){var f=this.getTargetLatency();null!==f&&(b.targetLatency=f)}(this.state===d.pb||this.seeking&&this.state!==d.mb)&&this.trigger(d.S,b)}},click:function(a){this.trigger(d.o,a)},volumechange:function(){var a=this.video;this.trigger(d.V,{volume:Math.round(100*a.volume)}),this.trigger(d.M,{mute:a.muted})},seeking:function(){if(this.state===d.nb){var a=this.video.buffered.length?this.video.buffered.start(0):-1;if(this.video.currentTime===a)return}else if(this.state===d.mb)return;this.seeking=!0},seeked:function(){this.seeking&&(this.seeking=!1,this.trigger(d.R))},playing:function(){-1===this.stallTime&&this.setState(d.pb),this.trigger(d.fb)},pause:function(){this.state!==d.kb&&(this.video.ended||this.video.error||this.video.currentTime!==this.video.duration&&this.setState(d.ob))},progress:function(){var a=this.getDuration();if(!(a<=0||a===1/0)){var b=this.video.buffered;if(b&&0!==b.length){var c=Object(e.a)(b.end(b.length-1)/a,0,1);this.trigger(d.D,{bufferPercent:100*c,position:this.getCurrentTime(),duration:a,currentTime:this.video.currentTime,seekRange:this.getSeekRange()})}}},ratechange:function(){this.trigger(d.P,{playbackRate:this.video.playbackRate})},ended:function(){this.state!==d.mb&&this.state!==d.kb&&this.trigger(d.F)}}},149:function(c,b,a){"use strict";var d=a(5),e=a(11),f=a(124);b.a={container:null,volume:function(a){this.video.volume=Math.min(Math.max(0,a/100),1)},mute:function(a){this.video.muted=!!a,this.video.muted||this.video.removeAttribute("muted")},resize:function(g,h,c){var i=this.video,l=i.videoWidth,m=i.videoHeight;if(g&&h&&l&&m){var f={objectFit:"",width:"",height:""},a=g/h,b=l/m;if("uniform"===c&&(a>b?g-g/(a/b):h-h/(b/a))<6&&(f.objectFit="fill",c="exactfit"),d.Browser.ie||d.OS.iOS&&9>(d.OS.version.major||0)||d.Browser.androidNative){if("uniform"!==c){f.objectFit="contain";var j=1,k=1;"none"===c?j=k=a>b?Math.ceil(100*m/h)/100:Math.ceil(100*l/g)/100:"fill"===c?j=k=a>b?a/b:b/a:"exactfit"===c&&(a>b?(j=a/b,k=1):(j=1,k=b/a)),Object(e.e)(i,"matrix("+j.toFixed(2)+", 0, 0, "+k.toFixed(2)+", 0, 0)")}else f.top=f.left=f.margin="",Object(e.e)(i,"")}Object(e.d)(i,f)}},getContainer:function(){return this.container},setContainer:function(a){this.container=a,this.video.parentNode!==a&&a.appendChild(this.video)},removeFromContainer:function(){var a=this.container,b=this.video;this.container=null,a&&a===b.parentNode&&a.removeChild(b)},remove:function(){this.stop(),this.destroy(),this.removeFromContainer()},atEdgeOfLiveStream:function(){return!!this.isLive()&&Object(f.a)(this.video.buffered)-this.video.currentTime<=2}}},150:function(b,a,c){"use strict";a.a={eventsOn_:function(){},eventsOff_:function(){},attachMedia:function(){this.eventsOn_()},detachMedia:function(){return this.eventsOff_()}}},151:function(c,b,a){"use strict";a.d(b,"b",function(){return e}),a.d(b,"a",function(){return f});var d=a(1);function e(e,a,g){var b=e+1e3,c=d.m;return a>0?(403===a&&(c=d.o),b+=f(a)):"http:"===(""+g).substring(0,5)&&"https:"===document.location.protocol?b+=12:0===a&&(b+=11),{code:b,key:c}}var f=function(a){return a>=400&&a<600?a:6}},161:function(c,b,a){"use strict";a.d(b,"a",function(){return g});var d=a(0),e=a(3);function f(b,c){var a=b[c];return Object(d.s)(a)&&a>=0?a:null}function g(b,c,g){var a=function(e,c,a){var b;if(null===(b=Object(d.s)(a.startPTS)?f(a,"startPTS"):f(a,"start")))return null;switch(e){case"PROGRAM-DATE-TIME":var m=f(a,"duration");return{metadataType:"program-date-time",programDateTime:c,start:b,end:b+m};case"EXT-X-DATERANGE":var g={},n=c.split(",").map(function(d){var a=d.split("="),b=a[0],c=(a[1]||"").replace(/^"|"$/g,"");return g[b]=c,{name:b,value:c}}),h=g["START-DATE"];if(!h)return null;var k=g["END-DATE"],i=b;if(Object(d.s)(a.programDateTime)&&(i+=(new Date(h).getTime()-new Date(a.programDateTime).getTime())/1e3),isNaN(i))return null;var j=parseFloat(g["PLANNED-DURATION"]||g.DURATION)||0;return!j&&k&&(j=(new Date(k).getTime()-new Date(h).getTime())/1e3),{metadataType:"date-range",tag:e,content:c,attributes:n,start:i,end:i+j,startDate:h,endDate:k,duration:j};case"EXT-X-CUE-IN":case"EXT-X-CUE-OUT":var o=parseFloat(c)||0;return{metadataType:"scte-35",tag:e,content:c,start:b,end:b+o};case"DISCONTINUITY":var l,p=f(a,"duration"),q=b+p;return"cc"in a&&(l=a.cc),{metadataType:"discontinuity",tag:e,discontinuitySequence:l,PTS:c,start:b,end:q};default:return null}}(b,c,g);if(a){if(!Object(d.s)(a.start))return;var h=this.createCue(a.start,a.end,JSON.stringify(a)),i=g.sn+"_"+b+"_"+c;if(this.addVTTCue({type:"metadata",cue:h},i)){var j=a.metadataType;delete a.metadataType,this.trigger(e.L,{metadataType:j,metadata:a})}}}},162:function(d,a,b){"use strict";b.d(a,"b",function(){return c}),b.d(a,"c",function(){return e}),b.d(a,"a",function(){return f});var c=1,e=c+1,f=25},163:function(c,a,b){"use strict";function d(a,c,d){if(!a)return"";var b=a.bitrate||a.bandwidth;return function(a,b){var c=null;if(b&&a){var d=Object.keys(a);if(d.length){var f,i,k,g,j,h=(f=d,i=e(b),g=null,j=1/0,f.forEach(function(a){(k=Math.abs(parseFloat(a)-i))<j&&(g=a,j=k)}),g);h&&(c=a[h])}}return c}(c,b)||a.label||function(c,a,f){if(!c&&!a)return"";var b="",d="";return a&&(b=d=e(a)+" kbps"),c&&(b=c+"p",a&&f&&(b+=" ("+d+")")),b}(a.height,b,d)}function e(a){return Math.floor(a/1e3)}function f(a){return!!Array.isArray(a)&&h(a,["height","bitrate","bandwidth"])}function g(a){return!!Array.isArray(a)&&h(a,["label"])}function h(a,b){return a.some(function(d){for(var a,c=0;c<b.length&&!(a=d[b[c]]);c++);if(!a)return!1;var e=this[a]||!1;return this[a]=!0,e},{})}b.d(a,"a",function(){return d}),b.d(a,"d",function(){return e}),b.d(a,"c",function(){return f}),b.d(a,"b",function(){return g})},164:function(c,b,a){"use strict";a.d(b,"a",function(){return f});var d=a(3),e=a(0);function f(b,a){var c,f=a;return{start:function(){this.stop(),c=window.setInterval(function(){var a=b.getBandwidthEstimate();Object(e.z)(a)&&(f=a,b.trigger(d.j,{bandwidthEstimate:f}))},1e3)},stop:function(){clearInterval(c)},getEstimate:function(){return f}}}},166:function(m,g,a){"use strict";var b={};a.r(b),a.d(b,"debug",function(){return u}),a.d(b,"log",function(){return v}),a.d(b,"info",function(){return w}),a.d(b,"warn",function(){return x}),a.d(b,"error",function(){return y});var h=a(0),n=function(){function a(a,b,c,d){this.video=a,this.hlsjs=c,this.videoListeners=b,this.hlsjsListeners=d}var b=a.prototype;return b.on=function(){var a=this;this.off(),Object(h.i)(this.videoListeners,function(b,c){a.video.addEventListener(c,b,!1)}),Object(h.i)(this.hlsjsListeners,function(b,c){a.hlsjs.on(c,b)})},b.off=function(){var a=this;Object(h.i)(this.videoListeners,function(b,c){a.video.removeEventListener(c,b)}),Object(h.i)(this.hlsjsListeners,function(b,c){a.hlsjs.off(c,b)})},a}(),o=a(163);function p(a){return a.audioGroupIds?a.audioGroupIds[a._urlId||a.urlId]:void 0}function q(b,c){var d=Object(o.c)(b),a=Object(h.A)(b,function(a,b){return{label:Object(o.a)(a,c,d),level_id:a.id,hlsjsIndex:b,bitrate:a.bitrate,height:a.height,width:a.width,audioGroupId:p(a)}});return a.sort(function(a,b){return a.height&&b.height&&a.height!==b.height?b.height-a.height:(b.bitrate||0)-(a.bitrate||0)}),a.length>1&&a.unshift({label:"Auto",level_id:"auto",hlsjsIndex:-1}),a}function r(b,a){return Math.max(0,Object(h.p)(a,Object(h.l)(a,function(a){return a.hlsjsIndex===b})))}function s(c,g,h,b){void 0===b&&(b=c.length);var d,e,i=function(){try{return window.devicePixelRatio}catch(a){}return 1}();g*=i,h*=i;for(var a=0;a<b;a++){var f=c[a];if((f.width>=g||f.height>=h)&&(d=f,!(e=c[a+1])||d.width!==e.width||d.height!==e.height))return a}return b-1}var d,i=a(15),t=function(){},c=function(a){return i.a.debug?console[a].bind(console,"[Hls.js "+a+"] ->"):t},u=c("debug"),v=c("log"),w=c("info"),x=c("warn"),y=c("error"),z=a(162),A=a(50),B=a(151),C=a(1);function D(a){if(a){if(/^frag/.test(a))return 2e3;if(/^(manifest|level|audioTrack)/.test(a))return 1e3;if(/^key/.test(a))return 4e3}return 0}(U=d||(d={}))[U.BASE_ERROR=23e4]="BASE_ERROR",U[U.ERROR_LIVE_STREAM_DOWN_OR_ENDED=230001]="ERROR_LIVE_STREAM_DOWN_OR_ENDED",U[U.MANIFEST_ERROR_CONNECTION_LOST=232002]="MANIFEST_ERROR_CONNECTION_LOST",U[U.ERROR_CONNECTION_LOST=230002]="ERROR_CONNECTION_LOST",U[U.MANIFEST_PARSING_ERROR=232600]="MANIFEST_PARSING_ERROR",U[U.LEVEL_EMPTY_ERROR=232631]="LEVEL_EMPTY_ERROR",U[U.MANIFEST_INCOMPATIBLE_CODECS_ERROR=232632]="MANIFEST_INCOMPATIBLE_CODECS_ERROR",U[U.FRAG_PARSING_ERROR=233600]="FRAG_PARSING_ERROR",U[U.FRAG_DECRYPT_ERROR=233650]="FRAG_DECRYPT_ERROR",U[U.BUFFER_STALLED_ERROR=234001]="BUFFER_STALLED_ERROR",U[U.BUFFER_APPEND_ERROR=234002]="BUFFER_APPEND_ERROR";var j=a(9),_=a(149),k=a(150),l=a(126);function E(a,b){return(E=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a})(a,b)}var e=function(d){var a,b;function c(){return d.apply(this,arguments)||this}return b=d,(a=c).prototype=Object.create(b.prototype),a.prototype.constructor=a,E(a,b),c}(j.a);Object(h.j)(e.prototype,_.a,k.a,l.a);var F=e,G=a(147),H=a(161),I=a(85),J=a(5),K=a(3),L=a(18),M=a(148),N=a(20),O=a(81),P=a(164),Q=a(83);function R(d,c){for(var b=0;b<c.length;b++){var a=c[b];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(d,a.key,a)}}function S(a,b){return(S=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a})(a,b)}function T(e){var j,T,a,k,l,m,U,Z,o,aa,ab,t,u,f,g,v,w,x,y,ac,ad,ae,c=e.Events,af=c.MEDIA_ATTACHED,ag=c.MEDIA_DETACHED,ah=c.MANIFEST_PARSED,ai=c.LEVEL_LOADED,aj=c.LEVEL_UPDATED,ak=c.LEVEL_PTS_UPDATED,al=c.FRAG_CHANGED,am=c.LEVEL_SWITCHED,an=c.FRAG_PARSING_METADATA,ao=c.BUFFER_APPENDED,ap=c.BUFFER_CODECS,aq=c.FRAG_BUFFERED,ar=c.INIT_PTS_FOUND,_=c.NON_NATIVE_TEXT_TRACKS_FOUND,as=c.CUES_PARSED,at=c.AUDIO_TRACKS_UPDATED,au=c.ERROR,E=e.ErrorTypes,av=E.MEDIA_ERROR,aw=E.NETWORK_ERROR,$=(T=(j=e).ErrorTypes.NETWORK_ERROR,a=j.ErrorDetails,k=a.MANIFEST_PARSING_ERROR,l=a.LEVEL_EMPTY_ERROR,m=a.MANIFEST_INCOMPATIBLE_CODECS_ERROR,U=a.FRAG_PARSING_ERROR,Z=a.FRAG_DECRYPT_ERROR,o=a.BUFFER_STALLED_ERROR,aa=a.BUFFER_APPEND_ERROR,ab=a.INTERNAL_EXCEPTION,t=a.MANIFEST_LOAD_ERROR,u=a.MANIFEST_LOAD_TIMEOUT,f=a.LEVEL_LOAD_ERROR,g=a.LEVEL_LOAD_TIMEOUT,v=a.FRAG_LOAD_ERROR,w=a.FRAG_LOAD_TIMEOUT,x=a.BUFFER_SEEK_OVER_HOLE,y=a.BUFFER_NUDGE_ON_STALL,ac=[t,u,k,m,f,g,v,w],ad=[o,x,y],ae=[l,f,g],function(c){var b=c.details,f=c.response,n=c.type,g=c.fatal,h=0>ac.indexOf(b),p=ad.indexOf(b)>=0,i=ae.indexOf(b)>=0,e=C.m,a=d.BASE_ERROR;switch(b){case k:a=d.MANIFEST_PARSING_ERROR;break;case l:a=d.LEVEL_EMPTY_ERROR;break;case m:e=C.l,a=d.MANIFEST_INCOMPATIBLE_CODECS_ERROR;break;case U:a=d.FRAG_PARSING_ERROR;break;case Z:a=d.FRAG_DECRYPT_ERROR;break;case o:a=d.BUFFER_STALLED_ERROR;break;case aa:a=d.BUFFER_APPEND_ERROR;break;case ab:a=239e3;break;default:if(n===T){if(!1===navigator.onLine)h=!1,i=!1,a=(g="manifestLoadError"===b)?d.MANIFEST_ERROR_CONNECTION_LOST:d.ERROR_CONNECTION_LOST,e=C.j;else if(/TimeOut$/.test(b))a=d.BASE_ERROR+1001+D(b);else if(f){var j=Object(B.b)(d.BASE_ERROR,f.code,c.url);a=j.code,e=j.key,a+=D(b)}}}return{key:e,code:a,recoverable:h,stalling:p,suppressLevel:i,fatal:g,error:c}});return function(k){function c(d,b,e){var a;return(a=k.call(this)||this).bandwidthMonitor=Object(P.a)(function(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}(a),b.bandwidthEstimate),a.bitrateSelection=b.bitrateSelection,a.bufferStallTimeout=1e3,a.connectionTimeoutDuration=1e4,a.dvrEnd=null,a.dvrPosition=null,a.dvrUpdatedTime=0,a.eventHandler=null,a.hlsjs=null,a.hlsjsConfig=null,a.hlsjsOptions=null,a.jwConfig=b,a.lastPosition=0,a.maxRetries=3,a.playerId=d,a.processPlaylistMetadata=H.a,a.recoveryInterval=5e3,a.renderNatively=X(b.renderCaptionsNatively),a.savedVideoProperties=!1,a.seeking=!1,a.staleManifestDurationMultiplier=3e3,a.state=K.mb,a.supports=c.supports,a.supportsPlaybackRate=!0,a.video=e,a.playerWidth=0,a.playerHeight=0,a.playerStretching=null,a.capLevels=!1,a.levelDuration=0,a.live=!1,a.liveEdgePosition=null,a.liveEdgeUpdated=0,a.staleManifestTimeout=-1,a.connectionTimeout=-1,a.programDateSyncTime=0,a.retryCount=0,a.stallTime=-1,a.jwLevels=[],a.audioTracks=null,a.audioTracksMap=null,a.resetLifecycleVariables(),a}m=k,(l=c).prototype=Object.create(m.prototype),l.prototype.constructor=l,S(l,m);var l,m,f,g,j,a=c.prototype;return a.resetLifecycleVariables=function(){this.resetRecovery(),this.stopStaleTimeout(),this.stopConnectionTimeout(),this.stallTime=-1,this.streamBitrate=-1,this.videoFound=!1,this.videoHeight=0,this.src=null,this.currentHlsjsLevel=null,this.currentAudioTrackIndex=null,this.currentJwItem=null,this.jwLevels=[],this.audioTracks=null,this.audioTracksMap=null,this.lastRecoveryTime=null,this.lastEndSn=null,this.levelDuration=0,this.live=!1,this.liveEdgePosition=null,this.liveEdgeUpdated=0,this.liveEdgeSn=-1,this.livePaused=!1,this.recoveringMediaError=!1,this.recoveringNetworkError=!1,this.streamType="VOD",this.lastProgramDateTime=0,this.programDateSyncTime=0},a.resetRecovery=function(){this.retryCount=0},a.stopStaleTimeout=function(){clearTimeout(this.staleManifestTimeout),this.staleManifestTimeout=-1},a.stopConnectionTimeout=function(){clearTimeout(this.connectionTimeout),this.connectionTimeout=-1},a.startConnectionTimeout=function(){var a=this;-1===this.connectionTimeout&&(this.connectionTimeout=setTimeout(function(){navigator.onLine?a.hlsjs.startLoad():a.handleError(d.ERROR_CONNECTION_LOST,null,C.j)},this.connectionTimeoutDuration))},a.initHlsjs=function(a){var g=this.jwConfig.hlsjsConfig,c={withCredentials:!!Y(a,this.jwConfig,"withCredentials"),aesToken:Y(a,this.jwConfig,"aestoken"),renderTextTracksNatively:this.renderNatively,onXhrOpen:a.sources[0].onXhrOpen,liveSyncDuration:Y(a,this.jwConfig,"liveSyncDuration"),hlsjsConfig:g};if(this.setupSideloadedTracks(a.tracks),this.capLevels=!a.stereomode,!this.hlsjs||!Object(h.B)(this.hlsjsOptions)(c)){this.hlsjsOptions=c,this.restoreVideoProperties(),this.stopStaleTimeout(),this.stopConnectionTimeout(),this.hlsjsConfig=(k=(j=c).withCredentials,l=j.aesToken,m=j.renderTextTracksNatively,o=j.onXhrOpen,p=j.liveSyncDuration,q=j.hlsjsConfig,r=Object(h.C)(q||{},["liveSyncDuration","liveSyncDurationCount","liveMaxLatencyDuration","liveMaxLatencyDurationCount","liveBackBufferLength","backBufferLength","loader","pLoader","fLoader","fragLoadingMaxRetry","fragLoadingRetryDelay","enableWorker","debug"]),s={autoStartLoad:!1,capLevelToPlayerSize:!1,captionsTextTrack1Label:"Unknown CC",captionsTextTrack2Label:"Unknown CC",captionsTextTrack1LanguageCode:"",captionsTextTrack2LanguageCode:"",debug:!!i.a.debug&&b,fragLoadingMaxRetry:2,fragLoadingRetryDelay:4e3,maxMaxBufferLength:z.a,renderTextTracksNatively:m,startLevel:-1,testBandwidth:!1},t=r.liveSyncDurationCount,u=r.liveMaxLatencyDurationCount,v=r.liveMaxLatencyDuration,void 0!==t|| void 0!==u?(r.liveSyncDuration=r.liveMaxLatencyDuration=void 0,r.liveSyncDurationCount=Object(h.s)(t)?t:1/0,r.liveMaxLatencyDurationCount=Object(h.s)(u)?u:1/0):void 0===p&& void 0===v||(r.liveSyncDurationCount=r.liveMaxLatencyDurationCount=void 0,s.liveSyncDuration=Object(A.c)(p),r.liveMaxLatencyDuration=Object(h.s)(v)?v:1/0),k||l||o?Object(h.j)({},s,(w=k,x=l,y=o,{xhrSetup:function(a,b){if(w&&(a.withCredentials=!0),x){var c=b.indexOf("?")>0?"&token=":"?token=";a.open("GET",b+c+x,!0)}"function"==typeof y&&y(a,b)},fetchSetup:function(a,b){if(x){var c=a.url.indexOf("?")>0?"&token=":"?token=";a.url=a.url+c+x}return w&&(b.credentials="include"),new Request(a.url,b)}}),r):Object(h.j)({},s,r));var j,k,l,m,o,p,q,r,s,t,u,v,w,x,y,d=Object(h.j)({},this.hlsjsConfig),f=this.bandwidthMonitor.getEstimate();Object(h.z)(f)&&(d.abrEwmaDefaultEstimate=f),this.hlsjs=new e(d),this.eventHandler=new n(this.video,this.createVideoListeners(),this.hlsjs,this.createHlsjsListeners())}},a.init=function(a){this.destroy(),this.initHlsjs(a)},a.preload=function(a){"metadata"===a.preload&&(this.maxBufferLength=z.b),this.load(a)},a.load=function(a){var b=this.hlsjs,d=this.video,g=this.src;if(b){var c=a.sources[0].file,e=c.url&&"string"==typeof c.url?c.url:c;if(g!==e||this.videoSrc!==d.src){var f=a.starttime|| -1;f< -1&&(f=this.lastPosition),this.initHlsjs(a),this.currentJwItem=a,this.src=e,this.videoHeight=0,this.eventsOn_(),b.config.startPosition=f,b.loadSource(e),b.attachMedia(d),this.videoSrc=d.src}else this.maxBufferLength=z.a}},a.restartStream=function(b){var a=Object(h.j)({},this.currentJwItem);b?a.starttime=b:delete a.starttime,this.src=null,this._clearNonNativeCues(),this.clearMetaCues(),this.clearTracks(),this.init(a),this.load(a),delete a.starttime},a.play=function(){return this.livePaused&&(this.livePaused=!1,this.restartStream()),this.video.play()||Object(O.a)(this.video)},a.pause=function(){this.stopConnectionTimeout(),this.live&&"LIVE"===this.streamType&&!this.livePaused&&this.livePause(),this.video.pause()},a.livePause=function(){this.hlsjs&&(this.livePaused=!0,this.hlsjs.stopLoad(),this.stopStaleTimeout())},a.stop=function(){this.clearTracks(),this.hlsjs&&(this.eventsOff_(),this.hlsjs.stopLoad()),this.pause(),this.setState(K.mb)},a.seek=function(b){var a=this.getDuration();if(a&&a!==1/0&&!Object(h.u)(a)){this.stopStaleTimeout(),this.stopConnectionTimeout();var c=b>=0?b:b+this.video.duration,d=this.getSeekRange();"DVR"===this.streamType&&null!==this.dvrEnd&&(this.dvrPosition=c-this.dvrEnd,b<0&&(c+=Math.min(12,(Object(L.a)()-this.dvrUpdatedTime)/1e3))),this.seeking=!0;var e=this.video.currentTime;this.trigger(K.Q,{position:this.getCurrentTime(),offset:c,duration:a,currentTime:e,seekRange:d,metadata:{currentTime:e}}),this.video.currentTime=c;var f=this.video.currentTime,g={position:this.getCurrentTime(),duration:a,currentTime:f,seekRange:d,metadata:{currentTime:f}};this.trigger("time",g)}},a.getCurrentQuality=function(){var a=0;return this.hlsjs&&!this.hlsjs.autoLevelEnabled&&(a=r(this.hlsjs.manualLevel,this.jwLevels)),a},a.getQualityLevels=function(){return Object(h.A)(this.jwLevels,function(a){return Object(G.a)(a)})},a.getCurrentAudioTrack=function(){return Object(h.v)(this.currentAudioTrackIndex)?this.currentAudioTrackIndex:-1},a.getAudioTracks=function(){return this.audioTracks||[]},a.getCurrentTime=function(){return this.live&&"DVR"===this.streamType?(this.dvrPosition||this.updateDvrPosition(this.getSeekRange()),this.dvrPosition):this.video.currentTime},a.getDuration=function(){if(this.live&&this.currentJwItem){var a=this.levelDuration,b=this.currentJwItem.minDvrWindow;return Object(I.a)(a,b)?(this.streamType="DVR",-a):(this.streamType="LIVE",1/0)}return this.streamType="VOD",this.video.duration},a.getCurrentHlsjsLevel=function(){var b=0,a=this.hlsjs;return a&&(b=a.streamController.loadedmetadata?a.currentLevel:a.firstLevel),b},a.getName=function(){return V()},a.getPlaybackRate=function(){return this.video.playbackRate},a.getSeekRange=function(){var e=this.levelDuration,b=this.video,a=b.seekable,c=b.duration,d=a.length?Math.max(a.end(0),a.end(a.length-1)):c;return Object(h.u)(c)?{start:0,end:0}:{start:Math.max(0,d-e),end:d}},a.getBandwidthEstimate=function(){var a=this.hlsjs;return a?a.bandwidthEstimate:null},a.getLiveLatency=function(){var a=null;if(this.live&&null!==this.liveEdgePosition){var c=Object(L.a)();a=this.liveEdgePosition+(c-this.liveEdgeUpdated)/1e3-this.video.currentTime;var d=this.lastProgramDateTime;if(d){var b=c/1e3-(d/1e3+(this.video.currentTime-this.programDateSyncTime))-a;b>0&&b<10&&(a+=b)}}return a},a.getTargetLatency=function(){return this.hlsjs&&this.hlsjs.targetLatency||null},a.setCurrentQuality=function(a){if(!(a<0)){var b,c,d,e=(b=a,c=this.jwLevels,d=-1,b> -1&&c[b]&&(d=c[b].hlsjsIndex),d);this.hlsjs.nextLevel=e,this.trigger(K.J,{levels:this.jwLevels,currentQuality:a}),this.bitrateSelection=this.jwLevels[a].bitrate}},a.setCurrentAudioTrack=function(a){var d=this.getCurrentHlsjsLevel(),e=this.hlsjs.levels[d],f=r(d,this.jwLevels);if(this.jwLevels&&this.jwLevels[f]&&Object(h.v)(a)&&this.audioTracksMap&&Object(h.F)(this.audioTracksMap)&&e){var g=p(e),b=this.audioTracks=this.audioTracksMap[g];if(b&&Object(h.F)(b)&&b[a]&&this.currentAudioTrackIndex!==a){this.trigger(K.g,{tracks:b,currentTrack:a});var c=(b=this.audioTracks)[a];null!==this.currentAudioTrackIndex&&c.hlsjsIndex!==this.hlsjs.audioTrack&&(this.trigger(K.h,{tracks:b,currentTrack:a}),c=this.audioTracks[a]),this.currentAudioTrackIndex=a,c.hlsjsIndex!==this.hlsjs.audioTrack&&(this.hlsjs.audioTrack=c.hlsjsIndex)}}},a.updateAudioTrack=function(c){if(this.hlsjs&&this.hlsjs.audioTracks.length){var a,b=this.currentAudioTrackIndex;if(Object(h.v)(b))this.audioTracks&&this.audioTracks[b].hlsjsIndex===this.hlsjs.audioTrack||(this.currentAudioTrackIndex=null);else{var d=p(c);b=this.audioTracksMap?(void 0===(a=this.audioTracksMap[d])&&(a=[]),Math.max(Object(h.p)(a,Object(h.l)(a,function(a){return a.defaulttrack})),0)):0}this.setCurrentAudioTrack(b)}},a.updateDvrPosition=function(a){this.dvrPosition=this.video.currentTime-a.end,this.dvrEnd=a.end,this.dvrUpdatedTime=Object(L.a)()},a.setCurrentSubtitleTrack=function(a){this.hlsjs.subtitleTrack=a},a.setPlaybackRate=function(a){this.video.playbackRate=this.video.defaultPlaybackRate=a},a.isLive=function(){return this.live},a.checkAdaptation=function(d){var l=this,e=this.hlsjs,f=e.levels,b=e.autoLevelEnabled,a=f[d];if(a){var g=a.width,c=a.height,h=a.bitrate;if(g=g||this.video.videoWidth,(c=c||this.video.videoHeight)!==this.videoHeight||h!==this.streamBitrate){var k=r(d,this.jwLevels),i="api";-1!==this.streamBitrate&&this.streamBitrate||this.videoHeight?b&&(i="auto"):i="initial choice",this.videoHeight=c,this.streamBitrate=h;var m=b?"auto":"manual",n=b&&f.length>1?"auto":this.jwLevels[k].label,j=function(){l.trigger(K.U,{reason:i,mode:m,level:{bitrate:h,index:k,label:n,width:g,height:c}})};J.Browser.ie?this.once("time",j,this):j()}}},a.createVideoListeners=function(){var b=this,a={waiting:function(){b.startConnectionTimeout(),b.seeking?b.setState(K.nb):b.state===K.pb&&(b.atEdgeOfLiveStream()&&b.setPlaybackRate(1),b.stallTime=b.video.currentTime,b.setState(K.qb))}};return Object.keys(M.a).forEach(function(c){var d=M.a[c];"playing"===c?a[c]=(function(){var a=this.getCurrentHlsjsLevel();this.checkAdaptation(a),d.call(this)}).bind(b):"ended"===c?a[c]=(function(){this.videoHeight=0,this.streamBitrate=-1,d.call(this)}).bind(b):"error"!==c&&(a[c]=d.bind(b))}),a},a.createHlsjsListeners=function(){var b=this,a={};return a[af]=function(){b.recoveringMediaError&&(b.hlsjs.startLoad(),b.recoveringMediaError=!1,b.resetRecovery(),b.stopStaleTimeout(),b.stopConnectionTimeout())},a[ag]=function(){b._clearNonNativeCues()},a[ah]=function(k,e){var c=e.levels,a=b.hlsjs,f=b.bitrateSelection,j=b.jwConfig,d=-1,g=-1;if(b.currentHlsjsLevel=null,b.jwLevels=q(c,j.qualityLabels),b.capLevels&&(b.playerWidth||b.playerHeight)&&b.playerStretching){var i=s(c,b.playerWidth,b.playerHeight,e.firstLevel+1);a.levelController.firstLevel!==i&&(a.firstLevel=i),b.resize(b.playerWidth,b.playerHeight,b.playerStretching)}Object(h.z)(f)&&(g=d=function(c,d){if(!d)return -1;for(var e=Number.MAX_VALUE,f=-1,a=0;a<c.length;a++){var g=c[a];if(g.bitrate){var b=Math.abs(d-g.bitrate);if(b<=e&&(e=b,f=a),!b)break}}return f}(c,f)),a.startLevel=d,a.nextLevel=g,a.startLoad(a.config.startPosition),b.trigger(K.I,{levels:b.jwLevels,currentQuality:r(d,b.jwLevels)})},a[ai]=function(g,c){var a=c.details,d=a.endSN,e=a.live,f=a.targetduration;b.checkStaleManifest(d,e,f)},a[aj]=function(h,e){var a=e.details,c=a.live,f=a.totalduration;b.live=c,b.levelDuration=f;var d=b.getSeekRange(),g=null!==b.dvrEnd&&Math.abs(b.dvrEnd-d.end)>1;"DVR"===b.streamType&&g&&b.updateDvrPosition(d),c&&b.state===K.mb&&b.livePause()},a[ak]=function(g,e){var d=e.details,c=d.fragments,f=d.totalduration;if(b.levelDuration=f,c.length){var a=c[c.length-1];a.sn!==b.liveEdgeSn&&(b.liveEdgeUpdated=Object(L.a)(),b.liveEdgeSn=a.sn,b.liveEdgePosition=a.start+a.duration)}},a[am]=function(d,c){var a=c.level;a!==b.currentHlsjsLevel?b.setCurrentLevel(a):b.checkAdaptation(a)},a[al]=function(c,a){b.lastProgramDateTime=a.frag.programDateTime,b.programDateSyncTime=a.frag.start},a[an]=function(c,a){a.samples&&[].some.call(b.video.textTracks,function(a){return!a.inuse})&&b.setTextTracks(b.video.textTracks)},a[ao]=function(){-1!==b.connectionTimeout&&b.stopConnectionTimeout(),b.atEdgeOfLiveStream()||b.stopStaleTimeout(),b.recoveringNetworkError&&(b.resetRecovery(),b.recoveringNetworkError=!1)},a[ap]=function(d,a){if(!a.audio||!b.videoFound){var c=a.video?"video":"audio";b.videoFound=b.videoFound||"video"===c,b.trigger(K.T,{mediaType:c})}},a[aq]=function(d,a){var c=a.frag;(c.tagList||[]).forEach(function(a){var d=a[0],e=a[1];return b.processPlaylistMetadata(d,e,c)})},a[ar]=function(e,a){var c=a.frag,d=a.initPTS;b.processPlaylistMetadata("DISCONTINUITY",d,c)},this.renderNatively||(a[_]=function(c,a){b.addTextTracks(a.tracks)},a[as]=function(c,a){if(a&&a.cues&&a.cues.length){var d=!(a.cues[0]instanceof Q.a);a.cues.forEach(function(e){if(d){var c=e;(e=new Q.a(c.startTime,c.endTime,c.text)).line=c.line,e.align=c.align,e.position=c.position}b.addVTTCue({type:a.type,cue:e,track:a.track})})}}),a[at]=function(g,d){var c,a=d.audioTracks,e=b.hlsjs.levels,f=b.getCurrentHlsjsLevel();a&&a.length&&(b.audioTracksMap=(c=a,Object(h.E)(c,function(b,a,d){var c=a.groupId;return b[c]=b[c]||[],b[c].push({autoselect:a.autoselect,defaulttrack:a.default,groupid:c,language:a.lang,name:a.name,hlsjsIndex:d}),b},{})),b.jwLevels.forEach(function(a){var b=a.hlsjsIndex>0?e[a.hlsjsIndex]:null;b&&(a.audioGroupId=p(b))}),b.updateAudioTrack(e[f]))},a[au]=function(o,c){var h,d=b.hlsjs,a=$(c),e=c.type,i=a.key;if(W(c),"DVR"===b.streamType&&e===aw){var l=b.getSeekRange();b.updateDvrPosition(l)}if(232403===a.code&&b.retryCount<b.maxRetries&&/jwpsrv.com\/.*\?token=/.test(c.url)&&(a.suppressLevel=!1,a.recoverable=!0,a.fatal=!0,h=!0,b.maxRetries=1),a.suppressLevel){var m=d.levels,j=(c.context||c).level,f=m[j];if(f&&Array.isArray(f.url)&&1===f.url.length){if(d.removeLevel(j,0),!d.levels.length)return void b.handleError(a.code,c,i);a.fatal=!1,b.jwLevels=q(d.levels,b.jwConfig.qualityLabels),b.playerWidth&&b.playerHeight&&b.playerStretching&&b.resize(b.playerWidth,b.playerHeight,b.playerStretching),d.loadLevel=0,d.currentLevel=-1,b.trigger(K.I,{levels:b.jwLevels,currentQuality:0})}}if(a.fatal){var k=Object(L.a)(),n=a.recoverable&&(e===aw||e===av),g=b.retryCount;if(!(n&&g<b.maxRetries))return d.stopLoad(),void b.handleError(a.code,c,i);(!b.lastRecoveryTime||k>=b.lastRecoveryTime+b.recoveryInterval)&&(W("Attempting to recover, retry count:",g),e===aw?/^manifest/.test(c.details)||h?(b.recoverManifestError(),b.retryCount=g):d.startLoad():e===av&&(b.recoveringMediaError=!0,d.recoverMediaError()),b.recoveringNetworkError=!0,b.retryCount+=1,b.lastRecoveryTime=k)}b.trigger(K.ub,new C.q(null,a.code+1e5,c))},a},a.resize=function(d,e,f){if(this.playerWidth=d,this.playerHeight=e,this.playerStretching=f,this.capLevels){var a=this.hlsjs;if(a&&a.levels){var b=a.autoLevelCapping,c=s(a.levels,this.playerWidth,this.playerHeight);c!==b&&(a.autoLevelCapping=c,c>b&& -1!==b&&this.state!==K.mb&&this.state!==K.kb&&a.streamController.nextLevelSwitch())}}k.prototype.resize.call(this,d,e,f)},a.recoverManifestError=function(){var a=this.video,b=a.currentTime,c=a.paused;b||!c?(this.restartStream(b),c||this.play().catch(function(){})):(this.hlsjs.stopLoad(),this.hlsjs.loadSource(this.src))},a.eventsOn_=function(){var b=this.bandwidthMonitor,a=this.eventHandler;a&&a.on(),b.start()},a.eventsOff_=function(){var c=this.bandwidthMonitor,a=this.eventHandler,b=this.hlsjs;b&&a&&(this.disableTextTrack(),this.lastPosition=this.video.currentTime,b.detachMedia(),a.off()),this.off(null,null,this),c.stop(),this.resetLifecycleVariables()},a.handleError=function(a,b,c){this.resetLifecycleVariables(),this.trigger(K.G,new C.q(c,a,b))},a.destroy=function(){this.hlsjs&&(this.eventsOff_(),this.hlsjs.destroy(),this.hlsjs=null,this.hlsjsOptions=null)},a.restoreVideoProperties=function(){this.savedVideoProperties&&(this.volume(this.jwConfig.volume),this.mute(this.jwConfig.mute),this.savedVideoProperties=!1)},a.checkStaleManifest=function(a,b,d){var e=this,c=null!==this.jwConfig.liveTimeout?this.jwConfig.liveTimeout:this.staleManifestDurationMultiplier*d;b&&this.lastEndSn===a&&0!==c?-1===this.staleManifestTimeout&&(this.staleManifestTimeout=setTimeout(function(){e.checkStreamEnded()},c)):this.stopStaleTimeout(),this.lastEndSn=a,this.live=b},a.checkStreamEnded=function(){this.hlsjs&&(this.video.ended||this.atEdgeOfLiveStream())&&(this.hlsjs.stopLoad(),this.handleError(d.ERROR_LIVE_STREAM_DOWN_OR_ENDED,null,C.n))},a.setCurrentLevel=function(a){this.currentHlsjsLevel=a,this.checkAdaptation(a),this.updateAudioTrack(this.hlsjs.levels[a])},a._clearNonNativeCues=function(){var a=this;!this.renderNatively&&this._textTracks&&this._textTracks.forEach(function(b){a.clearCueData(b._id)})},c.setEdition=function(a){c.supports=Object(N.a)(a)},f=c,g=[{key:"maxBufferLength",set:function(a){this.hlsjs&&(this.hlsjs.config.maxMaxBufferLength=a)}}],R(f.prototype,g),j&&R(f,j),c}(F)}a.d(g,"a",function(){return T});var U,f,V=function(){return{name:"hlsjs"}},W=(f="warn",i.a.debug?console[f].bind(console):function(){}),X=function(a){return!(!J.OS.iOS&&!J.Browser.safari)||J.Browser.chrome&&a},Y=function(b,d,a){var c=b.sources[0];return void 0!==c[a]?c[a]:void 0!==b[a]?b[a]:d[a]}},295:function(c,b){var d,a;"undefined"!=typeof window&&(d=this,a=function(){return function(b){var c={};function a(d){if(c[d])return c[d].exports;var e=c[d]={i:d,l:!1,exports:{}};return b[d].call(e.exports,e,e.exports,a),e.l=!0,e.exports}return a.m=b,a.c=c,a.d=function(b,c,d){a.o(b,c)||Object.defineProperty(b,c,{enumerable:!0,get:d})},a.r=function(a){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},a.t=function(b,c){if(1&c&&(b=a(b)),8&c||4&c&&"object"==typeof b&&b&&b.__esModule)return b;var d=Object.create(null);if(a.r(d),Object.defineProperty(d,"default",{enumerable:!0,value:b}),2&c&&"string"!=typeof b)for(var e in b)a.d(d,e,(function(a){return b[a]}).bind(null,e));return d},a.n=function(c){var b=c&&c.__esModule?function(){return c.default}:function(){return c};return a.d(b,"a",b),b},a.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},a.p="/dist/",a(a.s="./src/hls.ts")}({"./node_modules/eventemitter3/index.js":/*!*********************************************!*\
   !*** ./node_modules/eventemitter3/index.js ***!
   \*********************************************/ /*! no static exports found */ function(d,e,f){"use strict";var g=Object.prototype.hasOwnProperty,b="~";function c(){}function h(a,b,c){this.fn=a,this.context=b,this.once=c||!1}function i(a,e,f,g,i){if("function"!=typeof f)throw new TypeError("The listener must be a function");var d=new h(f,g||a,i),c=b?b+e:e;return a._events[c]?a._events[c].fn?a._events[c]=[a._events[c],d]:a._events[c].push(d):(a._events[c]=d,a._eventsCount++),a}function j(a,b){0== --a._eventsCount?a._events=new c:delete a._events[b]}function a(){this._events=new c,this._eventsCount=0}Object.create&&(c.prototype=Object.create(null),(new c).__proto__||(b=!1)),a.prototype.eventNames=function(){var d,a,c=[];if(0===this._eventsCount)return c;for(a in d=this._events)g.call(d,a)&&c.push(b?a.slice(1):a);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(d)):c},a.prototype.listeners=function(d){var a=this._events[b?b+d:d];if(!a)return[];if(a.fn)return[a.fn];for(var c=0,e=a.length,f=new Array(e);c<e;c++)f[c]=a[c].fn;return f},a.prototype.listenerCount=function(c){var a=this._events[b?b+c:c];return a?a.fn?1:a.length:0},a.prototype.emit=function(i,d,f,j,k,m){var l=b?b+i:i;if(!this._events[l])return!1;var e,c,a=this._events[l],g=arguments.length;if(a.fn){switch(a.once&&this.removeListener(i,a.fn,void 0,!0),g){case 1:return a.fn.call(a.context),!0;case 2:return a.fn.call(a.context,d),!0;case 3:return a.fn.call(a.context,d,f),!0;case 4:return a.fn.call(a.context,d,f,j),!0;case 5:return a.fn.call(a.context,d,f,j,k),!0;case 6:return a.fn.call(a.context,d,f,j,k,m),!0}for(c=1,e=new Array(g-1);c<g;c++)e[c-1]=arguments[c];a.fn.apply(a.context,e)}else{var h,n=a.length;for(c=0;c<n;c++)switch(a[c].once&&this.removeListener(i,a[c].fn,void 0,!0),g){case 1:a[c].fn.call(a[c].context);break;case 2:a[c].fn.call(a[c].context,d);break;case 3:a[c].fn.call(a[c].context,d,f);break;case 4:a[c].fn.call(a[c].context,d,f,j);break;default:if(!e)for(h=1,e=new Array(g-1);h<g;h++)e[h-1]=arguments[h];a[c].fn.apply(a[c].context,e)}}return!0},a.prototype.on=function(a,b,c){return i(this,a,b,c,!1)},a.prototype.once=function(a,b,c){return i(this,a,b,c,!0)},a.prototype.removeListener=function(h,g,f,i){var c=b?b+h:h;if(!this._events[c])return this;if(!g)return j(this,c),this;var a=this._events[c];if(a.fn)a.fn!==g||i&&!a.once||f&&a.context!==f||j(this,c);else{for(var d=0,e=[],k=a.length;d<k;d++)(a[d].fn!==g||i&&!a[d].once||f&&a[d].context!==f)&&e.push(a[d]);e.length?this._events[c]=1===e.length?e[0]:e:j(this,c)}return this},a.prototype.removeAllListeners=function(a){var d;return a?(d=b?b+a:a,this._events[d]&&j(this,d)):(this._events=new c,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=b,a.EventEmitter=a,d.exports=a},"./node_modules/url-toolkit/src/url-toolkit.js":/*!*****************************************************!*\
   !*** ./node_modules/url-toolkit/src/url-toolkit.js ***!
   \*****************************************************/ /*! no static exports found */ function(b,g,h){var c,d,e,f,a;c=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/?#]*\/)*[^;?#]*)?(;[^?#]*)?(\?[^#]*)?(#[^]*)?$/,d=/^([^\/?#]*)([^]*)$/,e=/(?:\/|^)\.(?=\/)/g,f=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,a={buildAbsoluteURL:function(f,h,g){if(g=g||{},f=f.trim(),!(h=h.trim())){if(!g.alwaysNormalize)return f;var i=a.parseURL(f);if(!i)throw new Error("Error trying to parse base URL.");return i.path=a.normalizePath(i.path),a.buildURLFromParts(i)}var b=a.parseURL(h);if(!b)throw new Error("Error trying to parse relative URL.");if(b.scheme)return g.alwaysNormalize?(b.path=a.normalizePath(b.path),a.buildURLFromParts(b)):h;var c=a.parseURL(f);if(!c)throw new Error("Error trying to parse base URL.");if(!c.netLoc&&c.path&&"/"!==c.path[0]){var j=d.exec(c.path);c.netLoc=j[1],c.path=j[2]}c.netLoc&&!c.path&&(c.path="/");var e={scheme:c.scheme,netLoc:b.netLoc,path:null,params:b.params,query:b.query,fragment:b.fragment};if(!b.netLoc&&(e.netLoc=c.netLoc,"/"!==b.path[0])){if(b.path){var k=c.path,l=k.substring(0,k.lastIndexOf("/")+1)+b.path;e.path=a.normalizePath(l)}else e.path=c.path,b.params||(e.params=c.params,b.query||(e.query=c.query))}return null===e.path&&(e.path=g.alwaysNormalize?a.normalizePath(b.path):b.path),a.buildURLFromParts(e)},parseURL:function(b){var a=c.exec(b);return a?{scheme:a[1]||"",netLoc:a[2]||"",path:a[3]||"",params:a[4]||"",query:a[5]||"",fragment:a[6]||""}:null},normalizePath:function(a){for(a=a.split("").reverse().join("").replace(e,"");a.length!==(a=a.replace(f,"")).length;);return a.split("").reverse().join("")},buildURLFromParts:function(a){return a.scheme+a.netLoc+a.path+a.params+a.query+a.fragment}},b.exports=a},"./node_modules/webworkify-webpack/index.js":/*!**************************************************!*\
   !*** ./node_modules/webworkify-webpack/index.js ***!
   \**************************************************/ /*! no static exports found */ function(a,b,c){function d(c){var d={};function a(b){if(d[b])return d[b].exports;var e=d[b]={i:b,l:!1,exports:{}};return c[b].call(e.exports,e,e.exports,a),e.l=!0,e.exports}a.m=c,a.c=d,a.i=function(a){return a},a.d=function(b,c,d){a.o(b,c)||Object.defineProperty(b,c,{configurable:!1,enumerable:!0,get:d})},a.r=function(a){Object.defineProperty(a,"__esModule",{value:!0})},a.n=function(c){var b=c&&c.__esModule?function(){return c.default}:function(){return c};return a.d(b,"a",b),b},a.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},a.p="/",a.oe=function(a){throw console.error(a),a};var b=a(a.s=ENTRY_MODULE);return b.default||b}function e(a){return(a+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function f(k,n,h){var a={};a[h]=[];var i=n.toString(),l=i.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!l)return a;for(var b,m=l[1],j=new RegExp("(\\\\n|\\W)"+e(m)+"\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)","g");b=j.exec(i);)"dll-reference"!==b[3]&&a[h].push(b[3]);for(j=new RegExp("\\("+e(m)+'\\("(dll-reference\\s([\\.|\\-|\\+|\\w|/|@]+))"\\)\\)\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)',"g");b=j.exec(i);)k[b[2]]||(a[h].push(b[1]),k[b[2]]=c(b[1]).m),a[b[2]]=a[b[2]]||[],a[b[2]].push(b[4]);for(var f=Object.keys(a),d=0;d<f.length;d++)for(var g=0;g<a[f[d]].length;g++)isNaN(1*a[f[d]][g])||(a[f[d]][g]=1*a[f[d]][g]);return a}function g(a){return Object.keys(a).reduce(function(b,c){return b||a[c].length>0},!1)}a.exports=function(e,a){a=a||{};var h={main:c.m},i=a.all?{main:Object.keys(h.main)}:function(j,n){for(var b={main:[n]},h={main:[]},i={main:{}};g(b);)for(var l=Object.keys(b),k=0;k<l.length;k++){var a=l[k],e=b[a].pop();if(i[a]=i[a]||{},!i[a][e]&&j[a][e]){i[a][e]=!0,h[a]=h[a]||[],h[a].push(e);for(var m=f(j,j[a][e],a),d=Object.keys(m),c=0;c<d.length;c++)b[d[c]]=b[d[c]]||[],b[d[c]]=b[d[c]].concat(m[d[c]])}}return h}(h,e),b="";Object.keys(i).filter(function(a){return"main"!==a}).forEach(function(a){for(var c=0;i[a][c];)c++;i[a].push(c),h[a][c]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",b=b+"var "+a+" = ("+d.toString().replace("ENTRY_MODULE",JSON.stringify(c))+")({"+i[a].map(function(b){return JSON.stringify(b)+": "+h[a][b].toString()}).join(",")+"});\n"}),b=b+"new (("+d.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+i.main.map(function(a){return JSON.stringify(a)+": "+h.main[a].toString()}).join(",")+"}))(self);";var j=new window.Blob([b],{type:"text/javascript"});if(a.bare)return j;var k=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(j),l=new window.Worker(k);return l.objectURL=k,l}},"./src/config.ts":/*!***********************!*\
   !*** ./src/config.ts ***!
   \***********************/ /*! exports provided: hlsDefaultConfig, mergeConfig, enableStreamingMode */ function(q,b,a){"use strict";a.r(b),a.d(b,"hlsDefaultConfig",function(){return w}),a.d(b,"mergeConfig",function(){return x}),a.d(b,"enableStreamingMode",function(){return y});var d=a(/*! ./controller/abr-controller */ "./src/controller/abr-controller.ts"),e=a(/*! ./controller/audio-stream-controller */ "./src/controller/audio-stream-controller.ts"),f=a(/*! ./controller/audio-track-controller */ "./src/controller/audio-track-controller.ts"),g=a(/*! ./controller/subtitle-stream-controller */ "./src/controller/subtitle-stream-controller.ts"),h=a(/*! ./controller/subtitle-track-controller */ "./src/controller/subtitle-track-controller.ts"),i=a(/*! ./controller/buffer-controller */ "./src/controller/buffer-controller.ts"),j=a(/*! ./controller/timeline-controller */ "./src/controller/timeline-controller.ts"),k=a(/*! ./controller/cap-level-controller */ "./src/controller/cap-level-controller.ts"),l=a(/*! ./controller/fps-controller */ "./src/controller/fps-controller.ts"),m=a(/*! ./controller/eme-controller */ "./src/controller/eme-controller.ts"),n=a(/*! ./utils/xhr-loader */ "./src/utils/xhr-loader.ts"),r=a(/*! ./utils/fetch-loader */ "./src/utils/fetch-loader.ts"),o=a(/*! ./utils/cues */ "./src/utils/cues.ts"),p=a(/*! ./utils/mediakeys-helper */ "./src/utils/mediakeys-helper.ts"),s=a(/*! ./utils/logger */ "./src/utils/logger.ts");function t(){return(t=Object.assign||function(d){for(var a=1;a<arguments.length;a++){var b=arguments[a];for(var c in b)Object.prototype.hasOwnProperty.call(b,c)&&(d[c]=b[c])}return d}).apply(this,arguments)}function u(c,d){var a=Object.keys(c);if(Object.getOwnPropertySymbols){var b=Object.getOwnPropertySymbols(c);d&&(b=b.filter(function(a){return Object.getOwnPropertyDescriptor(c,a).enumerable})),a.push.apply(a,b)}return a}function c(c){for(var a=1;a<arguments.length;a++){var b=null!=arguments[a]?arguments[a]:{};a%2?u(Object(b),!0).forEach(function(a){v(c,a,b[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(c,Object.getOwnPropertyDescriptors(b)):u(Object(b)).forEach(function(a){Object.defineProperty(c,a,Object.getOwnPropertyDescriptor(b,a))})}return c}function v(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}var w=c(c({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:n.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:d.default,bufferController:i.default,capLevelController:k.default,fpsController:l.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:p.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0},{cueHandler:o.default,enableCEA708Captions:!0,enableWebVTT:!0,enableIMSC1:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:g.SubtitleStreamController,subtitleTrackController:h.default,timelineController:j.TimelineController,audioStreamController:e.default,audioTrackController:f.default,emeController:m.default});function x(b,a){if((a.liveSyncDurationCount||a.liveMaxLatencyDurationCount)&&(a.liveSyncDuration||a.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==a.liveMaxLatencyDurationCount&&(void 0===a.liveSyncDurationCount||a.liveMaxLatencyDurationCount<=a.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==a.liveMaxLatencyDuration&&(void 0===a.liveSyncDuration||a.liveMaxLatencyDuration<=a.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return t({},b,a)}function y(a){var b=a.loader;b!==r.default&&b!==n.default?(s.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),a.progressive=!1):Object(r.fetchSupported)()&&(a.loader=r.default,a.progressive=!0,a.enableSoftwareAES=!0,s.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}},"./src/controller/abr-controller.ts":/*!******************************************!*\
   !*** ./src/controller/abr-controller.ts ***!
   \******************************************/ /*! exports provided: default */ function(d,b,a){"use strict";a.r(b);var e=a(/*! ./src/polyfills/number */ "./src/polyfills/number.ts"),f=a(/*! ../utils/ewma-bandwidth-estimator */ "./src/utils/ewma-bandwidth-estimator.ts"),g=a(/*! ../events */ "./src/events.ts"),h=a(/*! ../utils/buffer-helper */ "./src/utils/buffer-helper.ts"),i=a(/*! ../errors */ "./src/errors.ts"),j=a(/*! ../types/loader */ "./src/types/loader.ts"),k=a(/*! ../utils/logger */ "./src/utils/logger.ts");function l(d,c){for(var b=0;b<c.length;b++){var a=c[b];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(d,a.key,a)}}var c=function(){function b(b){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=b;var a=b.config;this.bwEstimator=new f.default(a.abrEwmaSlowVoD,a.abrEwmaFastVoD,a.abrEwmaDefaultEstimate),this.registerListeners()}var c,d,m,a=b.prototype;return a.registerListeners=function(){var a=this.hls;a.on(g.Events.FRAG_LOADING,this.onFragLoading,this),a.on(g.Events.FRAG_LOADED,this.onFragLoaded,this),a.on(g.Events.FRAG_BUFFERED,this.onFragBuffered,this),a.on(g.Events.LEVEL_LOADED,this.onLevelLoaded,this),a.on(g.Events.ERROR,this.onError,this)},a.unregisterListeners=function(){var a=this.hls;a.off(g.Events.FRAG_LOADING,this.onFragLoading,this),a.off(g.Events.FRAG_LOADED,this.onFragLoaded,this),a.off(g.Events.FRAG_BUFFERED,this.onFragBuffered,this),a.off(g.Events.LEVEL_LOADED,this.onLevelLoaded,this),a.off(g.Events.ERROR,this.onError,this)},a.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},a.onFragLoading=function(d,a){var b,c=a.frag;c.type===j.PlaylistLevelType.MAIN&&(this.timer||(this.fragCurrent=c,this.partCurrent=null!=(b=a.part)?b:null,this.timer=self.setInterval(this.onCheck,100)))},a.onLevelLoaded=function(c,b){var a=this.hls.config;b.details.live?this.bwEstimator.update(a.abrEwmaSlowLive,a.abrEwmaFastLive):this.bwEstimator.update(a.abrEwmaSlowVoD,a.abrEwmaFastVoD)},a._abandonRulesCheck=function(){var a=this.fragCurrent,c=this.partCurrent,d=this.hls,u=d.autoLevelEnabled,v=d.config,f=d.media;if(a&&f){var b=c?c.stats:a.stats,j=c?c.duration:a.duration;if(b.aborted)return k.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);if(u&&!f.paused&&f.playbackRate&&f.readyState){var m=performance.now()-b.loading.start,n=Math.abs(f.playbackRate);if(!(m<=500*j/n)){var q=d.levels,w=d.minAutoLevel,x=q[a.level],y=b.total||Math.max(b.loaded,Math.round(j*x.maxBitrate/8)),r=Math.max(1,b.bwEstimate?b.bwEstimate/8:1e3*b.loaded/m),o=(y-b.loaded)/r,s=f.currentTime,l=(h.BufferHelper.bufferInfo(f,s,v.maxBufferHole).end-s)/n;if(!(l>=2*j/n||o<=l)){var i,p=Number.POSITIVE_INFINITY;for(i=a.level-1;i>w&&!((p=j*q[i].maxBitrate/(6.4*r))<l);i--);if(!(p>=o)){var t=this.bwEstimator.getEstimate();k.logger.warn("Fragment "+a.sn+(c?" part "+c.index:"")+" of level "+a.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+i+"\n      Current BW estimate: "+(Object(e.isFiniteNumber)(t)?(t/1024).toFixed(3):"Unknown")+" Kb/s\n      Estimated load time for current fragment: "+o.toFixed(3)+" s\n      Estimated load time for the next fragment: "+p.toFixed(3)+" s\n      Time to underbuffer: "+l.toFixed(3)+" s"),d.nextLoadLevel=i,this.bwEstimator.sample(m,b.loaded),this.clearTimer(),a.loader&&(this.fragCurrent=this.partCurrent=null,a.loader.abort()),d.trigger(g.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:a,part:c,stats:b})}}}}}},a.onFragLoaded=function(m,d){var a=d.frag,c=d.part;if(a.type===j.PlaylistLevelType.MAIN&&Object(e.isFiniteNumber)(a.sn)){var f=c?c.stats:a.stats,k=c?c.duration:a.duration;if(this.clearTimer(),this.lastLoadedFragLevel=a.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var b=this.hls.levels[a.level],h=(b.loaded?b.loaded.bytes:0)+f.loaded,i=(b.loaded?b.loaded.duration:0)+k;b.loaded={bytes:h,duration:i},b.realBitrate=Math.round(8*h/i)}if(a.bitrateTest){var l={stats:f,frag:a,part:c,id:a.type};this.onFragBuffered(g.Events.FRAG_BUFFERED,l),a.bitrateTest=!1}}},a.onFragBuffered=function(f,c){var b=c.frag,d=c.part,a=d?d.stats:b.stats;if(!a.aborted&&b.type===j.PlaylistLevelType.MAIN&&"initSegment"!==b.sn){var e=a.parsing.end-a.loading.start;this.bwEstimator.sample(e,a.loaded),a.bwEstimate=this.bwEstimator.getEstimate(),b.bitrateTest?this.bitrateTestDelay=e/1e3:this.bitrateTestDelay=0}},a.onError=function(b,a){switch(a.details){case i.ErrorDetails.FRAG_LOAD_ERROR:case i.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}},a.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},a.getNextABRAutoLevel=function(){var j=this.fragCurrent,l=this.partCurrent,c=this.hls,m=c.maxAutoLevel,a=c.config,n=c.minAutoLevel,b=c.media,d=l?l.duration:j?j.duration:0,o=b?b.currentTime:0,s=b&&0!==b.playbackRate?Math.abs(b.playbackRate):1,p=this.bwEstimator?this.bwEstimator.getEstimate():a.abrEwmaDefaultEstimate,e=(h.BufferHelper.bufferInfo(b,o,a.maxBufferHole).end-o)/s,f=this.findBestLevel(p,n,m,e,a.abrBandWidthFactor,a.abrBandWidthUpFactor);if(f>=0)return f;k.logger.trace((e?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var g=d?Math.min(d,a.maxStarvationDelay):a.maxStarvationDelay,q=a.abrBandWidthFactor,r=a.abrBandWidthUpFactor;if(!e){var i=this.bitrateTestDelay;i&&(g=(d?Math.min(d,a.maxLoadingDelay):a.maxLoadingDelay)-i,k.logger.trace("bitrate test took "+Math.round(1e3*i)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*g)+" ms"),q=r=1)}return Math.max(f=this.findBestLevel(p,n,m,e+g,q,r),0)},a.findBestLevel=function(l,r,s,m,t,u){for(var e,n=this.fragCurrent,f=this.partCurrent,o=this.lastLoadedFragLevel,g=this.hls.levels,b=g[o],v=!(null==b||null===(e=b.details)|| void 0===e||!e.live),p=null==b?void 0:b.codecSet,w=f?f.duration:n?n.duration:0,a=s;a>=r;a--){var h=g[a];if(h&&(!p||h.codecSet===p)){var c=h.details,q=(f?null==c?void 0:c.partTarget:null==c?void 0:c.averagetargetduration)||w,d=void 0;d=a<=o?t*l:u*l;var i=g[a].maxBitrate,j=i*q/d;if(k.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+a+"/"+Math.round(d)+"/"+i+"/"+q+"/"+m+"/"+j),d>i&&(!j||v&&!this.bitrateTestDelay||j<m))return a}}return -1},c=b,d=[{key:"nextAutoLevel",get:function(){var a=this._nextAutoLevel,c=this.bwEstimator;if(!(-1===a||c&&c.canEstimate()))return a;var b=this.getNextABRAutoLevel();return -1!==a&&(b=Math.min(a,b)),b},set:function(a){this._nextAutoLevel=a}}],l(c.prototype,d),m&&l(c,m),b}();b.default=c},"./src/controller/audio-stream-controller.ts":/*!***************************************************!*\
   !*** ./src/controller/audio-stream-controller.ts ***!
   \***************************************************/ /*! exports provided: default */ function(e,b,a){"use strict";a.r(b);var f=a(/*! ./src/polyfills/number */ "./src/polyfills/number.ts"),c=a(/*! ./base-stream-controller */ "./src/controller/base-stream-controller.ts"),g=a(/*! ../events */ "./src/events.ts"),h=a(/*! ../utils/buffer-helper */ "./src/utils/buffer-helper.ts"),i=a(/*! ./fragment-tracker */ "./src/controller/fragment-tracker.ts"),j=a(/*! ../types/level */ "./src/types/level.ts"),k=a(/*! ../types/loader */ "./src/types/loader.ts"),l=a(/*! ../loader/fragment */ "./src/loader/fragment.ts"),m=a(/*! ../demux/chunk-cache */ "./src/demux/chunk-cache.ts"),n=a(/*! ../demux/transmuxer-interface */ "./src/demux/transmuxer-interface.ts"),o=a(/*! ../types/transmuxer */ "./src/types/transmuxer.ts"),p=a(/*! ./fragment-finders */ "./src/controller/fragment-finders.ts"),q=a(/*! ../utils/discontinuities */ "./src/utils/discontinuities.ts"),r=a(/*! ../errors */ "./src/errors.ts"),s=a(/*! ../utils/logger */ "./src/utils/logger.ts");function t(){return(t=Object.assign||function(d){for(var a=1;a<arguments.length;a++){var b=arguments[a];for(var c in b)Object.prototype.hasOwnProperty.call(b,c)&&(d[c]=b[c])}return d}).apply(this,arguments)}function u(a,b){return(u=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a})(a,b)}var d=function(d){function b(b,c){var a;return(a=d.call(this,b,c,"[audio-stream-controller]")||this).videoBuffer=null,a.videoTrackCC=-1,a.waitingVideoCC=-1,a.audioSwitch=!1,a.trackId=-1,a.waitingData=null,a.mainDetails=null,a.bufferFlushed=!1,a._registerListeners(),a}v=d,(e=b).prototype=Object.create(v.prototype),e.prototype.constructor=e,u(e,v);var e,v,a=b.prototype;return a.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},a._registerListeners=function(){var a=this.hls;a.on(g.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.on(g.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.on(g.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.on(g.Events.LEVEL_LOADED,this.onLevelLoaded,this),a.on(g.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),a.on(g.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),a.on(g.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),a.on(g.Events.ERROR,this.onError,this),a.on(g.Events.BUFFER_RESET,this.onBufferReset,this),a.on(g.Events.BUFFER_CREATED,this.onBufferCreated,this),a.on(g.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),a.on(g.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),a.on(g.Events.FRAG_BUFFERED,this.onFragBuffered,this)},a._unregisterListeners=function(){var a=this.hls;a.off(g.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.off(g.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.off(g.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.off(g.Events.LEVEL_LOADED,this.onLevelLoaded,this),a.off(g.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),a.off(g.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),a.off(g.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),a.off(g.Events.ERROR,this.onError,this),a.off(g.Events.BUFFER_RESET,this.onBufferReset,this),a.off(g.Events.BUFFER_CREATED,this.onBufferCreated,this),a.off(g.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),a.off(g.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),a.off(g.Events.FRAG_BUFFERED,this.onFragBuffered,this)},a.onInitPtsFound=function(g,a){var b=a.frag,f=a.id,d=a.initPTS;if("main"===f){var e=b.cc;this.initPTS[b.cc]=d,this.log("InitPTS for cc: "+e+" found from main: "+d),this.videoTrackCC=e,this.state===c.State.WAITING_INIT_PTS&&this.tick()}},a.startLoad=function(a){if(!this.levels)return this.startPosition=a,void(this.state=c.State.STOPPED);var b=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),this.fragLoadError=0,b>0&& -1===a?(this.log("Override startPosition with lastCurrentTime @"+b.toFixed(3)),this.state=c.State.IDLE):(this.loadedmetadata=!1,this.state=c.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=a,this.tick()},a.doTick=function(){switch(this.state){case c.State.IDLE:this.doTickIdle();break;case c.State.WAITING_TRACK:var e,g=this.levels,m=this.trackId,i=null==g||null===(e=g[m])|| void 0===e?void 0:e.details;if(i){if(this.waitForCdnTuneIn(i))break;this.state=c.State.WAITING_INIT_PTS}break;case c.State.FRAG_LOADING_WAITING_RETRY:var f,n=performance.now(),j=this.retryDate;(!j||n>=j||null!==(f=this.media)&& void 0!==f&&f.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.state=c.State.IDLE);break;case c.State.WAITING_INIT_PTS:var b=this.waitingData;if(b){var a=b.frag,o=b.part,q=b.cache,r=b.complete;if(void 0!==this.initPTS[a.cc]){this.waitingData=null,this.waitingVideoCC=-1,this.state=c.State.FRAG_LOADING;var k={frag:a,part:o,payload:q.flush(),networkDetails:null};this._handleFragmentLoadProgress(k),r&&d.prototype._handleFragmentLoadComplete.call(this,k)}else if(this.videoTrackCC!==this.waitingVideoCC)s.logger.log("Waiting fragment cc ("+a.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var t=this.getLoadPosition(),l=h.BufferHelper.bufferInfo(this.mediaBuffer,t,this.config.maxBufferHole);0>Object(p.fragmentWithinToleranceTest)(l.end,this.config.maxFragLookUpTolerance,a)&&(s.logger.log("Waiting fragment cc ("+a.cc+") @ "+a.start+" cancelled because another fragment at "+l.end+" is needed"),this.clearWaitingFragment())}}else this.state=c.State.IDLE}this.onTickEnd()},a.clearWaitingFragment=function(){var a=this.waitingData;a&&(this.fragmentTracker.removeFragment(a.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=c.State.IDLE)},a.onTickEnd=function(){var a=this.media;if(a&&a.readyState){var b=(this.mediaBuffer?this.mediaBuffer:a).buffered;!this.loadedmetadata&&b.length&&(this.loadedmetadata=!0),this.lastCurrentTime=a.currentTime}},a.doTickIdle=function(){var e,f,o=this.hls,h=this.levels,p=this.media,i=this.trackId,r=o.config;if(h&&h[i]&&(p|| !this.startFragRequested&&r.startFragPrefetch)){var a=h[i].details;if(!a||a.live&&this.levelLastLoaded!==i||this.waitForCdnTuneIn(a))this.state=c.State.WAITING_TRACK;else{this.bufferFlushed&&(this.bufferFlushed=!1,this.afterBufferFlushed(this.mediaBuffer?this.mediaBuffer:this.media,l.ElementaryStreamTypes.AUDIO,k.PlaylistLevelType.AUDIO));var b=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,k.PlaylistLevelType.AUDIO);if(null!==b){var s=b.len,t=this.getMaxBufferLength(),j=this.audioSwitch;if(!(s>=t)||j){if(!j&&this._streamEnded(b,a))return o.trigger(g.Events.BUFFER_EOS,{type:"audio"}),void(this.state=c.State.ENDED);var m=a.fragments[0].start,n=b.end;if(j){var q=this.getLoadPosition();n=q,a.PTSKnown&&q<m&&(b.end>m||b.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),p.currentTime=m+.05)}var d=this.getNextFragment(n,a);d?"identity"!==(null===(e=d.decryptdata)|| void 0===e?void 0:e.keyFormat)||null!==(f=d.decryptdata)&& void 0!==f&&f.key?this.loadFragment(d,a,n):this.loadKey(d,a):this.bufferFlushed=!0}}}}},a.getMaxBufferLength=function(){var a=d.prototype.getMaxBufferLength.call(this),b=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,k.PlaylistLevelType.MAIN);return null===b?a:Math.max(a,b.len)},a.onMediaDetaching=function(){this.videoBuffer=null,d.prototype.onMediaDetaching.call(this)},a.onAudioTracksUpdated=function(c,a){var b=a.audioTracks;this.resetTransmuxer(),this.levels=b.map(function(a){return new j.Level(a)})},a.onAudioTrackSwitching=function(e,b){var d=!!b.url;this.trackId=b.id;var a=this.fragCurrent;null!=a&&a.loader&&a.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),d?this.setInterval(100):this.resetTransmuxer(),d?(this.audioSwitch=!0,this.state=c.State.IDLE):this.state=c.State.STOPPED,this.tick()},a.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},a.onLevelLoaded=function(b,a){this.mainDetails=a.details},a.onAudioTrackLoaded=function(j,h){var e,i=this.levels,a=h.details,d=h.id;if(i){this.log("Track "+d+" loaded ["+a.startSN+","+a.endSN+"],duration:"+a.totalduration);var b=i[d],f=0;if(a.live||null!==(e=b.details)&& void 0!==e&&e.live){var g=this.mainDetails;if(a.fragments[0]||(a.deltaUpdateFailed=!0),a.deltaUpdateFailed||!g)return;!b.details&&a.hasProgramDateTime&&g.hasProgramDateTime?(Object(q.alignPDT)(a,g),f=a.fragments[0].start):f=this.alignPlaylists(a,b.details)}b.details=a,this.levelLastLoaded=d,this.startFragRequested|| !this.mainDetails&&a.live||this.setStartPosition(b.details,f),this.state!==c.State.WAITING_TRACK||this.waitForCdnTuneIn(a)||(this.state=c.State.IDLE),this.tick()}else this.warn("Audio tracks were reset while loading level "+d)},a._handleFragmentLoadProgress=function(e){var f,a=e.frag,b=e.part,g=e.payload,r=this.config,j=this.trackId,l=this.levels;if(l){var h=l[j];console.assert(h,"Audio track is defined on fragment load progress");var d=h.details;console.assert(d,"Audio track details are defined on fragment load progress");var t=r.defaultAudioCodec||h.audioCodec||"mp4a.40.2",i=this.transmuxer;i||(i=this.transmuxer=new n.default(this.hls,k.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var p=this.initPTS[a.cc],u=null===(f=a.initSegment)|| void 0===f?void 0:f.data;if(void 0!==p){var q=b?b.index:-1,v=-1!==q,w=new o.ChunkMetadata(a.level,a.sn,a.stats.chunkCount,g.byteLength,q,v);i.push(g,u,t,"",a,b,d.totalduration,!1,w,p)}else s.logger.log("Unknown video PTS for cc "+a.cc+", waiting for video PTS before demuxing audio frag "+a.sn+" of ["+d.startSN+" ,"+d.endSN+"],track "+j),(this.waitingData=this.waitingData||{frag:a,part:b,cache:new m.default,complete:!1}).cache.push(new Uint8Array(g)),this.waitingVideoCC=this.videoTrackCC,this.state=c.State.WAITING_INIT_PTS}else this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+a.sn+" of level "+a.level+" will not be buffered")},a._handleFragmentLoadComplete=function(a){this.waitingData?this.waitingData.complete=!0:d.prototype._handleFragmentLoadComplete.call(this,a)},a.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},a.onBufferCreated=function(c,a){var b=a.tracks.audio;b&&(this.mediaBuffer=b.buffer),a.tracks.video&&(this.videoBuffer=a.tracks.video.buffer)},a.onFragBuffered=function(d,c){var a=c.frag,b=c.part;a.type===k.PlaylistLevelType.AUDIO&&(this.fragContextChanged(a)?this.warn("Fragment "+a.sn+(b?" p: "+b.index:"")+" of level "+a.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch):("initSegment"!==a.sn&&(this.fragPrevious=a,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(g.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(a,b)))},a.onError=function(f,a){switch(a.details){case r.ErrorDetails.FRAG_LOAD_ERROR:case r.ErrorDetails.FRAG_LOAD_TIMEOUT:case r.ErrorDetails.KEY_LOAD_ERROR:case r.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(k.PlaylistLevelType.AUDIO,a);break;case r.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case r.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==c.State.ERROR&&this.state!==c.State.STOPPED&&(this.state=a.fatal?c.State.ERROR:c.State.IDLE,this.warn(a.details+" while loading frag, switching to "+this.state+" state"));break;case r.ErrorDetails.BUFFER_FULL_ERROR:if("audio"===a.parent&&(this.state===c.State.PARSING||this.state===c.State.PARSED)){var e=!0,b=this.getFwdBufferInfo(this.mediaBuffer,k.PlaylistLevelType.AUDIO);b&&b.len>.5&&(e=!this.reduceMaxBufferLength(b.len)),e&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,d.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}}},a.onBufferFlushed=function(b,a){a.type===l.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0)},a._handleTransmuxComplete=function(o){var h,i="audio",j=this.hls,e=o.remuxResult,d=o.chunkMeta,k=this.getCurrentContext(d);if(!k)return this.warn("The loading context changed while buffering fragment "+d.sn+" of level "+d.level+". This chunk will not be buffered."),void this.resetLiveStartWhenNotLoaded(d.level);var a=k.frag,m=k.part,b=e.audio,p=e.text,n=e.id3,f=e.initSegment;if(!this.fragContextChanged(a)){if(this.state=c.State.PARSING,this.audioSwitch&&b&&this.completeAudioSwitch(),null!=f&&f.tracks&&(this._bufferInitSegment(f.tracks,a,d),j.trigger(g.Events.FRAG_PARSING_INIT_SEGMENT,{frag:a,id:i,tracks:f.tracks})),b){var q=b.startPTS,r=b.endPTS,s=b.startDTS,u=b.endDTS;m&&(m.elementaryStreams[l.ElementaryStreamTypes.AUDIO]={startPTS:q,endPTS:r,startDTS:s,endDTS:u}),a.setElementaryStreamInfo(l.ElementaryStreamTypes.AUDIO,q,r,s,u),this.bufferFragmentData(b,a,m,d)}if(null!=n&&null!==(h=n.samples)&& void 0!==h&&h.length){var v=t({frag:a,id:i},n);j.trigger(g.Events.FRAG_PARSING_METADATA,v)}if(p){var w=t({frag:a,id:i},p);j.trigger(g.Events.FRAG_PARSING_USERDATA,w)}}},a._bufferInitSegment=function(b,e,f){if(this.state===c.State.PARSING){b.video&&delete b.video;var a=b.audio;if(a){a.levelCodec=a.codec,a.id="audio",this.log("Init audio buffer, container:"+a.container+", codecs[parsed]=["+a.codec+"]"),this.hls.trigger(g.Events.BUFFER_CODECS,b);var d=a.initSegment;if(null!=d&&d.byteLength){var h={type:"audio",frag:e,part:null,chunkMeta:f,parent:e.type,data:d};this.hls.trigger(g.Events.BUFFER_APPENDING,h)}this.tick()}}},a.loadFragment=function(a,b,g){var e=this.fragmentTracker.getState(a);this.fragCurrent=a,(this.audioSwitch||e===i.FragmentState.NOT_LOADED||e===i.FragmentState.PARTIAL)&&("initSegment"===a.sn?this._loadInitSegment(a):b.live&&!Object(f.isFiniteNumber)(this.initPTS[a.cc])?(this.log("Waiting for video PTS in continuity counter "+a.cc+" of live stream before loading audio fragment "+a.sn+" of level "+this.trackId),this.state=c.State.WAITING_INIT_PTS):(this.startFragRequested=!0,d.prototype.loadFragment.call(this,a,b,g)))},a.completeAudioSwitch=function(){var a=this.hls,b=this.media,c=this.trackId;b&&(this.log("Switching audio track : flushing all audio"),d.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,a.trigger(g.Events.AUDIO_TRACK_SWITCHED,{id:c})},b}(c.default);b.default=d},"./src/controller/audio-track-controller.ts":/*!**************************************************!*\
   !*** ./src/controller/audio-track-controller.ts ***!
   \**************************************************/ /*! exports provided: default */ function(e,b,a){"use strict";a.r(b);var f=a(/*! ../events */ "./src/events.ts"),g=a(/*! ../errors */ "./src/errors.ts"),c=a(/*! ./base-playlist-controller */ "./src/controller/base-playlist-controller.ts"),h=a(/*! ../types/loader */ "./src/types/loader.ts");function i(d,c){for(var b=0;b<c.length;b++){var a=c[b];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(d,a.key,a)}}function j(a,b){return(j=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a})(a,b)}var d=function(k){function b(b){var a;return(a=k.call(this,b,"[audio-track-controller]")||this).tracks=[],a.groupId=null,a.tracksInGroup=[],a.trackId=-1,a.trackName="",a.selectDefaultTrack=!0,a.registerListeners(),a}m=k,(l=b).prototype=Object.create(m.prototype),l.prototype.constructor=l,j(l,m);var l,m,c,d,e,a=b.prototype;return a.registerListeners=function(){var a=this.hls;a.on(f.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.on(f.Events.MANIFEST_PARSED,this.onManifestParsed,this),a.on(f.Events.LEVEL_LOADING,this.onLevelLoading,this),a.on(f.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),a.on(f.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),a.on(f.Events.ERROR,this.onError,this)},a.unregisterListeners=function(){var a=this.hls;a.off(f.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.off(f.Events.MANIFEST_PARSED,this.onManifestParsed,this),a.off(f.Events.LEVEL_LOADING,this.onLevelLoading,this),a.off(f.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),a.off(f.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),a.off(f.Events.ERROR,this.onError,this)},a.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,k.prototype.destroy.call(this)},a.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},a.onManifestParsed=function(b,a){this.tracks=a.audioTracks||[]},a.onAudioTrackLoaded=function(f,b){var a=b.id,d=b.details,c=this.tracksInGroup[a];if(c){var e=c.details;c.details=b.details,this.log("audioTrack "+a+" loaded ["+d.startSN+"-"+d.endSN+"]"),a===this.trackId&&(this.retryCount=0,this.playlistLoaded(a,b,e))}else this.warn("Invalid audio track id "+a)},a.onLevelLoading=function(b,a){this.switchLevel(a.level)},a.onLevelSwitching=function(b,a){this.switchLevel(a.level)},a.switchLevel=function(d){var a=this.hls.levels[d];if(null!=a&&a.audioGroupIds){var c=a.audioGroupIds[a.urlId];if(this.groupId!==c){this.groupId=c;var b=this.tracks.filter(function(a){return!c||a.groupId===c});this.selectDefaultTrack&&!b.some(function(a){return a.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=b;var e={audioTracks:b};this.log("Updating audio tracks, "+b.length+' track(s) found in "'+c+'" group-id'),this.hls.trigger(f.Events.AUDIO_TRACKS_UPDATED,e),this.selectInitialTrack()}}},a.onError=function(b,a){k.prototype.onError.call(this,b,a),!a.fatal&&a.context&&a.context.type===h.PlaylistContextType.AUDIO_TRACK&&a.context.id===this.trackId&&a.context.groupId===this.groupId&&this.retryLoadingOrFail(a)},a.setAudioTrack=function(b){var c=this.tracksInGroup;if(b<0||b>=c.length)this.warn("Invalid id passed to audio-track controller");else{this.clearTimer();var d=c[this.trackId];this.log("Now switching to audio-track index "+b);var a=c[b],h=a.id,e=a.groupId,i=void 0===e?"":e,g=a.name,j=a.type,k=a.url;if(this.trackId=b,this.trackName=g,this.selectDefaultTrack=!1,this.hls.trigger(f.Events.AUDIO_TRACK_SWITCHING,{id:h,groupId:i,name:g,type:j,url:k}),!a.details||a.details.live){var l=this.switchParams(a.url,null==d?void 0:d.details);this.loadPlaylist(l)}}},a.selectInitialTrack=function(){var b=this.tracksInGroup;console.assert(b.length,"Initial audio track should be selected when tracks are known");var c=this.trackName,a=this.findTrackId(c)||this.findTrackId();-1!==a?this.setAudioTrack(a):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(f.Events.ERROR,{type:g.ErrorTypes.MEDIA_ERROR,details:g.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},a.findTrackId=function(c){for(var d=this.tracksInGroup,a=0;a<d.length;a++){var b=d[a];if((!this.selectDefaultTrack||b.default)&&(!c||c===b.name))return b.id}return -1},a.loadPlaylist=function(b){var a=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(a)){var d=a.id,e=a.groupId,c=a.url;if(b)try{c=b.addDirectives(c)}catch(g){this.warn("Could not construct new URL with HLS Delivery Directives: "+g)}this.log("loading audio-track playlist for id: "+d),this.clearTimer(),this.hls.trigger(f.Events.AUDIO_TRACK_LOADING,{url:c,id:d,groupId:e,deliveryDirectives:b||null})}},c=b,d=[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(a){this.selectDefaultTrack=!1,this.setAudioTrack(a)}}],i(c.prototype,d),e&&i(c,e),b}(c.default);b.default=d},"./src/controller/base-playlist-controller.ts":/*!****************************************************!*\
   !*** ./src/controller/base-playlist-controller.ts ***!
   \****************************************************/ /*! exports provided: default */ function(c,b,a){"use strict";a.r(b),a.d(b,"default",function(){return i});var d=a(/*! ./src/polyfills/number */ "./src/polyfills/number.ts"),e=a(/*! ../types/level */ "./src/types/level.ts"),f=a(/*! ./level-helper */ "./src/controller/level-helper.ts"),g=a(/*! ../utils/logger */ "./src/utils/logger.ts"),h=a(/*! ../errors */ "./src/errors.ts"),i=function(){function b(b,a){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=g.logger.log.bind(g.logger,a+":"),this.warn=g.logger.warn.bind(g.logger,a+":"),this.hls=b}var a=b.prototype;return a.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},a.onError=function(b,a){a.fatal&&a.type===h.ErrorTypes.NETWORK_ERROR&&this.clearTimer()},a.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},a.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},a.stopLoad=function(){this.canLoad=!1,this.clearTimer()},a.switchParams=function(j,a){var c=null==a?void 0:a.renditionReports;if(c)for(var f=0;f<c.length;f++){var g=c[f],h=""+g.URI;if(h===j.substr(-h.length)){var i=parseInt(g["LAST-MSN"]),b=parseInt(g["LAST-PART"]);if(a&&this.hls.config.lowLatencyMode){var k=Math.min(a.age-a.partTarget,a.targetduration);void 0!==b&&k>a.partTarget&&(b+=1)}if(Object(d.isFiniteNumber)(i))return new e.HlsUrlParameters(i,Object(d.isFiniteNumber)(b)?b:void 0,e.HlsSkip.No)}}},a.loadPlaylist=function(a){},a.shouldLoadTrack=function(a){return this.canLoad&&a&&!!a.url&&(!a.details||a.details.live)},a.playlistLoaded=function(n,g,b){var t=this,a=g.details,h=g.stats,s=h.loading.end?Math.max(0,self.performance.now()-h.loading.end):0;if(a.advancedDateTime=Date.now()-s,a.live||null!=b&&b.live){if(a.reloaded(b),b&&this.log("live playlist "+n+" "+(a.advanced?"REFRESHED "+a.lastPartSn+"-"+a.lastPartIndex:"MISSED")),b&&a.fragments.length>0&&Object(f.mergeDetails)(b,a),!this.canLoad||!a.live)return;var i,d=void 0,e=void 0;if(a.canBlockReload&&a.endSN&&a.advanced){var o=this.hls.config.lowLatencyMode,p=a.lastPartSn,j=a.endSN,k=a.lastPartIndex,l=p===j;-1!==k?(d=l?j+1:p,e=l?o?0:k:k+1):d=j+1;var q=a.age,c=Math.min(q+a.ageHeader-a.partTarget,1.5*a.targetduration);if(c>0){if(b&&c>b.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+b.tuneInGoal+" to: "+c+" with playlist age: "+a.age),c=0;else{var r=Math.floor(c/a.targetduration);d+=r,void 0!==e&&(e+=Math.round(c%a.targetduration/a.partTarget)),this.log("CDN Tune-in age: "+a.ageHeader+"s last advanced "+q.toFixed(2)+"s goal: "+c+" skip sn "+r+" to part "+e)}a.tuneInGoal=c}if(i=this.getDeliveryDirectives(a,g.deliveryDirectives,d,e),o||!l)return void this.loadPlaylist(i)}else i=this.getDeliveryDirectives(a,g.deliveryDirectives,d,e);var m=Object(f.computeReloadInterval)(a,h);void 0!==d&&a.canBlockReload&&(m-=a.partTarget||1),this.log("reload live playlist "+n+" in "+Math.round(m)+" ms"),this.timer=self.setTimeout(function(){return t.loadPlaylist(i)},m)}else this.clearTimer()},a.getDeliveryDirectives=function(c,a,b,d){var f=Object(e.getSkipValue)(c,b);return null!=a&&a.skip&&c.deltaUpdateFailed&&(b=a.msn,d=a.part,f=e.HlsSkip.No),new e.HlsUrlParameters(b,d,f)},a.retryLoadingOrFail=function(a){var b,f=this,c=this.hls.config,d=this.retryCount<c.levelLoadingMaxRetry;if(d){if(this.retryCount++,a.details.indexOf("LoadTimeOut")> -1&&null!==(b=a.context)&& void 0!==b&&b.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+a.details+'"'),this.loadPlaylist();else{var e=Math.min(Math.pow(2,this.retryCount)*c.levelLoadingRetryDelay,c.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return f.loadPlaylist()},e),this.warn("retry playlist loading #"+this.retryCount+" in "+e+' ms after "'+a.details+'"')}}else this.warn('cannot recover from error "'+a.details+'"'),this.clearTimer(),a.fatal=!0;return d},b}()},"./src/controller/base-stream-controller.ts":/*!**************************************************!*\
   !*** ./src/controller/base-stream-controller.ts ***!
   \**************************************************/ /*! exports provided: State, default */ function(d,b,a){"use strict";a.r(b),a.d(b,"State",function(){return v}),a.d(b,"default",function(){return w});var e=a(/*! ./src/polyfills/number */ "./src/polyfills/number.ts"),c=a(/*! ../task-loop */ "./src/task-loop.ts"),f=a(/*! ./fragment-tracker */ "./src/controller/fragment-tracker.ts"),g=a(/*! ../utils/buffer-helper */ "./src/utils/buffer-helper.ts"),h=a(/*! ../utils/logger */ "./src/utils/logger.ts"),i=a(/*! ../events */ "./src/events.ts"),j=a(/*! ../errors */ "./src/errors.ts"),k=a(/*! ../types/transmuxer */ "./src/types/transmuxer.ts"),l=a(/*! ../utils/mp4-tools */ "./src/utils/mp4-tools.ts"),m=a(/*! ../utils/discontinuities */ "./src/utils/discontinuities.ts"),n=a(/*! ./fragment-finders */ "./src/controller/fragment-finders.ts"),o=a(/*! ./level-helper */ "./src/controller/level-helper.ts"),p=a(/*! ../loader/fragment-loader */ "./src/loader/fragment-loader.ts"),q=a(/*! ../crypt/decrypter */ "./src/crypt/decrypter.ts"),r=a(/*! ../utils/time-ranges */ "./src/utils/time-ranges.ts"),s=a(/*! ../types/loader */ "./src/types/loader.ts");function t(d,c){for(var b=0;b<c.length;b++){var a=c[b];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(d,a.key,a)}}function u(a,b){return(u=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a})(a,b)}var v={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BACKTRACKING:"BACKTRACKING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},w=function(x){function b(b,d,c){var a;return(a=x.call(this)||this).hls=void 0,a.fragPrevious=null,a.fragCurrent=null,a.fragmentTracker=void 0,a.transmuxer=null,a._state=v.STOPPED,a.media=void 0,a.mediaBuffer=void 0,a.config=void 0,a.bitrateTest=!1,a.lastCurrentTime=0,a.nextLoadPosition=0,a.startPosition=0,a.loadedmetadata=!1,a.fragLoadError=0,a.retryDate=0,a.levels=null,a.fragmentLoader=void 0,a.levelLastLoaded=null,a.startFragRequested=!1,a.decrypter=void 0,a.initPTS=[],a.onvseeking=null,a.onvended=null,a.logPrefix="",a.log=void 0,a.warn=void 0,a.logPrefix=c,a.log=h.logger.log.bind(h.logger,c+":"),a.warn=h.logger.warn.bind(h.logger,c+":"),a.hls=b,a.fragmentLoader=new p.default(b.config),a.fragmentTracker=d,a.config=b.config,a.decrypter=new q.default(b,b.config),b.on(i.Events.KEY_LOADED,a.onKeyLoaded,function(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}(a)),a}z=x,(y=b).prototype=Object.create(z.prototype),y.prototype.constructor=y,u(y,z);var y,z,c,d,w,a=b.prototype;return a.doTick=function(){this.onTickEnd()},a.onTickEnd=function(){},a.startLoad=function(a){},a.stopLoad=function(){this.fragmentLoader.abort();var a=this.fragCurrent;a&&this.fragmentTracker.removeFragment(a),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=v.STOPPED},a._streamEnded=function(d,b){var a=this.fragCurrent,e=this.fragmentTracker;if(!b.live&&a&&a.sn===b.endSN&&!d.nextStart){var c=e.getState(a);return c===f.FragmentState.PARTIAL||c===f.FragmentState.OK}return!1},a.onMediaAttached=function(d,c){var a=this.media=this.mediaBuffer=c.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),a.addEventListener("seeking",this.onvseeking),a.addEventListener("ended",this.onvended);var b=this.config;this.levels&&b.autoStartLoad&&this.state===v.STOPPED&&this.startLoad(b.startPosition)},a.onMediaDetaching=function(){var a=this.media;null!=a&&a.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),a&&(a.removeEventListener("seeking",this.onvseeking),a.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},a.onMediaSeeking=function(){var d=this.config,b=this.fragCurrent,c=this.media,k=this.mediaBuffer,f=this.state,a=c?c.currentTime:0,h=g.BufferHelper.bufferInfo(k||c,a,d.maxBufferHole);if(this.log("media seeking to "+(Object(e.isFiniteNumber)(a)?a.toFixed(3):a)+", state: "+f),f===v.ENDED)this.resetLoadingState();else if(b&&!h.len){var i=d.maxFragLookUpTolerance,l=b.start-i,j=a>b.start+b.duration+i;(a<l||j)&&(j&&b.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),b.loader.abort()),this.resetLoadingState())}c&&(this.lastCurrentTime=a),this.loadedmetadata||h.len||(this.nextLoadPosition=this.startPosition=a),this.tickImmediate()},a.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},a.onKeyLoaded=function(c,a){if(this.state===v.KEY_LOADING&&a.frag===this.fragCurrent&&this.levels){this.state=v.IDLE;var b=this.levels[a.frag.level].details;b&&this.loadFragment(a.frag,b,a.frag.start)}},a.onHandlerDestroying=function(){this.stopLoad(),x.prototype.onHandlerDestroying.call(this)},a.onHandlerDestroyed=function(){this.state=v.STOPPED,this.hls.off(i.Events.KEY_LOADED,this.onKeyLoaded,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,x.prototype.onHandlerDestroyed.call(this)},a.loadKey=function(a,b){this.log("Loading key for "+a.sn+" of ["+b.startSN+"-"+b.endSN+"], "+("[stream-controller]"===this.logPrefix?"level":"track")+" "+a.level),this.state=v.KEY_LOADING,this.fragCurrent=a,this.hls.trigger(i.Events.KEY_LOADING,{frag:a})},a.loadFragment=function(a,b,c){this._loadFragForPlayback(a,b,c)},a._loadFragForPlayback=function(a,b,c){var d=this;this._doFragLoad(a,b,c,function(b){if(d.fragContextChanged(a))return d.warn("Fragment "+a.sn+(b.part?" p: "+b.part.index:"")+" of level "+a.level+" was dropped during download."),void d.fragmentTracker.removeFragment(a);a.stats.chunkCount++,d._handleFragmentLoadProgress(b)}).then(function(b){if(b){d.fragLoadError=0;var c=d.state;if(!d.fragContextChanged(a))return"payload"in b&&(d.log("Loaded fragment "+a.sn+" of level "+a.level),d.hls.trigger(i.Events.FRAG_LOADED,b),d.state===v.BACKTRACKING)?(d.fragmentTracker.backtrack(a,b),void d.resetFragmentLoading(a)):void d._handleFragmentLoadComplete(b);c!==v.FRAG_LOADING&&c!==v.BACKTRACKING&&(d.fragCurrent||c!==v.PARSING)||(d.fragmentTracker.removeFragment(a),d.state=v.IDLE)}}).catch(function(b){d.warn(b),d.resetFragmentLoading(a)})},a.flushMainBuffer=function(b,c,a){if(void 0===a&&(a=null),b-c){var d={startOffset:b,endOffset:c,type:a};this.fragLoadError=0,this.hls.trigger(i.Events.BUFFER_FLUSHING,d)}},a._loadInitSegment=function(a){var b=this;this._doFragLoad(a).then(function(c){if(!c||b.fragContextChanged(a)||!b.levels)throw new Error("init load aborted");return c}).then(function(e){var f=b.hls,d=e.payload,c=a.decryptdata;if(d&&d.byteLength>0&&c&&c.key&&c.iv&&"AES-128"===c.method){var g=self.performance.now();return b.decrypter.webCryptoDecrypt(new Uint8Array(d),c.key.buffer,c.iv.buffer).then(function(b){var c=self.performance.now();return f.trigger(i.Events.FRAG_DECRYPTED,{frag:a,payload:b,stats:{tstart:g,tdecrypt:c}}),e.payload=b,e})}return e}).then(function(d){var e=b.fragCurrent,g=b.hls,f=b.levels;if(!f)throw new Error("init load aborted, missing levels");var h=f[a.level].details;console.assert(h,"Level details are defined when init segment is loaded");var c=a.stats;b.state=v.IDLE,b.fragLoadError=0,a.data=new Uint8Array(d.payload),c.parsing.start=c.buffering.start=self.performance.now(),c.parsing.end=c.buffering.end=self.performance.now(),d.frag===e&&g.trigger(i.Events.FRAG_BUFFERED,{stats:c,frag:e,part:null,id:a.type}),b.tick()}).catch(function(c){b.warn(c),b.resetFragmentLoading(a)})},a.fragContextChanged=function(a){var b=this.fragCurrent;return!a||!b||a.level!==b.level||a.sn!==b.sn||a.urlId!==b.urlId},a.fragBufferedComplete=function(a,b){var c=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+a.type+" sn: "+a.sn+(b?" part: "+b.index:"")+" of "+("[stream-controller]"===this.logPrefix?"level":"track")+" "+a.level+" "+r.default.toString(g.BufferHelper.getBuffered(c))),this.state=v.IDLE,this.tick()},a._handleFragmentLoadComplete=function(a){var d=this.transmuxer;if(d){var b=a.frag,e=a.part,c=a.partsLoaded,f=!c||0===c.length||c.some(function(a){return!a}),g=new k.ChunkMetadata(b.level,b.sn,b.stats.chunkCount+1,0,e?e.index:-1,!f);d.flush(g)}},a._handleFragmentLoadProgress=function(a){},a._doFragLoad=function(a,c,b,g){var j=this;if(void 0===b&&(b=null),!this.levels)throw new Error("frag load aborted, missing levels");if(b=Math.max(a.start,b||0),this.config.lowLatencyMode&&c){var d=c.partList;if(d&&g){b>a.end&&c.fragmentHint&&(a=c.fragmentHint);var f=this.getNextPart(d,a,b);if(f> -1){var h=d[f];return this.log("Loading part sn: "+a.sn+" p: "+h.index+" cc: "+a.cc+" of playlist ["+c.startSN+"-"+c.endSN+"] parts [0-"+f+"-"+(d.length-1)+"] "+("[stream-controller]"===this.logPrefix?"level":"track")+": "+a.level+", target: "+parseFloat(b.toFixed(3))),this.nextLoadPosition=h.start+h.duration,this.state=v.FRAG_LOADING,this.hls.trigger(i.Events.FRAG_LOADING,{frag:a,part:d[f],targetBufferTime:b}),this.doFragPartsLoad(a,d,f,g).catch(function(a){return j.handleFragLoadError(a)})}if(!a.url||this.loadedEndOfParts(d,b))return Promise.resolve(null)}}return this.log("Loading fragment "+a.sn+" cc: "+a.cc+" "+(c?"of ["+c.startSN+"-"+c.endSN+"] ":"")+("[stream-controller]"===this.logPrefix?"level":"track")+": "+a.level+", target: "+parseFloat(b.toFixed(3))),Object(e.isFiniteNumber)(a.sn)&&!this.bitrateTest&&(this.nextLoadPosition=a.start+a.duration),this.state=v.FRAG_LOADING,this.hls.trigger(i.Events.FRAG_LOADING,{frag:a,targetBufferTime:b}),this.fragmentLoader.load(a,g).catch(function(a){return j.handleFragLoadError(a)})},a.doFragPartsLoad=function(a,b,c,d){var e=this;return new Promise(function(f,g){var h=[];!function k(c){var j=b[c];e.fragmentLoader.loadPart(a,j,d).then(function(d){h[j.index]=d;var l=d.part;e.hls.trigger(i.Events.FRAG_LOADED,d);var g=b[c+1];if(!g||g.fragment!==a)return f({frag:a,part:l,partsLoaded:h});k(c+1)}).catch(g)}(c)})},a.handleFragLoadError=function(b){var a=b.data;return a&&a.details===j.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(a.frag,a.part):this.hls.trigger(i.Events.ERROR,a),null},a._handleTransmuxerFlush=function(c){var a=this.getCurrentContext(c);if(a&&this.state===v.PARSING){var d=a.frag,b=a.part,f=a.level,e=self.performance.now();d.stats.parsing.end=e,b&&(b.stats.parsing.end=e),this.updateLevelTiming(d,b,f,c.partial)}else this.fragCurrent||(this.state=v.IDLE)},a.getCurrentContext=function(a){var b=this.levels,c=a.level,d=a.sn,g=a.part;if(!b||!b[c])return this.warn("Levels object was unset while buffering fragment "+d+" of level "+c+". The current chunk will not be buffered."),null;var e=b[c],f=g> -1?Object(o.getPartWith)(e,d,g):null,h=f?f.fragment:Object(o.getFragmentWithSN)(e,d,this.fragCurrent);return h?{frag:h,part:f,level:e}:null},a.bufferFragmentData=function(a,c,e,g){if(a&&this.state===v.PARSING){var d=a.data1,f=a.data2,b=d;if(d&&f&&(b=Object(l.appendUint8Array)(d,f)),b&&b.length){var h={type:a.type,frag:c,part:e,chunkMeta:g,parent:c.type,data:b};this.hls.trigger(i.Events.BUFFER_APPENDING,h),a.dropped&&a.independent&&!e&&this.flushBufferGap(c)}}},a.flushBufferGap=function(a){var b=this.media;if(b){if(g.BufferHelper.isBuffered(b,b.currentTime)){var d=b.currentTime,f=g.BufferHelper.bufferInfo(b,d,0),h=a.duration,c=Math.min(2*this.config.maxFragLookUpTolerance,.25*h),e=Math.max(Math.min(a.start-c,f.end-c),d+c);a.start-e>c&&this.flushMainBuffer(e,a.start)}else this.flushMainBuffer(0,a.start)}},a.getFwdBufferInfo=function(c,h){var d=this.config,b=this.getLoadPosition();if(!Object(e.isFiniteNumber)(b))return null;var a=g.BufferHelper.bufferInfo(c,b,d.maxBufferHole);if(0===a.len&& void 0!==a.nextStart){var f=this.fragmentTracker.getBufferedFrag(b,h);if(f&&a.nextStart<f.end)return g.BufferHelper.bufferInfo(c,b,Math.max(a.nextStart,d.maxBufferHole))}return a},a.getMaxBufferLength=function(b){var c,a=this.config;return c=b?Math.max(8*a.maxBufferSize/b,a.maxBufferLength):a.maxBufferLength,Math.min(c,a.maxMaxBufferLength)},a.reduceMaxBufferLength=function(b){var a=this.config,c=b||a.maxBufferLength;return a.maxMaxBufferLength>=c&&(a.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+a.maxMaxBufferLength+"s"),!0)},a.getNextFragment=function(d,b){var e,f,c=b.fragments,g=c.length;if(!g)return null;var a,h=this.config,j=c[0].start;if(b.live){var i=h.initialLiveManifestSize;if(g<i)return this.warn("Not enough fragments to start playback (have: "+g+", need: "+i+")"),null;b.PTSKnown||this.startFragRequested|| -1!==this.startPosition||(a=this.getInitialLiveFragment(b,c),this.startPosition=a?this.hls.liveSyncPosition||a.start:d)}else d<=j&&(a=c[0]);if(!a){var k=h.lowLatencyMode?b.partEnd:b.fragmentEnd;a=this.getFragmentAtPosition(d,k,b)}return null===(e=a)|| void 0===e||!e.initSegment||null!==(f=a)&& void 0!==f&&f.initSegment.data||this.bitrateTest||(a=a.initSegment),a},a.getNextPart=function(e,h,i){for(var c=-1,f=!1,d=!0,b=0,j=e.length;b<j;b++){var a=e[b];if(d=d&&!a.independent,c> -1&&i<a.start)break;var g=a.loaded;!g&&(f||a.independent||d)&&a.fragment===h&&(c=b),f=g}return c},a.loadedEndOfParts=function(b,c){var a=b[b.length-1];return a&&c>a.start&&a.loaded},a.getInitialLiveFragment=function(b,d){var c=this.fragPrevious,a=null;if(c){if(b.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+c.programDateTime),a=Object(n.findFragmentByPDT)(d,c.endProgramDateTime,this.config.maxFragLookUpTolerance)),!a){var e=c.sn+1;if(e>=b.startSN&&e<=b.endSN){var f=d[e-b.startSN];c.cc===f.cc&&(a=f,this.log("Live playlist, switching playlist, load frag with next SN: "+a.sn))}a||(a=Object(n.findFragWithCC)(d,c.cc))&&this.log("Live playlist, switching playlist, load frag with same CC: "+a.sn)}}else{var g=this.hls.liveSyncPosition;null!==g&&(a=this.getFragmentAtPosition(g,this.bitrateTest?b.fragmentEnd:b.edge,b))}return a},a.getFragmentAtPosition=function(i,j,d){var a,k=this.config,c=this.fragPrevious,b=d.fragments,l=d.endSN,e=d.fragmentHint,m=k.maxFragLookUpTolerance,o=!!(k.lowLatencyMode&&d.partList&&e);if(o&&e&&!this.bitrateTest&&(b=b.concat(e),l=e.sn),i<j){var q=i>j-m?0:m;a=Object(n.findFragmentByPTS)(c,b,i,q)}else a=b[b.length-1];if(a){var p=a.sn-d.startSN,r=c&&a.level===c.level,g=b[p+1];if(this.fragmentTracker.getState(a)===f.FragmentState.BACKTRACKED){a=null;for(var h=p;b[h]&&this.fragmentTracker.getState(b[h])===f.FragmentState.BACKTRACKED;)a=c?b[h--]:b[--h];a||(a=g)}else c&&a.sn===c.sn&&!o&&r&&(a.sn<l&&this.fragmentTracker.getState(g)!==f.FragmentState.OK?(this.log("SN "+a.sn+" just loaded, load next one: "+g.sn),a=g):a=null)}return a},a.synchronizeToLiveEdge=function(e){var d=this.config,a=this.media;if(a){var b=this.hls.liveSyncPosition,c=a.currentTime,h=e.fragments[0].start,f=e.edge,g=c>=h-d.maxFragLookUpTolerance&&c<=f;if(null!==b&&a.duration>b&&(c<b||!g)){var i=void 0!==d.liveMaxLatencyDuration?d.liveMaxLatencyDuration:d.liveMaxLatencyDurationCount*e.targetduration;(!g&&a.readyState<4||c<f-i)&&(this.loadedmetadata||(this.nextLoadPosition=b),a.readyState&&(this.warn("Playback: "+c.toFixed(3)+" is located too far from the end of live sliding playlist: "+f+", reset currentTime to : "+b.toFixed(3)),a.currentTime=b))}}},a.alignPlaylists=function(a,b){var i=this.levels,f=this.levelLastLoaded,c=this.fragPrevious,j=null!==f?i[f]:null,g=a.fragments.length;if(!g)return this.warn("No fragments in live playlist"),0;var d=a.fragments[0].start,k=!b,l=a.alignedSliding&&Object(e.isFiniteNumber)(d);if(k|| !l&&!d){Object(m.alignStream)(c,j,a);var h=a.fragments[0].start;return this.log("Live playlist sliding: "+h.toFixed(2)+" start-sn: "+(b?b.startSN:"na")+"->"+a.startSN+" prev-sn: "+(c?c.sn:"na")+" fragments: "+g),h}return d},a.waitForCdnTuneIn=function(a){return a.live&&a.canBlockReload&&a.tuneInGoal>Math.max(a.partHoldBack,3*a.partTarget)},a.setStartPosition=function(c,b){var a=this.startPosition;if(a<b&&(a=-1),-1===a|| -1===this.lastCurrentTime){var d=c.startTimeOffset;Object(e.isFiniteNumber)(d)?(a=b+d,d<0&&(a+=c.totalduration),a=Math.min(Math.max(b,a),b+c.totalduration),this.log("Start time offset "+d+" found in playlist, adjust startPosition to "+a),this.startPosition=a):c.live?a=this.hls.liveSyncPosition||b:this.startPosition=a=0,this.lastCurrentTime=a}this.nextLoadPosition=a},a.getLoadPosition=function(){var b=this.media,a=0;return this.loadedmetadata&&b?a=b.currentTime:this.nextLoadPosition&&(a=this.nextLoadPosition),a},a.handleFragLoadAborted=function(a,b){this.transmuxer&&"initSegment"!==a.sn&&a.stats.aborted&&(this.warn("Fragment "+a.sn+(b?" part"+b.index:"")+" of level "+a.level+" was aborted"),this.resetFragmentLoading(a))},a.resetFragmentLoading=function(a){this.fragCurrent&&this.fragContextChanged(a)||(this.state=v.IDLE)},a.onFragmentOrKeyLoadError=function(d,b){if(!b.fatal){var a=b.frag;if(a&&a.type===d){var c=this.fragCurrent;console.assert(c&&a.sn===c.sn&&a.level===c.level&&a.urlId===c.urlId,"Frag load error must match current frag to retry");var e=this.config;if(this.fragLoadError+1<=e.fragLoadingMaxRetry){if(this.resetLiveStartWhenNotLoaded(a.level))return;var f=Math.min(Math.pow(2,this.fragLoadError)*e.fragLoadingRetryDelay,e.fragLoadingMaxRetryTimeout);this.warn("Fragment "+a.sn+" of "+d+" "+a.level+" failed to load, retrying in "+f+"ms"),this.retryDate=self.performance.now()+f,this.fragLoadError++,this.state=v.FRAG_LOADING_WAITING_RETRY}else b.levelRetry?(d===s.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=v.IDLE):(h.logger.error(b.details+" reaches max retry, redispatch as fatal ..."),b.fatal=!0,this.hls.stopLoad(),this.state=v.ERROR)}}},a.afterBufferFlushed=function(a,b,c){if(a){var d=g.BufferHelper.getBuffered(a);this.fragmentTracker.detectEvictedFragments(b,d,c),this.state===v.ENDED&&this.resetLoadingState()}},a.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=v.IDLE},a.resetLiveStartWhenNotLoaded=function(b){if(!this.loadedmetadata){this.startFragRequested=!1;var a=this.levels?this.levels[b].details:null;if(null!=a&&a.live)return this.startPosition=-1,this.setStartPosition(a,0),this.resetLoadingState(),!0;this.nextLoadPosition=this.startPosition}return!1},a.updateLevelTiming=function(a,b,c,e){var f=this,d=c.details;console.assert(!!d,"level.details must be defined"),Object.keys(a.elementaryStreams).reduce(function(h,g){var b=a.elementaryStreams[g];if(b){var j=b.endPTS-b.startPTS;if(j<=0)return f.warn("Could not parse fragment "+a.sn+" "+g+" duration reliably ("+j+") resetting transmuxer to fallback to playlist timing"),f.resetTransmuxer(),h||!1;var k=e?0:Object(o.updateFragPTSDTS)(d,a,b.startPTS,b.endPTS,b.startDTS,b.endDTS);return f.hls.trigger(i.Events.LEVEL_PTS_UPDATED,{details:d,level:c,drift:k,type:g,frag:a,start:b.startPTS,end:b.endPTS}),!0}return h},!1)?(this.state=v.PARSED,this.hls.trigger(i.Events.FRAG_PARSED,{frag:a,part:b})):this.resetLoadingState()},a.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},c=b,d=[{key:"state",get:function(){return this._state},set:function(a){var b=this._state;b!==a&&(this._state=a,this.log(b+"->"+a))}}],t(c.prototype,d),w&&t(c,w),b}(c.default)},"./src/controller/buffer-controller.ts":/*!*********************************************!*\
   !*** ./src/controller/buffer-controller.ts ***!
   \*********************************************/ /*! exports provided: default */ function(d,b,a){"use strict";a.r(b),a.d(b,"default",function(){return n});var e=a(/*! ./src/polyfills/number */ "./src/polyfills/number.ts"),f=a(/*! ../events */ "./src/events.ts"),g=a(/*! ../utils/logger */ "./src/utils/logger.ts"),h=a(/*! ../errors */ "./src/errors.ts"),i=a(/*! ../utils/buffer-helper */ "./src/utils/buffer-helper.ts"),c=a(/*! ../utils/mediasource-helper */ "./src/utils/mediasource-helper.ts"),j=a(/*! ../loader/fragment */ "./src/loader/fragment.ts"),k=a(/*! ./buffer-operation-queue */ "./src/controller/buffer-operation-queue.ts"),l=Object(c.getMediaSource)(),m=/([ha]vc.)(?:\.[^.,]+)+/,n=function(){function b(a){var b=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var d=b.hls,a=b.media,c=b.mediaSource;g.logger.log("[buffer-controller]: Media source opened"),a&&(b.updateMediaElementDuration(),d.trigger(f.Events.MEDIA_ATTACHED,{media:a})),c&&c.removeEventListener("sourceopen",b._onMediaSourceOpen),b.checkPendingTracks()},this._onMediaSourceClose=function(){g.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){g.logger.log("[buffer-controller]: Media source ended")},this.hls=a,this._initSourceBuffer(),this.registerListeners()}var a=b.prototype;return a.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},a.destroy=function(){this.unregisterListeners(),this.details=null},a.registerListeners=function(){var a=this.hls;a.on(f.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),a.on(f.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.on(f.Events.MANIFEST_PARSED,this.onManifestParsed,this),a.on(f.Events.BUFFER_RESET,this.onBufferReset,this),a.on(f.Events.BUFFER_APPENDING,this.onBufferAppending,this),a.on(f.Events.BUFFER_CODECS,this.onBufferCodecs,this),a.on(f.Events.BUFFER_EOS,this.onBufferEos,this),a.on(f.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),a.on(f.Events.LEVEL_UPDATED,this.onLevelUpdated,this),a.on(f.Events.FRAG_PARSED,this.onFragParsed,this),a.on(f.Events.FRAG_CHANGED,this.onFragChanged,this)},a.unregisterListeners=function(){var a=this.hls;a.off(f.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),a.off(f.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.off(f.Events.MANIFEST_PARSED,this.onManifestParsed,this),a.off(f.Events.BUFFER_RESET,this.onBufferReset,this),a.off(f.Events.BUFFER_APPENDING,this.onBufferAppending,this),a.off(f.Events.BUFFER_CODECS,this.onBufferCodecs,this),a.off(f.Events.BUFFER_EOS,this.onBufferEos,this),a.off(f.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),a.off(f.Events.LEVEL_UPDATED,this.onLevelUpdated,this),a.off(f.Events.FRAG_PARSED,this.onFragParsed,this),a.off(f.Events.FRAG_CHANGED,this.onFragChanged,this)},a._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new k.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},a.onManifestParsed=function(c,a){var b=2;(!a.audio||a.video)&&a.altAudio||(b=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=b,this.details=null,g.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},a.onMediaAttaching=function(d,c){var b=this.media=c.media;if(b&&l){var a=this.mediaSource=new l;a.addEventListener("sourceopen",this._onMediaSourceOpen),a.addEventListener("sourceended",this._onMediaSourceEnded),a.addEventListener("sourceclose",this._onMediaSourceClose),b.src=self.URL.createObjectURL(a),this._objectUrl=b.src}},a.onMediaDetaching=function(){var b=this.media,a=this.mediaSource,c=this._objectUrl;if(a){if(g.logger.log("[buffer-controller]: media source detaching"),"open"===a.readyState)try{a.endOfStream()}catch(d){g.logger.warn("[buffer-controller]: onMediaDetaching: "+d.message+" while calling endOfStream")}this.onBufferReset(),a.removeEventListener("sourceopen",this._onMediaSourceOpen),a.removeEventListener("sourceended",this._onMediaSourceEnded),a.removeEventListener("sourceclose",this._onMediaSourceClose),b&&(c&&self.URL.revokeObjectURL(c),b.src===c?(b.removeAttribute("src"),b.load()):g.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(f.Events.MEDIA_DETACHED,void 0)},a.onBufferReset=function(){var a=this;this.getSourceBufferTypes().forEach(function(b){var c=a.sourceBuffer[b];try{c&&(a.removeBufferListeners(b),a.mediaSource&&a.mediaSource.removeSourceBuffer(c),a.sourceBuffer[b]=void 0)}catch(d){g.logger.warn("[buffer-controller]: Failed to reset the "+b+" buffer",d)}}),this._initSourceBuffer()},a.onBufferCodecs=function(c,a){var d=this,b=this.getSourceBufferTypes().length;Object.keys(a).forEach(function(c){if(b){var e=d.tracks[c];if(e&&"function"==typeof e.buffer.changeType){var f=a[c],g=f.codec,h=f.levelCodec,i=f.container;if((e.levelCodec||e.codec).replace(m,"$1")!==(h||g).replace(m,"$1")){var j=i+";codecs="+(h||g);d.appendChangeType(c,j)}}}else d.pendingTracks[c]=a[c]}),b||(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks())},a.appendChangeType=function(a,c){var d=this,b=this.operationQueue;b.append({execute:function(){var e=d.sourceBuffer[a];e&&(g.logger.log("[buffer-controller]: changing "+a+" sourceBuffer type to "+c),e.changeType(c)),b.shiftAndExecuteNext(a)},onStart:function(){},onComplete:function(){},onError:function(b){g.logger.warn("[buffer-controller]: Failed to change "+a+" SourceBuffer type",b)}},a)},a.onBufferAppending=function(q,a){var r=this,s=this.hls,m=this.operationQueue,n=this.tracks,t=a.data,b=a.type,o=a.frag,e=a.part,j=a.chunkMeta,p=j.buffering[b],c=self.performance.now();p.start=c;var k=o.stats.buffering,d=e?e.stats.buffering:null;0===k.start&&(k.start=c),d&&0===d.start&&(d.start=c);var l=n.audio,u="audio"===b&&1===j.id&&"audio/mpeg"===(null==l?void 0:l.container);m.append({execute:function(){if(p.executeStart=self.performance.now(),u){var a=r.sourceBuffer[b];if(a){var c=o.start-a.timestampOffset;Math.abs(c)>=.1&&(g.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+o.start+" (delta: "+c+") sn: "+o.sn+")"),a.timestampOffset=o.start)}}r.appendExecutor(t,b)},onStart:function(){},onComplete:function(){var a=self.performance.now();p.executeEnd=p.end=a,0===k.first&&(k.first=a),d&&0===d.first&&(d.first=a);var c=r.sourceBuffer,g={};for(var h in c)g[h]=i.BufferHelper.getBuffered(c[h]);r.appendError=0,r.hls.trigger(f.Events.BUFFER_APPENDED,{type:b,frag:o,part:e,chunkMeta:j,parent:o.type,timeRanges:g})},onError:function(c){g.logger.error("[buffer-controller]: Error encountered while trying to append to the "+b+" SourceBuffer",c);var a={type:h.ErrorTypes.MEDIA_ERROR,parent:o.type,details:h.ErrorDetails.BUFFER_APPEND_ERROR,err:c,fatal:!1};c.code===DOMException.QUOTA_EXCEEDED_ERR?a.details=h.ErrorDetails.BUFFER_FULL_ERROR:(r.appendError++,a.details=h.ErrorDetails.BUFFER_APPEND_ERROR,r.appendError>s.config.appendErrorMaxRetry&&(g.logger.error("[buffer-controller]: Failed "+s.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),a.fatal=!0)),s.trigger(f.Events.ERROR,a)}},b)},a.onBufferFlushing=function(d,a){var e=this,b=this.operationQueue,c=function(b){return{execute:e.removeExecutor.bind(e,b,a.startOffset,a.endOffset),onStart:function(){},onComplete:function(){e.hls.trigger(f.Events.BUFFER_FLUSHED,{type:b})},onError:function(a){g.logger.warn("[buffer-controller]: Failed to remove from "+b+" SourceBuffer",a)}}};a.type?b.append(c(a.type),a.type):this.getSourceBufferTypes().forEach(function(a){b.append(c(a),a)})},a.onFragParsed=function(h,d){var i=this,b=d.frag,e=d.part,a=[],c=e?e.elementaryStreams:b.elementaryStreams;c[j.ElementaryStreamTypes.AUDIOVIDEO]?a.push("audiovideo"):(c[j.ElementaryStreamTypes.AUDIO]&&a.push("audio"),c[j.ElementaryStreamTypes.VIDEO]&&a.push("video")),0===a.length&&g.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+b.type+" level: "+b.level+" sn: "+b.sn),this.blockBuffers(function(){var a=self.performance.now();b.stats.buffering.end=a,e&&(e.stats.buffering.end=a);var c=e?e.stats:b.stats;i.hls.trigger(f.Events.FRAG_BUFFERED,{frag:b,part:e,stats:c,id:b.type})},a)},a.onFragChanged=function(a,b){this.flushBackBuffer()},a.onBufferEos=function(a,b){var c=this;this.getSourceBufferTypes().reduce(function(e,d){var a=c.sourceBuffer[d];return b.type&&b.type!==d||a&&!a.ended&&(a.ended=!0,g.logger.log("[buffer-controller]: "+d+" sourceBuffer now EOS")),e&&!(a&&!a.ended)},!0)&&this.blockBuffers(function(){var a=c.mediaSource;a&&"open"===a.readyState&&a.endOfStream()})},a.onLevelUpdated=function(c,b){var a=b.details;a.fragments.length&&(this.details=a,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},a.flushBackBuffer=function(){var a=this.hls,b=this.details,g=this.media,l=this.sourceBuffer;if(g&&null!==b){var h=this.getSourceBufferTypes();if(h.length){var c=b.live&&null!==a.config.liveBackBufferLength?a.config.liveBackBufferLength:a.config.backBufferLength;if(Object(e.isFiniteNumber)(c)&&!(c<0)){var j=g.currentTime,d=b.levelTargetDuration,k=Math.max(c,d),m=Math.floor(j/d)*d-k;h.forEach(function(c){var d=l[c];if(d){var e=i.BufferHelper.getBuffered(d);e.length>0&&m>e.start(0)&&(a.trigger(f.Events.BACK_BUFFER_REACHED,{bufferEnd:m}),b.live&&a.trigger(f.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:m}),a.trigger(f.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:m,type:c}))}})}}}},a.updateMediaElementDuration=function(){if(this.details&&this.media&&this.mediaSource&&"open"===this.mediaSource.readyState){var a=this.details,f=this.hls,h=this.media,b=this.mediaSource,c=a.fragments[0].start+a.totalduration,d=h.duration,i=Object(e.isFiniteNumber)(b.duration)?b.duration:0;a.live&&f.config.liveDurationInfinity?(g.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),b.duration=1/0,this.updateSeekableRange(a)):(c>i&&c>d||!Object(e.isFiniteNumber)(d))&&(g.logger.log("[buffer-controller]: Updating Media Source duration to "+c.toFixed(3)),b.duration=c)}},a.updateSeekableRange=function(a){var b=this.mediaSource,d=a.fragments;if(d.length&&a.live&&null!=b&&b.setLiveSeekableRange){var c=Math.max(0,d[0].start),e=Math.max(c,c+a.totalduration);b.setLiveSeekableRange(c,e)}},a.checkPendingTracks=function(){var d=this.bufferCodecEventsExpected,e=this.operationQueue,a=this.pendingTracks,b=Object.keys(a).length;if(b&&!d||2===b){this.createSourceBuffers(a),this.pendingTracks={};var c=this.getSourceBufferTypes();if(0===c.length)return void this.hls.trigger(f.Events.ERROR,{type:h.ErrorTypes.MEDIA_ERROR,details:h.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});c.forEach(function(a){e.executeNext(a)})}},a.createSourceBuffers=function(e){var i=this.sourceBuffer,j=this.mediaSource;if(!j)throw Error("createSourceBuffers called when mediaSource was null");var k=0;for(var b in e)if(!i[b]){var a=e[b];if(!a)throw Error("source buffer exists for track "+b+", however track does not");var l=a.levelCodec||a.codec,c=a.container+";codecs="+l;g.logger.log("[buffer-controller]: creating sourceBuffer("+c+")");try{var n=i[b]=j.addSourceBuffer(c),d=b;this.addBufferListener(d,"updatestart",this._onSBUpdateStart),this.addBufferListener(d,"updateend",this._onSBUpdateEnd),this.addBufferListener(d,"error",this._onSBUpdateError),this.tracks[b]={buffer:n,codec:l,container:a.container,levelCodec:a.levelCodec,id:a.id},k++}catch(m){g.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+m.message),this.hls.trigger(f.Events.ERROR,{type:h.ErrorTypes.MEDIA_ERROR,details:h.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:m,mimeType:c})}}k&&this.hls.trigger(f.Events.BUFFER_CREATED,{tracks:this.tracks})},a._onSBUpdateStart=function(a){this.operationQueue.current(a).onStart()},a._onSBUpdateEnd=function(a){var b=this.operationQueue;b.current(a).onComplete(),b.shiftAndExecuteNext(a)},a._onSBUpdateError=function(a,b){g.logger.error("[buffer-controller]: "+a+" SourceBuffer error",b),this.hls.trigger(f.Events.ERROR,{type:h.ErrorTypes.MEDIA_ERROR,details:h.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var c=this.operationQueue.current(a);c&&c.onError(b)},a.removeExecutor=function(a,j,k){var b=this.media,c=this.mediaSource,i=this.operationQueue,d=this.sourceBuffer[a];if(!b||!c||!d)return g.logger.warn("[buffer-controller]: Attempting to remove from the "+a+" SourceBuffer, but it does not exist"),void i.shiftAndExecuteNext(a);var l=Object(e.isFiniteNumber)(b.duration)?b.duration:1/0,m=Object(e.isFiniteNumber)(c.duration)?c.duration:1/0,f=Math.max(0,j),h=Math.min(k,l,m);h>f?(g.logger.log("[buffer-controller]: Removing ["+f+","+h+"] from the "+a+" SourceBuffer"),console.assert(!d.updating,a+" sourceBuffer must not be updating"),d.remove(f,h)):i.shiftAndExecuteNext(a)},a.appendExecutor=function(c,a){var d=this.operationQueue,b=this.sourceBuffer[a];if(!b)return g.logger.warn("[buffer-controller]: Attempting to append to the "+a+" SourceBuffer, but it does not exist"),void d.shiftAndExecuteNext(a);b.ended=!1,console.assert(!b.updating,a+" sourceBuffer must not be updating"),b.appendBuffer(c)},a.blockBuffers=function(b,a){var d=this;if(void 0===a&&(a=this.getSourceBufferTypes()),!a.length)return g.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve(b);var e=this.operationQueue,c=a.map(function(a){return e.appendBlocker(a)});Promise.all(c).then(function(){b(),a.forEach(function(a){var b=d.sourceBuffer[a];b&&b.updating||e.shiftAndExecuteNext(a)})})},a.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},a.addBufferListener=function(a,b,e){var c=this.sourceBuffer[a];if(c){var d=e.bind(this,a);this.listeners[a].push({event:b,listener:d}),c.addEventListener(b,d)}},a.removeBufferListeners=function(a){var b=this.sourceBuffer[a];b&&this.listeners[a].forEach(function(a){b.removeEventListener(a.event,a.listener)})},b}()},"./src/controller/buffer-operation-queue.ts":/*!**************************************************!*\
   !*** ./src/controller/buffer-operation-queue.ts ***!
   \**************************************************/ /*! exports provided: default */ function(c,b,a){"use strict";a.r(b),a.d(b,"default",function(){return e});var d=a(/*! ../utils/logger */ "./src/utils/logger.ts"),e=function(){function b(a){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=a}var a=b.prototype;return a.append=function(c,a){var b=this.queues[a];b.push(c),1===b.length&&this.buffers[a]&&this.executeNext(a)},a.insertAbort=function(b,a){this.queues[a].unshift(b),this.executeNext(a)},a.appendBlocker=function(a){var b,c=new Promise(function(a){b=a});return this.append({execute:b,onStart:function(){},onComplete:function(){},onError:function(){}},a),c},a.executeNext=function(a){var f=this.buffers,g=this.queues,c=f[a],b=g[a];if(b.length){var e=b[0];try{e.execute()}catch(h){d.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),e.onError(h),c&&c.updating||(b.shift(),this.executeNext(a))}}},a.shiftAndExecuteNext=function(a){this.queues[a].shift(),this.executeNext(a)},a.current=function(a){return this.queues[a][0]},b}()},"./src/controller/cap-level-controller.ts":/*!************************************************!*\
   !*** ./src/controller/cap-level-controller.ts ***!
   \************************************************/ /*! exports provided: default */ function(d,a,b){"use strict";b.r(a);var e=b(/*! ../events */ "./src/events.ts");function f(d,c){for(var b=0;b<c.length;b++){var a=c[b];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(d,a.key,a)}}var c=function(){function b(a){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=a,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var c,g,d,a=b.prototype;return a.setStreamController=function(a){this.streamController=a},a.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},a.registerListeners=function(){var a=this.hls;a.on(e.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),a.on(e.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),a.on(e.Events.MANIFEST_PARSED,this.onManifestParsed,this),a.on(e.Events.BUFFER_CODECS,this.onBufferCodecs,this),a.on(e.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},a.unregisterListener=function(){var a=this.hls;a.off(e.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),a.off(e.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),a.off(e.Events.MANIFEST_PARSED,this.onManifestParsed,this),a.off(e.Events.BUFFER_CODECS,this.onBufferCodecs,this),a.off(e.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},a.onFpsDropLevelCapping=function(c,a){b.isLevelAllowed(a.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(a.droppedLevel)},a.onMediaAttaching=function(b,a){this.media=a.media instanceof HTMLVideoElement?a.media:null},a.onManifestParsed=function(c,a){var b=this.hls;this.restrictedLevels=[],this.firstLevel=a.firstLevel,b.config.capLevelToPlayerSize&&a.video&&this.startCapping()},a.onBufferCodecs=function(b,a){this.hls.config.capLevelToPlayerSize&&a.video&&this.startCapping()},a.onMediaDetaching=function(){this.stopCapping()},a.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var b=this.hls.levels;if(b.length){var a=this.hls;a.autoLevelCapping=this.getMaxLevel(b.length-1),a.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=a.autoLevelCapping}}},a.getMaxLevel=function(d){var e=this,a=this.hls.levels;if(!a.length)return -1;var c=a.filter(function(c,a){return b.isLevelAllowed(a,e.restrictedLevels)&&a<=d});return this.clientRect=null,b.getMaxLevelByMediaSize(c,this.mediaWidth,this.mediaHeight)},a.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},a.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},a.getDimensions=function(){if(this.clientRect)return this.clientRect;var c=this.media,a={width:0,height:0};if(c){var b=c.getBoundingClientRect();a.width=b.width,a.height=b.height,a.width||a.height||(a.width=b.right-b.left||c.width||0,a.height=b.bottom-b.top||c.height||0)}return this.clientRect=a,a},b.isLevelAllowed=function(b,a){return void 0===a&&(a=[]),-1===a.indexOf(b)},b.getMaxLevelByMediaSize=function(a,g,h){if(!a||!a.length)return -1;for(var c,d,f=a.length-1,b=0;b<a.length;b+=1){var e=a[b];if((e.width>=g||e.height>=h)&&(c=e,!(d=a[b+1])||c.width!==d.width||c.height!==d.height)){f=b;break}}return f},c=b,d=[{key:"contentScaleFactor",get:function(){var a=1;try{a=self.devicePixelRatio}catch(b){}return a}}],g=[{key:"mediaWidth",get:function(){return this.getDimensions().width*b.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*b.contentScaleFactor}}],f(c.prototype,g),d&&f(c,d),b}();a.default=c},"./src/controller/eme-controller.ts":/*!******************************************!*\
   !*** ./src/controller/eme-controller.ts ***!
   \******************************************/ /*! exports provided: default */ function(d,b,a){"use strict";a.r(b);var e=a(/*! ../events */ "./src/events.ts"),f=a(/*! ../errors */ "./src/errors.ts"),g=a(/*! ../utils/logger */ "./src/utils/logger.ts"),h=a(/*! ../utils/mediakeys-helper */ "./src/utils/mediakeys-helper.ts");function i(d,c){for(var b=0;b<c.length;b++){var a=c[b];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(d,a.key,a)}}var c=function(){function b(a){this.hls=void 0,this._widevineLicenseUrl=void 0,this._licenseXhrSetup=void 0,this._licenseResponseCallback=void 0,this._emeEnabled=void 0,this._requestMediaKeySystemAccess=void 0,this._drmSystemOptions=void 0,this._config=void 0,this._mediaKeysList=[],this._media=null,this._hasSetMediaKeys=!1,this._requestLicenseFailureCount=0,this.mediaKeysPromise=null,this._onMediaEncrypted=this.onMediaEncrypted.bind(this),this.hls=a,this._config=a.config,this._widevineLicenseUrl=this._config.widevineLicenseUrl,this._licenseXhrSetup=this._config.licenseXhrSetup,this._licenseResponseCallback=this._config.licenseResponseCallback,this._emeEnabled=this._config.emeEnabled,this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc,this._drmSystemOptions=this._config.drmSystemOptions,this._registerListeners()}var c,d,j,a=b.prototype;return a.destroy=function(){this._unregisterListeners(),this.hls=this._onMediaEncrypted=null,this._requestMediaKeySystemAccess=null},a._registerListeners=function(){this.hls.on(e.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(e.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(e.Events.MANIFEST_PARSED,this.onManifestParsed,this)},a._unregisterListeners=function(){this.hls.off(e.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(e.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(e.Events.MANIFEST_PARSED,this.onManifestParsed,this)},a.getLicenseServerUrl=function(a){switch(a){case h.KeySystems.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+a+'"')},a._attemptKeySystemAccess=function(a,c,d){var f=this,e=function(a,e,f,g){if(a===h.KeySystems.WIDEVINE){var b,c,i,d;return b=e,c=f,i=g,d={audioCapabilities:[],videoCapabilities:[]},b.forEach(function(a){d.audioCapabilities.push({contentType:'audio/mp4; codecs="'+a+'"',robustness:i.audioRobustness||""})}),c.forEach(function(a){d.videoCapabilities.push({contentType:'video/mp4; codecs="'+a+'"',robustness:i.videoRobustness||""})}),[d]}throw new Error("Unknown key-system: "+a)}(a,c,d,this._drmSystemOptions);g.logger.log("Requesting encrypted media key-system access");var b=this.requestMediaKeySystemAccess(a,e);this.mediaKeysPromise=b.then(function(b){return f._onMediaKeySystemAccessObtained(a,b)}),b.catch(function(b){g.logger.error('Failed to obtain key-system "'+a+'" access:',b)})},a._onMediaKeySystemAccessObtained=function(a,c){var e=this;g.logger.log('Access for key-system "'+a+'" obtained');var d={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:c,mediaKeySystemDomain:a};this._mediaKeysList.push(d);var b=Promise.resolve().then(function(){return c.createMediaKeys()}).then(function(b){return d.mediaKeys=b,g.logger.log('Media-keys created for key-system "'+a+'"'),e._onMediaKeysCreated(),b});return b.catch(function(a){g.logger.error("Failed to create media-keys:",a)}),b},a._onMediaKeysCreated=function(){var a=this;this._mediaKeysList.forEach(function(b){b.mediaKeysSession||(b.mediaKeysSession=b.mediaKeys.createSession(),a._onNewMediaKeySession(b.mediaKeysSession))})},a._onNewMediaKeySession=function(a){var b=this;g.logger.log("New key-system session "+a.sessionId),a.addEventListener("message",function(c){b._onKeySessionMessage(a,c.message)},!1)},a._onKeySessionMessage=function(b,a){g.logger.log("Got EME message event, creating license request"),this._requestLicense(a,function(a){g.logger.log("Received license data (length: "+(a?a.byteLength:a)+"), updating key-session"),b.update(a)})},a.onMediaEncrypted=function(b){var c=this;if(g.logger.log('Media is encrypted using "'+b.initDataType+'" init data type'),!this.mediaKeysPromise)return g.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),void this.hls.trigger(e.Events.ERROR,{type:f.ErrorTypes.KEY_SYSTEM_ERROR,details:f.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});var a=function(a){c._media&&(c._attemptSetMediaKeys(a),c._generateRequestWithPreferredKeySession(b.initDataType,b.initData))};this.mediaKeysPromise.then(a).catch(a)},a._attemptSetMediaKeys=function(b){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var a=this._mediaKeysList[0];if(!a||!a.mediaKeys)return g.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this.hls.trigger(e.Events.ERROR,{type:f.ErrorTypes.KEY_SYSTEM_ERROR,details:f.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});g.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(a.mediaKeys),this._hasSetMediaKeys=!0}},a._generateRequestWithPreferredKeySession=function(b,c){var h=this,a=this._mediaKeysList[0];if(!a)return g.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.hls.trigger(e.Events.ERROR,{type:f.ErrorTypes.KEY_SYSTEM_ERROR,details:f.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});if(a.mediaKeysSessionInitialized)g.logger.warn("Key-Session already initialized but requested again");else{var d=a.mediaKeysSession;if(!d)return g.logger.error("Fatal: Media is encrypted but no key-session existing"),void this.hls.trigger(e.Events.ERROR,{type:f.ErrorTypes.KEY_SYSTEM_ERROR,details:f.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0});if(!c)return g.logger.warn("Fatal: initData required for generating a key session is null"),void this.hls.trigger(e.Events.ERROR,{type:f.ErrorTypes.KEY_SYSTEM_ERROR,details:f.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});g.logger.log('Generating key-session request for "'+b+'" init data type'),a.mediaKeysSessionInitialized=!0,d.generateRequest(b,c).then(function(){g.logger.debug("Key-session generation succeeded")}).catch(function(a){g.logger.error("Error generating key-session request:",a),h.hls.trigger(e.Events.ERROR,{type:f.ErrorTypes.KEY_SYSTEM_ERROR,details:f.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})}},a._createLicenseXhr=function(c,d,e){var a=new XMLHttpRequest;a.responseType="arraybuffer",a.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,a,c,d,e);var b=this._licenseXhrSetup;if(b)try{b.call(this.hls,a,c),b=void 0}catch(f){g.logger.error(f)}try{a.readyState||a.open("POST",c,!0),b&&b.call(this.hls,a,c)}catch(h){throw new Error("issue setting up KeySystem license XHR "+h)}return a},a._onLicenseRequestReadyStageChange=function(a,b,i,c){if(4===a.readyState){if(200===a.status){this._requestLicenseFailureCount=0,g.logger.log("License request succeeded");var d=a.response,h=this._licenseResponseCallback;if(h)try{d=h.call(this.hls,a,b)}catch(j){g.logger.error(j)}c(d)}else{if(g.logger.error("License Request XHR failed ("+b+"). Status: "+a.status+" ("+a.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>3)return void this.hls.trigger(e.Events.ERROR,{type:f.ErrorTypes.KEY_SYSTEM_ERROR,details:f.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});var k=3-this._requestLicenseFailureCount+1;g.logger.warn("Retrying license request, "+k+" attempts left"),this._requestLicense(i,c)}}},a._generateLicenseRequestChallenge=function(a,b){if(a.mediaKeySystemDomain===h.KeySystems.WIDEVINE)return b;throw new Error("unsupported key-system: "+a.mediaKeySystemDomain)},a._requestLicense=function(b,d){g.logger.log("Requesting content license for key-system");var a=this._mediaKeysList[0];if(!a)return g.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),void this.hls.trigger(e.Events.ERROR,{type:f.ErrorTypes.KEY_SYSTEM_ERROR,details:f.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});try{var c=this.getLicenseServerUrl(a.mediaKeySystemDomain),h=this._createLicenseXhr(c,b,d);g.logger.log("Sending license request to URL: "+c);var i=this._generateLicenseRequestChallenge(a,b);h.send(i)}catch(j){g.logger.error("Failure requesting DRM license: "+j),this.hls.trigger(e.Events.ERROR,{type:f.ErrorTypes.KEY_SYSTEM_ERROR,details:f.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},a.onMediaAttached=function(c,b){if(this._emeEnabled){var a=b.media;this._media=a,a.addEventListener("encrypted",this._onMediaEncrypted)}},a.onMediaDetached=function(){var a=this._media,b=this._mediaKeysList;a&&(a.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(b.map(function(a){if(a.mediaKeysSession)return a.mediaKeysSession.close().catch(function(){})})).then(function(){return a.setMediaKeys(null)}).catch(function(){}))},a.onManifestParsed=function(d,a){if(this._emeEnabled){var b=a.levels.map(function(a){return a.audioCodec}).filter(function(a){return!!a}),c=a.levels.map(function(a){return a.videoCodec}).filter(function(a){return!!a});this._attemptKeySystemAccess(h.KeySystems.WIDEVINE,b,c)}},c=b,d=[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}],i(c.prototype,d),j&&i(c,j),b}();b.default=c},"./src/controller/fps-controller.ts":/*!******************************************!*\
   !*** ./src/controller/fps-controller.ts ***!
   \******************************************/ /*! exports provided: default */ function(d,b,a){"use strict";a.r(b);var e=a(/*! ../events */ "./src/events.ts"),f=a(/*! ../utils/logger */ "./src/utils/logger.ts"),c=function(){function b(a){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=a,this.registerListeners()}var a=b.prototype;return a.setStreamController=function(a){this.streamController=a},a.registerListeners=function(){this.hls.on(e.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},a.unregisterListeners=function(){this.hls.off(e.Events.MEDIA_ATTACHING,this.onMediaAttaching)},a.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},a.onMediaAttaching=function(d,b){var c=this.hls.config;if(c.capLevelOnFPSDrop){var a=b.media instanceof self.HTMLVideoElement?b.media:null;this.media=a,a&&"function"==typeof a.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),c.fpsDroppedMonitoringPeriod)}},a.checkFPS=function(l,c,d){var h=performance.now();if(c){if(this.lastTime){var j=h-this.lastTime,g=d-this.lastDroppedFrames,i=c-this.lastDecodedFrames,k=1e3*g/j,a=this.hls;if(a.trigger(e.Events.FPS_DROP,{currentDropped:g,currentDecoded:i,totalDroppedFrames:d}),k>0&&g>a.config.fpsDroppedMonitoringThreshold*i){var b=a.currentLevel;f.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+b),b>0&&(-1===a.autoLevelCapping||a.autoLevelCapping>=b)&&(b-=1,a.trigger(e.Events.FPS_DROP_LEVEL_CAPPING,{level:b,droppedLevel:a.currentLevel}),a.autoLevelCapping=b,this.streamController.nextLevelSwitch())}}this.lastTime=h,this.lastDroppedFrames=d,this.lastDecodedFrames=c}},a.checkFPSInterval=function(){var a=this.media;if(a){if(this.isVideoPlaybackQualityAvailable){var b=a.getVideoPlaybackQuality();this.checkFPS(a,b.totalVideoFrames,b.droppedVideoFrames)}else this.checkFPS(a,a.webkitDecodedFrameCount,a.webkitDroppedFrameCount)}},b}();b.default=c},"./src/controller/fragment-finders.ts":/*!********************************************!*\
   !*** ./src/controller/fragment-finders.ts ***!
   \********************************************/ /*! exports provided: findFragmentByPDT, findFragmentByPTS, fragmentWithinToleranceTest, pdtWithinToleranceTest, findFragWithCC */ function(c,b,a){"use strict";a.r(b),a.d(b,"findFragmentByPDT",function(){return f}),a.d(b,"findFragmentByPTS",function(){return g}),a.d(b,"fragmentWithinToleranceTest",function(){return h}),a.d(b,"pdtWithinToleranceTest",function(){return i}),a.d(b,"findFragWithCC",function(){return j});var d=a(/*! ./src/polyfills/number */ "./src/polyfills/number.ts"),e=a(/*! ../utils/binary-search */ "./src/utils/binary-search.ts");function f(a,b,c){if(null===b||!Array.isArray(a)||!a.length||!Object(d.isFiniteNumber)(b)||b<(a[0].programDateTime||0)||b>=(a[a.length-1].endProgramDateTime||0))return null;c=c||0;for(var e=0;e<a.length;++e){var f=a[e];if(i(b,c,f))return f}return null}function g(f,b,c,d){void 0===c&&(c=0),void 0===d&&(d=0);var a=null;return(f?a=b[f.sn-b[0].sn+1]||null:0===c&&0===b[0].start&&(a=b[0]),a&&0===h(c,d,a))?a:e.default.search(b,h.bind(null,c,d))||a}function h(b,c,a){void 0===b&&(b=0),void 0===c&&(c=0);var d=Math.min(c,a.duration+(a.deltaPTS?a.deltaPTS:0));return a.start+a.duration-d<=b?1:a.start-d>b&&a.start?-1:0}function i(b,c,a){var d=1e3*Math.min(c,a.duration+(a.deltaPTS?a.deltaPTS:0));return(a.endProgramDateTime||0)-d>b}function j(a,b){return e.default.search(a,function(a){return a.cc<b?1:a.cc>b?-1:0})}},"./src/controller/fragment-tracker.ts":/*!********************************************!*\
   !*** ./src/controller/fragment-tracker.ts ***!
   \********************************************/ /*! exports provided: FragmentState, FragmentTracker */ function(e,c,a){"use strict";a.r(c),a.d(c,"FragmentState",function(){return d}),a.d(c,"FragmentTracker",function(){return h});var d,b,f=a(/*! ../events */ "./src/events.ts"),g=a(/*! ../types/loader */ "./src/types/loader.ts");(b=d||(d={})).NOT_LOADED="NOT_LOADED",b.BACKTRACKED="BACKTRACKED",b.APPENDING="APPENDING",b.PARTIAL="PARTIAL",b.OK="OK";var h=function(){function b(a){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=a,this._registerListeners()}var a=b.prototype;return a._registerListeners=function(){var a=this.hls;a.on(f.Events.BUFFER_APPENDED,this.onBufferAppended,this),a.on(f.Events.FRAG_BUFFERED,this.onFragBuffered,this),a.on(f.Events.FRAG_LOADED,this.onFragLoaded,this)},a._unregisterListeners=function(){var a=this.hls;a.off(f.Events.BUFFER_APPENDED,this.onBufferAppended,this),a.off(f.Events.FRAG_BUFFERED,this.onFragBuffered,this),a.off(f.Events.FRAG_LOADED,this.onFragLoaded,this)},a.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},a.getAppendedFrag=function(b,f){if(f===g.PlaylistLevelType.MAIN){var a=this.activeFragment,c=this.activeParts;if(!a)return null;if(c)for(var d=c.length;d--;){var e=c[d],h=e?e.end:a.appendedPTS;if(e.start<=b&& void 0!==h&&b<=h)return d>9&&(this.activeParts=c.slice(d-9)),e}else if(a.start<=b&& void 0!==a.appendedPTS&&b<=a.appendedPTS)return a}return this.getBufferedFrag(b,f)},a.getBufferedFrag=function(c,g){for(var d=this.fragments,e=Object.keys(d),f=e.length;f--;){var a=d[e[f]];if((null==a?void 0:a.body.type)===g&&a.buffered){var b=a.body;if(b.start<=c&&c<=b.end)return b}}return null},a.detectEvictedFragments=function(a,b,c){var d=this;Object.keys(this.fragments).forEach(function(g){var e=d.fragments[g];if(e){if(e.buffered){var f=e.range[a];f&&f.time.some(function(a){var c=!d.isTimeBuffered(a.startPTS,a.endPTS,b);return c&&d.removeFragment(e.body),c})}else e.body.type===c&&d.removeFragment(e.body)}})},a.detectPartialFragments=function(b){var f=this,c=this.timeRanges,d=b.frag,g=b.part;if(c&&"initSegment"!==d.sn){var e=j(d),a=this.fragments[e];a&&(Object.keys(c).forEach(function(b){var e=d.elementaryStreams[b];if(e){var h=c[b],i=null!==g|| !0===e.partial;a.range[b]=f.getBufferedTimes(d,g,i,h)}}),a.backtrack=a.loaded=null,Object.keys(a.range).length?a.buffered=!0:this.removeFragment(a.body))}},a.fragBuffered=function(b){var c=j(b),a=this.fragments[c];a&&(a.backtrack=a.loaded=null,a.buffered=!0)},a.getBufferedTimes=function(d,e,j,b){for(var f={time:[],partial:j},g=e?e.start:d.start,c=e?e.end:d.end,k=d.minEndPTS||c,l=d.maxStartPTS||g,a=0;a<b.length;a++){var h=b.start(a)-this.bufferPadding,i=b.end(a)+this.bufferPadding;if(l>=h&&k<=i){f.time.push({startPTS:Math.max(g,b.start(a)),endPTS:Math.min(c,b.end(a))});break}if(g<i&&c>h)f.partial=!0,f.time.push({startPTS:Math.max(g,b.start(a)),endPTS:Math.min(c,b.end(a))});else if(c<=h)break}return f},a.getPartialFragment=function(c){var d,e,f,a=null,g=0,h=this.bufferPadding,b=this.fragments;return Object.keys(b).forEach(function(k){var j=b[k];j&&i(j)&&(e=j.body.start-h,f=j.body.end+h,c>=e&&c<=f&&g<=(d=Math.min(c-e,f-c))&&(a=j.body,g=d))}),a},a.getState=function(b){var c=j(b),a=this.fragments[c];return a?a.buffered?i(a)?d.PARTIAL:d.OK:a.backtrack?d.BACKTRACKED:d.APPENDING:d.NOT_LOADED},a.backtrack=function(b,c){var d=j(b),a=this.fragments[d];if(!a||a.backtrack)return null;var e=a.backtrack=c||a.loaded;return a.loaded=null,e},a.getBacktrackData=function(c){var e=j(c),d=this.fragments[e];if(d){var a,b=d.backtrack;if(null!=b&&null!==(a=b.payload)&& void 0!==a&&a.byteLength)return b;this.removeFragment(c)}return null},a.isTimeBuffered=function(f,d,b){for(var c,e,a=0;a<b.length;a++){if(c=b.start(a)-this.bufferPadding,e=b.end(a)+this.bufferPadding,f>=c&&d<=e)return!0;if(d<=c)break}return!1},a.onFragLoaded=function(e,b){var a=b.frag,c=b.part;if("initSegment"!==a.sn&&!a.bitrateTest&&!c){var d=j(a);this.fragments[d]={body:a,loaded:b,backtrack:null,buffered:!1,range:Object.create(null)}}},a.onBufferAppended=function(f,a){var h=this,c=a.frag,d=a.part,e=a.timeRanges;if(c.type===g.PlaylistLevelType.MAIN){if(this.activeFragment=c,d){var b=this.activeParts;b||(this.activeParts=b=[]),b.push(d)}else this.activeParts=null}this.timeRanges=e,Object.keys(e).forEach(function(f){var a=e[f];if(h.detectEvictedFragments(f,a),!d)for(var b=0;b<a.length;b++)c.appendedPTS=Math.max(a.end(b),c.appendedPTS||0)})},a.onFragBuffered=function(b,a){this.detectPartialFragments(a)},a.hasFragment=function(a){var b=j(a);return!!this.fragments[b]},a.removeFragmentsInRange=function(a,b,c){var d=this;Object.keys(this.fragments).forEach(function(g){var f=d.fragments[g];if(f&&f.buffered){var e=f.body;e.type===c&&e.start<b&&e.end>a&&d.removeFragment(e)}})},a.removeFragment=function(a){var b=j(a);a.stats.loaded=0,a.clearElementaryStreamInfo(),delete this.fragments[b]},a.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},b}();function i(a){var b,c;return a.buffered&&((null===(b=a.range.video)|| void 0===b?void 0:b.partial)||(null===(c=a.range.audio)|| void 0===c?void 0:c.partial))}function j(a){return a.type+"_"+a.level+"_"+a.urlId+"_"+a.sn}},"./src/controller/gap-controller.ts":/*!******************************************!*\
   !*** ./src/controller/gap-controller.ts ***!
   \******************************************/ /*! exports provided: STALL_MINIMUM_DURATION_MS, MAX_START_GAP_JUMP, SKIP_BUFFER_HOLE_STEP_SECONDS, SKIP_BUFFER_RANGE_START, default */ function(c,b,a){"use strict";a.r(b),a.d(b,"STALL_MINIMUM_DURATION_MS",function(){return h}),a.d(b,"MAX_START_GAP_JUMP",function(){return i}),a.d(b,"SKIP_BUFFER_HOLE_STEP_SECONDS",function(){return j}),a.d(b,"SKIP_BUFFER_RANGE_START",function(){return k}),a.d(b,"default",function(){return l});var d=a(/*! ../utils/buffer-helper */ "./src/utils/buffer-helper.ts"),e=a(/*! ../errors */ "./src/errors.ts"),f=a(/*! ../events */ "./src/events.ts"),g=a(/*! ../utils/logger */ "./src/utils/logger.ts"),h=250,i=2,j=.1,k=.05,l=function(){function b(a,b,c,d){this.config=void 0,this.media=void 0,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=a,this.media=b,this.fragmentTracker=c,this.hls=d}var a=b.prototype;return a.destroy=function(){this.hls=this.fragmentTracker=this.media=null},a.poll=function(p){var q=this.config,a=this.media,f=this.stalled,b=a.currentTime,c=a.seeking,r=this.seeking&&!c,s=!this.seeking&&c;if(this.seeking=c,b===p){if((s||r)&&(this.stalled=null),!a.paused&&!a.ended&&0!==a.playbackRate&&d.BufferHelper.getBuffered(a).length){var e=d.BufferHelper.bufferInfo(a,b,0),t=e.len>0,j=e.nextStart||0;if(t||j){if(c){var u=e.len>i,v=!j||j-b>i&&!this.fragmentTracker.getPartialFragment(b);if(u||v)return;this.moved=!1}if(!this.moved&&null!==this.stalled){var k,m=Math.max(j,e.start||0)-b,l=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,w=(null==l||null===(k=l.details)|| void 0===k?void 0:k.live)?2*l.details.targetduration:i;if(m>0&&m<=w)return void this._trySkipBufferHole(null)}var n=self.performance.now();if(null!==f){var o=n-f;!c&&o>=h&&this._reportStall(e.len);var x=d.BufferHelper.bufferInfo(a,b,q.maxBufferHole);this._tryFixBufferStall(x,o)}else this.stalled=n}}}else if(this.moved=!0,null!==f){if(this.stallReported){var y=self.performance.now()-f;g.logger.warn("playback not stuck anymore @"+b+", after "+Math.round(y)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}},a._tryFixBufferStall=function(c,d){var a=this.config,e=this.fragmentTracker,f=this.media.currentTime,b=e.getPartialFragment(f);b&&this._trySkipBufferHole(b)||c.len>a.maxBufferHole&&d>1e3*a.highBufferWatchdogPeriod&&(g.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())},a._reportStall=function(a){var b=this.hls,c=this.media;this.stallReported||(this.stallReported=!0,g.logger.warn("Playback stalling at @"+c.currentTime+" due to low buffer (buffer="+a+")"),b.trigger(f.Events.ERROR,{type:e.ErrorTypes.MEDIA_ERROR,details:e.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:a}))},a._trySkipBufferHole=function(l){for(var o=this.config,p=this.hls,a=this.media,b=a.currentTime,m=0,i=d.BufferHelper.getBuffered(a),c=0;c<i.length;c++){var n=i.start(c);if(b+o.maxBufferHole>=m&&b<n){var h=Math.max(n+k,a.currentTime+j);return g.logger.warn("skipping hole, adjusting currentTime from "+b+" to "+h),this.moved=!0,this.stalled=null,a.currentTime=h,l&&p.trigger(f.Events.ERROR,{type:e.ErrorTypes.MEDIA_ERROR,details:e.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+b+" to "+h,frag:l}),h}m=i.end(c)}return 0},a._tryNudgeBuffer=function(){var a=this.config,d=this.hls,h=this.media,b=h.currentTime,c=(this.nudgeRetry||0)+1;if(this.nudgeRetry=c,c<a.nudgeMaxRetry){var i=b+c*a.nudgeOffset;g.logger.warn("Nudging 'currentTime' from "+b+" to "+i),h.currentTime=i,d.trigger(f.Events.ERROR,{type:e.ErrorTypes.MEDIA_ERROR,details:e.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else g.logger.error("Playhead still not moving while enough data buffered @"+b+" after "+a.nudgeMaxRetry+" nudges"),d.trigger(f.Events.ERROR,{type:e.ErrorTypes.MEDIA_ERROR,details:e.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})},b}()},"./src/controller/id3-track-controller.ts":/*!************************************************!*\
   !*** ./src/controller/id3-track-controller.ts ***!
   \************************************************/ /*! exports provided: default */ function(d,b,a){"use strict";a.r(b);var e=a(/*! ../events */ "./src/events.ts"),f=a(/*! ../utils/texttrack-utils */ "./src/utils/texttrack-utils.ts"),g=a(/*! ../demux/id3 */ "./src/demux/id3.ts"),c=function(){function b(a){this.hls=void 0,this.id3Track=null,this.media=null,this.hls=a,this._registerListeners()}var a=b.prototype;return a.destroy=function(){this._unregisterListeners()},a._registerListeners=function(){var a=this.hls;a.on(e.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.on(e.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.on(e.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),a.on(e.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},a._unregisterListeners=function(){var a=this.hls;a.off(e.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.off(e.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.off(e.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),a.off(e.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},a.onMediaAttached=function(b,a){this.media=a.media},a.onMediaDetaching=function(){this.id3Track&&(Object(f.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null)},a.getID3Track=function(c){if(this.media){for(var b=0;b<c.length;b++){var a=c[b];if("metadata"===a.kind&&"id3"===a.label)return Object(f.sendAddTrackEvent)(a,this.media),a}return this.media.addTextTrack("metadata","id3")}},a.onFragParsingMetadata=function(m,h){if(this.media){var k=h.frag,b=h.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var l=self.WebKitDataCue||self.VTTCue||self.TextTrackCue,a=0;a<b.length;a++){var c=g.getID3Frames(b[a].data);if(c){var d=b[a].pts,e=a<b.length-1?b[a+1].pts:k.end;e-d<=0&&(e=d+.25);for(var f=0;f<c.length;f++){var i=c[f];if(!g.isTimeStampFrame(i)){var j=new l(d,e,"");j.value=i,this.id3Track.addCue(j)}}}}}},a.onBufferFlushing=function(g,a){var d=a.startOffset,e=a.endOffset,b=a.type;if(!b||"audio"===b){var c=this.id3Track;c&&Object(f.removeCuesInRange)(c,d,e)}},b}();b.default=c},"./src/controller/latency-controller.ts":/*!**********************************************!*\
   !*** ./src/controller/latency-controller.ts ***!
   \**********************************************/ /*! exports provided: default */ function(c,b,a){"use strict";a.r(b),a.d(b,"default",function(){return h});var d=a(/*! ../errors */ "./src/errors.ts"),e=a(/*! ../events */ "./src/events.ts"),f=a(/*! ../utils/logger */ "./src/utils/logger.ts");function g(d,c){for(var b=0;b<c.length;b++){var a=c[b];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(d,a.key,a)}}var h=function(){function b(a){var b=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return b.timeupdate()},this.hls=a,this.config=a.config,this.registerListeners()}var c,h,i,a=b.prototype;return a.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},a.registerListeners=function(){this.hls.on(e.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(e.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(e.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(e.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(e.Events.ERROR,this.onError,this)},a.unregisterListeners=function(){this.hls.off(e.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(e.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(e.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(e.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(e.Events.ERROR,this.onError)},a.onMediaAttached=function(b,a){this.media=a.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},a.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},a.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},a.onLevelUpdated=function(c,b){var a=b.details;this.levelDetails=a,a.advanced&&this.timeupdate(),!a.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},a.onError=function(b,a){a.details===d.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,f.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},a.timeupdate=function(){var a=this.media,b=this.levelDetails;if(a&&b){this.currentTime=a.currentTime;var c=this.computeLatency();if(null!==c){this._latency=c;var f=this.config,h=f.lowLatencyMode,g=f.maxLiveSyncPlaybackRate;if(h&&1!==g){var d=this.targetLatency;if(null!==d){var e=c-d,i=e<Math.min(this.maxLatency,d+b.targetduration);if(b.live&&i&&e>.05&&this.forwardBufferLength>1){var j=Math.min(2,Math.max(1,g)),k=Math.round(2/(1+Math.exp(-0.75*e-this.edgeStalled))*20)/20;a.playbackRate=Math.min(j,Math.max(1,k))}else 1!==a.playbackRate&&0!==a.playbackRate&&(a.playbackRate=1)}}}}},a.estimateLiveEdge=function(){var a=this.levelDetails;return null===a?null:a.edge+a.age},a.computeLatency=function(){var a=this.estimateLiveEdge();return null===a?null:a-this.currentTime},c=b,h=[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var a=this.config,b=this.levelDetails;return void 0!==a.liveMaxLatencyDuration?a.liveMaxLatencyDuration:b?a.liveMaxLatencyDurationCount*b.targetduration:0}},{key:"targetLatency",get:function(){var a=this.levelDetails;if(null===a)return null;var g=a.holdBack,h=a.partHoldBack,d=a.targetduration,b=this.config,e=b.liveSyncDuration,i=b.liveSyncDurationCount,j=b.lowLatencyMode,f=this.hls.userConfig,c=j&&h||g;(f.liveSyncDuration||f.liveSyncDurationCount||0===c)&&(c=void 0!==e?e:i*d);var k=d;return c+Math.min(1*this.stallCount,k)}},{key:"liveSyncPosition",get:function(){var b=this.estimateLiveEdge(),c=this.targetLatency,a=this.levelDetails;if(null===b||null===c||null===a)return null;var d=a.edge,e=b-c-this.edgeStalled,f=d-a.totalduration,g=d-(this.config.lowLatencyMode&&a.partTarget||a.targetduration);return Math.min(Math.max(f,e),g)}},{key:"drift",get:function(){var a=this.levelDetails;return null===a?1:a.drift}},{key:"edgeStalled",get:function(){var a=this.levelDetails;if(null===a)return 0;var b=3*(this.config.lowLatencyMode&&a.partTarget||a.targetduration);return Math.max(a.age-b,0)}},{key:"forwardBufferLength",get:function(){var a=this.media,b=this.levelDetails;if(!a||!b)return 0;var c=a.buffered.length;return c?a.buffered.end(c-1):b.edge-this.currentTime}}],g(c.prototype,h),i&&g(c,i),b}()},"./src/controller/level-controller.ts":/*!********************************************!*\
   !*** ./src/controller/level-controller.ts ***!
   \********************************************/ /*! exports provided: default */ function(d,b,a){"use strict";a.r(b),a.d(b,"default",function(){return o});var e=a(/*! ../types/level */ "./src/types/level.ts"),f=a(/*! ../events */ "./src/events.ts"),g=a(/*! ../errors */ "./src/errors.ts"),h=a(/*! ../utils/codecs */ "./src/utils/codecs.ts"),i=a(/*! ./level-helper */ "./src/controller/level-helper.ts"),c=a(/*! ./base-playlist-controller */ "./src/controller/base-playlist-controller.ts"),j=a(/*! ../types/loader */ "./src/types/loader.ts");function k(){return(k=Object.assign||function(d){for(var a=1;a<arguments.length;a++){var b=arguments[a];for(var c in b)Object.prototype.hasOwnProperty.call(b,c)&&(d[c]=b[c])}return d}).apply(this,arguments)}function l(d,c){for(var b=0;b<c.length;b++){var a=c[b];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(d,a.key,a)}}function m(a,b){return(m=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a})(a,b)}var n=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),o=function(p){function b(b){var a;return(a=p.call(this,b,"[level-controller]")||this)._levels=[],a._firstLevel=-1,a._startLevel=void 0,a.currentLevelIndex=-1,a.manualLevelIndex=-1,a.onParsedComplete=void 0,a._registerListeners(),a}r=p,(q=b).prototype=Object.create(r.prototype),q.prototype.constructor=q,m(q,r);var q,r,c,d,o,a=b.prototype;return a._registerListeners=function(){var a=this.hls;a.on(f.Events.MANIFEST_LOADED,this.onManifestLoaded,this),a.on(f.Events.LEVEL_LOADED,this.onLevelLoaded,this),a.on(f.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),a.on(f.Events.FRAG_LOADED,this.onFragLoaded,this),a.on(f.Events.ERROR,this.onError,this)},a._unregisterListeners=function(){var a=this.hls;a.off(f.Events.MANIFEST_LOADED,this.onManifestLoaded,this),a.off(f.Events.LEVEL_LOADED,this.onLevelLoaded,this),a.off(f.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),a.off(f.Events.FRAG_LOADED,this.onFragLoaded,this),a.off(f.Events.ERROR,this.onError,this)},a.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,p.prototype.destroy.call(this)},a.startLoad=function(){this._levels.forEach(function(a){a.loadError=0}),p.prototype.startLoad.call(this)},a.onManifestLoaded=function(r,b){var j,s,a=[],c=[],k=[],t={},o=!1,l=!1,m=!1;if(b.levels.forEach(function(b){var c=b.attrs;o=o||!(!b.width||!b.height),l=l||!!b.videoCodec,m=m||!!b.audioCodec,n&&b.audioCodec&& -1!==b.audioCodec.indexOf("mp4a.40.34")&&(b.audioCodec=void 0);var d=b.bitrate+"-"+b.attrs.RESOLUTION+"-"+b.attrs.CODECS;(s=t[d])?s.url.push(b.url):(s=new e.Level(b),t[d]=s,a.push(s)),c&&(c.AUDIO&&Object(i.addGroupId)(s,"audio",c.AUDIO),c.SUBTITLES&&Object(i.addGroupId)(s,"text",c.SUBTITLES))}),(o||l)&&m&&(a=a.filter(function(a){var b=a.videoCodec,c=a.width,d=a.height;return!!b||!(!c||!d)})),a=a.filter(function(a){var b=a.audioCodec,c=a.videoCodec;return(!b||Object(h.isCodecSupportedInMp4)(b,"audio"))&&(!c||Object(h.isCodecSupportedInMp4)(c,"video"))}),b.audioTracks&&(c=b.audioTracks.filter(function(a){return!a.audioCodec||Object(h.isCodecSupportedInMp4)(a.audioCodec,"audio")}),Object(i.assignTrackIdsByGroup)(c)),b.subtitles&&(k=b.subtitles,Object(i.assignTrackIdsByGroup)(k)),a.length>0){j=a[0].bitrate,a.sort(function(a,b){return a.bitrate-b.bitrate}),this._levels=a;for(var d=0;d<a.length;d++)if(a[d].bitrate===j){this._firstLevel=d,this.log("manifest loaded, "+a.length+" level(s) found, first bitrate: "+j);break}var p=m&&!l,q={levels:a,audioTracks:c,subtitleTracks:k,firstLevel:this._firstLevel,stats:b.stats,audio:m,video:l,altAudio:!p&&c.some(function(a){return!!a.url})};this.hls.trigger(f.Events.MANIFEST_PARSED,q),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(f.Events.ERROR,{type:g.ErrorTypes.MEDIA_ERROR,details:g.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:b.url,reason:"no level with compatible codecs found in manifest"})},a.onError=function(i,a){if(p.prototype.onError.call(this,i,a),!a.fatal){var b=a.context,c=this._levels[this.currentLevelIndex];if(b&&(b.type===j.PlaylistContextType.AUDIO_TRACK&&c.audioGroupIds&&b.groupId===c.audioGroupIds[c.urlId]||b.type===j.PlaylistContextType.SUBTITLE_TRACK&&c.textGroupIds&&b.groupId===c.textGroupIds[c.urlId]))this.redundantFailover(this.currentLevelIndex);else{var d,e=!1,h=!0;switch(a.details){case g.ErrorDetails.FRAG_LOAD_ERROR:case g.ErrorDetails.FRAG_LOAD_TIMEOUT:case g.ErrorDetails.KEY_LOAD_ERROR:case g.ErrorDetails.KEY_LOAD_TIMEOUT:if(a.frag){var f=this._levels[a.frag.level];f?(f.fragmentError++,f.fragmentError>this.hls.config.fragLoadingMaxRetry&&(d=a.frag.level)):d=a.frag.level}break;case g.ErrorDetails.LEVEL_LOAD_ERROR:case g.ErrorDetails.LEVEL_LOAD_TIMEOUT:b&&(b.deliveryDirectives&&(h=!1),d=b.level),e=!0;break;case g.ErrorDetails.REMUX_ALLOC_ERROR:d=a.level,e=!0}void 0!==d&&this.recoverLevel(a,d,e,h)}}},a.recoverLevel=function(a,b,f,g){var h=a.details,d=this._levels[b];if(d.loadError++,f){if(!this.retryLoadingOrFail(a))return void(this.currentLevelIndex=-1);a.levelRetry=!0}if(g){var e=d.url.length;if(e>1&&d.loadError<e)a.levelRetry=!0,this.redundantFailover(b);else if(-1===this.manualLevelIndex){var c=0===b?this._levels.length-1:b-1;this.currentLevelIndex!==c&&0===this._levels[c].loadError&&(this.warn(h+": switch to "+c),a.levelRetry=!0,this.hls.nextAutoLevel=c)}}},a.redundantFailover=function(a){var b=this._levels[a],c=b.url.length;if(c>1){var d=(b.urlId+1)%c;this.warn("Switching to redundant URL-id "+d),this._levels.forEach(function(a){a.urlId=d}),this.level=a}},a.onFragLoaded=function(d,c){var a=c.frag;if(void 0!==a&&a.type===j.PlaylistLevelType.MAIN){var b=this._levels[a.level];void 0!==b&&(b.fragmentError=0,b.loadError=0)}},a.onLevelLoaded=function(g,a){var d,e,b=a.level,f=a.details,c=this._levels[b];if(!c)return this.warn("Invalid level index "+b),void(null!==(e=a.deliveryDirectives)&& void 0!==e&&e.skip&&(f.deltaUpdateFailed=!0));b===this.currentLevelIndex?(0===c.fragmentError&&(c.loadError=0,this.retryCount=0),this.playlistLoaded(b,a,c.details)):null!==(d=a.deliveryDirectives)&& void 0!==d&&d.skip&&(f.deltaUpdateFailed=!0)},a.onAudioTrackSwitched=function(f,d){var a=this.hls.levels[this.currentLevelIndex];if(a&&a.audioGroupIds){for(var c=-1,e=this.hls.audioTracks[d.id].groupId,b=0;b<a.audioGroupIds.length;b++)if(a.audioGroupIds[b]===e){c=b;break}c!==a.urlId&&(a.urlId=c,this.startLoad())}},a.loadPlaylist=function(a){var d=this.currentLevelIndex,b=this._levels[d];if(this.canLoad&&b&&b.url.length>0){var e=b.urlId,c=b.url[e];if(a)try{c=a.addDirectives(c)}catch(g){this.warn("Could not construct new URL with HLS Delivery Directives: "+g)}this.log("Attempt loading level index "+d+(a?" at sn "+a.msn+" part "+a.part:"")+" with URL-id "+e+" "+c),this.clearTimer(),this.hls.trigger(f.Events.LEVEL_LOADING,{url:c,level:d,id:e,deliveryDirectives:a||null})}},a.removeLevel=function(b,c){var d=function(b,a){return a!==c},a=this._levels.filter(function(a,e){return e!==b||a.url.length>1&& void 0!==c&&(a.url=a.url.filter(d),a.audioGroupIds&&(a.audioGroupIds=a.audioGroupIds.filter(d)),a.textGroupIds&&(a.textGroupIds=a.textGroupIds.filter(d)),a.urlId=0,!0)}).map(function(b,c){var a=b.details;return null!=a&&a.fragments&&a.fragments.forEach(function(a){a.level=c}),b});this._levels=a,this.hls.trigger(f.Events.LEVELS_UPDATED,{levels:a})},c=b,d=[{key:"levels",get:function(){return 0===this._levels.length?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(a){var d,b=this._levels;if(0!==b.length&&(this.currentLevelIndex!==a||null===(d=b[a])|| void 0===d||!d.details)){if(a<0||a>=b.length){var e=a<0;if(this.hls.trigger(f.Events.ERROR,{type:g.ErrorTypes.OTHER_ERROR,details:g.ErrorDetails.LEVEL_SWITCH_ERROR,level:a,fatal:e,reason:"invalid level idx"}),e)return;a=Math.min(a,b.length-1)}this.clearTimer();var h=this.currentLevelIndex,i=b[h],c=b[a];this.log("switching to level "+a+" from "+h),this.currentLevelIndex=a;var j=k({},c,{level:a,maxBitrate:c.maxBitrate,uri:c.uri,urlId:c.urlId});delete j._urlId,this.hls.trigger(f.Events.LEVEL_SWITCHING,j);var l=c.details;if(!l||l.live){var m=this.switchParams(c.uri,null==i?void 0:i.details);this.loadPlaylist(m)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(a){this.manualLevelIndex=a,void 0===this._startLevel&&(this._startLevel=a),-1!==a&&(this.level=a)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(a){this._firstLevel=a}},{key:"startLevel",get:function(){if(void 0===this._startLevel){var a=this.hls.config.startLevel;return void 0!==a?a:this._firstLevel}return this._startLevel},set:function(a){this._startLevel=a}},{key:"nextLoadLevel",get:function(){return -1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(a){this.level=a,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=a)}}],l(c.prototype,d),o&&l(c,o),b}(c.default)},"./src/controller/level-helper.ts":/*!****************************************!*\
   !*** ./src/controller/level-helper.ts ***!
   \****************************************/ /*! exports provided: addGroupId, assignTrackIdsByGroup, updatePTS, updateFragPTSDTS, mergeDetails, mapPartIntersection, mapFragmentIntersection, adjustSliding, addSliding, computeReloadInterval, getFragmentWithSN, getPartWith */ function(c,b,a){"use strict";a.r(b),a.d(b,"addGroupId",function(){return f}),a.d(b,"assignTrackIdsByGroup",function(){return g}),a.d(b,"updatePTS",function(){return h}),a.d(b,"updateFragPTSDTS",function(){return j}),a.d(b,"mergeDetails",function(){return k}),a.d(b,"mapPartIntersection",function(){return l}),a.d(b,"mapFragmentIntersection",function(){return m}),a.d(b,"adjustSliding",function(){return n}),a.d(b,"addSliding",function(){return o}),a.d(b,"computeReloadInterval",function(){return p}),a.d(b,"getFragmentWithSN",function(){return q}),a.d(b,"getPartWith",function(){return r});var d=a(/*! ./src/polyfills/number */ "./src/polyfills/number.ts"),e=a(/*! ../utils/logger */ "./src/utils/logger.ts");function f(a,c,b){switch(c){case"audio":a.audioGroupIds||(a.audioGroupIds=[]),a.audioGroupIds.push(b);break;case"text":a.textGroupIds||(a.textGroupIds=[]),a.textGroupIds.push(b)}}function g(a){var b={};a.forEach(function(c){var a=c.groupId||"";c.id=b[a]=b[a]||0,b[a]++})}function h(a,b,c){i(a[b],a[c])}function i(a,b){var f=b.startPTS;if(Object(d.isFiniteNumber)(f)){var c,e=0;b.sn>a.sn?(e=f-a.start,c=a):(e=a.start-f,c=b),c.duration!==e&&(c.duration=e)}else b.sn>a.sn?a.cc===b.cc&&a.minEndPTS?b.start=a.start+(a.minEndPTS-a.start):b.start=a.start+a.duration:b.start=Math.max(a.start-b.duration,0)}function j(f,a,b,g,j,k){g-b<=0&&(e.logger.warn("Fragment should have a positive duration",a),g=b+a.duration,k=j+a.duration);var o=b,p=g,l=a.startPTS,q=a.endPTS;if(Object(d.isFiniteNumber)(l)){var r=Math.abs(l-b);Object(d.isFiniteNumber)(a.deltaPTS)?a.deltaPTS=Math.max(r,a.deltaPTS):a.deltaPTS=r,o=Math.max(b,l),b=Math.min(b,l),j=Math.min(j,a.startDTS),p=Math.min(g,q),g=Math.max(g,q),k=Math.max(k,a.endDTS)}a.duration=g-b;var s=b-a.start;a.appendedPTS=g,a.start=a.startPTS=b,a.maxStartPTS=o,a.startDTS=j,a.endPTS=g,a.minEndPTS=p,a.endDTS=k;var c,m=a.sn;if(!f||m<f.startSN||m>f.endSN)return 0;var n=m-f.startSN,h=f.fragments;for(h[n]=a,c=n;c>0;c--)i(h[c],h[c-1]);for(c=n;c<h.length-1;c++)i(h[c],h[c+1]);return f.fragmentHint&&i(h[h.length-1],f.fragmentHint),f.PTSKnown=f.alignedSliding=!0,s}function k(b,a){for(var r=null,k=b.fragments,g=k.length-1;g>=0;g--){var o=k[g].initSegment;if(o){r=o;break}}b.fragmentHint&&delete b.fragmentHint.endPTS;var c,p=0;if(m(b,a,function(b,e){var f;b.relurl&&(p=b.cc-e.cc),Object(d.isFiniteNumber)(b.startPTS)&&Object(d.isFiniteNumber)(b.endPTS)&&(e.start=e.startPTS=b.startPTS,e.startDTS=b.startDTS,e.appendedPTS=b.appendedPTS,e.maxStartPTS=b.maxStartPTS,e.endPTS=b.endPTS,e.endDTS=b.endDTS,e.minEndPTS=b.minEndPTS,e.duration=b.endPTS-b.startPTS,e.duration&&(c=e),a.PTSKnown=a.alignedSliding=!0),e.elementaryStreams=b.elementaryStreams,e.loader=b.loader,e.stats=b.stats,e.urlId=b.urlId,b.initSegment?(e.initSegment=b.initSegment,r=b.initSegment):e.initSegment&&e.initSegment.relurl!=(null===(f=r)|| void 0===f?void 0:f.relurl)||(e.initSegment=r)}),a.skippedSegments&&(a.deltaUpdateFailed=a.fragments.some(function(a){return!a}),a.deltaUpdateFailed)){e.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var s=a.skippedSegments;s--;)a.fragments.shift();a.startSN=a.fragments[0].sn,a.startCC=a.fragments[0].cc}var f=a.fragments;if(p){e.logger.warn("discontinuity sliding from playlist, take drift into account");for(var h=0;h<f.length;h++)f[h].cc+=p}a.skippedSegments&&(a.startCC=a.fragments[0].cc),l(b.partList,a.partList,function(a,b){b.elementaryStreams=a.elementaryStreams,b.stats=a.stats}),c?j(a,c,c.startPTS,c.endPTS,c.startDTS,c.endDTS):n(b,a),f.length&&(a.totalduration=a.edge-f[0].start),a.driftStartTime=b.driftStartTime,a.driftStart=b.driftStart;var i=a.advancedDateTime;if(a.advanced&&i){var q=a.edge;a.driftStart||(a.driftStartTime=i,a.driftStart=q),a.driftEndTime=i,a.driftEnd=q}else a.driftEndTime=b.driftEndTime,a.driftEnd=b.driftEnd,a.advancedDateTime=b.advancedDateTime}function l(d,e,g){if(d&&e)for(var f=0,a=0,h=d.length;a<=h;a++){var b=d[a],c=e[a+f];b&&c&&b.index===c.index&&b.fragment.sn===c.fragment.sn?g(b,c):f--}}function m(b,a,g){for(var e=a.skippedSegments,h=Math.max(b.startSN,a.startSN)-a.startSN,i=(b.fragmentHint?1:0)+(e?a.endSN:Math.min(b.endSN,a.endSN))-a.startSN,j=a.startSN-b.startSN,k=a.fragmentHint?a.fragments.concat(a.fragmentHint):a.fragments,l=b.fragmentHint?b.fragments.concat(b.fragmentHint):b.fragments,c=h;c<=i;c++){var f=l[j+c],d=k[c];e&&!d&&c<e&&(d=a.fragments[c]=f),f&&d&&g(f,d)}}function n(c,a){var b=a.startSN+a.skippedSegments-c.startSN,d=c.fragments;b<0||b>=d.length||o(a,d[b].start)}function o(a,b){if(b){for(var d=a.fragments,c=a.skippedSegments;c<d.length;c++)d[c].start+=b;a.fragmentHint&&(a.fragmentHint.start+=b)}}function p(a,f){var b,c=1e3*a.levelTargetDuration,g=c/2,d=a.age,h=d>0&&d<3*c,i=f.loading.end-f.loading.start,e=a.availabilityDelay;return!1===a.updated?h?(b=Math.max(Math.min(g,2*i),333*a.misses),a.availabilityDelay=(a.availabilityDelay||0)+b):b=g:h?(e=Math.min(e||c/2,d),a.availabilityDelay=e,b=e+c-d):b=c-i,Math.round(b)}function q(d,a,e){if(!d||!d.details)return null;var b=d.details,c=b.fragments[a-b.startSN];return c||((c=b.fragmentHint)&&c.sn===a?c:a<b.startSN&&e&&e.sn===a?e:null)}function r(a,e,f){if(!a||!a.details)return null;var b=a.details.partList;if(b)for(var d=b.length;d--;){var c=b[d];if(c.index===f&&c.fragment.sn===e)return c}return null}},"./src/controller/stream-controller.ts":/*!*********************************************!*\
   !*** ./src/controller/stream-controller.ts ***!
   \*********************************************/ /*! exports provided: default */ function(d,b,a){"use strict";a.r(b),a.d(b,"default",function(){return s});var e=a(/*! ./src/polyfills/number */ "./src/polyfills/number.ts"),c=a(/*! ./base-stream-controller */ "./src/controller/base-stream-controller.ts"),f=a(/*! ../is-supported */ "./src/is-supported.ts"),g=a(/*! ../events */ "./src/events.ts"),h=a(/*! ../utils/buffer-helper */ "./src/utils/buffer-helper.ts"),i=a(/*! ./fragment-tracker */ "./src/controller/fragment-tracker.ts"),j=a(/*! ../types/loader */ "./src/types/loader.ts"),k=a(/*! ../loader/fragment */ "./src/loader/fragment.ts"),l=a(/*! ../demux/transmuxer-interface */ "./src/demux/transmuxer-interface.ts"),m=a(/*! ../types/transmuxer */ "./src/types/transmuxer.ts"),n=a(/*! ./gap-controller */ "./src/controller/gap-controller.ts"),o=a(/*! ../errors */ "./src/errors.ts"),p=a(/*! ../utils/logger */ "./src/utils/logger.ts");function q(d,c){for(var b=0;b<c.length;b++){var a=c[b];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(d,a.key,a)}}function r(a,b){return(r=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a})(a,b)}var s=function(u){function b(b,c){var a;return(a=u.call(this,b,c,"[stream-controller]")||this).audioCodecSwap=!1,a.gapController=null,a.level=-1,a._forceStartLoad=!1,a.altAudio=!1,a.audioOnly=!1,a.fragPlaying=null,a.onvplaying=null,a.onvseeked=null,a.fragLastKbps=0,a.stalled=!1,a.couldBacktrack=!1,a.audioCodecSwitch=!1,a.videoBuffer=null,a._registerListeners(),a}w=u,(v=b).prototype=Object.create(w.prototype),v.prototype.constructor=v,r(v,w);var v,w,d,s,t,a=b.prototype;return a._registerListeners=function(){var a=this.hls;a.on(g.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.on(g.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.on(g.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.on(g.Events.MANIFEST_PARSED,this.onManifestParsed,this),a.on(g.Events.LEVEL_LOADING,this.onLevelLoading,this),a.on(g.Events.LEVEL_LOADED,this.onLevelLoaded,this),a.on(g.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),a.on(g.Events.ERROR,this.onError,this),a.on(g.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),a.on(g.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),a.on(g.Events.BUFFER_CREATED,this.onBufferCreated,this),a.on(g.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),a.on(g.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),a.on(g.Events.FRAG_BUFFERED,this.onFragBuffered,this)},a._unregisterListeners=function(){var a=this.hls;a.off(g.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.off(g.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.off(g.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.off(g.Events.MANIFEST_PARSED,this.onManifestParsed,this),a.off(g.Events.LEVEL_LOADED,this.onLevelLoaded,this),a.off(g.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),a.off(g.Events.ERROR,this.onError,this),a.off(g.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),a.off(g.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),a.off(g.Events.BUFFER_CREATED,this.onBufferCreated,this),a.off(g.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),a.off(g.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),a.off(g.Events.FRAG_BUFFERED,this.onFragBuffered,this)},a.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},a.startLoad=function(d){if(this.levels){var e=this.lastCurrentTime,a=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var b=a.startLevel;-1===b&&(a.config.testBandwidth?(b=0,this.bitrateTest=!0):b=a.nextAutoLevel),this.level=a.nextLoadLevel=b,this.loadedmetadata=!1}e>0&& -1===d&&(this.log("Override startPosition with lastCurrentTime @"+e.toFixed(3)),d=e),this.state=c.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=d,this.tick()}else this._forceStartLoad=!0,this.state=c.State.STOPPED},a.stopLoad=function(){this._forceStartLoad=!1,u.prototype.stopLoad.call(this)},a.doTick=function(){switch(this.state){case c.State.IDLE:this.doTickIdle();break;case c.State.WAITING_LEVEL:var a,e=this.levels,g=this.level,b=null==e||null===(a=e[g])|| void 0===a?void 0:a.details;if(b&&(!b.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(b))break;this.state=c.State.IDLE}break;case c.State.FRAG_LOADING_WAITING_RETRY:var d,h=self.performance.now(),f=this.retryDate;(!f||h>=f||null!==(d=this.media)&& void 0!==d&&d.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.state=c.State.IDLE)}this.onTickEnd()},a.onTickEnd=function(){u.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},a.doTickIdle=function(){var f,h,l=this.hls,s=this.levelLastLoaded,m=this.levels,n=this.media,t=l.config,d=l.nextLoadLevel;if(null!==s&&(n|| !this.startFragRequested&&t.startFragPrefetch)&&(!this.altAudio||!this.audioOnly)&&m&&m[d]){var p=m[d];this.level=l.nextLoadLevel=d;var b=p.details;if(!b||this.state===c.State.WAITING_LEVEL||b.live&&this.levelLastLoaded!==d)this.state=c.State.WAITING_LEVEL;else{var e=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:n,j.PlaylistLevelType.MAIN);if(null!==e&&!(e.len>=this.getMaxBufferLength(p.maxBitrate))){if(this._streamEnded(e,b)){var q={};return this.altAudio&&(q.type="video"),this.hls.trigger(g.Events.BUFFER_EOS,q),void(this.state=c.State.ENDED)}var o=e.end,a=this.getNextFragment(o,b);if(this.couldBacktrack&&!this.fragPrevious&&a&&"initSegment"!==a.sn){var r=a.sn-b.startSN;r>1&&(a=b.fragments[r-1],this.fragmentTracker.removeFragment(a))}if(a&&this.fragmentTracker.getState(a)===i.FragmentState.OK&&this.nextLoadPosition>o){var u=this.audioOnly&&!this.altAudio?k.ElementaryStreamTypes.AUDIO:k.ElementaryStreamTypes.VIDEO;this.afterBufferFlushed(n,u,j.PlaylistLevelType.MAIN),a=this.getNextFragment(this.nextLoadPosition,b)}a&&(!a.initSegment||a.initSegment.data||this.bitrateTest||(a=a.initSegment),"identity"!==(null===(f=a.decryptdata)|| void 0===f?void 0:f.keyFormat)||null!==(h=a.decryptdata)&& void 0!==h&&h.key?this.loadFragment(a,b,o):this.loadKey(a,b))}}}},a.loadFragment=function(a,e,f){var c,b=this.fragmentTracker.getState(a);if(this.fragCurrent=a,b===i.FragmentState.BACKTRACKED){var d=this.fragmentTracker.getBacktrackData(a);if(d)return this._handleFragmentLoadProgress(d),void this._handleFragmentLoadComplete(d);b=i.FragmentState.NOT_LOADED}b===i.FragmentState.NOT_LOADED||b===i.FragmentState.PARTIAL?"initSegment"===a.sn?this._loadInitSegment(a):this.bitrateTest?(a.bitrateTest=!0,this.log("Fragment "+a.sn+" of level "+a.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(a)):(this.startFragRequested=!0,u.prototype.loadFragment.call(this,a,e,f)):b===i.FragmentState.APPENDING?this.reduceMaxBufferLength(a.duration)&&this.fragmentTracker.removeFragment(a):0===(null===(c=this.media)|| void 0===c?void 0:c.buffered.length)&&this.fragmentTracker.removeAllFragments()},a.getAppendedFrag=function(b){var a=this.fragmentTracker.getAppendedFrag(b,j.PlaylistLevelType.MAIN);return a&&"fragment"in a?a.fragment:a},a.getBufferedFrag=function(a){return this.fragmentTracker.getBufferedFrag(a,j.PlaylistLevelType.MAIN)},a.followingBufferedFrag=function(a){return a?this.getBufferedFrag(a.end+.5):null},a.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},a.nextLevelSwitch=function(){var g=this.levels,a=this.media;if(null!=a&&a.readyState){var c,d=this.getAppendedFrag(a.currentTime);if(d&&d.start>1&&this.flushMainBuffer(0,d.start-1),!a.paused&&g){var i=g[this.hls.nextLoadLevel],h=this.fragLastKbps;c=h&&this.fragCurrent?this.fragCurrent.duration*i.maxBitrate/(1e3*h)+1:0}else c=0;var e=this.getBufferedFrag(a.currentTime+c);if(e){var b=this.followingBufferedFrag(e);if(b){this.abortCurrentFrag();var j=b.maxStartPTS?b.maxStartPTS:b.start,f=b.duration,k=Math.max(e.end,j+Math.min(Math.max(f-this.config.maxFragLookUpTolerance,.5*f),.75*f));this.flushMainBuffer(k,Number.POSITIVE_INFINITY)}}}},a.abortCurrentFrag=function(){var a=this.fragCurrent;this.fragCurrent=null,null!=a&&a.loader&&a.loader.abort(),this.state===c.State.KEY_LOADING&&(this.state=c.State.IDLE),this.nextLoadPosition=this.getLoadPosition()},a.flushMainBuffer=function(a,b){u.prototype.flushMainBuffer.call(this,a,b,this.altAudio?"video":null)},a.onMediaAttached=function(c,b){u.prototype.onMediaAttached.call(this,c,b);var a=b.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),a.addEventListener("playing",this.onvplaying),a.addEventListener("seeked",this.onvseeked),this.gapController=new n.default(this.config,a,this.fragmentTracker,this.hls)},a.onMediaDetaching=function(){var a=this.media;a&&(a.removeEventListener("playing",this.onvplaying),a.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),u.prototype.onMediaDetaching.call(this)},a.onMediaPlaying=function(){this.tick()},a.onMediaSeeked=function(){var a=this.media,b=a?a.currentTime:null;Object(e.isFiniteNumber)(b)&&this.log("Media seeked to "+b.toFixed(3)),this.tick()},a.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(g.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=this.stalled=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null},a.onManifestParsed=function(d,a){var e,b=!1,c=!1;a.levels.forEach(function(a){(e=a.audioCodec)&&(-1!==e.indexOf("mp4a.40.2")&&(b=!0),-1!==e.indexOf("mp4a.40.5")&&(c=!0))}),this.audioCodecSwitch=b&&c&&!Object(f.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=a.levels,this.startFragRequested=!1},a.onLevelLoading=function(e,b){var d=this.levels;if(d&&this.state===c.State.IDLE){var a=d[b.level];(!a.details||a.details.live&&this.levelLastLoaded!==b.level||this.waitForCdnTuneIn(a.details))&&(this.state=c.State.WAITING_LEVEL)}},a.onLevelLoaded=function(l,e){var f,i=this.levels,b=e.level,a=e.details,k=a.totalduration;if(i){this.log("Level "+b+" loaded ["+a.startSN+","+a.endSN+"], cc ["+a.startCC+", "+a.endCC+"] duration:"+k);var d=this.fragCurrent;!d||this.state!==c.State.FRAG_LOADING&&this.state!==c.State.FRAG_LOADING_WAITING_RETRY||d.level!==e.level&&d.loader&&(this.state=c.State.IDLE,d.loader.abort());var h=i[b],j=0;if(a.live||null!==(f=h.details)&& void 0!==f&&f.live){if(a.fragments[0]||(a.deltaUpdateFailed=!0),a.deltaUpdateFailed)return;j=this.alignPlaylists(a,h.details)}if(h.details=a,this.levelLastLoaded=b,this.hls.trigger(g.Events.LEVEL_UPDATED,{details:a,level:b}),this.state===c.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(a))return;this.state=c.State.IDLE}this.startFragRequested?a.live&&this.synchronizeToLiveEdge(a):this.setStartPosition(a,j),this.tick()}else this.warn("Levels were reset while loading level "+b)},a._handleFragmentLoadProgress=function(c){var d,a=c.frag,e=c.part,g=c.payload,h=this.levels;if(h){var f=h[a.level],b=f.details;if(b){var k=f.videoCodec,n=b.PTSKnown||!b.live,o=null===(d=a.initSegment)|| void 0===d?void 0:d.data,p=this._getAudioCodec(f),q=this.transmuxer=this.transmuxer||new l.default(this.hls,j.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),i=e?e.index:-1,r=-1!==i,s=new m.ChunkMetadata(a.level,a.sn,a.stats.chunkCount,g.byteLength,i,r),t=this.initPTS[a.cc];q.push(g,o,p,k,a,e,b.totalduration,n,s,t)}else this.warn("Dropping fragment "+a.sn+" of level "+a.level+" after level details were reset")}else this.warn("Levels were reset while fragment load was in progress. Fragment "+a.sn+" of level "+a.level+" will not be buffered")},a.onAudioTrackSwitching=function(h,b){var d=this.altAudio,e=!!b.url,f=b.id;if(!e){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var a=this.fragCurrent;null!=a&&a.loader&&(this.log("Switching to main audio track, cancel main fragment load"),a.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var c=this.hls;d&&c.trigger(g.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),c.trigger(g.Events.AUDIO_TRACK_SWITCHED,{id:f})}},a.onAudioTrackSwitched=function(e,c){var d=c.id,b=!!this.hls.audioTracks[d].url;if(b){var a=this.videoBuffer;a&&this.mediaBuffer!==a&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=a)}this.altAudio=b,this.tick()},a.onBufferCreated=function(i,h){var b,d,c=h.tracks,e=!1;for(var a in c){var f=c[a];if("main"===f.id){if(d=a,b=f,"video"===a){var g=c[a];g&&(this.videoBuffer=g.buffer)}}else e=!0}e&&b?(this.log("Alternate track found, use "+d+".buffered to schedule main fragment loading"),this.mediaBuffer=b.buffer):this.mediaBuffer=this.media},a.onFragBuffered=function(f,e){var a=e.frag,b=e.part;if(!a||a.type===j.PlaylistLevelType.MAIN){if(this.fragContextChanged(a))return this.warn("Fragment "+a.sn+(b?" p: "+b.index:"")+" of level "+a.level+" finished buffering, but was aborted. state: "+this.state),void(this.state===c.State.PARSED&&(this.state=c.State.IDLE));var d=b?b.stats:a.stats;this.fragLastKbps=Math.round(8*d.total/(d.buffering.end-d.loading.first)),"initSegment"!==a.sn&&(this.fragPrevious=a),this.fragBufferedComplete(a,b)}},a.onError=function(e,a){switch(a.details){case o.ErrorDetails.FRAG_LOAD_ERROR:case o.ErrorDetails.FRAG_LOAD_TIMEOUT:case o.ErrorDetails.KEY_LOAD_ERROR:case o.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(j.PlaylistLevelType.MAIN,a);break;case o.ErrorDetails.LEVEL_LOAD_ERROR:case o.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==c.State.ERROR&&(a.fatal?(this.warn(""+a.details),this.state=c.State.ERROR):a.levelRetry||this.state!==c.State.WAITING_LEVEL||(this.state=c.State.IDLE));break;case o.ErrorDetails.BUFFER_FULL_ERROR:if("main"===a.parent&&(this.state===c.State.PARSING||this.state===c.State.PARSED)){var d=!0,b=this.getFwdBufferInfo(this.media,j.PlaylistLevelType.MAIN);b&&b.len>.5&&(d=!this.reduceMaxBufferLength(b.len)),d&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}}},a.checkBuffer=function(){var a=this.media,b=this.gapController;if(a&&b&&a.readyState){var c=h.BufferHelper.getBuffered(a);!this.loadedmetadata&&c.length?(this.loadedmetadata=!0,this.seekToStartPos()):b.poll(this.lastCurrentTime),this.lastCurrentTime=a.currentTime}},a.onFragLoadEmergencyAborted=function(){this.state=c.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},a.onBufferFlushed=function(d,b){var a=b.type;if(a!==k.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var c=(a===k.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(c,a,j.PlaylistLevelType.MAIN)}},a.onLevelsUpdated=function(b,a){this.levels=a.levels},a.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},a.seekToStartPos=function(){var b=this.media,d=b.currentTime,a=this.startPosition;if(a>=0&&d<a){if(b.seeking)return void p.logger.log("could not seek to "+a+", already seeking at "+d);var e=h.BufferHelper.getBuffered(b),c=(e.length?e.start(0):0)-a;c>0&&c<this.config.maxBufferHole&&(p.logger.log("adjusting start position by "+c+" to match buffer start"),a+=c,this.startPosition=a),this.log("seek to target start position "+a+" from current time "+d),b.currentTime=a}},a._getAudioCodec=function(b){var a=this.config.defaultAudioCodec||b.audioCodec;return this.audioCodecSwap&&a&&(this.log("Swapping audio codec"),a=-1!==a.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),a},a._loadBitrateTestFrag=function(a){var b=this;this._doFragLoad(a).then(function(e){var f=b.hls;if(e&&!f.nextLoadLevel&&!b.fragContextChanged(a)){b.fragLoadError=0,b.state=c.State.IDLE,b.startFragRequested=!1,b.bitrateTest=!1;var d=a.stats;d.parsing.start=d.parsing.end=d.buffering.start=d.buffering.end=self.performance.now(),f.trigger(g.Events.FRAG_LOADED,e)}})},a._handleTransmuxComplete=function(u){var o,l="main",m=this.hls,d=u.remuxResult,f=u.chunkMeta,n=this.getCurrentContext(f);if(!n)return this.warn("The loading context changed while buffering fragment "+f.sn+" of level "+f.level+". This chunk will not be buffered."),void this.resetLiveStartWhenNotLoaded(f.level);var a=n.frag,h=n.part,v=n.level,b=d.video,w=d.text,p=d.id3,i=d.initSegment,j=this.altAudio?void 0:d.audio;if(!this.fragContextChanged(a)){if(this.state=c.State.PARSING,i){i.tracks&&(this._bufferInitSegment(v,i.tracks,a,f),m.trigger(g.Events.FRAG_PARSING_INIT_SEGMENT,{frag:a,id:l,tracks:i.tracks}));var q=i.initPTS,B=i.timescale;Object(e.isFiniteNumber)(q)&&(this.initPTS[a.cc]=q,m.trigger(g.Events.INIT_PTS_FOUND,{frag:a,id:l,initPTS:q,timescale:B}))}if(b&& !1!==d.independent){if(v.details){var r=b.startPTS,s=b.endPTS,x=b.startDTS,t=b.endDTS;if(h)h.elementaryStreams[b.type]={startPTS:r,endPTS:s,startDTS:x,endDTS:t};else if(b.firstKeyFrame&&b.independent&&(this.couldBacktrack=!0),b.dropped&&b.independent){if(this.getLoadPosition()+this.config.maxBufferHole<r)return void this.backtrack(a);a.setElementaryStreamInfo(b.type,a.start,s,a.start,t,!0)}a.setElementaryStreamInfo(b.type,r,s,x,t),this.bufferFragmentData(b,a,h,f)}}else if(!1===d.independent)return void this.backtrack(a);if(j){var y=j.startPTS,z=j.endPTS,_=j.startDTS,A=j.endDTS;h&&(h.elementaryStreams[k.ElementaryStreamTypes.AUDIO]={startPTS:y,endPTS:z,startDTS:_,endDTS:A}),a.setElementaryStreamInfo(k.ElementaryStreamTypes.AUDIO,y,z,_,A),this.bufferFragmentData(j,a,h,f)}if(null!=p&&null!==(o=p.samples)&& void 0!==o&&o.length){var C={frag:a,id:l,samples:p.samples};m.trigger(g.Events.FRAG_PARSING_METADATA,C)}if(w){var D={frag:a,id:l,samples:w.samples};m.trigger(g.Events.FRAG_PARSING_USERDATA,D)}}},a._bufferInitSegment=function(b,d,j,k){var l=this;if(this.state===c.State.PARSING){this.audioOnly=!!d.audio&&!d.video,this.altAudio&&!this.audioOnly&&delete d.audio;var e=d.audio,f=d.video,h=d.audiovideo;if(e){var a=b.audioCodec,i=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(a&&(a=-1!==a.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),1!==e.metadata.channelCount&& -1===i.indexOf("firefox")&&(a="mp4a.40.5")),-1!==i.indexOf("android")&&"audio/mpeg"!==e.container&&(a="mp4a.40.2",this.log("Android: force audio codec to "+a)),b.audioCodec&&b.audioCodec!==a&&this.log('Swapping manifest audio codec "'+b.audioCodec+'" for "'+a+'"'),e.levelCodec=a,e.id="main",this.log("Init audio buffer, container:"+e.container+", codecs[selected/level/parsed]=["+(a||"")+"/"+(b.audioCodec||"")+"/"+e.codec+"]")}f&&(f.levelCodec=b.videoCodec,f.id="main",this.log("Init video buffer, container:"+f.container+", codecs[level/parsed]=["+(b.videoCodec||"")+"/"+f.codec+"]")),h&&this.log("Init audiovideo buffer, container:"+h.container+", codecs[level/parsed]=["+(b.attrs.CODECS||"")+"/"+h.codec+"]"),this.hls.trigger(g.Events.BUFFER_CODECS,d),Object.keys(d).forEach(function(b){var a=d[b].initSegment;null!=a&&a.byteLength&&l.hls.trigger(g.Events.BUFFER_APPENDING,{type:b,data:a,frag:j,part:null,chunkMeta:k,parent:j.type})}),this.tick()}},a.backtrack=function(a){this.couldBacktrack=!0,this.resetTransmuxer(),this.flushBufferGap(a);var b=this.fragmentTracker.backtrack(a);this.fragPrevious=null,this.nextLoadPosition=a.start,b?this.resetFragmentLoading(a):this.state=c.State.BACKTRACKING},a.checkFragmentChanged=function(){var b=this.media,a=null;if(b&&b.readyState>1&& !1===b.seeking){var d=b.currentTime;if(h.BufferHelper.isBuffered(b,d)?a=this.getAppendedFrag(d):h.BufferHelper.isBuffered(b,d+.1)&&(a=this.getAppendedFrag(d+.1)),a){var c=this.fragPlaying,e=a.level;c&&a.sn===c.sn&&c.level===e&&a.urlId===c.urlId||(this.hls.trigger(g.Events.FRAG_CHANGED,{frag:a}),c&&c.level===e||this.hls.trigger(g.Events.LEVEL_SWITCHED,{level:e}),this.fragPlaying=a)}}},d=b,s=[{key:"nextLevel",get:function(){var a=this.nextBufferedFrag;return a?a.level:-1}},{key:"currentLevel",get:function(){var a=this.media;if(a){var b=this.getAppendedFrag(a.currentTime);if(b)return b.level}return -1}},{key:"nextBufferedFrag",get:function(){var a=this.media;if(a){var b=this.getAppendedFrag(a.currentTime);return this.followingBufferedFrag(b)}return null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}],q(d.prototype,s),t&&q(d,t),b}(c.default)},"./src/controller/subtitle-stream-controller.ts":/*!******************************************************!*\
   !*** ./src/controller/subtitle-stream-controller.ts ***!
   \******************************************************/ /*! exports provided: SubtitleStreamController */ function(d,b,a){"use strict";a.r(b),a.d(b,"SubtitleStreamController",function(){return p});var e=a(/*! ../events */ "./src/events.ts"),f=a(/*! ../utils/logger */ "./src/utils/logger.ts"),g=a(/*! ../utils/buffer-helper */ "./src/utils/buffer-helper.ts"),h=a(/*! ./fragment-finders */ "./src/controller/fragment-finders.ts"),i=a(/*! ../utils/discontinuities */ "./src/utils/discontinuities.ts"),j=a(/*! ./level-helper */ "./src/controller/level-helper.ts"),k=a(/*! ./fragment-tracker */ "./src/controller/fragment-tracker.ts"),c=a(/*! ./base-stream-controller */ "./src/controller/base-stream-controller.ts"),l=a(/*! ../types/loader */ "./src/types/loader.ts"),m=a(/*! ../types/level */ "./src/types/level.ts");function n(d,c){for(var b=0;b<c.length;b++){var a=c[b];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(d,a.key,a)}}function o(a,b){return(o=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a})(a,b)}var p=function(r){function b(b,c){var a;return(a=r.call(this,b,c,"[subtitle-stream-controller]")||this).levels=[],a.currentTrackId=-1,a.tracksBuffered=[],a.mainDetails=null,a._registerListeners(),a}t=r,(s=b).prototype=Object.create(t.prototype),s.prototype.constructor=s,o(s,t);var s,t,d,p,q,a=b.prototype;return a.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},a._registerListeners=function(){var a=this.hls;a.on(e.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.on(e.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.on(e.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.on(e.Events.LEVEL_LOADED,this.onLevelLoaded,this),a.on(e.Events.ERROR,this.onError,this),a.on(e.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),a.on(e.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),a.on(e.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),a.on(e.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),a.on(e.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},a._unregisterListeners=function(){var a=this.hls;a.off(e.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.off(e.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.off(e.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.off(e.Events.LEVEL_LOADED,this.onLevelLoaded,this),a.off(e.Events.ERROR,this.onError,this),a.off(e.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),a.off(e.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),a.off(e.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),a.off(e.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),a.off(e.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},a.startLoad=function(){this.stopLoad(),this.state=c.State.IDLE,this.setInterval(500),this.tick()},a.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},a.onLevelLoaded=function(b,a){this.mainDetails=a.details},a.onSubtitleFragProcessed=function(j,g){var b=g.frag,i=g.success;if(this.fragPrevious=b,this.state=c.State.IDLE,i){var a=this.tracksBuffered[this.currentTrackId];if(a){for(var d,f=b.start,e=0;e<a.length;e++)if(f>=a[e].start&&f<=a[e].end){d=a[e];break}var h=b.start+b.duration;d?d.end=h:(d={start:f,end:h},a.push(d)),this.fragmentTracker.fragBuffered(b)}}},a.onBufferFlushing=function(g,b){var e=b.startOffset,f=b.endOffset;if(0===e&&f!==Number.POSITIVE_INFINITY){var c=this.currentTrackId,a=this.levels;if(!a.length||!a[c]||!a[c].details)return;var d=f-a[c].details.targetduration;if(d<=0)return;b.endOffsetSubtitles=Math.max(0,d),this.tracksBuffered.forEach(function(a){for(var b=0;b<a.length;)if(a[b].end<=d)a.shift();else{if(!(a[b].start<d))break;a[b].start=d,b++}}),this.fragmentTracker.removeFragmentsInRange(e,d,l.PlaylistLevelType.SUBTITLE)}},a.onError=function(e,d){var a,b=d.frag;b&&b.type===l.PlaylistLevelType.SUBTITLE&&(null!==(a=this.fragCurrent)&& void 0!==a&&a.loader&&this.fragCurrent.loader.abort(),this.state=c.State.IDLE)},a.onSubtitleTracksUpdated=function(c,a){var d=this,b=a.subtitleTracks;this.tracksBuffered=[],this.levels=b.map(function(a){return new m.Level(a)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(a){d.tracksBuffered[a.id]=[]}),this.mediaBuffer=null},a.onSubtitleTrackSwitch=function(c,b){if(this.currentTrackId=b.id,this.levels.length&& -1!==this.currentTrackId){var a=this.levels[this.currentTrackId];null!=a&&a.details?(this.mediaBuffer=this.mediaBufferTimeRanges,this.setInterval(500)):this.mediaBuffer=null}else this.clearInterval()},a.onSubtitleTrackLoaded=function(n,l){var f,a=l.details,g=l.id,m=this.currentTrackId,k=this.levels;if(k.length){var b=k[m];if(!(g>=k.length||g!==m)&&b){if(this.mediaBuffer=this.mediaBufferTimeRanges,a.live||null!==(f=b.details)&& void 0!==f&&f.live){var d=this.mainDetails;if(a.deltaUpdateFailed||!d)return;var e=d.fragments[0];b.details?0===this.alignPlaylists(a,b.details)&&e&&Object(j.addSliding)(a,e.start):a.hasProgramDateTime&&d.hasProgramDateTime?Object(i.alignPDT)(a,d):e&&Object(j.addSliding)(a,e.start)}b.details=a,this.levelLastLoaded=g,this.tick(),a.live&&!this.fragCurrent&&this.media&&this.state===c.State.IDLE&&(Object(h.findFragmentByPTS)(null,a.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),b.details=void 0))}}},a._handleFragmentLoadComplete=function(c){var d=c.frag,b=c.payload,a=d.decryptdata,f=this.hls;if(!this.fragContextChanged(d)&&b&&b.byteLength>0&&a&&a.key&&a.iv&&"AES-128"===a.method){var g=performance.now();this.decrypter.webCryptoDecrypt(new Uint8Array(b),a.key.buffer,a.iv.buffer).then(function(a){var b=performance.now();f.trigger(e.Events.FRAG_DECRYPTED,{frag:d,payload:a,stats:{tstart:g,tdecrypt:b}})})}},a.doTick=function(){if(this.media){if(this.state===c.State.IDLE){var l,m=this.currentTrackId,j=this.levels;if(!j.length||!j[m]||!j[m].details)return;var b=j[m].details,o=b.targetduration,p=this.config,s=this.media,q=g.BufferHelper.bufferedInfo(this.mediaBufferTimeRanges,s.currentTime-o,p.maxBufferHole),n=q.end;if(!(q.len>this.getMaxBufferLength()+o)){console.assert(b,"Subtitle track details are defined on idle subtitle stream controller tick");var a,d=b.fragments,t=d.length,u=b.edge,i=this.fragPrevious;if(n<u){var r=p.maxFragLookUpTolerance;i&&b.hasProgramDateTime&&(a=Object(h.findFragmentByPDT)(d,i.endProgramDateTime,r)),a||(a=Object(h.findFragmentByPTS)(i,d,n,r))||!i||!(i.start<d[0].start)||(a=d[0])}else a=d[t-1];null!==(l=a)&& void 0!==l&&l.encrypted?(f.logger.log("Loading key for "+a.sn),this.state=c.State.KEY_LOADING,this.hls.trigger(e.Events.KEY_LOADING,{frag:a})):a&&this.fragmentTracker.getState(a)===k.FragmentState.NOT_LOADED&&this.loadFragment(a,b,n)}}}else this.state=c.State.IDLE},a.loadFragment=function(a,b,c){this.fragCurrent=a,r.prototype.loadFragment.call(this,a,b,c)},p=[{key:"mediaBufferTimeRanges",get:function(){return this.tracksBuffered[this.currentTrackId]||[]}}],n((d=b).prototype,p),q&&n(d,q),b}(c.default)},"./src/controller/subtitle-track-controller.ts":/*!*****************************************************!*\
   !*** ./src/controller/subtitle-track-controller.ts ***!
   \*****************************************************/ /*! exports provided: default */ function(e,b,a){"use strict";a.r(b);var f=a(/*! ../events */ "./src/events.ts"),g=a(/*! ../utils/texttrack-utils */ "./src/utils/texttrack-utils.ts"),c=a(/*! ./base-playlist-controller */ "./src/controller/base-playlist-controller.ts"),h=a(/*! ../types/loader */ "./src/types/loader.ts");function i(d,c){for(var b=0;b<c.length;b++){var a=c[b];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(d,a.key,a)}}function j(a,b){return(j=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a})(a,b)}var d=function(l){function b(b){var a;return(a=l.call(this,b,"[subtitle-track-controller]")||this).media=null,a.tracks=[],a.groupId=null,a.tracksInGroup=[],a.trackId=-1,a.selectDefaultTrack=!0,a.queuedDefaultTrack=-1,a.trackChangeListener=function(){return a.onTextTracksChanged()},a.asyncPollTrackChange=function(){return a.pollTrackChange(0)},a.useTextTrackPolling=!1,a.subtitlePollingInterval=-1,a.subtitleDisplay=!0,a.registerListeners(),a}n=l,(m=b).prototype=Object.create(n.prototype),m.prototype.constructor=m,j(m,n);var m,n,c,d,e,a=b.prototype;return a.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,l.prototype.destroy.call(this)},a.registerListeners=function(){var a=this.hls;a.on(f.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.on(f.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.on(f.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.on(f.Events.MANIFEST_PARSED,this.onManifestParsed,this),a.on(f.Events.LEVEL_LOADING,this.onLevelLoading,this),a.on(f.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),a.on(f.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),a.on(f.Events.ERROR,this.onError,this)},a.unregisterListeners=function(){var a=this.hls;a.off(f.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.off(f.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.off(f.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.off(f.Events.MANIFEST_PARSED,this.onManifestParsed,this),a.off(f.Events.LEVEL_LOADING,this.onLevelLoading,this),a.off(f.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),a.off(f.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),a.off(f.Events.ERROR,this.onError,this)},a.onMediaAttached=function(b,a){this.media=a.media,this.media&&(this.queuedDefaultTrack> -1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},a.pollTrackChange=function(a){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,a)},a.onMediaDetaching=function(){this.media&&(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId> -1&&(this.queuedDefaultTrack=this.trackId),k(this.media.textTracks).forEach(function(a){Object(g.clearCurrentCues)(a)}),this.subtitleTrack=-1,this.media=null)},a.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},a.onManifestParsed=function(b,a){this.tracks=a.subtitleTracks},a.onSubtitleTrackLoaded=function(g,a){var b=a.id,d=a.details,e=this.trackId,c=this.tracksInGroup[e];if(c){var f=c.details;c.details=a.details,this.log("subtitle track "+b+" loaded ["+d.startSN+"-"+d.endSN+"]"),b===this.trackId&&(this.retryCount=0,this.playlistLoaded(b,a,f))}else this.warn("Invalid subtitle track id "+b)},a.onLevelLoading=function(b,a){this.switchLevel(a.level)},a.onLevelSwitching=function(b,a){this.switchLevel(a.level)},a.switchLevel=function(g){var a=this.hls.levels[g];if(null!=a&&a.textGroupIds){var b=a.textGroupIds[a.urlId];if(this.groupId!==b){var c=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,d=this.tracks.filter(function(a){return!b||a.groupId===b});this.tracksInGroup=d;var e=this.findTrackId(null==c?void 0:c.name)||this.findTrackId();this.groupId=b;var h={subtitleTracks:d};this.log("Updating subtitle tracks, "+d.length+' track(s) found in "'+b+'" group-id'),this.hls.trigger(f.Events.SUBTITLE_TRACKS_UPDATED,h),-1!==e&&this.setSubtitleTrack(e,c)}}},a.findTrackId=function(c){for(var d=this.tracksInGroup,a=0;a<d.length;a++){var b=d[a];if((!this.selectDefaultTrack||b.default)&&(!c||c===b.name))return b.id}return -1},a.onError=function(b,a){l.prototype.onError.call(this,b,a),!a.fatal&&a.context&&a.context.type===h.PlaylistContextType.SUBTITLE_TRACK&&a.context.id===this.trackId&&a.context.groupId===this.groupId&&this.retryLoadingOrFail(a)},a.loadPlaylist=function(b){var a=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(a)){var d=a.id,e=a.groupId,c=a.url;if(b)try{c=b.addDirectives(c)}catch(g){this.warn("Could not construct new URL with HLS Delivery Directives: "+g)}this.log("Loading subtitle playlist for id "+d),this.hls.trigger(f.Events.SUBTITLE_TRACK_LOADING,{url:c,id:d,groupId:e,deliveryDirectives:b||null})}},a.toggleTrackModes=function(a){var i=this,b=this.media,g=this.subtitleDisplay,h=this.trackId;if(b){var c=k(b.textTracks),d=c.filter(function(a){return a.groupId===i.groupId});if(-1===a)[].slice.call(c).forEach(function(a){a.mode="disabled"});else{var e=d[h];e&&(e.mode="disabled")}var f=d[a];f&&(f.mode=g?"showing":"hidden")}},a.setSubtitleTrack=function(a,e){var c,d=this.tracksInGroup;if(this.media){if(this.trackId!==a&&this.toggleTrackModes(a),!(this.trackId===a&&(-1===a||null!==(c=d[a])&& void 0!==c&&c.details)||a< -1||a>=d.length)){this.clearTimer();var b=d[a];if(this.log("Switching to subtitle track "+a),this.trackId=a,b){var h=b.id,g=b.groupId,i=void 0===g?"":g,j=b.name,k=b.type,l=b.url;this.hls.trigger(f.Events.SUBTITLE_TRACK_SWITCH,{id:h,groupId:i,name:j,type:k,url:l});var m=this.switchParams(b.url,null==e?void 0:e.details);this.loadPlaylist(m)}else this.hls.trigger(f.Events.SUBTITLE_TRACK_SWITCH,{id:a})}}else this.queuedDefaultTrack=a},a.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),this.media&&this.hls.config.renderTextTracksNatively){for(var b=-1,c=k(this.media.textTracks),a=0;a<c.length;a++)if("hidden"===c[a].mode)b=a;else if("showing"===c[a].mode){b=a;break}this.subtitleTrack!==b&&(this.subtitleTrack=b)}},c=b,d=[{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(a){this.selectDefaultTrack=!1;var b=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(a,b)}}],i(c.prototype,d),e&&i(c,e),b}(c.default);function k(b){for(var c=[],a=0;a<b.length;a++){var d=b[a];"subtitles"===d.kind&&d.label&&c.push(b[a])}return c}b.default=d},"./src/controller/timeline-controller.ts":/*!***********************************************!*\
   !*** ./src/controller/timeline-controller.ts ***!
   \***********************************************/ /*! exports provided: TimelineController */ function(c,b,a){"use strict";a.r(b),a.d(b,"TimelineController",function(){return m});var d=a(/*! ./src/polyfills/number */ "./src/polyfills/number.ts"),e=a(/*! ../events */ "./src/events.ts"),f=a(/*! ../utils/cea-608-parser */ "./src/utils/cea-608-parser.ts"),g=a(/*! ../utils/output-filter */ "./src/utils/output-filter.ts"),h=a(/*! ../utils/webvtt-parser */ "./src/utils/webvtt-parser.ts"),i=a(/*! ../utils/texttrack-utils */ "./src/utils/texttrack-utils.ts"),j=a(/*! ../utils/imsc1-ttml-parser */ "./src/utils/imsc1-ttml-parser.ts"),k=a(/*! ../types/loader */ "./src/types/loader.ts"),l=a(/*! ../utils/logger */ "./src/utils/logger.ts"),m=function(){function b(a){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},this.captionsProperties=void 0,this.hls=a,this.config=a.config,this.Cues=a.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var b=new g.default(this,"textTrack1"),c=new g.default(this,"textTrack2"),d=new g.default(this,"textTrack3"),h=new g.default(this,"textTrack4");this.cea608Parser1=new f.default(1,b,c),this.cea608Parser2=new f.default(3,d,h)}a.on(e.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),a.on(e.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.on(e.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.on(e.Events.MANIFEST_LOADED,this.onManifestLoaded,this),a.on(e.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),a.on(e.Events.FRAG_LOADING,this.onFragLoading,this),a.on(e.Events.FRAG_LOADED,this.onFragLoaded,this),a.on(e.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),a.on(e.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),a.on(e.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),a.on(e.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),a.on(e.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var a=b.prototype;return a.destroy=function(){var a=this.hls;a.off(e.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),a.off(e.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.off(e.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.off(e.Events.MANIFEST_LOADED,this.onManifestLoaded,this),a.off(e.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),a.off(e.Events.FRAG_LOADING,this.onFragLoading,this),a.off(e.Events.FRAG_LOADED,this.onFragLoaded,this),a.off(e.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),a.off(e.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),a.off(e.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),a.off(e.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),a.off(e.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},a.addCues=function(f,a,b,g,d){for(var h,i,j,k,l=!1,m=d.length;m--;){var c=d[m],n=(h=c[0],i=c[1],j=a,k=b,Math.min(i,k)-Math.max(h,j));if(n>=0&&(c[0]=Math.min(c[0],a),c[1]=Math.max(c[1],b),l=!0,n/(b-a)>.5))return}if(l||d.push([a,b]),this.config.renderTextTracksNatively){var o=this.captionsTracks[f];this.Cues.newCue(o,a,b,g)}else{var p=this.Cues.newCue(null,a,b,g);this.hls.trigger(e.Events.CUES_PARSED,{type:"captions",cues:p,track:f})}},a.onInitPtsFound=function(h,a){var i=this,b=a.frag,d=a.id,f=a.initPTS,g=a.timescale,c=this.unparsedVttFrags;"main"===d&&(this.initPTS[b.cc]=f,this.timescale[b.cc]=g),c.length&&(this.unparsedVttFrags=[],c.forEach(function(a){i.onFragLoaded(e.Events.FRAG_LOADED,a)}))},a.getExistingTrack=function(d){var a=this.media;if(a)for(var b=0;b<a.textTracks.length;b++){var c=a.textTracks[b];if(c[d])return c}return null},a.createCaptionsTrack=function(a){this.config.renderTextTracksNatively?this.createNativeTrack(a):this.createNonNativeTrack(a)},a.createNativeTrack=function(a){if(!this.captionsTracks[a]){var f=this.captionsProperties,b=this.captionsTracks,g=this.media,d=f[a],h=d.label,j=d.languageCode,e=this.getExistingTrack(a);if(e)b[a]=e,Object(i.clearCurrentCues)(b[a]),Object(i.sendAddTrackEvent)(b[a],g);else{var c=this.createTextTrack("captions",h,j);c&&(c[a]=!0,b[a]=c)}}},a.createNonNativeTrack=function(b){if(!this.nonNativeCaptionsTracks[b]){var a=this.captionsProperties[b];if(a){var c={_id:b,label:a.label,kind:"captions",default:!!a.media&&!!a.media.default,closedCaptions:a.media};this.nonNativeCaptionsTracks[b]=c,this.hls.trigger(e.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[c]})}}},a.createTextTrack=function(b,c,d){var a=this.media;if(a)return a.addTextTrack(b,c,d)},a.onMediaAttaching=function(b,a){this.media=a.media,this._cleanTracks()},a.onMediaDetaching=function(){var a=this.captionsTracks;Object.keys(a).forEach(function(b){Object(i.clearCurrentCues)(a[b]),delete a[b]}),this.nonNativeCaptionsTracks={}},a.onManifestLoading=function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},a._cleanTracks=function(){var c=this.media;if(c){var a=c.textTracks;if(a)for(var b=0;b<a.length;b++)Object(i.clearCurrentCues)(a[b])}},a.onSubtitleTracksUpdated=function(g,b){var h=this;this.textTracks=[];var a=b.subtitleTracks||[],c=a.some(function(a){return a.textCodec===j.IMSC1_CODEC});if(this.config.enableWebVTT||c&&this.config.enableIMSC1){var d=this.tracks&&a&&this.tracks.length===a.length;if(this.tracks=a||[],this.config.renderTextTracksNatively){var k=this.media?this.media.textTracks:[];this.tracks.forEach(function(b,e){var a;if(e<k.length){for(var d=null,c=0;c<k.length;c++)if(n(k[c],b)){d=k[c];break}d&&(a=d)}a?Object(i.clearCurrentCues)(a):(a=h.createTextTrack("subtitles",b.name,b.lang))&&(a.mode="disabled"),a&&(a.groupId=b.groupId,h.textTracks.push(a))})}else if(!d&&this.tracks&&this.tracks.length){var f=this.tracks.map(function(a){return{label:a.name,kind:a.type.toLowerCase(),default:a.default,subtitleTrack:a}});this.hls.trigger(e.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:f})}}},a.onManifestLoaded=function(b,a){var c=this;this.config.enableCEA708Captions&&a.captions&&a.captions.forEach(function(a){var d=/(?:CC|SERVICE)([1-4])/.exec(a.instreamId);if(d){var e="textTrack"+d[1],b=c.captionsProperties[e];b&&(b.label=a.name,a.lang&&(b.languageCode=a.lang),b.media=a)}})},a.onFragLoading=function(f,a){var b=this.cea608Parser1,c=this.cea608Parser2,e=this.lastSn;if(this.enabled&&b&&c&&a.frag.type===k.PlaylistLevelType.MAIN){var d=a.frag.sn;d!==e+1&&(b.reset(),c.reset()),this.lastSn=d}},a.onFragLoaded=function(m,b){var a=b.frag,c=b.payload,h=this.initPTS,l=this.unparsedVttFrags;if(a.type===k.PlaylistLevelType.SUBTITLE){if(c.byteLength){if(!Object(d.isFiniteNumber)(h[a.cc]))return l.push(b),void(h.length&&this.hls.trigger(e.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:a,error:new Error("Missing initial subtitle PTS")}));var f=a.decryptdata;if(null==f||null==f.key||"AES-128"!==f.method){var i=this.tracks[a.level],g=this.vttCCs;g[a.cc]||(g[a.cc]={start:a.start,prevCC:this.prevCC,new:!0},this.prevCC=a.cc),i&&i.textCodec===j.IMSC1_CODEC?this._parseIMSC1(a,c):this._parseVTTs(a,c,g)}}else this.hls.trigger(e.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:a,error:new Error("Empty subtitle payload")})}},a._parseIMSC1=function(a,b){var c=this,d=this.hls;Object(j.parseIMSC1)(b,this.initPTS[a.cc],this.timescale[a.cc],function(b){c._appendCues(b,a.level),d.trigger(e.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:a})},function(b){l.logger.log("Failed to parse IMSC1: "+b),d.trigger(e.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:a,error:b})})},a._parseVTTs=function(a,b,c){var d=this,f=this.hls;Object(h.parseWebVTT)(b,this.initPTS[a.cc],this.timescale[a.cc],c,a.cc,a.start,function(b){d._appendCues(b,a.level),f.trigger(e.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:a})},function(c){d._fallbackToIMSC1(a,b),l.logger.log("Failed to parse VTT cue: "+c),f.trigger(e.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:a,error:c})})},a._fallbackToIMSC1=function(a,b){var d=this,c=this.tracks[a.level];c.textCodec||Object(j.parseIMSC1)(b,this.initPTS[a.cc],this.timescale[a.cc],function(){c.textCodec=j.IMSC1_CODEC,d._parseIMSC1(a,b)},function(){c.textCodec="wvtt"})},a._appendCues=function(b,a){var c=this.hls;if(this.config.renderTextTracksNatively){var d=this.textTracks[a];if("disabled"===d.mode)return;b.forEach(function(a){return Object(i.addCueToTrack)(d,a)})}else{var f=this.tracks[a].default?"default":"subtitles"+a;c.trigger(e.Events.CUES_PARSED,{type:"subtitles",cues:b,track:f})}},a.onFragDecrypted=function(c,a){var b=a.frag;if(b.type===k.PlaylistLevelType.SUBTITLE){if(!Object(d.isFiniteNumber)(this.initPTS[b.cc]))return void this.unparsedVttFrags.push(a);this.onFragLoaded(e.Events.FRAG_LOADED,a)}},a.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},a.onFragParsingUserdata=function(g,b){var c=this.cea608Parser1,d=this.cea608Parser2;if(this.enabled&&c&&d)for(var a=0;a<b.samples.length;a++){var e=b.samples[a].bytes;if(e){var f=this.extractCea608Data(e);c.addData(b.samples[a].pts,f[0]),d.addData(b.samples[a].pts,f[1])}}},a.onBufferFlushing=function(j,a){var d=a.startOffset,e=a.endOffset,f=a.endOffsetSubtitles,b=a.type,c=this.media;if(c&&!(c.currentTime<e)){if(!b||"video"===b){var g=this.captionsTracks;Object.keys(g).forEach(function(a){return Object(i.removeCuesInRange)(g[a],d,e)})}if(this.config.renderTextTracksNatively&&0===d&& void 0!==f){var h=this.textTracks;Object.keys(h).forEach(function(a){return Object(i.removeCuesInRange)(h[a],d,f)})}}},a.extractCea608Data=function(a){for(var i=31&a[0],c=2,d=[[],[]],e=0;e<i;e++){var f=a[c++],g=127&a[c++],h=127&a[c++],b=3&f;0===g&&0===h||0!=(4&f)&&(0!==b&&1!==b||(d[b].push(g),d[b].push(h)))}return d},b}();function n(a,b){return a&&a.label===b.name&&!(a.textTrack1||a.textTrack2)}},"./src/crypt/aes-crypto.ts":/*!*********************************!*\
   !*** ./src/crypt/aes-crypto.ts ***!
   \*********************************/ /*! exports provided: default */ function(c,a,b){"use strict";b.r(a),b.d(a,"default",function(){return d});var d=function(){function a(a,b){this.subtle=void 0,this.aesIV=void 0,this.subtle=a,this.aesIV=b}return a.prototype.decrypt=function(a,b){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},b,a)},a}()},"./src/crypt/aes-decryptor.ts":/*!************************************!*\
   !*** ./src/crypt/aes-decryptor.ts ***!
   \************************************/ /*! exports provided: removePadding, default */ function(c,b,a){"use strict";a.r(b),a.d(b,"removePadding",function(){return e}),a.d(b,"default",function(){return f});var d=a(/*! ../utils/typed-array */ "./src/utils/typed-array.ts");function e(a){var b=a.byteLength,c=b&&new DataView(a.buffer).getUint8(b-1);return c?Object(d.sliceUint8)(a,0,b-c):a}var f=function(){function b(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var a=b.prototype;return a.uint8ArrayToUint32Array_=function(c){for(var d=new DataView(c),b=new Uint32Array(4),a=0;a<4;a++)b[a]=d.getUint32(4*a);return b},a.initTable=function(){var l=this.sBox,m=this.invSBox,g=this.subMix,n=g[0],o=g[1],p=g[2],q=g[3],h=this.invSubMix,r=h[0],s=h[1],t=h[2],u=h[3],d=new Uint32Array(256),b=0,f=0,e=0;for(e=0;e<256;e++)d[e]=e<128?e<<1:e<<1^283;for(e=0;e<256;e++){var c=f^f<<1^f<<2^f<<3^f<<4;c=c>>>8^255&c^99,l[b]=c,m[c]=b;var i=d[b],j=d[i],k=d[j],a=257*d[c]^16843008*c;n[b]=a<<24|a>>>8,o[b]=a<<16|a>>>16,p[b]=a<<8|a>>>24,q[b]=a,a=16843009*k^65537*j^257*i^16843008*b,r[c]=a<<24|a>>>8,s[c]=a<<16|a>>>16,t[c]=a<<8|a>>>24,u[c]=a,b?(b=i^d[d[d[k^i]]],f^=d[d[f]]):b=f=1}},a.expandKey=function(n){for(var f=this.uint8ArrayToUint32Array_(n),k=!0,i=0;i<f.length&&k;)k=f[i]===this.key[i],i++;if(!k){this.key=f;var d=this.keySize=f.length;if(4!==d&&6!==d&&8!==d)throw new Error("Invalid aes key size="+d);var b,e,l,a,g=this.ksRows=4*(d+6+1),h=this.keySchedule=new Uint32Array(g),m=this.invKeySchedule=new Uint32Array(g),c=this.sBox,o=this.rcon,j=this.invSubMix,p=j[0],q=j[1],r=j[2],s=j[3];for(b=0;b<g;b++)b<d?l=h[b]=f[b]:(a=l,b%d==0?(a=c[(a=a<<8|a>>>24)>>>24]<<24|c[a>>>16&255]<<16|c[a>>>8&255]<<8|c[255&a],a^=o[b/d|0]<<24):d>6&&b%d==4&&(a=c[a>>>24]<<24|c[a>>>16&255]<<16|c[a>>>8&255]<<8|c[255&a]),h[b]=l=(h[b-d]^a)>>>0);for(e=0;e<g;e++)b=g-e,a=3&e?h[b]:h[b-4],m[e]=e<4||b<=4?a:p[c[a>>>24]]^q[c[a>>>16&255]]^r[c[a>>>8&255]]^s[c[255&a]],m[e]=m[e]>>>0}},a.networkToHostOrderSwap=function(a){return a<<24|(65280&a)<<8|(16711680&a)>>8|a>>>24},a.decrypt=function(D,c,E){for(var l,m,n,o,d,e,f,g,v,w,x,y,h,z,F=this.keySize+6,b=this.invKeySchedule,a=this.invSBox,p=this.invSubMix,q=p[0],r=p[1],s=p[2],t=p[3],u=this.uint8ArrayToUint32Array_(E),A=u[0],_=u[1],B=u[2],C=u[3],j=new Int32Array(D),k=new Int32Array(j.length),i=this.networkToHostOrderSwap;c<j.length;){for(v=i(j[c]),w=i(j[c+1]),x=i(j[c+2]),y=i(j[c+3]),d=v^b[0],e=y^b[1],f=x^b[2],g=w^b[3],h=4,z=1;z<F;z++)l=q[d>>>24]^r[e>>16&255]^s[f>>8&255]^t[255&g]^b[h],m=q[e>>>24]^r[f>>16&255]^s[g>>8&255]^t[255&d]^b[h+1],n=q[f>>>24]^r[g>>16&255]^s[d>>8&255]^t[255&e]^b[h+2],o=q[g>>>24]^r[d>>16&255]^s[e>>8&255]^t[255&f]^b[h+3],d=l,e=m,f=n,g=o,h+=4;l=a[d>>>24]<<24^a[e>>16&255]<<16^a[f>>8&255]<<8^a[255&g]^b[h],m=a[e>>>24]<<24^a[f>>16&255]<<16^a[g>>8&255]<<8^a[255&d]^b[h+1],n=a[f>>>24]<<24^a[g>>16&255]<<16^a[d>>8&255]<<8^a[255&e]^b[h+2],o=a[g>>>24]<<24^a[d>>16&255]<<16^a[e>>8&255]<<8^a[255&f]^b[h+3],k[c]=i(l^A),k[c+1]=i(o^_),k[c+2]=i(n^B),k[c+3]=i(m^C),A=v,_=w,B=x,C=y,c+=4}return k.buffer},b}()},"./src/crypt/decrypter.ts":/*!********************************!*\
   !*** ./src/crypt/decrypter.ts ***!
   \********************************/ /*! exports provided: default */ function(c,b,a){"use strict";a.r(b),a.d(b,"default",function(){return j});var d=a(/*! ./aes-crypto */ "./src/crypt/aes-crypto.ts"),e=a(/*! ./fast-aes-key */ "./src/crypt/fast-aes-key.ts"),f=a(/*! ./aes-decryptor */ "./src/crypt/aes-decryptor.ts"),g=a(/*! ../utils/logger */ "./src/utils/logger.ts"),h=a(/*! ../utils/mp4-tools */ "./src/utils/mp4-tools.ts"),i=a(/*! ../utils/typed-array */ "./src/utils/typed-array.ts"),j=function(){function b(e,f,b){var c=(void 0===b?{}:b).removePKCS7Padding,d=void 0===c||c;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=e,this.config=f,this.removePKCS7Padding=d,d)try{var a=self.crypto;a&&(this.subtle=a.subtle||a.webkitSubtle)}catch(g){}null===this.subtle&&(this.config.enableSoftwareAES=!0)}var a=b.prototype;return a.destroy=function(){this.observer=null},a.isSync=function(){return this.config.enableSoftwareAES},a.flush=function(){var a=this.currentResult;if(a){var b=new Uint8Array(a);return this.reset(),this.removePKCS7Padding?Object(f.removePadding)(b):b}this.reset()},a.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},a.decrypt=function(a,b,c,d){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(a),b,c);var e=this.flush();e&&d(e.buffer)}else this.webCryptoDecrypt(new Uint8Array(a),b,c).then(d)},a.softwareDecrypt=function(b,j,d){var e=this.currentIV,k=this.currentResult,g=this.remainderData;this.logOnce("JS AES decrypt"),g&&(b=Object(h.appendUint8Array)(g,b),this.remainderData=null);var c=this.getValidChunk(b);if(!c.length)return null;e&&(d=e);var a=this.softwareDecrypter;a||(a=this.softwareDecrypter=new f.default),a.expandKey(j);var l=k;return this.currentResult=a.decrypt(c.buffer,0,d),this.currentIV=Object(i.sliceUint8)(c,-16).buffer,l||null},a.webCryptoDecrypt=function(c,a,f){var g=this,b=this.subtle;return this.key===a&&this.fastAesKey||(this.key=a,this.fastAesKey=new e.default(b,a)),this.fastAesKey.expandKey().then(function(a){return b?new d.default(b,f).decrypt(c.buffer,a):Promise.reject(new Error("web crypto not initialized"))}).catch(function(b){return g.onWebCryptoError(b,c,a,f)})},a.onWebCryptoError=function(a,b,c,d){return g.logger.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",a),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(b,c,d)},a.getValidChunk=function(a){var c=a,b=a.length-a.length%16;return b!==a.length&&(c=Object(i.sliceUint8)(a,0,b),this.remainderData=Object(i.sliceUint8)(a,b)),c},a.logOnce=function(a){this.logEnabled&&(g.logger.log("[decrypter.ts]: "+a),this.logEnabled=!1)},b}()},"./src/crypt/fast-aes-key.ts":/*!***********************************!*\
   !*** ./src/crypt/fast-aes-key.ts ***!
   \***********************************/ /*! exports provided: default */ function(c,a,b){"use strict";b.r(a),b.d(a,"default",function(){return d});var d=function(){function a(a,b){this.subtle=void 0,this.key=void 0,this.subtle=a,this.key=b}return a.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},a}()},"./src/demux/aacdemuxer.ts":/*!*********************************!*\
   !*** ./src/demux/aacdemuxer.ts ***!
   \*********************************/ /*! exports provided: default */ function(e,b,a){"use strict";a.r(b);var d=a(/*! ./base-audio-demuxer */ "./src/demux/base-audio-demuxer.ts"),f=a(/*! ./adts */ "./src/demux/adts.ts"),g=a(/*! ../utils/logger */ "./src/utils/logger.ts"),h=a(/*! ../demux/id3 */ "./src/demux/id3.ts");function i(a,b){return(i=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a})(a,b)}var c=function(c){function a(b,d){var a;return(a=c.call(this)||this).observer=void 0,a.config=void 0,a.observer=b,a.config=d,a}e=c,(d=a).prototype=Object.create(e.prototype),d.prototype.constructor=d,i(d,e);var d,e,b=a.prototype;return b.resetInitSegment=function(a,d,b){c.prototype.resetInitSegment.call(this,a,d,b),this._audioTrack={container:"audio/adts",type:"audio",id:0,pid:-1,sequenceNumber:0,isAAC:!0,samples:[],manifestCodec:a,duration:b,inputTimeScale:9e4,dropped:0}},a.probe=function(a){if(!a)return!1;for(var b=(h.getID3Data(a,0)||[]).length,c=a.length;b<c;b++)if(f.probe(a,b))return g.logger.log("ADTS sync word found !"),!0;return!1},b.canParse=function(a,b){return f.canParse(a,b)},b.appendFrame=function(a,c,d){f.initTrackConfig(a,this.observer,c,d,a.manifestCodec);var b=f.appendFrame(a,c,d,this.initPTS,this.frameIndex);if(b&&0===b.missing)return b},a}(d.default);c.minProbeByteLength=9,b.default=c},"./src/demux/adts.ts":/*!***************************!*\
   !*** ./src/demux/adts.ts ***!
   \***************************/ /*! exports provided: getAudioConfig, isHeaderPattern, getHeaderLength, getFullFrameLength, canGetFrameLength, isHeader, canParse, probe, initTrackConfig, getFrameDuration, parseFrameHeader, appendFrame */ function(c,b,a){"use strict";a.r(b),a.d(b,"getAudioConfig",function(){return g}),a.d(b,"isHeaderPattern",function(){return h}),a.d(b,"getHeaderLength",function(){return i}),a.d(b,"getFullFrameLength",function(){return j}),a.d(b,"canGetFrameLength",function(){return k}),a.d(b,"isHeader",function(){return l}),a.d(b,"canParse",function(){return m}),a.d(b,"probe",function(){return n}),a.d(b,"initTrackConfig",function(){return o}),a.d(b,"getFrameDuration",function(){return p}),a.d(b,"parseFrameHeader",function(){return q}),a.d(b,"appendFrame",function(){return r});var d=a(/*! ../utils/logger */ "./src/utils/logger.ts"),e=a(/*! ../errors */ "./src/errors.ts"),f=a(/*! ../events */ "./src/events.ts");function g(n,j,k,g){var c,h,i,a,l=navigator.userAgent.toLowerCase(),m=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];c=1+((192&j[k+2])>>>6);var b=(60&j[k+2])>>>2;if(!(b>m.length-1))return i=(1&j[k+2])<<2,i|=(192&j[k+3])>>>6,d.logger.log("manifest codec:"+g+", ADTS type:"+c+", samplingIndex:"+b),/firefox/i.test(l)?b>=6?(c=5,a=new Array(4),h=b-3):(c=2,a=new Array(2),h=b):-1!==l.indexOf("android")?(c=2,a=new Array(2),h=b):(c=5,a=new Array(4),g&&(-1!==g.indexOf("mp4a.40.29")|| -1!==g.indexOf("mp4a.40.5"))|| !g&&b>=6?h=b-3:((g&& -1!==g.indexOf("mp4a.40.2")&&(b>=6&&1===i||/vivaldi/i.test(l))|| !g&&1===i)&&(c=2,a=new Array(2)),h=b)),a[0]=c<<3,a[0]|=(14&b)>>1,a[1]|=(1&b)<<7,a[1]|=i<<3,5===c&&(a[1]|=(14&h)>>1,a[2]=(1&h)<<7,a[2]|=8,a[3]=0),{config:a,samplerate:m[b],channelCount:i,codec:"mp4a.40."+c,manifestCodec:g};n.trigger(f.Events.ERROR,{type:e.ErrorTypes.MEDIA_ERROR,details:e.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+b})}function h(a,b){return 255===a[b]&&240==(246&a[b+1])}function i(a,b){return 1&a[b+1]?7:9}function j(a,b){return(3&a[b+3])<<11|a[b+4]<<3|(224&a[b+5])>>>5}function k(a,b){return b+5<a.length}function l(a,b){return b+1<a.length&&h(a,b)}function m(a,b){return k(a,b)&&h(a,b)&&j(a,b)<=a.length-b}function n(a,b){if(l(a,b)){var c=i(a,b);if(b+c>=a.length)return!1;var d=j(a,b);if(d<=c)return!1;var e=b+d;return e===a.length||l(a,e)}return!1}function o(b,c,e,f,h){if(!b.samplerate){var a=g(c,e,f,h);a&&(b.config=a.config,b.samplerate=a.samplerate,b.channelCount=a.channelCount,b.codec=a.codec,b.manifestCodec=a.manifestCodec,d.logger.log("parsed codec:"+b.codec+", rate:"+a.samplerate+", channels:"+a.channelCount))}}function p(a){return 9216e4/a}function q(a,b,e,f,g){var c=i(a,b),d=j(a,b);if((d-=c)>0)return{headerLength:c,frameLength:d,stamp:e+f*g}}function r(h,a,b,j,k){var n,c=q(a,b,j,k,9216e4/h.samplerate);if(c){var f,l=c.frameLength,d=c.headerLength,m=c.stamp,e=d+l,g=Math.max(0,b+e-a.length);g?(f=new Uint8Array(e-d)).set(a.subarray(b+d,a.length),0):f=a.subarray(b+d,b+e);var i={unit:f,pts:m};return g||h.samples.push(i),{sample:i,length:e,missing:g}}}},"./src/demux/base-audio-demuxer.ts":/*!*****************************************!*\
   !*** ./src/demux/base-audio-demuxer.ts ***!
   \*****************************************/ /*! exports provided: initPTSFn, default */ function(d,b,a){"use strict";a.r(b),a.d(b,"initPTSFn",function(){return j});var e=a(/*! ./src/polyfills/number */ "./src/polyfills/number.ts"),f=a(/*! ../demux/id3 */ "./src/demux/id3.ts"),g=a(/*! ./dummy-demuxed-track */ "./src/demux/dummy-demuxed-track.ts"),h=a(/*! ../utils/mp4-tools */ "./src/utils/mp4-tools.ts"),i=a(/*! ../utils/typed-array */ "./src/utils/typed-array.ts"),c=function(){function b(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.initPTS=null}var a=b.prototype;return a.resetInitSegment=function(a,b,c){this._id3Track={type:"id3",id:0,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},a.resetTimeStamp=function(){},a.resetContiguity=function(){},a.canParse=function(a,b){return!1},a.appendFrame=function(a,b,c){},a.demux=function(c,p){this.cachedData&&(c=Object(h.appendUint8Array)(this.cachedData,c),this.cachedData=null);var d,e,a=f.getID3Data(c,0),b=a?a.length:0,n=this._audioTrack,l=this._id3Track,q=a?f.getTimeStamp(a):void 0,k=c.length;for(0!==this.frameIndex&&null!==this.initPTS||(this.initPTS=j(q,p)),a&&a.length>0&&l.samples.push({pts:this.initPTS,dts:this.initPTS,data:a}),e=this.initPTS;b<k;){if(this.canParse(c,b)){var m=this.appendFrame(n,c,b);m?(this.frameIndex++,e=m.sample.pts,d=b+=m.length):b=k}else f.canParse(c,b)?(a=f.getID3Data(c,b),l.samples.push({pts:e,dts:e,data:a}),d=b+=a.length):b++;if(b===k&&d!==k){var o=Object(i.sliceUint8)(c,d);this.cachedData?this.cachedData=Object(h.appendUint8Array)(this.cachedData,o):this.cachedData=o}}return{audioTrack:n,avcTrack:Object(g.dummyTrack)(),id3Track:l,textTrack:Object(g.dummyTrack)()}},a.demuxSampleAes=function(a,b,c){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},a.flush=function(b){var a=this.cachedData;return a&&(this.cachedData=null,this.demux(a,0)),this.frameIndex=0,{audioTrack:this._audioTrack,avcTrack:Object(g.dummyTrack)(),id3Track:this._id3Track,textTrack:Object(g.dummyTrack)()}},a.destroy=function(){},b}(),j=function(a,b){return Object(e.isFiniteNumber)(a)?90*a:9e4*b};b.default=c},"./src/demux/chunk-cache.ts":/*!**********************************!*\
   !*** ./src/demux/chunk-cache.ts ***!
   \**********************************/ /*! exports provided: default */ function(c,a,b){"use strict";b.r(a),b.d(a,"default",function(){return d});var d=function(){function b(){this.chunks=[],this.dataLength=0}var a=b.prototype;return a.push=function(a){this.chunks.push(a),this.dataLength+=a.length},a.flush=function(){var b,a=this.chunks,c=this.dataLength;return a.length?(b=1===a.length?a[0]:function(b,f){for(var c=new Uint8Array(f),d=0,a=0;a<b.length;a++){var e=b[a];c.set(e,d),d+=e.length}return c}(a,c),this.reset(),b):new Uint8Array(0)},a.reset=function(){this.chunks.length=0,this.dataLength=0},b}()},"./src/demux/dummy-demuxed-track.ts":/*!******************************************!*\
   !*** ./src/demux/dummy-demuxed-track.ts ***!
   \******************************************/ /*! exports provided: dummyTrack */ function(c,a,b){"use strict";function d(){return{type:"",id:-1,pid:-1,inputTimeScale:9e4,sequenceNumber:-1,samples:[],dropped:0}}b.r(a),b.d(a,"dummyTrack",function(){return d})},"./src/demux/exp-golomb.ts":/*!*********************************!*\
   !*** ./src/demux/exp-golomb.ts ***!
   \*********************************/ /*! exports provided: default */ function(d,a,b){"use strict";b.r(a);var e=b(/*! ../utils/logger */ "./src/utils/logger.ts"),c=function(){function b(a){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=a,this.bytesAvailable=a.byteLength,this.word=0,this.bitsAvailable=0}var a=b.prototype;return a.loadWord=function(){var b=this.data,c=this.bytesAvailable,d=b.byteLength-c,e=new Uint8Array(4),a=Math.min(4,c);if(0===a)throw new Error("no bytes available");e.set(b.subarray(d,d+a)),this.word=new DataView(e.buffer).getUint32(0),this.bitsAvailable=8*a,this.bytesAvailable-=a},a.skipBits=function(a){var b;this.bitsAvailable>a?(this.word<<=a,this.bitsAvailable-=a):(a-=this.bitsAvailable,a-=(b=a>>3)>>3,this.bytesAvailable-=b,this.loadWord(),this.word<<=a,this.bitsAvailable-=a)},a.readBits=function(b){var a=Math.min(this.bitsAvailable,b),c=this.word>>>32-a;return b>32&&e.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=a,this.bitsAvailable>0?this.word<<=a:this.bytesAvailable>0&&this.loadWord(),(a=b-a)>0&&this.bitsAvailable?c<<a|this.readBits(a):c},a.skipLZ=function(){var a;for(a=0;a<this.bitsAvailable;++a)if(0!=(this.word&2147483648>>>a))return this.word<<=a,this.bitsAvailable-=a,a;return this.loadWord(),a+this.skipLZ()},a.skipUEG=function(){this.skipBits(1+this.skipLZ())},a.skipEG=function(){this.skipBits(1+this.skipLZ())},a.readUEG=function(){var a=this.skipLZ();return this.readBits(a+1)-1},a.readEG=function(){var a=this.readUEG();return 1&a?1+a>>>1:-1*(a>>>1)},a.readBoolean=function(){return 1===this.readBits(1)},a.readUByte=function(){return this.readBits(8)},a.readUShort=function(){return this.readBits(16)},a.readUInt=function(){return this.readBits(32)},a.skipScalingList=function(d){for(var b=8,a=8,c=0;c<d;c++)0!==a&&(a=(b+this.readEG()+256)%256),b=0===a?b:a},a.readSPS=function(){var k,l,e,m=0,n=0,o=0,p=0,d=this.readUByte.bind(this),q=this.readBits.bind(this),b=this.readUEG.bind(this),g=this.readBoolean.bind(this),f=this.skipBits.bind(this),i=this.skipEG.bind(this),h=this.skipUEG.bind(this),t=this.skipScalingList.bind(this);d();var c=d();if(q(5),f(3),d(),h(),100===c||110===c||122===c||244===c||44===c||83===c||86===c||118===c||128===c){var r=b();if(3===r&&f(1),h(),h(),f(1),g())for(l=3!==r?8:12,e=0;e<l;e++)g()&&t(e<6?16:64)}h();var s=b();if(0===s)b();else if(1===s)for(f(1),i(),i(),k=b(),e=0;e<k;e++)i();h(),f(1);var u=b(),v=b(),j=q(1);0===j&&f(1),f(1),g()&&(m=b(),n=b(),o=b(),p=b());var a=[1,1];if(g()&&g())switch(d()){case 1:a=[1,1];break;case 2:a=[12,11];break;case 3:a=[10,11];break;case 4:a=[16,11];break;case 5:a=[40,33];break;case 6:a=[24,11];break;case 7:a=[20,11];break;case 8:a=[32,11];break;case 9:a=[80,33];break;case 10:a=[18,11];break;case 11:a=[15,11];break;case 12:a=[64,33];break;case 13:a=[160,99];break;case 14:a=[4,3];break;case 15:a=[3,2];break;case 16:a=[2,1];break;case 255:a=[d()<<8|d(),d()<<8|d()]}return{width:Math.ceil(16*(u+1)-2*m-2*n),height:(2-j)*(v+1)*16-(j?2:4)*(o+p),pixelRatio:a}},a.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},b}();a.default=c},"./src/demux/id3.ts":/*!**************************!*\
   !*** ./src/demux/id3.ts ***!
   \**************************/ /*! exports provided: isHeader, isFooter, getID3Data, canParse, getTimeStamp, isTimeStampFrame, getID3Frames, decodeFrame, utf8ArrayToStr, testables */ function(d,a,b){"use strict";b.r(a),b.d(a,"isHeader",function(){return f}),b.d(a,"isFooter",function(){return g}),b.d(a,"getID3Data",function(){return h}),b.d(a,"canParse",function(){return j}),b.d(a,"getTimeStamp",function(){return k}),b.d(a,"isTimeStampFrame",function(){return l}),b.d(a,"getID3Frames",function(){return n}),b.d(a,"decodeFrame",function(){return o}),b.d(a,"utf8ArrayToStr",function(){return s}),b.d(a,"testables",function(){return t});var e,f=function(a,b){return b+10<=a.length&&73===a[b]&&68===a[b+1]&&51===a[b+2]&&a[b+3]<255&&a[b+4]<255&&a[b+6]<128&&a[b+7]<128&&a[b+8]<128&&a[b+9]<128},g=function(a,b){return b+10<=a.length&&51===a[b]&&68===a[b+1]&&73===a[b+2]&&a[b+3]<255&&a[b+4]<255&&a[b+6]<128&&a[b+7]<128&&a[b+8]<128&&a[b+9]<128},h=function(c,b){for(var d=b,a=0;f(c,b);)a+=10,a+=i(c,b+6),g(c,b+10)&&(a+=10),b+=a;if(a>0)return c.subarray(d,d+a)},i=function(a,b){var c=0;return c=(127&a[b])<<21,c|=(127&a[b+1])<<14,c|=(127&a[b+2])<<7,c|=127&a[b+3]},j=function(a,b){return f(a,b)&&i(a,b+6)+10<=a.length-b},k=function(d){for(var b=n(d),a=0;a<b.length;a++){var c=b[a];if(l(c))return r(c)}},l=function(a){return a&&"PRIV"===a.key&&"com.apple.streaming.transportStreamTimestamp"===a.info},m=function(a){var c=String.fromCharCode(a[0],a[1],a[2],a[3]),b=i(a,4);return{type:c,size:b,data:a.subarray(10,10+b)}},n=function(b){for(var a=0,c=[];f(b,a);){for(var h=i(b,a+6),j=(a+=10)+h;a+8<j;){var d=m(b.subarray(a)),e=o(d);e&&c.push(e),a+=d.size+10}g(b,a)&&(a+=10)}return c},o=function(a){return"PRIV"===a.type?p(a):"W"===a.type[0]?q(a):c(a)},p=function(a){if(!(a.size<2)){var b=s(a.data,!0),c=new Uint8Array(a.data.subarray(b.length+1));return{key:a.type,info:b,data:c.buffer}}},c=function(a){if(!(a.size<2)){if("TXXX"===a.type){var b=1,c=s(a.data.subarray(b),!0);b+=c.length+1;var d=s(a.data.subarray(b));return{key:a.type,info:c,data:d}}var e=s(a.data.subarray(1));return{key:a.type,data:e}}},q=function(a){if("WXXX"===a.type){if(a.size<2)return;var b=1,c=s(a.data.subarray(b),!0);b+=c.length+1;var d=s(a.data.subarray(b));return{key:a.type,info:c,data:d}}var e=s(a.data);return{key:a.type,data:e}},r=function(c){if(8===c.data.byteLength){var a=new Uint8Array(c.data),d=1&a[3],b=(a[4]<<23)+(a[5]<<15)+(a[6]<<7)+a[7];return b/=45,d&&(b+=47721858.84),Math.round(b)}},s=function(b,d){void 0===d&&(d=!1);var h=u();if(h){var e=h.decode(b);if(d){var i=e.indexOf("\0");return -1!==i?e.substring(0,i):e}return e.replace(/\0/g,"")}for(var a,f,j,k=b.length,g="",c=0;c<k&&(0!==(a=b[c++])||!d);)if(0!==a&&3!==a)switch(a>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:g+=String.fromCharCode(a);break;case 12:case 13:f=b[c++],g+=String.fromCharCode((31&a)<<6|63&f);break;case 14:f=b[c++],j=b[c++],g+=String.fromCharCode((15&a)<<12|(63&f)<<6|(63&j)<<0)}return g},t={decodeTextFrame:c};function u(){return e|| void 0===self.TextDecoder||(e=new self.TextDecoder("utf-8")),e}},"./src/demux/mp3demuxer.ts":/*!*********************************!*\
   !*** ./src/demux/mp3demuxer.ts ***!
   \*********************************/ /*! exports provided: default */ function(e,b,a){"use strict";a.r(b);var d=a(/*! ./base-audio-demuxer */ "./src/demux/base-audio-demuxer.ts"),f=a(/*! ../demux/id3 */ "./src/demux/id3.ts"),g=a(/*! ../utils/logger */ "./src/utils/logger.ts"),h=a(/*! ./mpegaudio */ "./src/demux/mpegaudio.ts");function i(a,b){return(i=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a})(a,b)}var c=function(c){function a(){return c.apply(this,arguments)||this}e=c,(d=a).prototype=Object.create(e.prototype),d.prototype.constructor=d,i(d,e);var d,e,b=a.prototype;return b.resetInitSegment=function(a,d,b){c.prototype.resetInitSegment.call(this,a,d,b),this._audioTrack={container:"audio/mpeg",type:"audio",id:0,pid:-1,sequenceNumber:0,isAAC:!1,samples:[],manifestCodec:a,duration:b,inputTimeScale:9e4,dropped:0}},a.probe=function(a){if(!a)return!1;for(var b=(f.getID3Data(a,0)||[]).length,c=a.length;b<c;b++)if(h.probe(a,b))return g.logger.log("MPEG Audio sync word found !"),!0;return!1},b.canParse=function(a,b){return h.canParse(a,b)},b.appendFrame=function(a,b,c){if(null!==this.initPTS)return h.appendFrame(a,b,c,this.initPTS,this.frameIndex)},a}(d.default);c.minProbeByteLength=4,b.default=c},"./src/demux/mp4demuxer.ts":/*!*********************************!*\
   !*** ./src/demux/mp4demuxer.ts ***!
   \*********************************/ /*! exports provided: default */ function(d,b,a){"use strict";a.r(b);var e=a(/*! ../utils/mp4-tools */ "./src/utils/mp4-tools.ts"),f=a(/*! ./dummy-demuxed-track */ "./src/demux/dummy-demuxed-track.ts"),c=function(){function b(b,a){this.remainderData=null,this.config=void 0,this.config=a}var a=b.prototype;return a.resetTimeStamp=function(){},a.resetInitSegment=function(){},a.resetContiguity=function(){},b.probe=function(a){return Object(e.findBox)({data:a,start:0,end:Math.min(a.length,16384)},["moof"]).length>0},a.demux=function(c){var a=c,b=Object(f.dummyTrack)();if(this.config.progressive){this.remainderData&&(a=Object(e.appendUint8Array)(this.remainderData,c));var d=Object(e.segmentValidRange)(a);this.remainderData=d.remainder,b.samples=d.valid||new Uint8Array}else b.samples=a;return{audioTrack:Object(f.dummyTrack)(),avcTrack:b,id3Track:Object(f.dummyTrack)(),textTrack:Object(f.dummyTrack)()}},a.flush=function(){var a=Object(f.dummyTrack)();return a.samples=this.remainderData||new Uint8Array,this.remainderData=null,{audioTrack:Object(f.dummyTrack)(),avcTrack:a,id3Track:Object(f.dummyTrack)(),textTrack:Object(f.dummyTrack)()}},a.demuxSampleAes=function(a,b,c){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},a.destroy=function(){},b}();c.minProbeByteLength=1024,b.default=c},"./src/demux/mpegaudio.ts":/*!********************************!*\
   !*** ./src/demux/mpegaudio.ts ***!
   \********************************/ /*! exports provided: appendFrame, parseHeader, isHeaderPattern, isHeader, canParse, probe */ function(c,a,b){"use strict";b.r(a),b.d(a,"appendFrame",function(){return i}),b.d(a,"parseHeader",function(){return j}),b.d(a,"isHeaderPattern",function(){return k}),b.d(a,"isHeader",function(){return l}),b.d(a,"canParse",function(){return m}),b.d(a,"probe",function(){return n});var d=null,e=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],f=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],g=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],h=[0,1,1,4];function i(c,d,b,g,h){if(!(b+24>d.length)){var a=j(d,b);if(a&&b+a.frameLength<=d.length){var e=g+h*(9e4*a.samplesPerFrame/a.sampleRate),f={unit:d.subarray(b,b+a.frameLength),pts:e,dts:e};return c.config=[],c.channelCount=a.channelCount,c.samplerate=a.sampleRate,c.samples.push(f),{sample:f,length:a.frameLength,missing:0}}}}function j(a,b){var c=a[b+1]>>3&3,i=a[b+1]>>1&3,j=a[b+2]>>4&15,k=a[b+2]>>2&3;if(1!==c&&0!==j&&15!==j&&3!==k){var r=a[b+2]>>1&1,l=a[b+3]>>6,m=1e3*e[14*(3===c?3-i:3===i?3:4)+j-1],n=f[3*(3===c?0:2===c?1:2)+k],s=3===l?1:2,o=g[c][i],p=h[i],t=8*o*p,u=Math.floor(o*m/n+r)*p;if(null===d){var q=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);d=q?parseInt(q[1]):0}return d&&d<=87&&2===i&&m>=224e3&&0===l&&(a[b+3]=128|a[b+3]),{sampleRate:n,channelCount:s,frameLength:u,samplesPerFrame:t}}}function k(a,b){return 255===a[b]&&224==(224&a[b+1])&&0!=(6&a[b+1])}function l(a,b){return b+1<a.length&&k(a,b)}function m(a,b){return k(a,b)&&4<=a.length-b}function n(a,b){if(b+1<a.length&&k(a,b)){var c=j(a,b),d=4;null!=c&&c.frameLength&&(d=c.frameLength);var e=b+d;return e===a.length||l(a,e)}return!1}},"./src/demux/sample-aes.ts":/*!*********************************!*\
   !*** ./src/demux/sample-aes.ts ***!
   \*********************************/ /*! exports provided: default */ function(d,b,a){"use strict";a.r(b);var e=a(/*! ../crypt/decrypter */ "./src/crypt/decrypter.ts"),f=a(/*! ./tsdemuxer */ "./src/demux/tsdemuxer.ts"),c=function(){function b(a,b,c){this.keyData=void 0,this.decrypter=void 0,this.keyData=c,this.decrypter=new e.default(a,b,{removePKCS7Padding:!1})}var a=b.prototype;return a.decryptBuffer=function(a,b){this.decrypter.decrypt(a,this.keyData.key.buffer,this.keyData.iv.buffer,b)},a.decryptAacSample=function(c,d,f,g){var b=c[d].unit,a=b.subarray(16,b.length-b.length%16),e=a.buffer.slice(a.byteOffset,a.byteOffset+a.length),h=this;this.decryptBuffer(e,function(a){var e=new Uint8Array(a);b.set(e,16),g||h.decryptAacSamples(c,d+1,f)})},a.decryptAacSamples=function(b,a,c){for(;;a++){if(a>=b.length)return void c();if(!(b[a].unit.length<32)){var d=this.decrypter.isSync();if(this.decryptAacSample(b,a,c,d),!d)return}}},a.getAvcEncryptedData=function(b){for(var e=16*Math.floor((b.length-48)/160)+16,c=new Int8Array(e),d=0,a=32;a<=b.length-16;a+=160,d+=16)c.set(b.subarray(a,a+16),d);return c},a.getAvcDecryptedUnit=function(a,d){for(var e=new Uint8Array(d),b=0,c=32;c<=a.length-16;c+=160,b+=16)a.set(e.subarray(b,b+16),c);return a},a.decryptAvcSample=function(d,e,g,h,a,i){var b=Object(f.discardEPB)(a.data),c=this.getAvcEncryptedData(b),j=this;this.decryptBuffer(c.buffer,function(c){a.data=j.getAvcDecryptedUnit(b,c),i||j.decryptAvcSamples(d,e,g+1,h)})},a.decryptAvcSamples=function(b,c,a,e){if(b instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;c++,a=0){if(c>=b.length)return void e();for(var f=b[c].units;!(a>=f.length);a++){var d=f[a];if(!(d.data.length<=48||1!==d.type&&5!==d.type)){var g=this.decrypter.isSync();if(this.decryptAvcSample(b,c,a,e,d,g),!g)return}}}},b}();b.default=c},"./src/demux/transmuxer-interface.ts":/*!*******************************************!*\
   !*** ./src/demux/transmuxer-interface.ts ***!
   \*******************************************/ /*! exports provided: default */ function(d,b,a){"use strict";a.r(b),a.d(b,"default",function(){return l});var e=a(/*! webworkify-webpack */ "./node_modules/webworkify-webpack/index.js"),f=a(/*! ../events */ "./src/events.ts"),g=a(/*! ../demux/transmuxer */ "./src/demux/transmuxer.ts"),h=a(/*! ../utils/logger */ "./src/utils/logger.ts"),i=a(/*! ../errors */ "./src/errors.ts"),c=a(/*! ../utils/mediasource-helper */ "./src/utils/mediasource-helper.ts"),j=a(/*! eventemitter3 */ "./node_modules/eventemitter3/index.js"),k=Object(c.getMediaSource)()||{isTypeSupported:function(){return!1}},l=function(){function b(m,b,o,p){var a,r=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.hls=m,this.id=b,this.onTransmuxComplete=o,this.onFlush=p;var c=m.config,n=function(b,a){(a=a||{}).frag=r.frag,a.id=r.id,m.trigger(b,a)};this.observer=new j.EventEmitter,this.observer.on(f.Events.FRAG_DECRYPTED,n),this.observer.on(f.Events.ERROR,n);var d={mp4:k.isTypeSupported("video/mp4"),mpeg:k.isTypeSupported("audio/mpeg"),mp3:k.isTypeSupported('audio/mp4; codecs="mp3"')},l=navigator.vendor;if(c.enableWorker&&"undefined"!=typeof Worker){h.logger.log("demuxing in webworker");try{a=this.worker=e(/*! ../demux/transmuxer-worker.ts */ "./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),a.addEventListener("message",this.onwmsg),a.onerror=function(a){m.trigger(f.Events.ERROR,{type:i.ErrorTypes.OTHER_ERROR,details:i.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",error:new Error(a.message+"  ("+a.filename+":"+a.lineno+")")})},a.postMessage({cmd:"init",typeSupported:d,vendor:l,id:b,config:JSON.stringify(c)})}catch(q){h.logger.warn("Error in worker:",q),h.logger.error("Error while initializing DemuxerWorker, fallback to inline"),a&&self.URL.revokeObjectURL(a.objectURL),this.transmuxer=new g.default(this.observer,d,c,l,b),this.worker=null}}else this.transmuxer=new g.default(this.observer,d,c,l,b)}var a=b.prototype;return a.destroy=function(){var a=this.worker;if(a)a.removeEventListener("message",this.onwmsg),a.terminate(),this.worker=null;else{var b=this.transmuxer;b&&(b.destroy(),this.transmuxer=null)}var c=this.observer;c&&c.removeAllListeners(),this.observer=null},a.push=function(e,u,v,w,b,d,x,m,a,y){var A=this;a.transmuxing.start=self.performance.now();var n=this.transmuxer,o=this.worker,p=d?d.start:b.start,q=b.decryptdata,c=this.frag,j=!(c&&b.cc===c.cc),f=!(c&&a.level===c.level),k=c?a.sn-c.sn:-1,r=this.part?a.part-this.part.index:1,i=!f&&(1===k||0===k&&1===r),s=self.performance.now();(f||k||0===b.stats.parsing.start)&&(b.stats.parsing.start=s),d&&(r||!i)&&(d.stats.parsing.start=s);var t=new g.TransmuxState(j,i,m,f,p);if(!i||j){h.logger.log("[transmuxer-interface, "+b.type+"]: Starting new transmux session for sn: "+a.sn+" p: "+a.part+" level: "+a.level+" id: "+a.id+"\n        discontinuity: "+j+"\n        trackSwitch: "+f+"\n        contiguous: "+i+"\n        accurateTimeOffset: "+m+"\n        timeOffset: "+p);var z=new g.TransmuxConfig(v,w,u,x,y);this.configureTransmuxer(z)}if(this.frag=b,this.part=d,o)o.postMessage({cmd:"demux",data:e,decryptdata:q,chunkMeta:a,state:t},e instanceof ArrayBuffer?[e]:[]);else if(n){var l=n.push(e,q,a,t);Object(g.isPromise)(l)?l.then(function(a){A.handleTransmuxComplete(a)}):this.handleTransmuxComplete(l)}},a.flush=function(a){var e=this;a.transmuxing.start=self.performance.now();var c=this.transmuxer,d=this.worker;if(d)d.postMessage({cmd:"flush",chunkMeta:a});else if(c){var b=c.flush(a);Object(g.isPromise)(b)?b.then(function(b){e.handleFlushResult(b,a)}):this.handleFlushResult(b,a)}},a.handleFlushResult=function(a,b){var c=this;a.forEach(function(a){c.handleTransmuxComplete(a)}),this.onFlush(b)},a.onWorkerMessage=function(b){var a=b.data,c=this.hls;switch(a.event){case"init":self.URL.revokeObjectURL(this.worker.objectURL);break;case"transmuxComplete":this.handleTransmuxComplete(a.data);break;case"flush":this.onFlush(a.data);break;default:a.data=a.data||{},a.data.frag=this.frag,a.data.id=this.id,c.trigger(a.event,a.data)}},a.configureTransmuxer=function(a){var b=this.worker,c=this.transmuxer;b?b.postMessage({cmd:"configure",config:a}):c&&c.configure(a)},a.handleTransmuxComplete=function(a){a.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(a)},b}()},"./src/demux/transmuxer-worker.ts":/*!****************************************!*\
   !*** ./src/demux/transmuxer-worker.ts ***!
   \****************************************/ /*! exports provided: default */ function(c,b,a){"use strict";a.r(b),a.d(b,"default",function(){return h});var d=a(/*! ../demux/transmuxer */ "./src/demux/transmuxer.ts"),e=a(/*! ../events */ "./src/events.ts"),f=a(/*! ../utils/logger */ "./src/utils/logger.ts"),g=a(/*! eventemitter3 */ "./node_modules/eventemitter3/index.js");function h(c){var a=new g.EventEmitter,b=function(a,b){c.postMessage({event:a,data:b})};a.on(e.Events.FRAG_DECRYPTED,b),a.on(e.Events.ERROR,b),c.addEventListener("message",function(m){var e=m.data;switch(e.cmd){case"init":var j=JSON.parse(e.config);c.transmuxer=new d.default(a,e.typeSupported,j,e.vendor,e.id),Object(f.enableLogs)(j.debug),b("init",null);break;case"configure":c.transmuxer.configure(e.config);break;case"demux":var g=c.transmuxer.push(e.data,e.decryptdata,e.chunkMeta,e.state);Object(d.isPromise)(g)?g.then(function(a){i(c,a)}):i(c,g);break;case"flush":var l=e.chunkMeta,h=c.transmuxer.flush(l);Object(d.isPromise)(h)?h.then(function(a){k(c,a,l)}):k(c,h,l)}})}function i(f,a){if((g=a.remuxResult).audio||g.video||g.text||g.id3||g.initSegment){var g,b=[],c=a.remuxResult,d=c.audio,e=c.video;d&&j(b,d),e&&j(b,e),f.postMessage({event:"transmuxComplete",data:a},b)}}function j(b,a){a.data1&&b.push(a.data1.buffer),a.data2&&b.push(a.data2.buffer)}function k(a,b,c){b.forEach(function(b){i(a,b)}),a.postMessage({event:"flush",data:c})}},"./src/demux/transmuxer.ts":/*!*********************************!*\
   !*** ./src/demux/transmuxer.ts ***!
   \*********************************/ /*! exports provided: default, isPromise, TransmuxConfig, TransmuxState */ function(l,b,a){"use strict";a.r(b),a.d(b,"default",function(){return t}),a.d(b,"isPromise",function(){return v}),a.d(b,"TransmuxConfig",function(){return w}),a.d(b,"TransmuxState",function(){return x});var d,m=a(/*! ../events */ "./src/events.ts"),n=a(/*! ../errors */ "./src/errors.ts"),o=a(/*! ../crypt/decrypter */ "./src/crypt/decrypter.ts"),e=a(/*! ../demux/aacdemuxer */ "./src/demux/aacdemuxer.ts"),f=a(/*! ../demux/mp4demuxer */ "./src/demux/mp4demuxer.ts"),g=a(/*! ../demux/tsdemuxer */ "./src/demux/tsdemuxer.ts"),h=a(/*! ../demux/mp3demuxer */ "./src/demux/mp3demuxer.ts"),c=a(/*! ../remux/mp4-remuxer */ "./src/remux/mp4-remuxer.ts"),i=a(/*! ../remux/passthrough-remuxer */ "./src/remux/passthrough-remuxer.ts"),p=a(/*! ./chunk-cache */ "./src/demux/chunk-cache.ts"),q=a(/*! ../utils/mp4-tools */ "./src/utils/mp4-tools.ts"),j=a(/*! ../utils/logger */ "./src/utils/logger.ts");try{d=self.performance.now.bind(self.performance)}catch(r){j.logger.debug("Unable to use Performance API on this environment"),d=self.Date.now}var k=[{demux:g.default,remux:c.default},{demux:f.default,remux:i.default},{demux:e.default,remux:c.default},{demux:h.default,remux:c.default}],s=1024;k.forEach(function(a){s=Math.max(s,a.demux.minProbeByteLength)});var t=function(){function b(a,b,c,d,e){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.cache=new p.default,this.observer=a,this.typeSupported=b,this.config=c,this.vendor=d,this.id=e}var a=b.prototype;return a.configure=function(a){this.transmuxConfig=a,this.decrypter&&this.decrypter.reset()},a.push=function(s,t,g,h){var G=this,i=g.transmuxing;i.executeStart=d();var m,c,j,a=new Uint8Array(s),n=this.cache,v=this.config,w=this.currentTransmuxState,e=this.transmuxConfig;h&&(this.currentTransmuxState=h);var b=(m=a,c=t,j=null,m.byteLength>0&&null!=c&&null!=c.key&&null!==c.iv&&null!=c.method&&(j=c),j);if(b&&"AES-128"===b.method){var o=this.getDecrypter();if(!v.enableSoftwareAES)return this.decryptionPromise=o.webCryptoDecrypt(a,b.key.buffer,b.iv.buffer).then(function(a){var b=G.push(a,null,g);return G.decryptionPromise=null,b}),this.decryptionPromise;var p=o.softwareDecrypt(a,b.key.buffer,b.iv.buffer);if(!p)return i.executeEnd=d(),u(g);a=new Uint8Array(p)}var f=h||w,x=f.contiguous,k=f.discontinuity,r=f.trackSwitch,y=f.accurateTimeOffset,z=f.timeOffset,A=e.audioCodec,B=e.videoCodec,C=e.defaultInitPts,D=e.duration,_=e.initSegmentData;if((k||r)&&this.resetInitSegment(_,A,B,D),k&&this.resetInitialTimestamp(C),x||this.resetContiguity(),this.needsProbing(a,k,r)){if(n.dataLength){var E=n.flush();a=Object(q.appendUint8Array)(E,a)}this.configureTransmuxer(a,e)}var F=this.transmux(a,b,z,y,g),l=this.currentTransmuxState;return l.contiguous=!0,l.discontinuity=!1,l.trackSwitch=!1,i.executeEnd=d(),F},a.flush=function(a){var q=this,e=a.transmuxing;e.executeStart=d();var f=this.decrypter,g=this.cache,k=this.currentTransmuxState,h=this.decryptionPromise;if(h)return h.then(function(){return q.flush(a)});var b=[],l=k.timeOffset;if(f){var i=f.flush();i&&b.push(this.push(i,null,a))}var o=g.dataLength;g.reset();var j=this.demuxer,p=this.remuxer;if(!j||!p)return o>=s&&this.observer.emit(m.Events.ERROR,m.Events.ERROR,{type:n.ErrorTypes.MEDIA_ERROR,details:n.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),e.executeEnd=d(),[u(a)];var c=j.flush(l);return v(c)?c.then(function(c){return q.flushRemux(b,c,a),b}):(this.flushRemux(b,c,a),b)},a.flushRemux=function(e,b,a){var f=b.audioTrack,g=b.avcTrack,h=b.id3Track,i=b.textTrack,c=this.currentTransmuxState,k=c.accurateTimeOffset,l=c.timeOffset;j.logger.log("[transmuxer.ts]: Flushed fragment "+a.sn+(a.part> -1?" p: "+a.part:"")+" of level "+a.level);var m=this.remuxer.remux(f,g,h,i,l,k,!0,this.id);e.push({remuxResult:m,chunkMeta:a}),a.transmuxing.executeEnd=d()},a.resetInitialTimestamp=function(a){var b=this.demuxer,c=this.remuxer;b&&c&&(b.resetTimeStamp(a),c.resetTimeStamp(a))},a.resetContiguity=function(){var a=this.demuxer,b=this.remuxer;a&&b&&(a.resetContiguity(),b.resetNextTimestamp())},a.resetInitSegment=function(e,a,b,f){var c=this.demuxer,d=this.remuxer;c&&d&&(c.resetInitSegment(a,b,f),d.resetInitSegment(e,a,b))},a.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},a.transmux=function(b,a,c,d,e){return a&&"SAMPLE-AES"===a.method?this.transmuxSampleAes(b,a,c,d,e):this.transmuxUnencrypted(b,c,d,e)},a.transmuxUnencrypted=function(c,b,d,e){var a=this.demuxer.demux(c,b,!1,!this.config.progressive),f=a.audioTrack,g=a.avcTrack,h=a.id3Track,i=a.textTrack;return{remuxResult:this.remuxer.remux(f,g,h,i,b,d,!1,this.id),chunkMeta:e}},a.transmuxSampleAes=function(a,b,c,d,e){var f=this;return this.demuxer.demuxSampleAes(a,b,c).then(function(a){return{remuxResult:f.remuxer.remux(a.audioTrack,a.avcTrack,a.id3Track,a.textTrack,c,d,!1,f.id),chunkMeta:e}})},a.configureTransmuxer=function(o,a){for(var b,e=this.config,g=this.observer,h=this.typeSupported,p=this.vendor,q=a.audioCodec,r=a.defaultInitPts,s=a.duration,t=a.initSegmentData,u=a.videoCodec,c=0,v=k.length;c<v;c++)if(k[c].demux.probe(o)){b=k[c];break}b||(j.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),b={demux:f.default,remux:i.default});var l=this.demuxer,m=this.remuxer,n=b.remux,d=b.demux;m&&m instanceof n||(this.remuxer=new n(g,e,h,p)),l&&l instanceof d||(this.demuxer=new d(g,e,h),this.probe=d.probe),this.resetInitSegment(t,q,u,s),this.resetInitialTimestamp(r)},a.needsProbing=function(c,a,b){return!this.demuxer||!this.remuxer||a||b},a.getDecrypter=function(){var a=this.decrypter;return a||(a=this.decrypter=new o.default(this.observer,this.config)),a},b}(),u=function(a){return{remuxResult:{},chunkMeta:a}};function v(a){return"then"in a&&a.then instanceof Function}var w=function(a,b,c,d,e){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=a,this.videoCodec=b,this.initSegmentData=c,this.duration=d,this.defaultInitPts=e},x=function(a,b,c,d,e){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.discontinuity=a,this.contiguous=b,this.accurateTimeOffset=c,this.trackSwitch=d,this.timeOffset=e}},"./src/demux/tsdemuxer.ts":/*!********************************!*\
   !*** ./src/demux/tsdemuxer.ts ***!
   \********************************/ /*! exports provided: discardEPB, default */ function(d,b,a){"use strict";a.r(b),a.d(b,"discardEPB",function(){return u});var e=a(/*! ./adts */ "./src/demux/adts.ts"),f=a(/*! ./mpegaudio */ "./src/demux/mpegaudio.ts"),g=a(/*! ./exp-golomb */ "./src/demux/exp-golomb.ts"),h=a(/*! ./id3 */ "./src/demux/id3.ts"),i=a(/*! ./sample-aes */ "./src/demux/sample-aes.ts"),j=a(/*! ../events */ "./src/events.ts"),k=a(/*! ../utils/mp4-tools */ "./src/utils/mp4-tools.ts"),l=a(/*! ../utils/logger */ "./src/utils/logger.ts"),m=a(/*! ../errors */ "./src/errors.ts"),n={video:1,audio:2,id3:3,text:4},c=function(){function b(a,b,c){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this.aacLastPTS=null,this._initPTS=null,this._initDTS=null,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=a,this.config=b,this.typeSupported=c}b.probe=function(c){var a=b.syncOffset(c);return!(a<0||(a&&l.logger.warn("MPEG2-TS detected but first sync word found @ offset "+a+", junk ahead ?"),0))},b.syncOffset=function(b){for(var c=Math.min(1e3,b.length-564),a=0;a<c;){if(71===b[a]&&71===b[a+188]&&71===b[a+376])return a;a++}return -1},b.createTrack=function(a,b){return{container:"video"===a||"audio"===a?"video/mp2t":void 0,type:a,id:n[a],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===a?b:void 0}};var a=b.prototype;return a.resetInitSegment=function(c,d,a){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=b.createTrack("video",a),this._audioTrack=b.createTrack("audio",a),this._id3Track=b.createTrack("id3",a),this._txtTrack=b.createTrack("text",a),this._audioTrack.isAAC=!0,this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=c,this.videoCodec=d,this._duration=a},a.resetTimeStamp=function(){},a.resetContiguity=function(){var a=this._audioTrack,b=this._avcTrack,c=this._id3Track;a&&(a.pesData=null),b&&(b.pesData=null),c&&(c.pesData=null),this.aacOverFlow=null,this.aacLastPTS=null},a.demux=function(a,F,u,s){void 0===u&&(u=!1),void 0===s&&(s=!1),u||(this.sampleAes=null);var e,n=this._avcTrack,d=this._audioTrack,o=this._id3Track,w=n.pid,f=n.pesData,x=d.pid,y=o.pid,g=d.pesData,h=o.pesData,z=!1,B=this.pmtParsed,C=this._pmtId,i=a.length;if(this.remainderData&&(i=(a=Object(k.appendUint8Array)(this.remainderData,a)).length,this.remainderData=null),i<188&&!s)return this.remainderData=a,{audioTrack:d,avcTrack:n,id3Track:o,textTrack:this._txtTrack};var A=Math.max(0,b.syncOffset(a));(i-=(i+A)%188)<a.byteLength&&!s&&(this.remainderData=new Uint8Array(a.buffer,i,a.buffer.byteLength-i));for(var _=A;_<i;_+=188)if(71===a[_]){var t=!!(64&a[_+1]),E=((31&a[_+1])<<8)+a[_+2],c=void 0;if((48&a[_+3])>>4>1){if((c=_+5+a[_+4])===_+188)continue}else c=_+4;switch(E){case w:t&&(f&&(e=r(f))&&this.parseAVCPES(e,!1),f={data:[],size:0}),f&&(f.data.push(a.subarray(c,_+188)),f.size+=_+188-c);break;case x:t&&(g&&(e=r(g))&&(d.isAAC?this.parseAACPES(e):this.parseMPEGPES(e)),g={data:[],size:0}),g&&(g.data.push(a.subarray(c,_+188)),g.size+=_+188-c);break;case y:t&&(h&&(e=r(h))&&this.parseID3PES(e),h={data:[],size:0}),h&&(h.data.push(a.subarray(c,_+188)),h.size+=_+188-c);break;case 0:t&&(c+=a[c]+1),C=this._pmtId=p(a,c);break;case C:t&&(c+=a[c]+1);var v=q(a,c,!0===this.typeSupported.mpeg|| !0===this.typeSupported.mp3,u);(w=v.avc)>0&&(n.pid=w),(x=v.audio)>0&&(d.pid=x,d.isAAC=v.isAAC),(y=v.id3)>0&&(o.pid=y),z&&!B&&(l.logger.log("reparse from beginning"),z=!1,_=A-188),B=this.pmtParsed=!0;break;case 17:case 8191:break;default:z=!0}}else this.observer.emit(j.Events.ERROR,j.Events.ERROR,{type:m.ErrorTypes.MEDIA_ERROR,details:m.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});n.pesData=f,d.pesData=g,o.pesData=h;var D={audioTrack:d,avcTrack:n,id3Track:o,textTrack:this._txtTrack};return s&&this.extractRemainingSamples(D),D},a.flush=function(){var a,b=this.remainderData;return this.remainderData=null,a=b?this.demux(b,-1,!1,!0):{audioTrack:this._audioTrack,avcTrack:this._avcTrack,textTrack:this._txtTrack,id3Track:this._id3Track},this.extractRemainingSamples(a),this.sampleAes?this.decrypt(a,this.sampleAes):a},a.extractRemainingSamples=function(d){var a,c=d.audioTrack,e=d.avcTrack,f=d.id3Track,g=e.pesData,b=c.pesData,h=f.pesData;g&&(a=r(g))?(this.parseAVCPES(a,!0),e.pesData=null):e.pesData=g,b&&(a=r(b))?(c.isAAC?this.parseAACPES(a):this.parseMPEGPES(a),c.pesData=null):(null!=b&&b.size&&l.logger.log("last AAC PES packet truncated,might overlap between fragments"),c.pesData=b),h&&(a=r(h))?(this.parseID3PES(a),f.pesData=null):f.pesData=h},a.demuxSampleAes=function(a,b,c){var d=this.demux(a,c,!0,!this.config.progressive),e=this.sampleAes=new i.default(this.observer,this.config,b);return this.decrypt(d,e)},a.decrypt=function(a,b){return new Promise(function(e){var c=a.audioTrack,d=a.avcTrack;c.samples&&c.isAAC?b.decryptAacSamples(c.samples,0,function(){d.samples?b.decryptAvcSamples(d.samples,0,0,function(){e(a)}):e(a)}):d.samples&&b.decryptAvcSamples(d.samples,0,0,function(){e(a)})})},a.destroy=function(){this._initPTS=this._initDTS=null,this._duration=0},a.parseAVCPES=function(b,e){var f,i=this,c=this._avcTrack,d=this.parseAVCNALu(b.data),a=this.avcSample,j=!1;b.data=null,a&&d.length&&!c.audFound&&(s(a,c),a=this.avcSample=o(!1,b.pts,b.dts,"")),d.forEach(function(e){switch(e.type){case 1:f=!0,a||(a=i.avcSample=o(!0,b.pts,b.dts,"")),a.frame=!0;var A=e.data;if(j&&A.length>4){var n=new g.default(A).readSliceType();2!==n&&4!==n&&7!==n&&9!==n||(a.key=!0)}break;case 5:f=!0,a||(a=i.avcSample=o(!0,b.pts,b.dts,"")),a.key=!0,a.frame=!0;break;case 6:f=!0;var d=new g.default(u(e.data));d.readUByte();for(var m=0,k=0,v=!1,p=0;!v&&d.bytesAvailable>1;){m=0;do m+=p=d.readUByte();while(255===p)k=0;do k+=p=d.readUByte();while(255===p)if(4===m&&0!==d.bytesAvailable){if(v=!0,181===d.readUByte()&&49===d.readUShort()&&1195456820===d.readUInt()&&3===d.readUByte()){for(var B=d.readUByte(),G=31&B,q=[B,d.readUByte()],C=0;C<G;C++)q.push(d.readUByte()),q.push(d.readUByte()),q.push(d.readUByte());t(i._txtTrack.samples,{type:3,pts:b.pts,bytes:q})}}else if(5===m&&0!==d.bytesAvailable){if(v=!0,k>16){for(var w=[],l=0;l<16;l++)w.push(d.readUByte().toString(16)),3!==l&&5!==l&&7!==l&&9!==l||w.push("-");for(var D=k-16,_=new Uint8Array(D),x=0;x<D;x++)_[x]=d.readUByte();t(i._txtTrack.samples,{pts:b.pts,payloadType:m,uuid:w.join(""),userData:Object(h.utf8ArrayToStr)(_),userDataBytes:_})}}else if(k<d.bytesAvailable)for(var E=0;E<k;E++)d.readUByte()}break;case 7:if(f=!0,j=!0,!c.sps){var y=new g.default(e.data).readSPS();c.width=y.width,c.height=y.height,c.pixelRatio=y.pixelRatio,c.sps=[e.data],c.duration=i._duration;for(var H=e.data.subarray(1,4),F="avc1.",z=0;z<3;z++){var r=H[z].toString(16);r.length<2&&(r="0"+r),F+=r}c.codec=F}break;case 8:f=!0,c.pps||(c.pps=[e.data]);break;case 9:f=!1,c.audFound=!0,a&&s(a,c),a=i.avcSample=o(!1,b.pts,b.dts,"");break;case 12:f=!1;break;default:f=!1,a&&(a.debug+="unknown NAL "+e.type+" ")}a&&f&&a.units.push(e)}),e&&a&&(s(a,c),this.avcSample=null)},a.getLastNalUnit=function(){var b,c,a=this.avcSample;if(!a||0===a.units.length){var d=this._avcTrack.samples;a=d[d.length-1]}if(null!==(b=a)&& void 0!==b&&b.units){var e=a.units;c=e[e.length-1]}return c},a.parseAVCNALu=function(b){var f,j,k=b.byteLength,o=this._avcTrack,a=o.naluState||0,l=a,h=[],c=0,e=-1,i=0;for(-1===a&&(e=0,i=31&b[0],a=0,c=1);c<k;)if(f=b[c++],a){if(1!==a){if(f){if(1===f){if(e>=0){var p={data:b.subarray(e,c-a-1),type:i};h.push(p)}else{var d=this.getLastNalUnit();if(d&&(l&&c<=4-l&&d.state&&(d.data=d.data.subarray(0,d.data.byteLength-l)),(j=c-a-1)>0)){var m=new Uint8Array(d.data.byteLength+j);m.set(d.data,0),m.set(b.subarray(0,j),d.data.byteLength),d.data=m}}c<k?(e=c,i=31&b[c],a=0):a=-1}else a=0}else a=3}else a=f?0:2}else a=f?0:1;if(e>=0&&a>=0){var q={data:b.subarray(e,k),type:i,state:a};h.push(q)}if(0===h.length){var g=this.getLastNalUnit();if(g){var n=new Uint8Array(g.data.byteLength+b.byteLength);n.set(g.data,0),n.set(b,g.data.byteLength),g.data=n}}return o.naluState=a,h},a.parseAACPES=function(k){var a,d,f,g,n,o=0,h=this._audioTrack,b=this.aacOverFlow,c=k.data;if(b){this.aacOverFlow=null;var p=b.sample.unit.byteLength,q=Math.min(b.missing,p),s=p-q;b.sample.unit.set(c.subarray(0,q),s),h.samples.push(b.sample),o=b.missing}for(a=o,d=c.length;a<d-1&&!e.isHeader(c,a);a++);if(a===o||(a<d-1?(f="AAC PES did not start with ADTS header,offset:"+a,g=!1):(f="no ADTS header found in AAC PES",g=!0),l.logger.warn("parsing error:"+f),this.observer.emit(j.Events.ERROR,j.Events.ERROR,{type:m.ErrorTypes.MEDIA_ERROR,details:m.ErrorDetails.FRAG_PARSING_ERROR,fatal:g,reason:f}),!g)){if(e.initTrackConfig(h,this.observer,c,a,this.audioCodec),void 0!==k.pts)n=k.pts;else{if(!b)return void l.logger.warn("[tsdemuxer]: AAC PES unknown PTS");var t=e.getFrameDuration(h.samplerate);n=b.sample.pts+t}for(var r=0;a<d;){if(e.isHeader(c,a)){if(a+5<d){var i=e.appendFrame(h,c,a,n,r);if(i){if(!i.missing){a+=i.length,r++;continue}this.aacOverFlow=i}}break}a++}}},a.parseMPEGPES=function(c){var b=c.data,h=b.length,d=0,a=0,e=c.pts;if(void 0!==e)for(;a<h;)if(f.isHeader(b,a)){var g=f.appendFrame(this._audioTrack,b,a,e,d);if(!g)break;a+=g.length,d++}else a++;else l.logger.warn("[tsdemuxer]: MPEG PES unknown PTS")},a.parseID3PES=function(a){void 0!==a.pts?this._id3Track.samples.push(a):l.logger.warn("[tsdemuxer]: ID3 PES unknown PTS")},b}();function o(a,b,c,d){return{key:a,frame:!1,pts:b,dts:c,units:[],debug:d,length:0}}function p(a,b){return(31&a[b+10])<<8|a[b+11]}function q(c,a,f,e){var b={audio:-1,avc:-1,id3:-1,isAAC:!0},g=a+3+((15&c[a+1])<<8|c[a+2])-4;for(a+=12+((15&c[a+10])<<8|c[a+11]);a<g;){var d=(31&c[a+1])<<8|c[a+2];switch(c[a]){case 207:if(!e){l.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:-1===b.audio&&(b.audio=d);break;case 21:-1===b.id3&&(b.id3=d);break;case 219:if(!e){l.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:-1===b.avc&&(b.avc=d);break;case 3:case 4:f?-1===b.audio&&(b.audio=d,b.isAAC=!1):l.logger.log("MPEG audio found, not supported in this browser");break;case 36:l.logger.warn("Unsupported HEVC stream type found")}a+=5+((15&c[a+3])<<8|c[a+4])}return b}function r(d){var a,f,k,e,g,m=0,b=d.data;if(!d||0===d.size)return null;for(;b[0].length<19&&b.length>1;){var i=new Uint8Array(b[0].length+b[1].length);i.set(b[0]),i.set(b[1],b[0].length),b[0]=i,b.splice(1,1)}if(1===((a=b[0])[0]<<16)+(a[1]<<8)+a[2]){if((f=(a[4]<<8)+a[5])&&f>d.size-6)return null;var n=a[7];192&n&&(e=536870912*(14&a[9])+4194304*(255&a[10])+16384*(254&a[11])+128*(255&a[12])+(254&a[13])/2,64&n?e-(g=536870912*(14&a[14])+4194304*(255&a[15])+16384*(254&a[16])+128*(255&a[17])+(254&a[18])/2)>54e5&&(l.logger.warn(Math.round((e-g)/9e4)+"s delta between PTS and DTS, align them"),e=g):g=e);var c=(k=a[8])+9;if(d.size<=c)return null;d.size-=c;for(var o=new Uint8Array(d.size),j=0,p=b.length;j<p;j++){var h=(a=b[j]).byteLength;if(c){if(c>h){c-=h;continue}a=a.subarray(c),h-=c,c=0}o.set(a,m),m+=h}return f&&(f-=k+3),{data:o,pts:e,dts:g,len:f}}return null}function s(a,b){if(a.units.length&&a.frame){if(void 0===a.pts){var c=b.samples,d=c.length;if(!d)return void b.dropped++;var e=c[d-1];a.pts=e.pts,a.dts=e.dts}b.samples.push(a)}a.debug.length&&l.logger.log(a.pts+"/"+a.dts+":"+a.debug)}function t(a,b){var d=a.length;if(d>0){if(b.pts>=a[d-1].pts)a.push(b);else for(var c=d-1;c>=0;c--)if(b.pts<a[c].pts){a.splice(c,0,b);break}}else a.push(b)}function u(b){for(var e=b.byteLength,c=[],a=1;a<e-2;)0===b[a]&&0===b[a+1]&&3===b[a+2]?(c.push(a+2),a+=2):a++;if(0===c.length)return b;var f=e-c.length,g=new Uint8Array(f),d=0;for(a=0;a<f;d++,a++)d===c[0]&&(d++,c.shift()),g[a]=b[d];return g}c.minProbeByteLength=188,b.default=c},"./src/errors.ts":/*!***********************!*\
   !*** ./src/errors.ts ***!
   \***********************/ /*! exports provided: ErrorTypes, ErrorDetails */ function(g,c,d){"use strict";var e,f,b,a;d.r(c),d.d(c,"ErrorTypes",function(){return e}),d.d(c,"ErrorDetails",function(){return f}),(b=e||(e={})).NETWORK_ERROR="networkError",b.MEDIA_ERROR="mediaError",b.KEY_SYSTEM_ERROR="keySystemError",b.MUX_ERROR="muxError",b.OTHER_ERROR="otherError",(a=f||(f={})).KEY_SYSTEM_NO_KEYS="keySystemNoKeys",a.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",a.KEY_SYSTEM_NO_SESSION="keySystemNoSession",a.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",a.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",a.MANIFEST_LOAD_ERROR="manifestLoadError",a.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",a.MANIFEST_PARSING_ERROR="manifestParsingError",a.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",a.LEVEL_EMPTY_ERROR="levelEmptyError",a.LEVEL_LOAD_ERROR="levelLoadError",a.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",a.LEVEL_SWITCH_ERROR="levelSwitchError",a.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",a.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",a.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",a.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",a.FRAG_LOAD_ERROR="fragLoadError",a.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",a.FRAG_DECRYPT_ERROR="fragDecryptError",a.FRAG_PARSING_ERROR="fragParsingError",a.REMUX_ALLOC_ERROR="remuxAllocError",a.KEY_LOAD_ERROR="keyLoadError",a.KEY_LOAD_TIMEOUT="keyLoadTimeOut",a.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",a.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",a.BUFFER_APPEND_ERROR="bufferAppendError",a.BUFFER_APPENDING_ERROR="bufferAppendingError",a.BUFFER_STALLED_ERROR="bufferStalledError",a.BUFFER_FULL_ERROR="bufferFullError",a.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",a.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",a.INTERNAL_EXCEPTION="internalException",a.INTERNAL_ABORTED="aborted",a.UNKNOWN="unknown"},"./src/events.ts":/*!***********************!*\
   !*** ./src/events.ts ***!
   \***********************/ /*! exports provided: Events */ function(e,b,c){"use strict";var d,a;c.r(b),c.d(b,"Events",function(){return d}),(a=d||(d={})).MEDIA_ATTACHING="hlsMediaAttaching",a.MEDIA_ATTACHED="hlsMediaAttached",a.MEDIA_DETACHING="hlsMediaDetaching",a.MEDIA_DETACHED="hlsMediaDetached",a.BUFFER_RESET="hlsBufferReset",a.BUFFER_CODECS="hlsBufferCodecs",a.BUFFER_CREATED="hlsBufferCreated",a.BUFFER_APPENDING="hlsBufferAppending",a.BUFFER_APPENDED="hlsBufferAppended",a.BUFFER_EOS="hlsBufferEos",a.BUFFER_FLUSHING="hlsBufferFlushing",a.BUFFER_FLUSHED="hlsBufferFlushed",a.MANIFEST_LOADING="hlsManifestLoading",a.MANIFEST_LOADED="hlsManifestLoaded",a.MANIFEST_PARSED="hlsManifestParsed",a.LEVEL_SWITCHING="hlsLevelSwitching",a.LEVEL_SWITCHED="hlsLevelSwitched",a.LEVEL_LOADING="hlsLevelLoading",a.LEVEL_LOADED="hlsLevelLoaded",a.LEVEL_UPDATED="hlsLevelUpdated",a.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",a.LEVELS_UPDATED="hlsLevelsUpdated",a.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",a.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",a.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",a.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",a.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",a.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",a.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",a.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",a.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",a.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",a.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",a.CUES_PARSED="hlsCuesParsed",a.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",a.INIT_PTS_FOUND="hlsInitPtsFound",a.FRAG_LOADING="hlsFragLoading",a.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",a.FRAG_LOADED="hlsFragLoaded",a.FRAG_DECRYPTED="hlsFragDecrypted",a.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",a.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",a.FRAG_PARSING_METADATA="hlsFragParsingMetadata",a.FRAG_PARSED="hlsFragParsed",a.FRAG_BUFFERED="hlsFragBuffered",a.FRAG_CHANGED="hlsFragChanged",a.FPS_DROP="hlsFpsDrop",a.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",a.ERROR="hlsError",a.DESTROYING="hlsDestroying",a.KEY_LOADING="hlsKeyLoading",a.KEY_LOADED="hlsKeyLoaded",a.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",a.BACK_BUFFER_REACHED="hlsBackBufferReached"},"./src/hls.ts":/*!********************!*\
   !*** ./src/hls.ts ***!
   \********************/ /*! exports provided: default */ function(d,b,a){"use strict";a.r(b),a.d(b,"default",function(){return c});var e=a(/*! url-toolkit */ "./node_modules/url-toolkit/src/url-toolkit.js"),f=a(/*! ./loader/playlist-loader */ "./src/loader/playlist-loader.ts"),g=a(/*! ./loader/key-loader */ "./src/loader/key-loader.ts"),h=a(/*! ./controller/id3-track-controller */ "./src/controller/id3-track-controller.ts"),i=a(/*! ./controller/latency-controller */ "./src/controller/latency-controller.ts"),j=a(/*! ./controller/level-controller */ "./src/controller/level-controller.ts"),k=a(/*! ./controller/fragment-tracker */ "./src/controller/fragment-tracker.ts"),l=a(/*! ./controller/stream-controller */ "./src/controller/stream-controller.ts"),m=a(/*! ./is-supported */ "./src/is-supported.ts"),n=a(/*! ./utils/logger */ "./src/utils/logger.ts"),o=a(/*! ./config */ "./src/config.ts"),p=a(/*! eventemitter3 */ "./node_modules/eventemitter3/index.js"),q=a(/*! ./events */ "./src/events.ts"),r=a(/*! ./errors */ "./src/errors.ts");function s(d,c){for(var b=0;b<c.length;b++){var a=c[b];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(d,a.key,a)}}var c=function(){function b(c){void 0===c&&(c={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new p.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this._media=null,this.url=null;var a=this.config=Object(o.mergeConfig)(b.DefaultConfig,c);this.userConfig=c,Object(n.enableLogs)(a.debug),this._autoLevelCapping=-1,a.progressive&&Object(o.enableStreamingMode)(a);var s=a.abrController,t=a.bufferController,u=a.capLevelController,v=a.fpsController,w=this.abrController=new s(this),x=this.bufferController=new t(this),q=this.capLevelController=new u(this),r=new v(this),y=new f.default(this),z=new g.default(this),A=new h.default(this),B=this.levelController=new j.default(this),d=new k.FragmentTracker(this),m=this.streamController=new l.default(this,d);q.setStreamController(m),r.setStreamController(m);var _=[B,m];this.networkControllers=_;var e=[y,z,w,x,q,r,A,d];this.audioTrackController=this.createController(a.audioTrackController,null,_),this.createController(a.audioStreamController,d,_),this.subtitleTrackController=this.createController(a.subtitleTrackController,null,_),this.createController(a.subtitleStreamController,d,_),this.createController(a.timelineController,null,e),this.emeController=this.createController(a.emeController,null,e),this.latencyController=this.createController(i.default,null,e),this.coreComponents=e}b.isSupported=function(){return Object(m.isSupported)()};var c,t,d,a=b.prototype;return a.createController=function(a,b,c){if(a){var d=b?new a(this,b):new a(this);return c&&c.push(d),d}return null},a.on=function(b,c,a){void 0===a&&(a=this),this._emitter.on(b,c,a)},a.once=function(b,c,a){void 0===a&&(a=this),this._emitter.once(b,c,a)},a.removeAllListeners=function(a){this._emitter.removeAllListeners(a)},a.off=function(b,c,a,d){void 0===a&&(a=this),this._emitter.off(b,c,a,d)},a.listeners=function(a){return this._emitter.listeners(a)},a.emit=function(a,b,c){return this._emitter.emit(a,b,c)},a.trigger=function(a,c){if(this.config.debug)return this.emit(a,a,c);try{return this.emit(a,a,c)}catch(b){n.logger.error("An internal error happened while handling event "+a+'. Error message: "'+b.message+'". Here is a stacktrace:',b),this.trigger(q.Events.ERROR,{type:r.ErrorTypes.OTHER_ERROR,details:r.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:a,error:b})}return!1},a.listenerCount=function(a){return this._emitter.listenerCount(a)},a.destroy=function(){n.logger.log("destroy"),this.trigger(q.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(a){return a.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(a){return a.destroy()}),this.coreComponents.length=0},a.attachMedia=function(a){n.logger.log("attachMedia"),this._media=a,this.trigger(q.Events.MEDIA_ATTACHING,{media:a})},a.detachMedia=function(){n.logger.log("detachMedia"),this.trigger(q.Events.MEDIA_DETACHING,void 0),this._media=null},a.loadSource=function(a){this.stopLoad();var b=this.media,c=this.url,d=this.url=e.buildAbsoluteURL(self.location.href,a,{alwaysNormalize:!0});n.logger.log("loadSource:"+d),b&&c&&c!==d&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(b)),this.trigger(q.Events.MANIFEST_LOADING,{url:a})},a.startLoad=function(a){void 0===a&&(a=-1),n.logger.log("startLoad("+a+")"),this.networkControllers.forEach(function(b){b.startLoad(a)})},a.stopLoad=function(){n.logger.log("stopLoad"),this.networkControllers.forEach(function(a){a.stopLoad()})},a.swapAudioCodec=function(){n.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},a.recoverMediaError=function(){n.logger.log("recoverMediaError");var a=this._media;this.detachMedia(),a&&this.attachMedia(a)},a.removeLevel=function(b,a){void 0===a&&(a=0),this.levelController.removeLevel(b,a)},c=b,d=[{key:"version",get:function(){return"1.0.7"}},{key:"Events",get:function(){return q.Events}},{key:"ErrorTypes",get:function(){return r.ErrorTypes}},{key:"ErrorDetails",get:function(){return r.ErrorDetails}},{key:"DefaultConfig",get:function(){return b.defaultConfig?b.defaultConfig:o.hlsDefaultConfig},set:function(a){b.defaultConfig=a}}],t=[{key:"levels",get:function(){return this.levelController.levels||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(a){n.logger.log("set currentLevel:"+a),this.loadLevel=a,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(a){n.logger.log("set nextLevel:"+a),this.levelController.manualLevel=a,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(a){n.logger.log("set loadLevel:"+a),this.levelController.manualLevel=a}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(a){this.levelController.nextLoadLevel=a}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(a){n.logger.log("set firstLevel:"+a),this.levelController.firstLevel=a}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(a){n.logger.log("set startLevel:"+a),-1!==a&&(a=Math.max(a,this.minAutoLevel)),this.levelController.startLevel=a}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(b){var a=!!b;a!==this.config.capLevelToPlayerSize&&(a?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=a)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(a){this._autoLevelCapping!==a&&(n.logger.log("set autoLevelCapping:"+a),this._autoLevelCapping=a)}},{key:"bandwidthEstimate",get:function(){var a=this.abrController.bwEstimator;return a?a.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return -1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var b=this.levels,c=this.config.minAutoBitrate;if(!b)return 0;for(var d=b.length,a=0;a<d;a++)if(b[a].maxBitrate>c)return a;return 0}},{key:"maxAutoLevel",get:function(){var a=this.levels,b=this.autoLevelCapping;return -1===b&&a&&a.length?a.length-1:b}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(a){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,a)}},{key:"audioTracks",get:function(){var a=this.audioTrackController;return a?a.audioTracks:[]}},{key:"audioTrack",get:function(){var a=this.audioTrackController;return a?a.audioTrack:-1},set:function(b){var a=this.audioTrackController;a&&(a.audioTrack=b)}},{key:"subtitleTracks",get:function(){var a=this.subtitleTrackController;return a?a.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var a=this.subtitleTrackController;return a?a.subtitleTrack:-1},set:function(b){var a=this.subtitleTrackController;a&&(a.subtitleTrack=b)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var a=this.subtitleTrackController;return!!a&&a.subtitleDisplay},set:function(b){var a=this.subtitleTrackController;a&&(a.subtitleDisplay=b)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(a){this.config.lowLatencyMode=a}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],s(c.prototype,t),d&&s(c,d),b}();c.defaultConfig=void 0},"./src/is-supported.ts":/*!*****************************!*\
   !*** ./src/is-supported.ts ***!
   \*****************************/ /*! exports provided: isSupported, changeTypeSupported */ function(c,b,a){"use strict";a.r(b),a.d(b,"isSupported",function(){return f}),a.d(b,"changeTypeSupported",function(){return g});var d=a(/*! ./utils/mediasource-helper */ "./src/utils/mediasource-helper.ts");function e(){return self.SourceBuffer||self.WebKitSourceBuffer}function f(){var a=Object(d.getMediaSource)();if(!a)return!1;var b=e(),c=a&&"function"==typeof a.isTypeSupported&&a.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),f=!b||b.prototype&&"function"==typeof b.prototype.appendBuffer&&"function"==typeof b.prototype.remove;return!!c&&!!f}function g(){var a,b=e();return"function"==typeof(null==b||null===(a=b.prototype)|| void 0===a?void 0:a.changeType)}},"./src/loader/fragment-loader.ts":/*!***************************************!*\
   !*** ./src/loader/fragment-loader.ts ***!
   \***************************************/ /*! exports provided: default, LoadError */ function(d,b,a){"use strict";a.r(b),a.d(b,"default",function(){return k}),a.d(b,"LoadError",function(){return m});var e=a(/*! ./src/polyfills/number */ "./src/polyfills/number.ts"),f=a(/*! ../errors */ "./src/errors.ts");function c(a){var b="function"==typeof Map?new Map:void 0;return(c=function(a){var d;if(null===a||(d=a,-1===Function.toString.call(d).indexOf("[native code]")))return a;if("function"!=typeof a)throw new TypeError("Super expression must either be null or a function");if(void 0!==b){if(b.has(a))return b.get(a);b.set(a,c)}function c(){return g(a,arguments,j(this).constructor)}return c.prototype=Object.create(a.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}}),i(c,a)})(a)}function g(a,b,c){return(g=h()?Reflect.construct:function(d,e,b){var a=[null];a.push.apply(a,e);var c=new(Function.bind.apply(d,a));return b&&i(c,b.prototype),c}).apply(null,arguments)}function h(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(a){return!1}}function i(a,b){return(i=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a})(a,b)}function j(a){return(j=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)})(a)}var k=function(){function b(a){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=a}var a=b.prototype;return a.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},a.abort=function(){this.loader&&this.loader.abort()},a.load=function(a,d){var e=this,b=a.url;if(!b)return Promise.reject(new m({type:f.ErrorTypes.NETWORK_ERROR,details:f.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:a,networkDetails:null},"Fragment does not have a "+(b?"part list":"url")));this.abort();var c=this.config,g=c.fLoader,h=c.loader;return new Promise(function(k,n){e.loader&&e.loader.destroy();var b=e.loader=a.loader=g?new g(c):new h(c),i=l(a),j={timeout:c.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:c.fragLoadingMaxRetryTimeout,highWaterMark:131072};a.stats=b.stats,b.load(i,j,{onSuccess:function(c,f,g,d){e.resetLoader(a,b),k({frag:a,part:null,payload:c.data,networkDetails:d})},onError:function(c,g,d){e.resetLoader(a,b),n(new m({type:f.ErrorTypes.NETWORK_ERROR,details:f.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:a,response:c,networkDetails:d}))},onAbort:function(d,g,c){e.resetLoader(a,b),n(new m({type:f.ErrorTypes.NETWORK_ERROR,details:f.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:a,networkDetails:c}))},onTimeout:function(d,g,c){e.resetLoader(a,b),n(new m({type:f.ErrorTypes.NETWORK_ERROR,details:f.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:a,networkDetails:c}))},onProgress:function(e,f,b,c){d&&d({frag:a,part:null,payload:b,networkDetails:c})}})})},a.loadPart=function(b,c,d){var e=this;this.abort();var a=this.config,g=a.fLoader,h=a.loader;return new Promise(function(n,o){e.loader&&e.loader.destroy();var i=e.loader=b.loader=g?new g(a):new h(a),j=l(b,c),k={timeout:a.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:a.fragLoadingMaxRetryTimeout,highWaterMark:131072};c.stats=i.stats,i.load(j,k,{onSuccess:function(f,h,j,g){e.resetLoader(b,i),e.updateStatsFromPart(b,c);var a={frag:b,part:c,payload:f.data,networkDetails:g};d(a),n(a)},onError:function(a,g,d){e.resetLoader(b,i),o(new m({type:f.ErrorTypes.NETWORK_ERROR,details:f.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:b,part:c,response:a,networkDetails:d}))},onAbort:function(d,g,a){b.stats.aborted=c.stats.aborted,e.resetLoader(b,i),o(new m({type:f.ErrorTypes.NETWORK_ERROR,details:f.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:b,part:c,networkDetails:a}))},onTimeout:function(d,g,a){e.resetLoader(b,i),o(new m({type:f.ErrorTypes.NETWORK_ERROR,details:f.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:b,part:c,networkDetails:a}))}})})},a.updateStatsFromPart=function(e,f){var a=e.stats,d=f.stats,g=d.total;if(a.loaded+=d.loaded,g){var h=Math.round(e.duration/f.duration),i=Math.min(Math.round(a.loaded/g),h),j=(h-i)*Math.round(a.loaded/i);a.total=a.loaded+j}else a.total=Math.max(a.loaded,a.total);var b=a.loading,c=d.loading;b.start?b.first+=c.first-c.start:(b.start=c.start,b.first=c.first),b.end=c.end},a.resetLoader=function(b,a){b.loader=null,this.loader===a&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),a.destroy()},b}();function l(d,a){void 0===a&&(a=null);var b=a||d,c={frag:d,part:a,responseType:"arraybuffer",url:b.url,rangeStart:0,rangeEnd:0},f=b.byteRangeStartOffset,g=b.byteRangeEndOffset;return Object(e.isFiniteNumber)(f)&&Object(e.isFiniteNumber)(g)&&(c.rangeStart=f,c.rangeEnd=g),c}var m=function(d){var a,b;function c(f){for(var b,c=arguments.length,e=new Array(c>1?c-1:0),a=1;a<c;a++)e[a-1]=arguments[a];return(b=d.call.apply(d,[this].concat(e))||this).data=void 0,b.data=f,b}return b=d,(a=c).prototype=Object.create(b.prototype),a.prototype.constructor=a,i(a,b),c}(c(Error))},"./src/loader/fragment.ts":/*!********************************!*\
   !*** ./src/loader/fragment.ts ***!
   \********************************/ /*! exports provided: ElementaryStreamTypes, BaseSegment, Fragment, Part */ function(f,b,a){"use strict";a.r(b),a.d(b,"ElementaryStreamTypes",function(){return d}),a.d(b,"BaseSegment",function(){return e}),a.d(b,"Fragment",function(){return p}),a.d(b,"Part",function(){return q});var c,d,g=a(/*! ./src/polyfills/number */ "./src/polyfills/number.ts"),h=a(/*! url-toolkit */ "./node_modules/url-toolkit/src/url-toolkit.js"),i=a(/*! ../utils/logger */ "./src/utils/logger.ts"),j=a(/*! ./level-key */ "./src/loader/level-key.ts"),k=a(/*! ./load-stats */ "./src/loader/load-stats.ts");function l(a,b){a.prototype=Object.create(b.prototype),a.prototype.constructor=a,m(a,b)}function m(a,b){return(m=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a})(a,b)}function n(d,c){for(var b=0;b<c.length;b++){var a=c[b];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(d,a.key,a)}}function o(a,b,c){return b&&n(a.prototype,b),c&&n(a,c),a}(c=d||(d={})).AUDIO="audio",c.VIDEO="video",c.AUDIOVIDEO="audiovideo";var e=function(){function a(b){var a;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=((a={})[d.AUDIO]=null,a[d.VIDEO]=null,a[d.AUDIOVIDEO]=null,a),this.baseurl=b}return a.prototype.setByteRange=function(d,c){var b=d.split("@",2),a=[];1===b.length?a[0]=c?c.byteRangeEndOffset:0:a[0]=parseInt(b[1]),a[1]=parseInt(b[0])+a[0],this._byteRange=a},o(a,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Object(h.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(a){this._url=a}}]),a}(),p=function(c){function a(b,d){var a;return(a=c.call(this,d)||this)._decryptdata=null,a.rawProgramDateTime=null,a.programDateTime=null,a.tagList=[],a.duration=0,a.sn=0,a.levelkey=void 0,a.type=void 0,a.loader=null,a.level=-1,a.cc=0,a.startPTS=void 0,a.endPTS=void 0,a.appendedPTS=void 0,a.startDTS=void 0,a.endDTS=void 0,a.start=0,a.deltaPTS=void 0,a.maxStartPTS=void 0,a.minEndPTS=void 0,a.stats=new k.LoadStats,a.urlId=0,a.data=void 0,a.bitrateTest=!1,a.title=null,a.initSegment=null,a.type=b,a}l(a,c);var b=a.prototype;return b.createInitializationVector=function(c){for(var b=new Uint8Array(16),a=12;a<16;a++)b[a]=c>>8*(15-a)&255;return b},b.setDecryptDataFromLevelKey=function(a,c){var b=a;return"AES-128"===(null==a?void 0:a.method)&&a.uri&&!a.iv&&((b=j.LevelKey.fromURI(a.uri)).method=a.method,b.iv=this.createInitializationVector(c),b.keyFormat="identity"),b},b.setElementaryStreamInfo=function(c,d,e,f,g,b){void 0===b&&(b=!1);var h=this.elementaryStreams,a=h[c];a?(a.startPTS=Math.min(a.startPTS,d),a.endPTS=Math.max(a.endPTS,e),a.startDTS=Math.min(a.startDTS,f),a.endDTS=Math.max(a.endDTS,g)):h[c]={startPTS:d,endPTS:e,startDTS:f,endDTS:g,partial:b}},b.clearElementaryStreamInfo=function(){var a=this.elementaryStreams;a[d.AUDIO]=null,a[d.VIDEO]=null,a[d.AUDIOVIDEO]=null},o(a,[{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var a=this.sn;"number"!=typeof a&&(this.levelkey&&"AES-128"===this.levelkey.method&&!this.levelkey.iv&&i.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),a=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,a)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(null===this.programDateTime||!Object(g.isFiniteNumber)(this.programDateTime))return null;var a=Object(g.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+1e3*a}},{key:"encrypted",get:function(){var a;return!(null===(a=this.decryptdata)|| void 0===a||!a.keyFormat||!this.decryptdata.uri)}}]),a}(e),q=function(b){function a(a,f,g,h,c){(d=b.call(this,g)||this).fragOffset=0,d.duration=0,d.gap=!1,d.independent=!1,d.relurl=void 0,d.fragment=void 0,d.index=void 0,d.stats=new k.LoadStats,d.duration=a.decimalFloatingPoint("DURATION"),d.gap=a.bool("GAP"),d.independent=a.bool("INDEPENDENT"),d.relurl=a.enumeratedString("URI"),d.fragment=f,d.index=h;var d,e=a.enumeratedString("BYTERANGE");return e&&d.setByteRange(e,c),c&&(d.fragOffset=c.fragOffset+c.duration),d}return l(a,b),o(a,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var a=this.elementaryStreams;return!!(a.audio||a.video||a.audiovideo)}}]),a}(e)},"./src/loader/key-loader.ts":/*!**********************************!*\
   !*** ./src/loader/key-loader.ts ***!
   \**********************************/ /*! exports provided: default */ function(c,b,a){"use strict";a.r(b),a.d(b,"default",function(){return g});var d=a(/*! ../events */ "./src/events.ts"),e=a(/*! ../errors */ "./src/errors.ts"),f=a(/*! ../utils/logger */ "./src/utils/logger.ts"),g=function(){function b(a){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=a,this._registerListeners()}var a=b.prototype;return a._registerListeners=function(){this.hls.on(d.Events.KEY_LOADING,this.onKeyLoading,this)},a._unregisterListeners=function(){this.hls.off(d.Events.KEY_LOADING,this.onKeyLoading)},a.destroy=function(){for(var b in this._unregisterListeners(),this.loaders){var a=this.loaders[b];a&&a.destroy()}this.loaders={}},a.onKeyLoading=function(n,h){var a=h.frag,e=a.type,g=this.loaders[e];if(a.decryptdata){var c=a.decryptdata.uri;if(c!==this.decrypturl||null===this.decryptkey){var b=this.hls.config;if(g&&(f.logger.warn("abort previous key loader for type:"+e),g.abort()),!c)return void f.logger.warn("key uri is falsy");var i=b.loader,j=a.loader=this.loaders[e]=new i(b);this.decrypturl=c,this.decryptkey=null;var k={url:c,frag:a,responseType:"arraybuffer"},l={timeout:b.fragLoadingTimeOut,maxRetry:0,retryDelay:b.fragLoadingRetryDelay,maxRetryDelay:b.fragLoadingMaxRetryTimeout,highWaterMark:0},m={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};j.load(k,l,m)}else this.decryptkey&&(a.decryptdata.key=this.decryptkey,this.hls.trigger(d.Events.KEY_LOADED,{frag:a}))}else f.logger.warn("Missing decryption data on fragment in onKeyLoading")},a.loadsuccess=function(b,e,c){var a=c.frag;a.decryptdata?(this.decryptkey=a.decryptdata.key=new Uint8Array(b.data),a.loader=null,delete this.loaders[a.type],this.hls.trigger(d.Events.KEY_LOADED,{frag:a})):f.logger.error("after key load, decryptdata unset")},a.loaderror=function(c,f){var a=f.frag,b=a.loader;b&&b.abort(),delete this.loaders[a.type],this.hls.trigger(d.Events.ERROR,{type:e.ErrorTypes.NETWORK_ERROR,details:e.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:a,response:c})},a.loadtimeout=function(f,c){var a=c.frag,b=a.loader;b&&b.abort(),delete this.loaders[a.type],this.hls.trigger(d.Events.ERROR,{type:e.ErrorTypes.NETWORK_ERROR,details:e.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:a})},b}()},"./src/loader/level-details.ts":/*!*************************************!*\
   !*** ./src/loader/level-details.ts ***!
   \*************************************/ /*! exports provided: LevelDetails */ function(c,b,a){"use strict";a.r(b),a.d(b,"LevelDetails",function(){return f});var d=a(/*! ./src/polyfills/number */ "./src/polyfills/number.ts");function e(d,c){for(var b=0;b<c.length;b++){var a=c[b];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(d,a.key,a)}}var f=function(){var a,c,f;function b(a){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.url=a}return b.prototype.reloaded=function(a){if(!a)return this.advanced=!0,void(this.updated=!0);var b=this.lastPartSn-a.lastPartSn,c=this.lastPartIndex-a.lastPartIndex;this.updated=this.endSN!==a.endSN||!!c||!!b,this.advanced=this.endSN>a.endSN||b>0||0===b&&c>0,this.updated||this.advanced?this.misses=Math.floor(.6*a.misses):this.misses=a.misses+1,this.availabilityDelay=a.availabilityDelay},a=b,c=[{key:"hasProgramDateTime",get:function(){return!!this.fragments.length&&Object(d.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime)}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||10}},{key:"drift",get:function(){var a=this.driftEndTime-this.driftStartTime;return a>0?1e3*(this.driftEnd-this.driftStart)/a:1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var a;return null!==(a=this.partList)&& void 0!==a&&a.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var a;return null!==(a=this.fragments)&& void 0!==a&&a.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var a;return null!==(a=this.partList)&& void 0!==a&&a.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var a;return null!==(a=this.partList)&& void 0!==a&&a.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}],e(a.prototype,c),f&&e(a,f),b}()},"./src/loader/level-key.ts":/*!*********************************!*\
   !*** ./src/loader/level-key.ts ***!
   \*********************************/ /*! exports provided: LevelKey */ function(c,b,a){"use strict";a.r(b),a.d(b,"LevelKey",function(){return f});var d=a(/*! url-toolkit */ "./node_modules/url-toolkit/src/url-toolkit.js");function e(d,c){for(var b=0;b<c.length;b++){var a=c[b];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(d,a.key,a)}}var f=function(){var b,c,f;function a(a,b){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,this._uri=b?Object(d.buildAbsoluteURL)(a,b,{alwaysNormalize:!0}):a}return a.fromURL=function(b,c){return new a(b,c)},a.fromURI=function(b){return new a(b)},c=[{key:"uri",get:function(){return this._uri}}],e((b=a).prototype,c),f&&e(b,f),a}()},"./src/loader/load-stats.ts":/*!**********************************!*\
   !*** ./src/loader/load-stats.ts ***!
   \**********************************/ /*! exports provided: LoadStats */ function(c,a,b){"use strict";b.r(a),b.d(a,"LoadStats",function(){return d});var d=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":/*!***********************************!*\
   !*** ./src/loader/m3u8-parser.ts ***!
   \***********************************/ /*! exports provided: default */ function(c,b,a){"use strict";a.r(b),a.d(b,"default",function(){return q});var d=a(/*! ./src/polyfills/number */ "./src/polyfills/number.ts"),e=a(/*! url-toolkit */ "./node_modules/url-toolkit/src/url-toolkit.js"),f=a(/*! ./fragment */ "./src/loader/fragment.ts"),g=a(/*! ./level-details */ "./src/loader/level-details.ts"),h=a(/*! ./level-key */ "./src/loader/level-key.ts"),i=a(/*! ../utils/attr-list */ "./src/utils/attr-list.ts"),j=a(/*! ../utils/logger */ "./src/utils/logger.ts"),k=a(/*! ../utils/codecs */ "./src/utils/codecs.ts"),l=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,m=/#EXT-X-MEDIA:(.*)/g,n=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),o=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(PLAYLIST-TYPE):(.+)/.source,/#EXT-X-(MEDIA-SEQUENCE): *(\d+)/.source,/#EXT-X-(SKIP):(.+)/.source,/#EXT-X-(TARGETDURATION): *(\d+)/.source,/#EXT-X-(KEY):(.+)/.source,/#EXT-X-(START):(.+)/.source,/#EXT-X-(ENDLIST)/.source,/#EXT-X-(DISCONTINUITY-SEQ)UENCE: *(\d+)/.source,/#EXT-X-(DIS)CONTINUITY/.source,/#EXT-X-(VERSION):(\d+)/.source,/#EXT-X-(MAP):(.+)/.source,/#EXT-X-(SERVER-CONTROL):(.+)/.source,/#EXT-X-(PART-INF):(.+)/.source,/#EXT-X-(GAP)/.source,/#EXT-X-(BITRATE):\s*(\d+)/.source,/#EXT-X-(PART):(.+)/.source,/#EXT-X-(PRELOAD-HINT):(.+)/.source,/#EXT-X-(RENDITION-REPORT):(.+)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),p=/\.(mp4|m4s|m4v|m4a)$/i,q=function(){function a(){}return a.findGroup=function(b,d){for(var a=0;a<b.length;a++){var c=b[a];if(c.id===d)return c}},a.convertAVC1ToAVCOTI=function(b){var a=b.split(".");if(a.length>2){var c=a.shift()+".";return c+=parseInt(a.shift()).toString(16),c+=("000"+parseInt(a.shift()).toString(16)).substr(-4)}return b},a.resolve=function(a,b){return e.buildAbsoluteURL(b,a,{alwaysNormalize:!0})},a.parseMasterPlaylist=function(k,m){var c,g=[],h={},j=!1;for(l.lastIndex=0;null!=(c=l.exec(k));)if(c[1]){var d=new i.AttrList(c[1]),b={attrs:d,bitrate:d.decimalInteger("AVERAGE-BANDWIDTH")||d.decimalInteger("BANDWIDTH"),name:d.NAME,url:a.resolve(c[2],m)},e=d.decimalResolution("RESOLUTION");e&&(b.width=e.width,b.height=e.height),r((d.CODECS||"").split(/[ ,]+/).filter(function(a){return a}),b),b.videoCodec&& -1!==b.videoCodec.indexOf("avc1")&&(b.videoCodec=a.convertAVC1ToAVCOTI(b.videoCodec)),g.push(b)}else if(c[3]){var f=new i.AttrList(c[3]);f["DATA-ID"]&&(j=!0,h[f["DATA-ID"]]=f)}return{levels:g,sessionData:j?h:null}},a.parseMasterPlaylistMedia=function(j,k,e,c){void 0===c&&(c=[]);var f,g=[],l=0;for(m.lastIndex=0;null!==(f=m.exec(j));){var b=new i.AttrList(f[1]);if(b.TYPE===e){var d={attrs:b,bitrate:0,id:l++,groupId:b["GROUP-ID"],instreamId:b["INSTREAM-ID"],name:b.NAME||b.LANGUAGE||"",type:e,default:b.bool("DEFAULT"),autoselect:b.bool("AUTOSELECT"),forced:b.bool("FORCED"),lang:b.LANGUAGE,url:b.URI?a.resolve(b.URI,k):""};if(c.length){var h=a.findGroup(c,d.groupId)||c[0];s(d,h,"audioCodec"),s(d,h,"textCodec")}g.push(d)}}return g},a.parseLevelPlaylist=function(P,s,y,G,aa){var b,m,k,a=new g.LevelDetails(s),q=a.fragments,z=null,w=0,H=0,r=0,u=0,l=null,_=new f.Fragment(G,s),A=-1,B=!1;for(n.lastIndex=0,a.m3u8=P;null!==(b=n.exec(P));){B&&(B=!1,(_=new f.Fragment(G,s)).start=r,_.sn=w,_.cc=u,_.level=y,z&&(_.initSegment=z,_.rawProgramDateTime=z.rawProgramDateTime));var C=b[1];if(C){_.duration=parseFloat(C);var I=(" "+b[2]).slice(1);_.title=I||null,_.tagList.push(I?["INF",C,I]:["INF",C])}else if(b[3])Object(d.isFiniteNumber)(_.duration)&&(_.start=r,k&&(_.levelkey=k),_.sn=w,_.level=y,_.cc=u,_.urlId=aa,q.push(_),_.relurl=(" "+b[3]).slice(1),t(_,l),l=_,r+=_.duration,w++,H=0,B=!0);else if(b[4]){var Q=(" "+b[4]).slice(1);l?_.setByteRange(Q,l):_.setByteRange(Q)}else if(b[5])_.rawProgramDateTime=(" "+b[5]).slice(1),_.tagList.push(["PROGRAM-DATE-TIME",_.rawProgramDateTime]),-1===A&&(A=q.length);else{if(!(b=b[0].match(o))){j.logger.warn("No matches on slow regex match for level playlist!");continue}for(m=1;m<b.length&& void 0===b[m];m++);var J=(" "+b[m]).slice(1),c=(" "+b[m+1]).slice(1),K=b[m+2]?(" "+b[m+2]).slice(1):"";switch(J){case"PLAYLIST-TYPE":a.type=c.toUpperCase();break;case"MEDIA-SEQUENCE":w=a.startSN=parseInt(c);break;case"SKIP":var R=new i.AttrList(c),D=R.decimalInteger("SKIPPED-SEGMENTS");if(Object(d.isFiniteNumber)(D)){a.skippedSegments=D;for(var ab=D;ab--;)q.unshift(null);w+=D}var S=R.enumeratedString("RECENTLY-REMOVED-DATERANGES");S&&(a.recentlyRemovedDateranges=S.split("	"));break;case"TARGETDURATION":a.targetduration=parseFloat(c);break;case"VERSION":a.version=parseInt(c);break;case"EXTM3U":break;case"ENDLIST":a.live=!1;break;case"#":(c||K)&&_.tagList.push(K?[c,K]:[c]);break;case"DIS":u++;case"GAP":_.tagList.push([J]);break;case"BITRATE":_.tagList.push([J,c]);break;case"DISCONTINUITY-SEQ":u=parseInt(c);break;case"KEY":var T,v=new i.AttrList(c),L=v.enumeratedString("METHOD"),U=v.URI,ac=v.hexadecimalInteger("IV"),V=v.enumeratedString("KEYFORMATVERSIONS"),W=v.enumeratedString("KEYID"),E=null!=(T=v.enumeratedString("KEYFORMAT"))?T:"identity";if(["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"].indexOf(E)> -1){j.logger.warn("Keyformat "+E+" is not supported from the manifest");continue}if("identity"!==E)continue;L&&(k=h.LevelKey.fromURL(s,U),U&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(L)>=0&&(k.method=L,k.keyFormat=E,W&&(k.keyID=W),V&&(k.keyFormatVersions=V),k.iv=ac));break;case"START":var X=new i.AttrList(c).decimalFloatingPoint("TIME-OFFSET");Object(d.isFiniteNumber)(X)&&(a.startTimeOffset=X);break;case"MAP":var M=new i.AttrList(c);_.relurl=M.URI,M.BYTERANGE&&_.setByteRange(M.BYTERANGE),_.level=y,_.sn="initSegment",k&&(_.levelkey=k),_.initSegment=null,z=_,B=!0;break;case"SERVER-CONTROL":var x=new i.AttrList(c);a.canBlockReload=x.bool("CAN-BLOCK-RELOAD"),a.canSkipUntil=x.optionalFloat("CAN-SKIP-UNTIL",0),a.canSkipDateRanges=a.canSkipUntil>0&&x.bool("CAN-SKIP-DATERANGES"),a.partHoldBack=x.optionalFloat("PART-HOLD-BACK",0),a.holdBack=x.optionalFloat("HOLD-BACK",0);break;case"PART-INF":var ad=new i.AttrList(c);a.partTarget=ad.decimalFloatingPoint("PART-TARGET");break;case"PART":var $=a.partList;$||($=a.partList=[]);var ae=H>0?$[$.length-1]:void 0,af=H++,Y=new f.Part(new i.AttrList(c),_,s,af,ae);$.push(Y),_.duration+=Y.duration;break;case"PRELOAD-HINT":var ag=new i.AttrList(c);a.preloadHint=ag;break;case"RENDITION-REPORT":var ah=new i.AttrList(c);a.renditionReports=a.renditionReports||[],a.renditionReports.push(ah);break;default:j.logger.warn("line parsed but not handled: "+b)}}}l&&!l.relurl?(q.pop(),r-=l.duration,a.partList&&(a.fragmentHint=l)):a.partList&&(t(_,l),_.cc=u,a.fragmentHint=_);var N=q.length,F=q[0],O=q[N-1];if((r+=a.skippedSegments*a.targetduration)>0&&N&&O){a.averagetargetduration=r/N;var Z=O.sn;a.endSN="initSegment"!==Z?Z:0,F&&(a.startCC=F.cc,F.initSegment||a.fragments.every(function(b){var c,d,a;return b.relurl&&(c=b.relurl,p.test(null!=(d=null===(a=e.parseURL(c))|| void 0===a?void 0:a.path)?d:""))})&&(j.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(_=new f.Fragment(G,s)).relurl=O.relurl,_.level=y,_.sn="initSegment",F.initSegment=_,a.needSidxRanges=!0))}else a.endSN=0,a.startCC=0;return a.fragmentHint&&(r+=a.fragmentHint.duration),a.totalduration=r,a.endCC=u,A>0&&function(b,c){for(var d=b[c],e=c;e--;){var a=b[e];if(!a)return;a.programDateTime=d.programDateTime-1e3*a.duration,d=a}}(q,A),a},a}();function r(a,b){["video","audio","text"].forEach(function(e){var c=a.filter(function(a){return Object(k.isCodecType)(a,e)});if(c.length){var d=c.filter(function(a){return 0===a.lastIndexOf("avc1",0)||0===a.lastIndexOf("mp4a",0)});b[e+"Codec"]=d.length>0?d[0]:c[0],a=a.filter(function(a){return -1===c.indexOf(a)})}}),b.unknownCodecs=a}function s(c,d,a){var b=d[a];b&&(c[a]=b)}function t(a,b){a.rawProgramDateTime?a.programDateTime=Date.parse(a.rawProgramDateTime):null!=b&&b.programDateTime&&(a.programDateTime=b.endProgramDateTime),Object(d.isFiniteNumber)(a.programDateTime)||(a.programDateTime=null,a.rawProgramDateTime=null)}},"./src/loader/playlist-loader.ts":/*!***************************************!*\
   !*** ./src/loader/playlist-loader.ts ***!
   \***************************************/ /*! exports provided: default */ function(d,b,a){"use strict";a.r(b);var e=a(/*! ./src/polyfills/number */ "./src/polyfills/number.ts"),f=a(/*! ../events */ "./src/events.ts"),g=a(/*! ../errors */ "./src/errors.ts"),h=a(/*! ../utils/logger */ "./src/utils/logger.ts"),i=a(/*! ../utils/mp4-tools */ "./src/utils/mp4-tools.ts"),j=a(/*! ./m3u8-parser */ "./src/loader/m3u8-parser.ts"),k=a(/*! ../types/loader */ "./src/types/loader.ts"),l=a(/*! ../utils/attr-list */ "./src/utils/attr-list.ts");function m(b,c){var a=b.url;return void 0!==a&&0!==a.indexOf("data:")||(a=c.url),a}var c=function(){function b(a){this.hls=void 0,this.loaders=Object.create(null),this.hls=a,this.registerListeners()}var a=b.prototype;return a.registerListeners=function(){var a=this.hls;a.on(f.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.on(f.Events.LEVEL_LOADING,this.onLevelLoading,this),a.on(f.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),a.on(f.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},a.unregisterListeners=function(){var a=this.hls;a.off(f.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.off(f.Events.LEVEL_LOADING,this.onLevelLoading,this),a.off(f.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),a.off(f.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},a.createInternalLoader=function(c){var a=this.hls.config,d=a.pLoader,e=a.loader,b=new(d||e)(a);return c.loader=b,this.loaders[c.type]=b,b},a.getInternalLoader=function(a){return this.loaders[a.type]},a.resetInternalLoader=function(a){this.loaders[a]&&delete this.loaders[a]},a.destroyInternalLoaders=function(){for(var a in this.loaders){var b=this.loaders[a];b&&b.destroy(),this.resetInternalLoader(a)}},a.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},a.onManifestLoading=function(c,a){var b=a.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:k.PlaylistContextType.MANIFEST,url:b,deliveryDirectives:null})},a.onLevelLoading=function(f,a){var b=a.id,c=a.level,d=a.url,e=a.deliveryDirectives;this.load({id:b,groupId:null,level:c,responseType:"text",type:k.PlaylistContextType.LEVEL,url:d,deliveryDirectives:e})},a.onAudioTrackLoading=function(f,a){var b=a.id,c=a.groupId,d=a.url,e=a.deliveryDirectives;this.load({id:b,groupId:c,level:null,responseType:"text",type:k.PlaylistContextType.AUDIO_TRACK,url:d,deliveryDirectives:e})},a.onSubtitleTrackLoading=function(f,a){var b=a.id,c=a.groupId,d=a.url,e=a.deliveryDirectives;this.load({id:b,groupId:c,level:null,responseType:"text",type:k.PlaylistContextType.SUBTITLE_TRACK,url:d,deliveryDirectives:e})},a.load=function(a){var g,f,c,i,j,d,b=this.hls.config,e=this.getInternalLoader(a);if(e){var l=e.context;if(l&&l.url===a.url)return void h.logger.trace("[playlist-loader]: playlist request ongoing");h.logger.log("[playlist-loader]: aborting previous loader for type: "+a.type),e.abort()}switch(a.type){case k.PlaylistContextType.MANIFEST:f=b.manifestLoadingMaxRetry,c=b.manifestLoadingTimeOut,i=b.manifestLoadingRetryDelay,j=b.manifestLoadingMaxRetryTimeout;break;case k.PlaylistContextType.LEVEL:case k.PlaylistContextType.AUDIO_TRACK:case k.PlaylistContextType.SUBTITLE_TRACK:f=0,c=b.levelLoadingTimeOut;break;default:f=b.levelLoadingMaxRetry,c=b.levelLoadingTimeOut,i=b.levelLoadingRetryDelay,j=b.levelLoadingMaxRetryTimeout}if(e=this.createInternalLoader(a),null!==(g=a.deliveryDirectives)&& void 0!==g&&g.part&&(a.type===k.PlaylistContextType.LEVEL&&null!==a.level?d=this.hls.levels[a.level].details:a.type===k.PlaylistContextType.AUDIO_TRACK&&null!==a.id?d=this.hls.audioTracks[a.id].details:a.type===k.PlaylistContextType.SUBTITLE_TRACK&&null!==a.id&&(d=this.hls.subtitleTracks[a.id].details),d)){var m=d.partTarget,n=d.targetduration;m&&n&&(c=Math.min(1e3*Math.max(3*m,.8*n),c))}var o={timeout:c,maxRetry:f,retryDelay:i,maxRetryDelay:j,highWaterMark:0},p={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};e.load(a,o,p)},a.loadsuccess=function(b,d,a,c){if(void 0===c&&(c=null),a.isSidxRequest)return this.handleSidxRequest(b,a),void this.handlePlaylistLoaded(b,d,a,c);this.resetInternalLoader(a.type);var e=b.data;0===e.indexOf("#EXTM3U")?(d.parsing.start=performance.now(),e.indexOf("#EXTINF:")>0||e.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(b,d,a,c):this.handleMasterPlaylist(b,d,a,c)):this.handleManifestParsingError(b,a,"no EXTM3U delimiter",c)},a.loaderror=function(b,c,a){void 0===a&&(a=null),this.handleNetworkError(c,a,!1,b)},a.loadtimeout=function(c,b,a){void 0===a&&(a=null),this.handleNetworkError(b,a,!0)},a.handleMasterPlaylist=function(e,n,g,i){var o=this.hls,c=e.data,b=m(e,g),k=j.default.parseMasterPlaylist(c,b),a=k.levels,p=k.sessionData;if(a.length){var q=a.map(function(a){return{id:a.attrs.AUDIO,audioCodec:a.audioCodec}}),r=a.map(function(a){return{id:a.attrs.SUBTITLES,textCodec:a.textCodec}}),d=j.default.parseMasterPlaylistMedia(c,b,"AUDIO",q),s=j.default.parseMasterPlaylistMedia(c,b,"SUBTITLES",r),t=j.default.parseMasterPlaylistMedia(c,b,"CLOSED-CAPTIONS");d.length&&(d.some(function(a){return!a.url})||!a[0].audioCodec||a[0].attrs.AUDIO||(h.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),d.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new l.AttrList({}),bitrate:0,url:""}))),o.trigger(f.Events.MANIFEST_LOADED,{levels:a,audioTracks:d,subtitles:s,captions:t,url:b,stats:n,networkDetails:i,sessionData:p})}else this.handleManifestParsingError(e,g,"no level found in manifest",i)},a.handleTrackOrLevelPlaylist=function(d,h,a,p){var q=this.hls,i=a.id,n=a.level,r=a.type,c=m(d,a),s=Object(e.isFiniteNumber)(i)?i:0,t=Object(e.isFiniteNumber)(n)?n:s,u=function(a){switch(a.type){case k.PlaylistContextType.AUDIO_TRACK:return k.PlaylistLevelType.AUDIO;case k.PlaylistContextType.SUBTITLE_TRACK:return k.PlaylistLevelType.SUBTITLE;default:return k.PlaylistLevelType.MAIN}}(a),b=j.default.parseLevelPlaylist(d.data,c,t,u,s);if(b.fragments.length){if(r===k.PlaylistContextType.MANIFEST){var v={attrs:new l.AttrList({}),bitrate:0,details:b,name:"",url:c};q.trigger(f.Events.MANIFEST_LOADED,{levels:[v],audioTracks:[],url:c,stats:h,networkDetails:p,sessionData:null})}if(h.parsing.end=performance.now(),b.needSidxRanges){var o,w=null===(o=b.fragments[0].initSegment)|| void 0===o?void 0:o.url;this.load({url:w,isSidxRequest:!0,type:r,level:n,levelDetails:b,id:i,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null})}else a.levelDetails=b,this.handlePlaylistLoaded(d,h,a,p)}else q.trigger(f.Events.ERROR,{type:g.ErrorTypes.NETWORK_ERROR,details:g.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:c,reason:"no fragments found in level",level:"number"==typeof a.level?a.level:void 0})},a.handleSidxRequest=function(b,c){var a=Object(i.parseSegmentIndex)(new Uint8Array(b.data));if(a){var d=a.references,e=c.levelDetails;d.forEach(function(d,f){var c=d.info,b=e.fragments[f];0===b.byteRange.length&&b.setByteRange(String(1+c.end-c.start)+"@"+String(c.start)),b.initSegment&&b.initSegment.setByteRange(String(a.moovEndOffset)+"@0")})}},a.handleManifestParsingError=function(a,b,c,d){this.hls.trigger(f.Events.ERROR,{type:g.ErrorTypes.NETWORK_ERROR,details:g.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:b.type===k.PlaylistContextType.MANIFEST,url:a.url,reason:c,response:a,context:b,networkDetails:d})},a.handleNetworkError=function(a,l,b,e){void 0===b&&(b=!1),h.logger.warn("[playlist-loader]: A network "+(b?"timeout":"error")+" occurred while loading "+a.type+" level: "+a.level+" id: "+a.id+' group-id: "'+a.groupId+'"');var c=g.ErrorDetails.UNKNOWN,d=!1,i=this.getInternalLoader(a);switch(a.type){case k.PlaylistContextType.MANIFEST:c=b?g.ErrorDetails.MANIFEST_LOAD_TIMEOUT:g.ErrorDetails.MANIFEST_LOAD_ERROR,d=!0;break;case k.PlaylistContextType.LEVEL:c=b?g.ErrorDetails.LEVEL_LOAD_TIMEOUT:g.ErrorDetails.LEVEL_LOAD_ERROR,d=!1;break;case k.PlaylistContextType.AUDIO_TRACK:c=b?g.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:g.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,d=!1;break;case k.PlaylistContextType.SUBTITLE_TRACK:c=b?g.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:g.ErrorDetails.SUBTITLE_LOAD_ERROR,d=!1}i&&this.resetInternalLoader(a.type);var j={type:g.ErrorTypes.NETWORK_ERROR,details:c,fatal:d,url:a.url,loader:i,context:a,networkDetails:l};e&&(j.response=e),this.hls.trigger(f.Events.ERROR,j)},a.handlePlaylistLoaded=function(j,e,b,c){var l=b.type,m=b.level,g=b.id,i=b.groupId,d=b.loader,a=b.levelDetails,h=b.deliveryDirectives;if(null!=a&&a.targetduration){if(d)switch(a.live&&(d.getCacheAge&&(a.ageHeader=d.getCacheAge()||0),d.getCacheAge&&!isNaN(a.ageHeader)||(a.ageHeader=0)),l){case k.PlaylistContextType.MANIFEST:case k.PlaylistContextType.LEVEL:this.hls.trigger(f.Events.LEVEL_LOADED,{details:a,level:m||0,id:g||0,stats:e,networkDetails:c,deliveryDirectives:h});break;case k.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(f.Events.AUDIO_TRACK_LOADED,{details:a,id:g||0,groupId:i||"",stats:e,networkDetails:c,deliveryDirectives:h});break;case k.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(f.Events.SUBTITLE_TRACK_LOADED,{details:a,id:g||0,groupId:i||"",stats:e,networkDetails:c,deliveryDirectives:h})}}else this.handleManifestParsingError(j,b,"invalid target duration",c)},b}();b.default=c},"./src/polyfills/number.ts":/*!*********************************!*\
   !*** ./src/polyfills/number.ts ***!
   \*********************************/ /*! exports provided: isFiniteNumber, MAX_SAFE_INTEGER */ function(c,a,b){"use strict";b.r(a),b.d(a,"isFiniteNumber",function(){return d}),b.d(a,"MAX_SAFE_INTEGER",function(){return e});var d=Number.isFinite||function(a){return"number"==typeof a&&isFinite(a)},e=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":/*!*********************************!*\
   !*** ./src/remux/aac-helper.ts ***!
   \*********************************/ /*! exports provided: default */ function(d,a,b){"use strict";b.r(a);var c=function(){function a(){}return a.getSilentFrame=function(b,a){if("mp4a.40.2"===b){if(1===a)return new Uint8Array([0,200,0,128,35,128]);if(2===a)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===a)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===a)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===a)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===a)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===a)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===a||3===a)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}},a}();a.default=c},"./src/remux/mp4-generator.ts":/*!************************************!*\
   !*** ./src/remux/mp4-generator.ts ***!
   \************************************/ /*! exports provided: default */ function(d,b,c){"use strict";c.r(b);var a=function(){function a(){}return a.init=function(){for(i in a.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},a.types)a.types.hasOwnProperty(i)&&(a.types[i]=[i.charCodeAt(0),i.charCodeAt(1),i.charCodeAt(2),i.charCodeAt(3)]);var i,c=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),d=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);a.HDLR_TYPES={video:c,audio:d};var e=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),f=new Uint8Array([0,0,0,0,0,0,0,0]);a.STTS=a.STSC=a.STCO=f,a.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),a.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),a.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),a.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var b=new Uint8Array([105,115,111,109]),g=new Uint8Array([97,118,99,49]),h=new Uint8Array([0,0,0,1]);a.FTYP=a.box(a.types.ftyp,b,h,b,g),a.DINF=a.box(a.types.dinf,a.box(a.types.dref,e))},a.box=function(g){for(var a=8,f=arguments.length,d=new Array(f>1?f-1:0),e=1;e<f;e++)d[e-1]=arguments[e];for(var b=d.length,h=b;b--;)a+=d[b].byteLength;var c=new Uint8Array(a);for(c[0]=a>>24&255,c[1]=a>>16&255,c[2]=a>>8&255,c[3]=255&a,c.set(g,4),b=0,a=8;b<h;b++)c.set(d[b],a),a+=d[b].byteLength;return c},a.hdlr=function(b){return a.box(a.types.hdlr,a.HDLR_TYPES[b])},a.mdat=function(b){return a.box(a.types.mdat,b)},a.mdhd=function(b,e){var c=Math.floor((e*=b)/4294967296),d=Math.floor(e%4294967296);return a.box(a.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,b>>24&255,b>>16&255,b>>8&255,255&b,c>>24,c>>16&255,c>>8&255,255&c,d>>24,d>>16&255,d>>8&255,255&d,85,196,0,0]))},a.mdia=function(b){return a.box(a.types.mdia,a.mdhd(b.timescale,b.duration),a.hdlr(b.type),a.minf(b))},a.mfhd=function(b){return a.box(a.types.mfhd,new Uint8Array([0,0,0,0,b>>24,b>>16&255,b>>8&255,255&b]))},a.minf=function(b){return"audio"===b.type?a.box(a.types.minf,a.box(a.types.smhd,a.SMHD),a.DINF,a.stbl(b)):a.box(a.types.minf,a.box(a.types.vmhd,a.VMHD),a.DINF,a.stbl(b))},a.moof=function(b,c,d){return a.box(a.types.moof,a.mfhd(b),a.traf(d,c))},a.moov=function(b){for(var c=b.length,d=[];c--;)d[c]=a.trak(b[c]);return a.box.apply(null,[a.types.moov,a.mvhd(b[0].timescale,b[0].duration)].concat(d).concat(a.mvex(b)))},a.mvex=function(c){for(var b=c.length,d=[];b--;)d[b]=a.trex(c[b]);return a.box.apply(null,[a.types.mvex].concat(d))},a.mvhd=function(b,e){var c=Math.floor((e*=b)/4294967296),d=Math.floor(e%4294967296),f=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,b>>24&255,b>>16&255,b>>8&255,255&b,c>>24,c>>16&255,c>>8&255,255&c,d>>24,d>>16&255,d>>8&255,255&d,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return a.box(a.types.mvhd,f)},a.sdtp=function(f){var b,c,d=f.samples||[],e=new Uint8Array(4+d.length);for(b=0;b<d.length;b++)c=d[b].flags,e[b+4]=c.dependsOn<<4|c.isDependedOn<<2|c.hasRedundancy;return a.box(a.types.sdtp,e)},a.stbl=function(b){return a.box(a.types.stbl,a.stsd(b),a.box(a.types.stts,a.STTS),a.box(a.types.stsc,a.STSC),a.box(a.types.stsz,a.STSZ),a.box(a.types.stco,a.STCO))},a.avc1=function(b){var c,g,e,d=[],f=[];for(c=0;c<b.sps.length;c++)e=(g=b.sps[c]).byteLength,d.push(e>>>8&255),d.push(255&e),d=d.concat(Array.prototype.slice.call(g));for(c=0;c<b.pps.length;c++)e=(g=b.pps[c]).byteLength,f.push(e>>>8&255),f.push(255&e),f=f.concat(Array.prototype.slice.call(g));var l=a.box(a.types.avcC,new Uint8Array([1,d[3],d[4],d[5],255,224|b.sps.length].concat(d).concat([b.pps.length]).concat(f))),j=b.width,k=b.height,h=b.pixelRatio[0],i=b.pixelRatio[1];return a.box(a.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,j>>8&255,255&j,k>>8&255,255&k,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),l,a.box(a.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),a.box(a.types.pasp,new Uint8Array([h>>24,h>>16&255,h>>8&255,255&h,i>>24,i>>16&255,i>>8&255,255&i])))},a.esds=function(b){var a=b.config.length;return new Uint8Array([0,0,0,0,3,23+a,0,1,0,4,15+a,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([a]).concat(b.config).concat([6,1,2]))},a.mp4a=function(b){var c=b.samplerate;return a.box(a.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,b.channelCount,0,16,0,0,0,0,c>>8&255,255&c,0,0]),a.box(a.types.esds,a.esds(b)))},a.mp3=function(b){var c=b.samplerate;return a.box(a.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,b.channelCount,0,16,0,0,0,0,c>>8&255,255&c,0,0]))},a.stsd=function(b){return"audio"===b.type?b.isAAC||"mp3"!==b.codec?a.box(a.types.stsd,a.STSD,a.mp4a(b)):a.box(a.types.stsd,a.STSD,a.mp3(b)):a.box(a.types.stsd,a.STSD,a.avc1(b))},a.tkhd=function(b){var c=b.id,f=b.duration*b.timescale,g=b.width,h=b.height,d=Math.floor(f/4294967296),e=Math.floor(f%4294967296);return a.box(a.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,c>>24&255,c>>16&255,c>>8&255,255&c,0,0,0,0,d>>24,d>>16&255,d>>8&255,255&d,e>>24,e>>16&255,e>>8&255,255&e,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,g>>8&255,255&g,0,0,h>>8&255,255&h,0,0]))},a.traf=function(e,f){var g=a.sdtp(e),b=e.id,c=Math.floor(f/4294967296),d=Math.floor(f%4294967296);return a.box(a.types.traf,a.box(a.types.tfhd,new Uint8Array([0,0,0,0,b>>24,b>>16&255,b>>8&255,255&b])),a.box(a.types.tfdt,new Uint8Array([1,0,0,0,c>>24,c>>16&255,c>>8&255,255&c,d>>24,d>>16&255,d>>8&255,255&d])),a.trun(e,g.length+16+20+8+16+8+8),g)},a.trak=function(b){return b.duration=b.duration||4294967295,a.box(a.types.trak,a.tkhd(b),a.mdia(b))},a.trex=function(c){var b=c.id;return a.box(a.types.trex,new Uint8Array([0,0,0,0,b>>24,b>>16&255,b>>8&255,255&b,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},a.trun=function(m,d){var e,i,f,g,b,h,k=m.samples||[],c=k.length,l=12+16*c,j=new Uint8Array(l);for(d+=8+l,j.set([0,0,15,1,c>>>24&255,c>>>16&255,c>>>8&255,255&c,d>>>24&255,d>>>16&255,d>>>8&255,255&d],0),e=0;e<c;e++)f=(i=k[e]).duration,g=i.size,b=i.flags,h=i.cts,j.set([f>>>24&255,f>>>16&255,f>>>8&255,255&f,g>>>24&255,g>>>16&255,g>>>8&255,255&g,b.isLeading<<2|b.dependsOn,b.isDependedOn<<6|b.hasRedundancy<<4|b.paddingValue<<1|b.isNonSync,61440&b.degradPrio,15&b.degradPrio,h>>>24&255,h>>>16&255,h>>>8&255,255&h],12+16*e);return a.box(a.types.trun,j)},a.initSegment=function(d){a.types||a.init();var c=a.moov(d),b=new Uint8Array(a.FTYP.byteLength+c.byteLength);return b.set(a.FTYP),b.set(c,a.FTYP.byteLength),b},a}();a.types=void 0,a.HDLR_TYPES=void 0,a.STTS=void 0,a.STSC=void 0,a.STCO=void 0,a.STSZ=void 0,a.VMHD=void 0,a.SMHD=void 0,a.STSD=void 0,a.FTYP=void 0,a.DINF=void 0,b.default=a},"./src/remux/mp4-remuxer.ts":/*!**********************************!*\
   !*** ./src/remux/mp4-remuxer.ts ***!
   \**********************************/ /*! exports provided: default, normalizePts */ function(c,b,a){"use strict";a.r(b),a.d(b,"default",function(){return p}),a.d(b,"normalizePts",function(){return q});var d=a(/*! ./src/polyfills/number */ "./src/polyfills/number.ts"),e=a(/*! ./aac-helper */ "./src/remux/aac-helper.ts"),f=a(/*! ./mp4-generator */ "./src/remux/mp4-generator.ts"),g=a(/*! ../events */ "./src/events.ts"),h=a(/*! ../errors */ "./src/errors.ts"),i=a(/*! ../utils/logger */ "./src/utils/logger.ts"),j=a(/*! ../types/loader */ "./src/types/loader.ts"),k=a(/*! ../utils/timescale-conversion */ "./src/utils/timescale-conversion.ts");function l(){return(l=Object.assign||function(d){for(var a=1;a<arguments.length;a++){var b=arguments[a];for(var c in b)Object.prototype.hasOwnProperty.call(b,c)&&(d[c]=b[c])}return d}).apply(this,arguments)}var m=null,n=null,o=!1,p=function(){function b(d,e,f,a){if(void 0===a&&(a=""),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=d,this.config=e,this.typeSupported=f,this.ISGenerated=!1,null===m){var b=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);m=b?parseInt(b[1]):0}if(null===n){var c=navigator.userAgent.match(/Safari\/(\d+)/i);n=c?parseInt(c[1]):0}o=!!m&&m<75|| !!n&&n<600}var a=b.prototype;return a.destroy=function(){},a.resetTimeStamp=function(a){i.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=a},a.resetNextTimestamp=function(){i.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},a.resetInitSegment=function(){i.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},a.getVideoStartPts=function(a){var b=!1,c=a.reduce(function(a,c){var d=c.pts-a;return d< -4294967296?(b=!0,q(a,c.pts)):d>0?a:c.pts},a[0].pts);return b&&i.logger.debug("PTS rollover detected"),c},a.remux=function(b,a,p,r,d,x,y,z){var e,g,k,s,t,l,u=d,h=d,A=b.pid> -1,v=a.pid> -1,m=a.samples.length,n=b.samples.length>0,f=m>1;if((!A||n)&&(!v||f)||this.ISGenerated||y){this.ISGenerated||(k=this.generateIS(b,a,d));var o=this.isVideoContiguous,c=-1;if(f&&(c=function(b){for(var a=0;a<b.length;a++)if(b[a].key)return a;return -1}(a.samples),!o&&this.config.forceKeyFrameOnDiscontinuity)){if(l=!0,c>0){i.logger.warn("[mp4-remuxer]: Dropped "+c+" out of "+m+" video samples due to a missing keyframe");var B=this.getVideoStartPts(a.samples);a.samples=a.samples.slice(c),a.dropped+=c,h+=(a.samples[0].pts-B)/(a.timescale||9e4)}else -1===c&&(i.logger.warn("[mp4-remuxer]: No keyframe found out of "+m+" video samples"),l=!1)}if(this.ISGenerated){if(n&&f){var _=this.getVideoStartPts(a.samples),w=(q(b.samples[0].pts,_)-_)/a.inputTimeScale;u+=Math.max(0,w),h+=Math.max(0,-w)}if(n){if(b.samplerate||(i.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),k=this.generateIS(b,a,d)),g=this.remuxAudio(b,u,this.isAudioContiguous,x,v||f||z===j.PlaylistLevelType.AUDIO?h:void 0),f){var C=g?g.endPTS-g.startPTS:0;a.inputTimeScale||(i.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),k=this.generateIS(b,a,d)),e=this.remuxVideo(a,h,o,C)}}else f&&(e=this.remuxVideo(a,h,o,0));e&&(e.firstKeyFrame=c,e.independent=-1!==c)}}return this.ISGenerated&&(p.samples.length&&(t=this.remuxID3(p,d)),r.samples.length&&(s=this.remuxText(r,d))),{audio:g,video:e,initSegment:k,independent:l,text:s,id3:t}},a.generateIS=function(a,b,l){var c,e,g,m=a.samples,j=b.samples,k=this.typeSupported,h={},i=!Object(d.isFiniteNumber)(this._initPTS),n="audio/mp4";if(i&&(c=e=1/0),a.config&&m.length&&(a.timescale=a.samplerate,a.isAAC||(k.mpeg?(n="audio/mpeg",a.codec=""):k.mp3&&(a.codec="mp3")),h.audio={id:"audio",container:n,codec:a.codec,initSegment:!a.isAAC&&k.mpeg?new Uint8Array(0):f.default.initSegment([a]),metadata:{channelCount:a.channelCount}},i&&(g=a.inputTimeScale,c=e=m[0].pts-Math.round(g*l))),b.sps&&b.pps&&j.length&&(b.timescale=b.inputTimeScale,h.video={id:"main",container:"video/mp4",codec:b.codec,initSegment:f.default.initSegment([b]),metadata:{width:b.width,height:b.height}},i)){g=b.inputTimeScale;var o=this.getVideoStartPts(j),p=Math.round(g*l);e=Math.min(e,q(j[0].dts,o)-p),c=Math.min(c,o-p)}if(Object.keys(h).length)return this.ISGenerated=!0,i&&(this._initPTS=c,this._initDTS=e),{tracks:h,initPTS:c,timescale:g}},a.remuxVideo=function(t,ae,P,Q){var c,b,H,u=t.inputTimeScale,a=t.samples,A=[],j=a.length,R=this._initPTS,n=this.nextAvcDts,B=8,C=Number.POSITIVE_INFINITY,I=Number.NEGATIVE_INFINITY,v=0,_=!1;P&&null!==n||(n=ae*u-(a[0].pts-q(a[0].dts,a[0].pts)));for(var x=0;x<j;x++){var d=a[x];d.pts=q(d.pts-R,n),d.dts=q(d.dts-R,n),d.dts>d.pts&&(v=Math.max(Math.min(v,d.pts-d.dts),-18e3)),d.dts<a[x>0?x-1:x].dts&&(_=!0)}_&&a.sort(function(a,b){var c=a.dts-b.dts,d=a.pts-b.pts;return c||d}),b=a[0].dts;var D=Math.round(((H=a[a.length-1].dts)-b)/(j-1));if(v<0){if(v< -2*D){i.logger.warn("PTS < DTS detected in video samples, offsetting DTS from PTS by "+Object(k.toMsFromMpegTsClock)(-D,!0)+" ms");for(var J=v,y=0;y<j;y++)a[y].dts=J=Math.max(J,a[y].pts-D),a[y].pts=Math.max(J,a[y].pts)}else{i.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Object(k.toMsFromMpegTsClock)(v,!0)+" ms to overcome this issue");for(var E=0;E<j;E++)a[E].dts=a[E].dts+v}b=a[0].dts}if(P){var p=b-n,S=p>D;if(S||p< -1){S?i.logger.warn("AVC: "+Object(k.toMsFromMpegTsClock)(p,!0)+" ms ("+p+"dts) hole between fragments detected, filling it"):i.logger.warn("AVC: "+Object(k.toMsFromMpegTsClock)(-p,!0)+" ms ("+p+"dts) overlapping between fragments detected"),b=n;var T=a[0].pts-p;a[0].dts=b,a[0].pts=T,i.logger.log("Video: First PTS/DTS adjusted: "+Object(k.toMsFromMpegTsClock)(T,!0)+"/"+Object(k.toMsFromMpegTsClock)(b,!0)+", delta: "+Object(k.toMsFromMpegTsClock)(p,!0)+" ms")}}o&&(b=Math.max(0,b));for(var U=0,V=0,K=0;K<j;K++){for(var e=a[K],W=e.units,X=W.length,L=0,M=0;M<X;M++)L+=W[M].data.length;V+=L,U+=X,e.length=L,e.dts=Math.max(e.dts,b),e.pts=Math.max(e.pts,e.dts,0),C=Math.min(e.pts,C),I=Math.max(e.pts,I)}H=a[j-1].dts;var z,F=V+4*U+8;try{z=new Uint8Array(F)}catch(ak){return void this.observer.emit(g.Events.ERROR,g.Events.ERROR,{type:h.ErrorTypes.MUX_ERROR,details:h.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:F,reason:"fail allocating video mdat "+F})}var Y=new DataView(z.buffer);Y.setUint32(0,F),z.set(f.default.types.mdat,4);for(var s=0;s<j;s++){for(var w=a[s],Z=w.units,aa=0,$=0,af=Z.length;$<af;$++){var ab=Z[$],ag=ab.data,N=ab.data.byteLength;Y.setUint32(B,N),B+=4,z.set(ag,B),B+=N,aa+=4+N}if(s<j-1)c=a[s+1].dts-w.dts;else{var ac=this.config,G=w.dts-a[s>0?s-1:s].dts;if(ac.stretchShortVideoTrack&&null!==this.nextAudioPts){var ah=Math.floor(ac.maxBufferHole*u),O=(Q?C+Q*u:this.nextAudioPts)-w.pts;O>ah?((c=O-G)<0&&(c=G),i.logger.log("[mp4-remuxer]: It is approximately "+O/90+" ms to the next segment; using duration "+c/90+" ms for the last video frame.")):c=G}else c=G}var ai=Math.round(w.pts-w.dts);A.push(new r(w.key,c,aa,ai))}if(A.length&&m&&m<70){var ad=A[0].flags;ad.dependsOn=2,ad.isNonSync=0}console.assert(void 0!==c,"mp4SampleDuration must be computed"),this.nextAvcDts=n=H+c,this.isVideoContiguous=!0;var aj={data1:f.default.moof(t.sequenceNumber++,b,l({},t,{samples:A})),data2:z,startPTS:C/u,endPTS:(I+c)/u,startDTS:b/u,endDTS:n/u,type:"video",hasAudio:!1,hasVideo:!0,nb:A.length,dropped:t.dropped};return t.samples=[],t.dropped=0,console.assert(z.length,"MDAT length must not be zero"),aj},a.remuxAudio=function(a,S,s,F,G){var d=a.inputTimeScale,t=d/(a.samplerate?a.samplerate:d),H=a.isAAC?1024:1152,j=H*t,T=this._initPTS,z=!a.isAAC&&this.typeSupported.mpeg,n=[],b=a.samples,A=z?0:8,c=this.nextAudioPts|| -1,B=S*d;if(this.isAudioContiguous=s=s||b.length&&c>0&&(F&&9e3>Math.abs(B-c)||Math.abs(q(b[0].pts-T,B)-c)<20*j),b.forEach(function(a){a.pts=q(a.pts-T,B)}),!s||c<0){if(!(b=b.filter(function(a){return a.pts>=0})).length)return;c=0===G?0:F?Math.max(0,B):b[0].pts}if(a.isAAC)for(var I=void 0!==G,J=this.config.maxAudioFramesDrift,k=0,_=c;k<b.length;k++){var C=b[k],u=C.pts,o=u-_,U=Math.abs(1e3*o/d);if(o<= -J*j&&I)0===k&&(i.logger.warn("Audio frame @ "+(u/d).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*o/d)+" ms."),this.nextAudioPts=c=_=u);else if(o>=J*j&&U<1e4&&I){var v=Math.round(o/j);(_=u-v*j)<0&&(v--,_+=j),0===k&&(this.nextAudioPts=c=_),i.logger.warn("[mp4-remuxer]: Injecting "+v+" audio frame @ "+(_/d).toFixed(3)+"s due to "+Math.round(1e3*o/d)+" ms gap.");for(var K=0;K<v;K++){var V=Math.max(_,0),D=e.default.getSilentFrame(a.manifestCodec||a.codec,a.channelCount);D||(i.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),D=C.unit.subarray()),b.splice(k,0,{unit:D,pts:V}),_+=j,k++}}C.pts=_,_+=j}for(var p,E=null,w=null,m=0,L=b.length;L--;)m+=b[L].unit.byteLength;for(var x=0,W=b.length;x<W;x++){var M=b[x],N=M.unit,y=M.pts;if(null!==w)n[x-1].duration=Math.round((y-w)/t);else{if(s&&a.isAAC&&(y=c),E=y,!(m>0))return;m+=A;try{p=new Uint8Array(m)}catch(Z){return void this.observer.emit(g.Events.ERROR,g.Events.ERROR,{type:h.ErrorTypes.MUX_ERROR,details:h.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:m,reason:"fail allocating audio mdat "+m})}z||(new DataView(p.buffer).setUint32(0,m),p.set(f.default.types.mdat,4))}p.set(N,A);var O=N.byteLength;A+=O,n.push(new r(!0,H,O,0)),w=y}var P=n.length;if(P){var X=n[n.length-1];this.nextAudioPts=c=w+t*X.duration;var Y=z?new Uint8Array(0):f.default.moof(a.sequenceNumber++,E/t,l({},a,{samples:n}));a.samples=[];var Q=E/d,R=c/d,$={data1:Y,data2:p,startPTS:Q,endPTS:R,startDTS:Q,endDTS:R,type:"audio",hasAudio:!0,hasVideo:!1,nb:P};return this.isAudioContiguous=!0,console.assert(p.length,"MDAT length must not be zero"),$}},a.remuxEmptyAudio=function(a,m,n,d){var b=a.inputTimeScale,o=b/(a.samplerate?a.samplerate:b),f=this.nextAudioPts,g=(null!==f?f:d.startDTS*b)+this._initDTS,p=d.endDTS*b+this._initDTS,h=1024*o,q=Math.ceil((p-g)/h),j=e.default.getSilentFrame(a.manifestCodec||a.codec,a.channelCount);if(i.logger.warn("[mp4-remuxer]: remux empty Audio"),j){for(var k=[],c=0;c<q;c++){var l=g+c*h;k.push({unit:j,pts:l,dts:l})}return a.samples=k,this.remuxAudio(a,m,n,!1)}i.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec")},a.remuxID3=function(a,e){var f=a.samples.length;if(f){for(var b=a.inputTimeScale,g=this._initPTS,h=this._initDTS,d=0;d<f;d++){var c=a.samples[d];c.pts=q(c.pts-g,e*b)/b,c.dts=q(c.dts-h,e*b)/b}var i=a.samples;return a.samples=[],{samples:i}}},a.remuxText=function(a,f){var c=a.samples.length;if(c){for(var d=a.inputTimeScale,g=this._initPTS,b=0;b<c;b++){var e=a.samples[b];e.pts=q(e.pts-g,f*d)/d}a.samples.sort(function(a,b){return a.pts-b.pts});var h=a.samples;return a.samples=[],{samples:h}}},b}();function q(a,b){var c;if(null===b)return a;for(c=b<a?-8589934592:8589934592;Math.abs(a-b)>4294967296;)a+=c;return a}var r=function(a,b,c,d){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=b,this.size=c,this.cts=d,this.flags=new s(a)},s=function(a){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=a?2:1,this.isNonSync=a?0:1}},"./src/remux/passthrough-remuxer.ts":/*!******************************************!*\
   !*** ./src/remux/passthrough-remuxer.ts ***!
   \******************************************/ /*! exports provided: default */ function(d,b,a){"use strict";a.r(b);var e=a(/*! ./src/polyfills/number */ "./src/polyfills/number.ts"),f=a(/*! ../utils/mp4-tools */ "./src/utils/mp4-tools.ts"),g=a(/*! ../loader/fragment */ "./src/loader/fragment.ts"),h=a(/*! ../utils/logger */ "./src/utils/logger.ts"),c=function(){function b(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndDTS=null}var a=b.prototype;return a.destroy=function(){},a.resetTimeStamp=function(a){this.initPTS=a,this.lastEndDTS=null},a.resetNextTimestamp=function(){this.lastEndDTS=null},a.resetInitSegment=function(a,b,c){this.audioCodec=b,this.videoCodec=c,this.generateInitSegment(a),this.emitInitSegment=!0},a.generateInitSegment=function(a){var c=this.audioCodec,d=this.videoCodec;if(!a||!a.byteLength)return this.initTracks=void 0,void(this.initData=void 0);var b=this.initData=Object(f.parseInitSegment)(a);c||(c=j(b.audio,g.ElementaryStreamTypes.AUDIO)),d||(d=j(b.video,g.ElementaryStreamTypes.VIDEO));var e={};b.audio&&b.video?e.audiovideo={container:"video/mp4",codec:c+","+d,initSegment:a,id:"main"}:b.audio?e.audio={container:"audio/mp4",codec:c,initSegment:a,id:"audio"}:b.video?e.video={container:"video/mp4",codec:d,initSegment:a,id:"main"}:h.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=e},a.remux=function(v,t,o,p,u){var j=this.initPTS,d=this.lastEndDTS,b={audio:void 0,video:void 0,text:p,id3:o,initSegment:void 0};Object(e.isFiniteNumber)(d)||(d=this.lastEndDTS=u||0);var c=t.samples;if(!c||!c.length)return b;var k={initPTS:void 0,timescale:1},a=this.initData;if(a&&a.length||(this.generateInitSegment(c),a=this.initData),!a||!a.length)return h.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),b;this.emitInitSegment&&(k.tracks=this.initTracks,this.emitInitSegment=!1),Object(e.isFiniteNumber)(j)||(this.initPTS=k.initPTS=j=i(a,c,d));var q=Object(f.getDuration)(c,a),l=d,m=q+l;Object(f.offsetStartDTS)(a,c,j),q>0?this.lastEndDTS=m:(h.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var r=!!a.audio,s=!!a.video,n="";r&&(n+="audio"),s&&(n+="video");var g={data1:c,startPTS:l,startDTS:l,endPTS:m,endDTS:m,type:n,hasAudio:r,hasVideo:s,nb:1,dropped:0};return b.audio="audio"===g.type?g:void 0,b.video="audio"!==g.type?g:void 0,b.text=p,b.id3=o,b.initSegment=k,b},b}(),i=function(a,b,c){return Object(f.getStartDTS)(a,b)-c};function j(b,c){var a=null==b?void 0:b.codec;return a&&a.length>4?a:"hvc1"===a?"hvc1.1.c.L120.90":"av01"===a?"av01.0.04M.08":"avc1"===a||c===g.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}b.default=c},"./src/task-loop.ts":/*!**************************!*\
   !*** ./src/task-loop.ts ***!
   \**************************/ /*! exports provided: default */ function(c,a,b){"use strict";b.r(a),b.d(a,"default",function(){return d});var d=function(){function b(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var a=b.prototype;return a.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},a.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},a.onHandlerDestroyed=function(){},a.hasInterval=function(){return!!this._tickInterval},a.hasNextTick=function(){return!!this._tickTimer},a.setInterval=function(a){return!this._tickInterval&&(this._tickInterval=self.setInterval(this._boundTick,a),!0)},a.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},a.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},a.tick=function(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},a.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},a.doTick=function(){},b}()},"./src/types/level.ts":/*!****************************!*\
   !*** ./src/types/level.ts ***!
   \****************************/ /*! exports provided: HlsSkip, getSkipValue, HlsUrlParameters, Level */ function(c,a,b){"use strict";function d(d,c){for(var b=0;b<c.length;b++){var a=c[b];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(d,a.key,a)}}function e(a,b){var c=a.canSkipUntil,d=a.canSkipDateRanges,e=a.endSN;return c&&(void 0!==b?b-e:0)<c?d?g.v2:g.Yes:g.No}b.r(a),b.d(a,"HlsSkip",function(){return g}),b.d(a,"getSkipValue",function(){return e}),b.d(a,"HlsUrlParameters",function(){return h}),b.d(a,"Level",function(){return i}),(f=g||(g={})).No="",f.Yes="YES",f.v2="v2";var f,g,h=function(){function a(a,b,c){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=a,this.part=b,this.skip=c}return a.prototype.addDirectives=function(b){var a=new self.URL(b);return void 0!==this.msn&&a.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&a.searchParams.set("_HLS_part",this.part.toString()),this.skip&&a.searchParams.set("_HLS_skip",this.skip),a.toString()},a}(),i=function(){var a,b,c;function e(a){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[a.url],this.attrs=a.attrs,this.bitrate=a.bitrate,a.details&&(this.details=a.details),this.id=a.id||0,this.name=a.name,this.width=a.width||0,this.height=a.height||0,this.audioCodec=a.audioCodec,this.videoCodec=a.videoCodec,this.unknownCodecs=a.unknownCodecs,this.codecSet=[a.videoCodec,a.audioCodec].filter(function(a){return a}).join(",").replace(/\.[^.,]+/g,"")}return a=e,b=[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(b){var a=b%this.url.length;this._urlId!==a&&(this.details=void 0,this._urlId=a)}}],d(a.prototype,b),c&&d(a,c),e}()},"./src/types/loader.ts":/*!*****************************!*\
   !*** ./src/types/loader.ts ***!
   \*****************************/ /*! exports provided: PlaylistContextType, PlaylistLevelType */ function(g,b,c){"use strict";var e,f,a,d;c.r(b),c.d(b,"PlaylistContextType",function(){return e}),c.d(b,"PlaylistLevelType",function(){return f}),(a=e||(e={})).MANIFEST="manifest",a.LEVEL="level",a.AUDIO_TRACK="audioTrack",a.SUBTITLE_TRACK="subtitleTrack",(d=f||(f={})).MAIN="main",d.AUDIO="audio",d.SUBTITLE="subtitle"},"./src/types/transmuxer.ts":/*!*********************************!*\
   !*** ./src/types/transmuxer.ts ***!
   \*********************************/ /*! exports provided: ChunkMetadata */ function(c,a,b){"use strict";b.r(a),b.d(a,"ChunkMetadata",function(){return d});var d=function(d,e,f,a,b,c){void 0===a&&(a=0),void 0===b&&(b=-1),void 0===c&&(c=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=d,this.sn=e,this.id=f,this.size=a,this.part=b,this.partial=c}},"./src/utils/attr-list.ts":/*!********************************!*\
   !*** ./src/utils/attr-list.ts ***!
   \********************************/ /*! exports provided: AttrList */ function(c,a,b){"use strict";b.r(a),b.d(a,"AttrList",function(){return f});var d=/^(\d+)x(\d+)$/,e=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,f=function(){function b(a){for(var c in"string"==typeof a&&(a=b.parseAttrList(a)),a)a.hasOwnProperty(c)&&(this[c]=a[c])}var a=b.prototype;return a.decimalInteger=function(b){var a=parseInt(this[b],10);return a>Number.MAX_SAFE_INTEGER?1/0:a},a.hexadecimalInteger=function(c){if(this[c]){var a=(this[c]||"0x").slice(2);a=(1&a.length?"0":"")+a;for(var d=new Uint8Array(a.length/2),b=0;b<a.length/2;b++)d[b]=parseInt(a.slice(2*b,2*b+2),16);return d}return null},a.hexadecimalIntegerAsNumber=function(b){var a=parseInt(this[b],16);return a>Number.MAX_SAFE_INTEGER?1/0:a},a.decimalFloatingPoint=function(a){return parseFloat(this[a])},a.optionalFloat=function(b,c){var a=this[b];return a?parseFloat(a):c},a.enumeratedString=function(a){return this[a]},a.bool=function(a){return"YES"===this[a]},a.decimalResolution=function(b){var a=d.exec(this[b]);if(null!==a)return{width:parseInt(a[1],10),height:parseInt(a[2],10)}},b.parseAttrList=function(d){var b,c={};for(e.lastIndex=0;null!==(b=e.exec(d));){var a=b[2];0===a.indexOf('"')&&a.lastIndexOf('"')===a.length-1&&(a=a.slice(1,-1)),c[b[1]]=a}return c},b}()},"./src/utils/binary-search.ts":/*!************************************!*\
   !*** ./src/utils/binary-search.ts ***!
   \************************************/ /*! exports provided: default */ function(c,a,b){"use strict";b.r(a),a.default={search:function(d,g){for(var a=0,b=d.length-1,c=null,e=null;a<=b;){var f=g(e=d[c=(a+b)/2|0]);if(f>0)a=c+1;else{if(!(f<0))return e;b=c-1}}return null}}},"./src/utils/buffer-helper.ts":/*!************************************!*\
   !*** ./src/utils/buffer-helper.ts ***!
   \************************************/ /*! exports provided: BufferHelper */ function(c,b,a){"use strict";a.r(b),a.d(b,"BufferHelper",function(){return f});var d=a(/*! ./logger */ "./src/utils/logger.ts"),e={length:0,start:function(){return 0},end:function(){return 0}},f=function(){function a(){}return a.isBuffered=function(d,e){try{if(d){for(var c=a.getBuffered(d),b=0;b<c.length;b++)if(e>=c.start(b)&&e<=c.end(b))return!0}}catch(f){}return!1},a.bufferInfo=function(e,c,g){try{if(e){var b,d=a.getBuffered(e),f=[];for(b=0;b<d.length;b++)f.push({start:d.start(b),end:d.end(b)});return this.bufferedInfo(f,c,g)}}catch(h){}return{len:0,start:c,end:c,nextStart:void 0}},a.bufferedInfo=function(b,c,e){c=Math.max(0,c),b.sort(function(a,b){return a.start-b.start||b.end-a.end});var a=[];if(e)for(var d=0;d<b.length;d++){var h=a.length;if(h){var i=a[h-1].end;b[d].start-i<e?b[d].end>i&&(a[h-1].end=b[d].end):a.push(b[d])}else a.push(b[d])}else a=b;for(var j,k=0,l=c,m=c,f=0;f<a.length;f++){var g=a[f].start,n=a[f].end;if(c+e>=g&&c<n)l=g,k=(m=n)-c;else if(c+e<g){j=g;break}}return{len:k,start:l||0,end:m||0,nextStart:j}},a.getBuffered=function(a){try{return a.buffered}catch(b){return d.logger.log("failed to get media.buffered",b),e}},a}()},"./src/utils/cea-608-parser.ts":/*!*************************************!*\
   !*** ./src/utils/cea-608-parser.ts ***!
   \*************************************/ /*! exports provided: Row, CaptionScreen, default */ function(f,b,c){"use strict";c.r(b),c.d(b,"Row",function(){return s}),c.d(b,"CaptionScreen",function(){return t});var d,a,g=c(/*! ../utils/logger */ "./src/utils/logger.ts"),h={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},i=function(a){var b=a;return h.hasOwnProperty(a)&&(b=h[a]),String.fromCharCode(b)},j={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},k={17:2,18:4,21:6,22:8,23:10,19:13,20:15},l={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},m={25:2,26:4,29:6,30:8,31:10,27:13,28:15},n=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];(a=d||(d={}))[a.ERROR=0]="ERROR",a[a.TEXT=1]="TEXT",a[a.WARNING=2]="WARNING",a[a.INFO=2]="INFO",a[a.DEBUG=3]="DEBUG",a[a.DATA=3]="DATA";var o=function(){function a(){this.time=null,this.verboseLevel=d.ERROR}return a.prototype.log=function(a,b){this.verboseLevel>=a&&g.logger.log(this.time+" ["+a+"] "+b)},a}(),p=function(b){for(var c=[],a=0;a<b.length;a++)c.push(b[a].toString(16));return c},q=function(){function b(a,b,c,d,e){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=a||"white",this.underline=b||!1,this.italics=c||!1,this.background=d||"black",this.flash=e||!1}var a=b.prototype;return a.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},a.setStyles=function(c){for(var d=["foreground","underline","italics","background","flash"],a=0;a<d.length;a++){var b=d[a];c.hasOwnProperty(b)&&(this[b]=c[b])}},a.isDefault=function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},a.equals=function(a){return this.foreground===a.foreground&&this.underline===a.underline&&this.italics===a.italics&&this.background===a.background&&this.flash===a.flash},a.copy=function(a){this.foreground=a.foreground,this.underline=a.underline,this.italics=a.italics,this.background=a.background,this.flash=a.flash},a.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},b}(),r=function(){function b(a,b,c,d,e,f){this.uchar=void 0,this.penState=void 0,this.uchar=a||" ",this.penState=new q(b,c,d,e,f)}var a=b.prototype;return a.reset=function(){this.uchar=" ",this.penState.reset()},a.setChar=function(a,b){this.uchar=a,this.penState.copy(b)},a.setPenState=function(a){this.penState.copy(a)},a.equals=function(a){return this.uchar===a.uchar&&this.penState.equals(a.penState)},a.copy=function(a){this.uchar=a.uchar,this.penState.copy(a.penState)},a.isEmpty=function(){return" "===this.uchar&&this.penState.isDefault()},b}(),s=function(){function b(b){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var a=0;a<100;a++)this.chars.push(new r);this.logger=b,this.pos=0,this.currPenState=new q}var a=b.prototype;return a.equals=function(c){for(var b=!0,a=0;a<100;a++)if(!this.chars[a].equals(c.chars[a])){b=!1;break}return b},a.copy=function(b){for(var a=0;a<100;a++)this.chars[a].copy(b.chars[a])},a.isEmpty=function(){for(var b=!0,a=0;a<100;a++)if(!this.chars[a].isEmpty()){b=!1;break}return b},a.setCursor=function(a){this.pos!==a&&(this.pos=a),this.pos<0?(this.logger.log(d.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>100&&(this.logger.log(d.DEBUG,"Too large cursor position "+this.pos),this.pos=100)},a.moveCursor=function(b){var c=this.pos+b;if(b>1)for(var a=this.pos+1;a<c+1;a++)this.chars[a].setPenState(this.currPenState);this.setCursor(c)},a.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},a.insertChar=function(a){a>=144&&this.backSpace();var b=i(a);this.pos>=100?this.logger.log(d.ERROR,"Cannot insert "+a.toString(16)+" ("+b+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(b,this.currPenState),this.moveCursor(1))},a.clearFromPos=function(b){var a;for(a=b;a<100;a++)this.chars[a].reset()},a.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},a.clearToEndOfRow=function(){this.clearFromPos(this.pos)},a.getTextString=function(){for(var b=[],c=!0,a=0;a<100;a++){var d=this.chars[a].uchar;" "!==d&&(c=!1),b.push(d)}return c?"":b.join("")},a.setPenStyles=function(a){this.currPenState.setStyles(a),this.chars[this.pos].setPenState(this.currPenState)},b}(),t=function(){function b(a){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var b=0;b<15;b++)this.rows.push(new s(a));this.logger=a,this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var a=b.prototype;return a.reset=function(){for(var a=0;a<15;a++)this.rows[a].clear();this.currRow=14},a.equals=function(c){for(var b=!0,a=0;a<15;a++)if(!this.rows[a].equals(c.rows[a])){b=!1;break}return b},a.copy=function(b){for(var a=0;a<15;a++)this.rows[a].copy(b.rows[a])},a.isEmpty=function(){for(var b=!0,a=0;a<15;a++)if(!this.rows[a].isEmpty()){b=!1;break}return b},a.backSpace=function(){this.rows[this.currRow].backSpace()},a.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},a.insertChar=function(a){this.rows[this.currRow].insertChar(a)},a.setPen=function(a){this.rows[this.currRow].setPenStyles(a)},a.moveCursor=function(a){this.rows[this.currRow].moveCursor(a)},a.setCursor=function(a){this.logger.log(d.INFO,"setCursor: "+a),this.rows[this.currRow].setCursor(a)},a.setPAC=function(a){this.logger.log(d.INFO,"pacData = "+JSON.stringify(a));var b=a.row-1;if(this.nrRollUpRows&&b<this.nrRollUpRows-1&&(b=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==b){for(var e=0;e<15;e++)this.rows[e].clear();var g=this.currRow+1-this.nrRollUpRows,f=this.lastOutputScreen;if(f){var h=f.rows[g].cueStartTime,i=this.logger.time;if(h&&null!==i&&h<i)for(var c=0;c<this.nrRollUpRows;c++)this.rows[b-this.nrRollUpRows+c+1].copy(f.rows[g+c])}}this.currRow=b;var j=this.rows[this.currRow];if(null!==a.indent){var k=Math.max(a.indent-1,0);j.setCursor(a.indent),a.color=j.chars[k].penState.foreground}var l={foreground:a.color,underline:a.underline,italics:a.italics,background:"black",flash:!1};this.setPen(l)},a.setBkgData=function(a){this.logger.log(d.INFO,"bkgData = "+JSON.stringify(a)),this.backSpace(),this.setPen(a),this.insertChar(32)},a.setRollUpRows=function(a){this.nrRollUpRows=a},a.rollUp=function(){if(null!==this.nrRollUpRows){this.logger.log(d.TEXT,this.getDisplayText());var b=this.currRow+1-this.nrRollUpRows,a=this.rows.splice(b,1)[0];a.clear(),this.rows.splice(this.currRow,0,a),this.logger.log(d.INFO,"Rolling up")}else this.logger.log(d.DEBUG,"roll_up but nrRollUpRows not set yet")},a.getDisplayText=function(b){b=b||!1;for(var a=[],e="",f=-1,c=0;c<15;c++){var d=this.rows[c].getTextString();d&&(f=c+1,b?a.push("Row "+f+": '"+d+"'"):a.push(d.trim()))}return a.length>0&&(e=b?"["+a.join(" | ")+"]":a.join("\n")),e},a.getTextAndFormat=function(){return this.rows},b}(),u=function(){function b(b,c,a){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=b,this.outputFilter=c,this.mode=null,this.verbose=0,this.displayedMemory=new t(a),this.nonDisplayedMemory=new t(a),this.lastOutputScreen=new t(a),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=a}var a=b.prototype;return a.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},a.getHandler=function(){return this.outputFilter},a.setHandler=function(a){this.outputFilter=a},a.setPAC=function(a){this.writeScreen.setPAC(a)},a.setBkgData=function(a){this.writeScreen.setBkgData(a)},a.setMode=function(a){a!==this.mode&&(this.mode=a,this.logger.log(d.INFO,"MODE="+a),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=a)},a.insertChars=function(b){for(var a=0;a<b.length;a++)this.writeScreen.insertChar(b[a]);var c=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(d.INFO,c+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(this.logger.log(d.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},a.ccRCL=function(){this.logger.log(d.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},a.ccBS=function(){this.logger.log(d.INFO,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},a.ccAOF=function(){},a.ccAON=function(){},a.ccDER=function(){this.logger.log(d.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},a.ccRU=function(a){this.logger.log(d.INFO,"RU("+a+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(a)},a.ccFON=function(){this.logger.log(d.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},a.ccRDC=function(){this.logger.log(d.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},a.ccTR=function(){this.logger.log(d.INFO,"TR"),this.setMode("MODE_TEXT")},a.ccRTD=function(){this.logger.log(d.INFO,"RTD"),this.setMode("MODE_TEXT")},a.ccEDM=function(){this.logger.log(d.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},a.ccCR=function(){this.logger.log(d.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},a.ccENM=function(){this.logger.log(d.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},a.ccEOC=function(){if(this.logger.log(d.INFO,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var a=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=a,this.writeScreen=this.nonDisplayedMemory,this.logger.log(d.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},a.ccTO=function(a){this.logger.log(d.INFO,"TO("+a+") - Tab Offset"),this.writeScreen.moveCursor(a)},a.ccMIDROW=function(b){var a={flash:!1};if(a.underline=b%2==1,a.italics=b>=46,a.italics)a.foreground="white";else{var c=Math.floor(b/2)-16;a.foreground=["white","green","blue","cyan","red","yellow","magenta"][c]}this.logger.log(d.INFO,"MIDROW: "+JSON.stringify(a)),this.writeScreen.setPen(a)},a.outputDataUpdate=function(b){void 0===b&&(b=!1);var a=this.logger.time;null!==a&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,a,this.lastOutputScreen),b&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:a):this.cueStartTime=a,this.lastOutputScreen.copy(this.displayedMemory))},a.cueSplitAtTime=function(a){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,a,this.displayedMemory),this.cueStartTime=a))},b}(),e=function(){function b(b,c,d){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var a=new o;this.channels=[null,new u(b,c,a),new u(b+1,d,a)],this.cmdHistory={a:null,b:null},this.logger=a}var a=b.prototype;return a.getHandler=function(a){return this.channels[a].getHandler()},a.setHandler=function(a,b){this.channels[a].setHandler(b)},a.addData=function(i,f){var c,a,b,g=!1;this.logger.time=i;for(var e=0;e<f.length;e+=2)if(a=127&f[e],b=127&f[e+1],0!==a||0!==b){if(this.logger.log(d.DATA,"["+p([f[e],f[e+1]])+"] -> ("+p([a,b])+")"),(c=this.parseCmd(a,b))||(c=this.parseMidrow(a,b)),c||(c=this.parsePAC(a,b)),c||(c=this.parseBackgroundAttributes(a,b)),!c&&(g=this.parseChars(a,b))){var h=this.currentChannel;h&&h>0?this.channels[h].insertChars(g):this.logger.log(d.WARNING,"No channel found yet. TEXT-MODE?")}c||g||this.logger.log(d.WARNING,"Couldn't parse cleaned data "+p([a,b])+" orig: "+p([f[e],f[e+1]]))}},a.parseCmd=function(c,a){var e=this.cmdHistory;if(!((20===c||28===c||21===c||29===c)&&a>=32&&a<=47||(23===c||31===c)&&a>=33&&a<=35))return!1;if(w(c,a,e))return v(null,null,e),this.logger.log(d.DEBUG,"Repeated command ("+p([c,a])+") is dropped"),!0;var f=20===c||21===c||23===c?1:2,b=this.channels[f];return 20===c||21===c||28===c||29===c?32===a?b.ccRCL():33===a?b.ccBS():34===a?b.ccAOF():35===a?b.ccAON():36===a?b.ccDER():37===a?b.ccRU(2):38===a?b.ccRU(3):39===a?b.ccRU(4):40===a?b.ccFON():41===a?b.ccRDC():42===a?b.ccTR():43===a?b.ccRTD():44===a?b.ccEDM():45===a?b.ccCR():46===a?b.ccENM():47===a&&b.ccEOC():b.ccTO(a-32),v(c,a,e),this.currentChannel=f,!0},a.parseMidrow=function(a,b){var c=0;if((17===a||25===a)&&b>=32&&b<=47){if((c=17===a?1:2)!==this.currentChannel)return this.logger.log(d.ERROR,"Mismatch channel in midrow parsing"),!1;var e=this.channels[c];return!!e&&(e.ccMIDROW(b),this.logger.log(d.DEBUG,"MIDROW ("+p([a,b])+")"),!0)}return!1},a.parsePAC=function(a,b){var e,d=this.cmdHistory;if(!((a>=17&&a<=23||a>=25&&a<=31)&&b>=64&&b<=127||(16===a||24===a)&&b>=64&&b<=95))return!1;if(w(a,b,d))return v(null,null,d),!0;var c=a<=23?1:2;e=b>=64&&b<=95?1===c?j[a]:l[a]:1===c?k[a]:m[a];var f=this.channels[c];return!!f&&(f.setPAC(this.interpretPAC(e,b)),v(a,b,d),this.currentChannel=c,!0)},a.interpretPAC=function(d,c){var a,b={color:null,italics:!1,indent:null,underline:!1,row:d};return a=c>95?c-96:c-64,b.underline=1==(1&a),a<=13?b.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(a/2)]:a<=15?(b.italics=!0,b.color="white"):b.indent=4*Math.floor((a-16)/2),b},a.parseChars=function(a,b){var f,g,e=null,c=null;if(a>=25?(f=2,c=a-8):(f=1,c=a),c>=17&&c<=19?(g=17===c?b+80:18===c?b+112:b+144,this.logger.log(d.INFO,"Special char '"+i(g)+"' in channel "+f),e=[g]):a>=32&&a<=127&&(e=0===b?[a]:[a,b]),e){var h=p(e);this.logger.log(d.DEBUG,"Char codes =  "+h.join(",")),v(a,b,this.cmdHistory)}return e},a.parseBackgroundAttributes=function(b,a){if(!((16===b||24===b)&&a>=32&&a<=47||(23===b||31===b)&&a>=45&&a<=47))return!1;var d,c={};16===b||24===b?(d=Math.floor((a-32)/2),c.background=n[d],a%2==1&&(c.background=c.background+"_semi")):45===a?c.background="transparent":(c.foreground="black",47===a&&(c.underline=!0));var e=b<=23?1:2;return this.channels[e].setBkgData(c),v(b,a,this.cmdHistory),!0},a.reset=function(){for(var a=0;a<Object.keys(this.channels).length;a++){var b=this.channels[a];b&&b.reset()}this.cmdHistory={a:null,b:null}},a.cueSplitAtTime=function(c){for(var a=0;a<this.channels.length;a++){var b=this.channels[a];b&&b.cueSplitAtTime(c)}},b}();function v(b,c,a){a.a=b,a.b=c}function w(b,c,a){return a.a===b&&a.b===c}b.default=e},"./src/utils/codecs.ts":/*!*****************************!*\
   !*** ./src/utils/codecs.ts ***!
   \*****************************/ /*! exports provided: isCodecType, isCodecSupportedInMp4 */ function(c,a,b){"use strict";b.r(a),b.d(a,"isCodecType",function(){return e}),b.d(a,"isCodecSupportedInMp4",function(){return f});var d={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function e(b,c){var a=d[c];return!!a&& !0===a[b.slice(0,4)]}function f(a,b){return MediaSource.isTypeSupported((b||"video")+'/mp4;codecs="'+a+'"')}},"./src/utils/cues.ts":/*!***************************!*\
   !*** ./src/utils/cues.ts ***!
   \***************************/ /*! exports provided: default */ function(c,b,a){"use strict";a.r(b);var d=a(/*! ./vttparser */ "./src/utils/vttparser.ts"),e=a(/*! ./webvtt-parser */ "./src/utils/webvtt-parser.ts"),f=a(/*! ./texttrack-utils */ "./src/utils/texttrack-utils.ts"),g=/\s/;b.default={newCue:function(i,j,k,p){for(var b,c,n,a,o,h=[],s=self.VTTCue||self.TextTrackCue,l=0;l<p.rows.length;l++)if(n=!0,a=0,o="",!(b=p.rows[l]).isEmpty()){for(var m=0;m<b.chars.length;m++)g.test(b.chars[m].uchar)&&n?a++:(o+=b.chars[m].uchar,n=!1);b.cueStartTime=j,j===k&&(k+=1e-4),a>=16?a--:a++;var q=Object(d.fixLineBreaks)(o.trim()),r=Object(e.generateCueId)(j,k,q);i&&i.cues&&i.cues.getCueById(r)||((c=new s(j,k,q)).id=r,c.line=l+1,c.align="left",c.position=10+Math.min(80,10*Math.floor(8*a/32)),h.push(c))}return i&&h.length&&(h.sort(function(a,b){return"auto"===a.line||"auto"===b.line?0:a.line>8&&b.line>8?b.line-a.line:a.line-b.line}),h.forEach(function(a){return Object(f.addCueToTrack)(i,a)})),h}}},"./src/utils/discontinuities.ts":/*!**************************************!*\
   !*** ./src/utils/discontinuities.ts ***!
   \**************************************/ /*! exports provided: findFirstFragWithCC, shouldAlignOnDiscontinuities, findDiscontinuousReferenceFrag, adjustSlidingStart, alignStream, alignPDT */ function(c,b,a){"use strict";a.r(b),a.d(b,"findFirstFragWithCC",function(){return g}),a.d(b,"shouldAlignOnDiscontinuities",function(){return h}),a.d(b,"findDiscontinuousReferenceFrag",function(){return i}),a.d(b,"adjustSlidingStart",function(){return k}),a.d(b,"alignStream",function(){return l}),a.d(b,"alignPDT",function(){return m});var d=a(/*! ./src/polyfills/number */ "./src/polyfills/number.ts"),e=a(/*! ./logger */ "./src/utils/logger.ts"),f=a(/*! ../controller/level-helper */ "./src/controller/level-helper.ts");function g(c,e){for(var d=null,a=0,f=c.length;a<f;a++){var b=c[a];if(b&&b.cc===e){d=b;break}}return d}function h(b,c,a){return!(!c.details||!(a.endCC>a.startCC||b&&b.cc<a.startCC))}function i(d,f){var b=d.fragments,c=f.fragments;if(c.length&&b.length){var a=g(b,c[0].cc);if(a&&(!a||a.startPTS))return a;e.logger.log("No frag in previous level to align on")}else e.logger.log("No fragments to align")}function j(a,c){if(a){var b=a.start+c;a.start=a.startPTS=b,a.endPTS=b+a.duration}}function k(c,a){for(var d=a.fragments,b=0,e=d.length;b<e;b++)j(d[b],c);a.fragmentHint&&j(a.fragmentHint,c),a.alignedSliding=!0}function l(c,a,b){a&&(function(f,a,c){if(h(f,c,a)){var b=i(c.details,a);b&&Object(d.isFiniteNumber)(b.start)&&(e.logger.log("Adjusting PTS using last level due to CC increase within current level "+a.url),k(b.start,a))}}(c,b,a),!b.alignedSliding&&a.details&&m(b,a.details),b.alignedSliding||!a.details||b.skippedSegments||Object(f.adjustSliding)(a.details,b))}function m(a,b){if(b.fragments.length&&a.hasProgramDateTime&&b.hasProgramDateTime){var f=b.fragments[0].programDateTime,g=a.fragments[0].programDateTime,c=(g-f)/1e3+b.fragments[0].start;c&&Object(d.isFiniteNumber)(c)&&(e.logger.log("Adjusting PTS using programDateTime delta "+(g-f)+"ms, sliding:"+c.toFixed(3)+" "+a.url+" "),k(c,a))}}},"./src/utils/ewma-bandwidth-estimator.ts":/*!***********************************************!*\
   !*** ./src/utils/ewma-bandwidth-estimator.ts ***!
   \***********************************************/ /*! exports provided: default */ function(d,a,b){"use strict";b.r(a);var e=b(/*! ../utils/ewma */ "./src/utils/ewma.ts"),c=function(){function b(a,b,c){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=c,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new e.default(a),this.fast_=new e.default(b)}var a=b.prototype;return a.update=function(a,b){var c=this.slow_,d=this.fast_;this.slow_.halfLife!==a&&(this.slow_=new e.default(a,c.getEstimate(),c.getTotalWeight())),this.fast_.halfLife!==b&&(this.fast_=new e.default(b,d.getEstimate(),d.getTotalWeight()))},a.sample=function(b,d){var a=(b=Math.max(b,this.minDelayMs_))/1e3,c=8*d/a;this.fast_.sample(a,c),this.slow_.sample(a,c)},a.canEstimate=function(){var a=this.fast_;return a&&a.getTotalWeight()>=this.minWeight_},a.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},a.destroy=function(){},b}();a.default=c},"./src/utils/ewma.ts":/*!***************************!*\
   !*** ./src/utils/ewma.ts ***!
   \***************************/ /*! exports provided: default */ function(d,a,b){"use strict";b.r(a);var c=function(){function b(a,b,c){void 0===b&&(b=0),void 0===c&&(c=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=a,this.alpha_=a?Math.exp(Math.log(.5)/a):0,this.estimate_=b,this.totalWeight_=c}var a=b.prototype;return a.sample=function(a,c){var b=Math.pow(this.alpha_,a);this.estimate_=c*(1-b)+b*this.estimate_,this.totalWeight_+=a},a.getTotalWeight=function(){return this.totalWeight_},a.getEstimate=function(){if(this.alpha_){var a=1-Math.pow(this.alpha_,this.totalWeight_);if(a)return this.estimate_/a}return this.estimate_},b}();a.default=c},"./src/utils/fetch-loader.ts":/*!***********************************!*\
   !*** ./src/utils/fetch-loader.ts ***!
   \***********************************/ /*! exports provided: fetchSupported, default */ function(e,b,a){"use strict";a.r(b),a.d(b,"fetchSupported",function(){return m});var f=a(/*! ./src/polyfills/number */ "./src/polyfills/number.ts"),g=a(/*! ../loader/load-stats */ "./src/loader/load-stats.ts"),h=a(/*! ../demux/chunk-cache */ "./src/demux/chunk-cache.ts");function c(a){var b="function"==typeof Map?new Map:void 0;return(c=function(a){var d;if(null===a||(d=a,-1===Function.toString.call(d).indexOf("[native code]")))return a;if("function"!=typeof a)throw new TypeError("Super expression must either be null or a function");if(void 0!==b){if(b.has(a))return b.get(a);b.set(a,c)}function c(){return i(a,arguments,l(this).constructor)}return c.prototype=Object.create(a.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}}),k(c,a)})(a)}function i(a,b,c){return(i=j()?Reflect.construct:function(d,e,b){var a=[null];a.push.apply(a,e);var c=new(Function.bind.apply(d,a));return b&&k(c,b.prototype),c}).apply(null,arguments)}function j(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(a){return!1}}function k(a,b){return(k=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a})(a,b)}function l(a){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)})(a)}function m(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(a){}return!1}var d=function(){function b(a){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=a.fetchSetup||n,this.controller=new self.AbortController,this.stats=new g.LoadStats}var a=b.prototype;return a.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},a.abortInternal=function(){var a=this.response;a&&a.ok||(this.stats.aborted=!0,this.controller.abort())},a.abort=function(){var a;this.abortInternal(),null!==(a=this.callbacks)&& void 0!==a&&a.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},a.load=function(a,d,e){var b,j,c,k=this,g=this.stats;if(g.loading.start)throw new Error("Loader can only be used once.");g.loading.start=self.performance.now();var h=(b=a,c={method:"GET",mode:"cors",credentials:"same-origin",signal:this.controller.signal},b.rangeEnd&&(c.headers=new self.Headers({Range:"bytes="+b.rangeStart+"-"+String(b.rangeEnd-1)})),c),l=e.onProgress,i="arraybuffer"===a.responseType,m=i?"byteLength":"length";this.context=a,this.config=d,this.callbacks=e,this.request=this.fetchSetup(a,h),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){k.abortInternal(),e.onTimeout(g,a,k.response)},d.timeout),self.fetch(this.request).then(function(b){if(k.response=k.loader=b,!b.ok){var c=b.status,e=b.statusText;throw new o(e||"fetch, bad network response",c,b)}return g.loading.first=Math.max(self.performance.now(),g.loading.start),g.total=parseInt(b.headers.get("Content-Length")||"0"),l&&Object(f.isFiniteNumber)(d.highWaterMark)?k.loadProgressively(b,g,a,d.highWaterMark,l):i?b.arrayBuffer():b.text()}).then(function(b){var c=k.response;self.clearTimeout(k.requestTimeout),g.loading.end=Math.max(self.performance.now(),g.loading.first),g.loaded=g.total=b[m];var h={url:c.url,data:b};l&&!Object(f.isFiniteNumber)(d.highWaterMark)&&l(g,a,b,c),e.onSuccess(h,g,a,c)}).catch(function(b){if(self.clearTimeout(k.requestTimeout),!g.aborted){var c=b.code||0;e.onError({code:c,text:b.message},a,b.details)}})},a.getCacheAge=function(){var a=null;if(this.response){var b=this.response.headers.get("age");a=b?parseFloat(b):null}return a},a.loadProgressively=function(b,c,d,a,e){void 0===a&&(a=0);var f=new h.default,g=b.body.getReader();return function h(){return g.read().then(function(i){if(i.done)return f.dataLength&&e(c,d,f.flush(),b),Promise.resolve(new ArrayBuffer(0));var g=i.value,j=g.length;return c.loaded+=j,j<a||f.dataLength?(f.push(g),f.dataLength>=a&&e(c,d,f.flush(),b)):e(c,d,g,b),h()}).catch(function(){return Promise.reject()})}()},b}();function n(a,b){return new self.Request(a.url,b)}var o=function(d){var a,b;function c(b,c,e){var a;return(a=d.call(this,b)||this).code=void 0,a.details=void 0,a.code=c,a.details=e,a}return b=d,(a=c).prototype=Object.create(b.prototype),a.prototype.constructor=a,k(a,b),c}(c(Error));b.default=d},"./src/utils/imsc1-ttml-parser.ts":/*!****************************************!*\
   !*** ./src/utils/imsc1-ttml-parser.ts ***!
   \****************************************/ /*! exports provided: IMSC1_CODEC, parseIMSC1 */ function(c,b,a){"use strict";a.r(b),a.d(b,"IMSC1_CODEC",function(){return k}),a.d(b,"parseIMSC1",function(){return o});var d=a(/*! ./mp4-tools */ "./src/utils/mp4-tools.ts"),e=a(/*! ./vttparser */ "./src/utils/vttparser.ts"),f=a(/*! ./vttcue */ "./src/utils/vttcue.ts"),g=a(/*! ../demux/id3 */ "./src/demux/id3.ts"),h=a(/*! ./timescale-conversion */ "./src/utils/timescale-conversion.ts"),i=a(/*! ./webvtt-parser */ "./src/utils/webvtt-parser.ts");function j(){return(j=Object.assign||function(d){for(var a=1;a<arguments.length;a++){var b=arguments[a];for(var c in b)Object.prototype.hasOwnProperty.call(b,c)&&(d[c]=b[c])}return d}).apply(this,arguments)}var k="stpp.ttml.im1t",l=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,m=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,n={left:"start",center:"center",right:"end",start:"start",end:"end"};function o(b,k,l,m,c){var e=Object(d.findBox)(new Uint8Array(b),["mdat"]);if(0!==e.length){var a=e[0],o=Object(g.utf8ArrayToStr)(new Uint8Array(b,a.start,a.end-a.start)),u=Object(h.toTimescaleFromScale)(k,1,l);try{m(function(b,e){var a=(new DOMParser).parseFromString(b,"text/xml").getElementsByTagName("tt")[0];if(!a)throw new Error("Invalid ttml");var c={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},g=Object.keys(c).reduce(function(d,b){return d[b]=a.getAttribute("ttp:"+b)||c[b],d},{}),h="preserve"!==a.getAttribute("xml:space"),k=q(p(a,"styling","style")),l=q(p(a,"layout","region")),d=p(a,"body","[begin]");return[].map.call(d,function(b){var o=function b(a,c){return[].slice.call(a.childNodes).reduce(function(d,a,f){var e;return"br"===a.nodeName&&f?d+"\n":null!==(e=a.childNodes)&& void 0!==e&&e.length?b(a,c):c?d+a.textContent.trim().replace(/\s+/g," "):d+a.textContent},"")}(b,h);if(!o||!b.hasAttribute("begin"))return null;var c=t(b.getAttribute("begin"),g),p=t(b.getAttribute("dur"),g),d=t(b.getAttribute("end"),g);if(null===c)throw s(b);if(null===d){if(null===p)throw s(b);d=c+p}var a=new f.default(c-e,d-e,o);a.id=Object(i.generateCueId)(a.startTime,a.endTime,a.text);var v,w,x,y=l[b.getAttribute("region")],z=k[b.getAttribute("style")];a.position=10,a.size=80;var q=(v=y,w=z,x="http://www.w3.org/ns/ttml#styling",["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"].reduce(function(b,a){var c=r(w,x,a)||r(v,x,a);return c&&(b[a]=c),b},{})),m=q.textAlign;if(m){var u=n[m];u&&(a.lineAlign=u),a.align=m}return j(a,q),a}).filter(function(a){return null!==a})}(o,u))}catch(v){c(v)}}else c(new Error("Could not parse IMSC1 mdat"))}function p(b,c,d){var a=b.getElementsByTagName(c)[0];return a?[].slice.call(a.querySelectorAll(d)):[]}function q(a){return a.reduce(function(a,b){var c=b.getAttribute("xml:id");return c&&(a[c]=b),a},{})}function r(a,b,c){return a.hasAttributeNS(b,c)?a.getAttributeNS(b,c):null}function s(a){return new Error("Could not parse ttml timestamp "+a)}function t(a,f){if(!a)return null;var g,d,b,h,c=Object(e.parseTimeStamp)(a);return null===c&&(l.test(a)?c=(g=a,d=f,h=(0|(b=l.exec(g))[4])+(0|b[5])/d.subFrameRate,3600*(0|b[1])+60*(0|b[2])+(0|b[3])+h/d.frameRate):m.test(a)&&(c=function(d,b){var c=m.exec(d),a=Number(c[1]);switch(c[2]){case"h":return 3600*a;case"m":return 60*a;case"ms":return 1e3*a;case"f":return a/b.frameRate;case"t":return a/b.tickRate}return a}(a,f))),c}},"./src/utils/logger.ts":/*!*****************************!*\
   !*** ./src/utils/logger.ts ***!
   \*****************************/ /*! exports provided: enableLogs, logger */ function(e,b,c){"use strict";c.r(b),c.d(b,"enableLogs",function(){return g}),c.d(b,"logger",function(){return h});var a=function(){},d={trace:a,debug:a,log:a,warn:a,info:a,error:a},f=d;function g(b){if(self.console&& !0===b||"object"==typeof b){!function(e){for(var c=arguments.length,d=new Array(c>1?c-1:0),b=1;b<c;b++)d[b-1]=arguments[b];d.forEach(function(b){var c,d;f[b]=e[b]?e[b].bind(e):(c=b,(d=self.console[c])?d.bind(self.console,"["+c+"] >"):a)})}(b,"debug","log","info","warn","error");try{f.log()}catch(c){f=d}}else f=d}var h=d},"./src/utils/mediakeys-helper.ts":/*!***************************************!*\
   !*** ./src/utils/mediakeys-helper.ts ***!
   \***************************************/ /*! exports provided: KeySystems, requestMediaKeySystemAccess */ function(c,a,b){"use strict";b.r(a),b.d(a,"KeySystems",function(){return e}),b.d(a,"requestMediaKeySystemAccess",function(){return f}),(d=e||(e={})).WIDEVINE="com.widevine.alpha",d.PLAYREADY="com.microsoft.playready";var d,e,f="undefined"!=typeof self&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null},"./src/utils/mediasource-helper.ts":/*!*****************************************!*\
   !*** ./src/utils/mediasource-helper.ts ***!
   \*****************************************/ /*! exports provided: getMediaSource */ function(c,a,b){"use strict";function d(){return self.MediaSource||self.WebKitMediaSource}b.r(a),b.d(a,"getMediaSource",function(){return d})},"./src/utils/mp4-tools.ts":/*!********************************!*\
   !*** ./src/utils/mp4-tools.ts ***!
   \********************************/ /*! exports provided: bin2str, readUint16, readUint32, writeUint32, findBox, parseSegmentIndex, parseInitSegment, getStartDTS, getDuration, computeRawDurationFromSamples, offsetStartDTS, segmentValidRange, appendUint8Array */ function(c,b,a){"use strict";a.r(b),a.d(b,"bin2str",function(){return g}),a.d(b,"readUint16",function(){return h}),a.d(b,"readUint32",function(){return i}),a.d(b,"writeUint32",function(){return j}),a.d(b,"findBox",function(){return k}),a.d(b,"parseSegmentIndex",function(){return l}),a.d(b,"parseInitSegment",function(){return m}),a.d(b,"getStartDTS",function(){return n}),a.d(b,"getDuration",function(){return o}),a.d(b,"computeRawDurationFromSamples",function(){return p}),a.d(b,"offsetStartDTS",function(){return q}),a.d(b,"segmentValidRange",function(){return r}),a.d(b,"appendUint8Array",function(){return s});var d=a(/*! ./typed-array */ "./src/utils/typed-array.ts"),e=a(/*! ../loader/fragment */ "./src/loader/fragment.ts"),f=[].push;function g(a){return String.fromCharCode.apply(null,a)}function h(a,b){"data"in a&&(b+=a.start,a=a.data);var c=a[b]<<8|a[b+1];return c<0?65536+c:c}function i(a,b){"data"in a&&(b+=a.start,a=a.data);var c=a[b]<<24|a[b+1]<<16|a[b+2]<<8|a[b+3];return c<0?4294967296+c:c}function j(a,b,c){"data"in a&&(b+=a.start,a=a.data),a[b]=c>>24,a[b+1]=c>>16&255,a[b+2]=c>>8&255,a[b+3]=255&c}function k(c,d){var b,j,e,h=[];if(!d.length)return h;"data"in c?(b=c.data,j=c.start,e=c.end):(j=0,e=(b=c).byteLength);for(var a=j;a<e;){var m=i(b,a),l=m>1?a+m:e;if(g(b.subarray(a+4,a+8))===d[0]){if(1===d.length)h.push({data:b,start:a+8,end:l});else{var n=k({data:b,start:a+8,end:l},d.slice(1));n.length&&f.apply(h,n)}}a=l}return h}function l(j){var l=k(j,["moov"])[0],s=l?l.end:null,d=k(j,["sidx"]);if(!d||!d[0])return null;var m=[],b=d[0],e=b.data[0],a=0===e?8:16,n=i(b,a);a+=4,a+=0===e?8:16,a+=2;var f=b.end+0,o=h(b,a);a+=2;for(var p=0;p<o;p++){var c=a,q=i(b,c);c+=4;var g=2147483647&q;if(1==(2147483648&q)>>>31)return console.warn("SIDX has hierarchical references (not supported)"),null;var r=i(b,c);c+=4,m.push({referenceSize:g,subsegmentDuration:r,info:{duration:r/n,start:f,end:f+g-1}}),f+=g,a=c+=4}return{earliestPresentationTime:0,timescale:n,version:e,referencesCount:o,references:m,moovEndOffset:s}}function m(m){for(var h=[],n=k(m,["moov","trak"]),j=0;j<n.length;j++){var a=n[j],b=k(a,["tkhd"])[0];if(b){var o=b.data[b.start],p=0===o?12:20,q=i(b,p),c=k(a,["mdia","mdhd"])[0];if(c){var r=i(c,p=0===(o=c.data[c.start])?12:20),d=k(a,["mdia","hdlr"])[0];if(d){var t=g(d.data.subarray(d.start+8,d.start+12)),l={soun:e.ElementaryStreamTypes.AUDIO,vide:e.ElementaryStreamTypes.VIDEO}[t];if(l){var f=k(a,["mdia","minf","stbl","stsd"])[0],s=void 0;f&&(s=g(f.data.subarray(f.start+12,f.start+16))),h[q]={timescale:r,type:l},h[l]={timescale:r,id:q,codec:s}}}}}}return k(m,["moov","mvex","trex"]).forEach(function(a){var b=h[i(a,4)];b&&(b.default={duration:i(a,12),flags:i(a,20)})}),h}function n(b,a){return k(a,["moof","traf"]).reduce(function(c,d){var e=k(d,["tfdt"])[0],f=e.data[e.start],a=k(d,["tfhd"]).reduce(function(a,h){var g=b[i(h,4)];if(g){var c=i(e,4);1===f&&(c*=4294967296,c+=i(e,8));var d=c/(g.timescale||9e4);if(isFinite(d)&&(null===a||d<a))return d}return a},null);return null!==a&&isFinite(a)&&(null===c||a<c)?a:c},null)||0}function o(q,v){for(var d=0,f=0,g=0,r=k(q,["moof","traf"]),h=0;h<r.length;h++){var s=r[h],j=k(s,["tfhd"])[0],a=v[i(j,4)];if(a){var b=a.default,t=i(j,0)|(null==b?void 0:b.flags),m=null==b?void 0:b.duration;8&t&&(m=i(j,2&t?12:8));for(var u=a.timescale||9e4,n=k(s,["trun"]),c=0;c<n.length;c++)d=m?m*i(n[c],4):p(n[c]),a.type===e.ElementaryStreamTypes.VIDEO?f+=d/u:a.type===e.ElementaryStreamTypes.AUDIO&&(g+=d/u)}}if(0===f&&0===g){var o=l(q);if(null!=o&&o.references)return o.references.reduce(function(a,b){return a+b.info.duration||0},0)}return f||g}function p(c){var b=i(c,0),a=8;1&b&&(a+=4),4&b&&(a+=4);for(var d=0,f=i(c,4),e=0;e<f;e++)256&b&&(d+=i(c,a),a+=4),512&b&&(a+=4),1024&b&&(a+=4),2048&b&&(a+=4);return d}function q(b,a,c){k(a,["moof","traf"]).forEach(function(a){k(a,["tfhd"]).forEach(function(e){var d=b[i(e,4)];if(d){var f=d.timescale||9e4;k(a,["tfdt"]).forEach(function(b){var d=b.data[b.start],a=i(b,4);if(0===d)j(b,4,a-c*f);else{a*=4294967296,a+=i(b,8),a-=c*f,a=Math.max(a,0);var e=Math.floor(a/4294967296),g=Math.floor(a%4294967296);j(b,4,e),j(b,8,g)}})}})})}function r(b){var a={valid:null,remainder:null},c=k(b,["moof"]);if(!c)return a;if(c.length<2)return a.remainder=b,a;var e=c[c.length-1];return a.valid=Object(d.sliceUint8)(b,0,e.start-8),a.remainder=Object(d.sliceUint8)(b,e.start-8),a}function s(a,c){var b=new Uint8Array(a.length+c.length);return b.set(a),b.set(c,a.length),b}},"./src/utils/output-filter.ts":/*!************************************!*\
   !*** ./src/utils/output-filter.ts ***!
   \************************************/ /*! exports provided: default */ function(c,a,b){"use strict";b.r(a),b.d(a,"default",function(){return d});var d=function(){function b(a,b){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=a,this.trackName=b}var a=b.prototype;return a.dispatchCue=function(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},a.newCue=function(a,b,c){(null===this.startTime||this.startTime>a)&&(this.startTime=a),this.endTime=b,this.screen=c,this.timelineController.createCaptionsTrack(this.trackName)},a.reset=function(){this.cueRanges=[]},b}()},"./src/utils/texttrack-utils.ts":/*!**************************************!*\
   !*** ./src/utils/texttrack-utils.ts ***!
   \**************************************/ /*! exports provided: sendAddTrackEvent, addCueToTrack, clearCurrentCues, removeCuesInRange, getCuesInRange */ function(c,b,a){"use strict";a.r(b),a.d(b,"sendAddTrackEvent",function(){return e}),a.d(b,"addCueToTrack",function(){return f}),a.d(b,"clearCurrentCues",function(){return g}),a.d(b,"removeCuesInRange",function(){return h}),a.d(b,"getCuesInRange",function(){return i});var d=a(/*! ./logger */ "./src/utils/logger.ts");function e(b,c){var a;try{a=new Event("addtrack")}catch(d){(a=document.createEvent("Event")).initEvent("addtrack",!1,!1)}a.track=b,c.dispatchEvent(a)}function f(a,b){var c=a.mode;if("disabled"===c&&(a.mode="hidden"),a.cues&&!a.cues.getCueById(b.id))try{if(a.addCue(b),!a.cues.getCueById(b.id))throw new Error("addCue is failed for: "+b)}catch(f){d.logger.debug("[texttrack-utils]: "+f);var e=new self.TextTrackCue(b.startTime,b.endTime,b.text);e.id=b.id,a.addCue(e)}"disabled"===c&&(a.mode=c)}function g(a){var b=a.mode;if("disabled"===b&&(a.mode="hidden"),a.cues)for(var c=a.cues.length;c--;)a.removeCue(a.cues[c]);"disabled"===b&&(a.mode=b)}function h(a,e,f){var b=a.mode;if("disabled"===b&&(a.mode="hidden"),a.cues&&a.cues.length>0)for(var d=i(a.cues,e,f),c=0;c<d.length;c++)a.removeCue(d[c]);"disabled"===b&&(a.mode=b)}function i(b,d,e){var f=[],g=function(a,b){if(b<a[0].startTime)return 0;var f=a.length-1;if(b>a[f].endTime)return -1;for(var c=0,d=f;c<=d;){var e=Math.floor((d+c)/2);if(b<a[e].startTime)d=e-1;else{if(!(b>a[e].startTime&&c<f))return e;c=e+1}}return a[c].startTime-b<b-a[d].startTime?c:d}(b,d);if(g> -1)for(var c=g,h=b.length;c<h;c++){var a=b[c];if(a.startTime>=d&&a.endTime<=e)f.push(a);else if(a.startTime>e)break}return f}},"./src/utils/time-ranges.ts":/*!**********************************!*\
   !*** ./src/utils/time-ranges.ts ***!
   \**********************************/ /*! exports provided: default */ function(c,a,b){"use strict";b.r(a),a.default={toString:function(b){for(var c="",d=b.length,a=0;a<d;a++)c+="["+b.start(a).toFixed(3)+","+b.end(a).toFixed(3)+"]";return c}}},"./src/utils/timescale-conversion.ts":/*!*******************************************!*\
   !*** ./src/utils/timescale-conversion.ts ***!
   \*******************************************/ /*! exports provided: toTimescaleFromBase, toTimescaleFromScale, toMsFromMpegTsClock, toMpegTsClockFromTimescale */ function(c,a,b){"use strict";function d(d,e,a,b){void 0===a&&(a=1),void 0===b&&(b=!1);var c=d*e*a;return b?Math.round(c):c}function e(c,e,a,b){return void 0===a&&(a=1),void 0===b&&(b=!1),d(c,e,1/a,b)}function f(b,a){return void 0===a&&(a=!1),d(b,1e3,1/9e4,a)}function g(b,a){return void 0===a&&(a=1),d(b,9e4,1/a)}b.r(a),b.d(a,"toTimescaleFromBase",function(){return d}),b.d(a,"toTimescaleFromScale",function(){return e}),b.d(a,"toMsFromMpegTsClock",function(){return f}),b.d(a,"toMpegTsClockFromTimescale",function(){return g})},"./src/utils/typed-array.ts":/*!**********************************!*\
   !*** ./src/utils/typed-array.ts ***!
   \**********************************/ /*! exports provided: sliceUint8 */ function(c,a,b){"use strict";function d(a,b,c){return Uint8Array.prototype.slice?a.slice(b,c):new Uint8Array(Array.prototype.slice.call(a,b,c))}b.r(a),b.d(a,"sliceUint8",function(){return d})},"./src/utils/vttcue.ts":/*!*****************************!*\
   !*** ./src/utils/vttcue.ts ***!
   \*****************************/ /*! exports provided: default */ function(c,a,b){"use strict";b.r(a),a.default=function(){if("undefined"!=typeof self&&self.VTTCue)return self.VTTCue;var b=["","lr","rl"],c=["start","middle","end","left","right"];function d(a,b){if("string"!=typeof b||!Array.isArray(a))return!1;var c=b.toLowerCase();return!!~a.indexOf(c)&&c}function e(a){return d(c,a)}function f(d){for(var b=arguments.length,g=new Array(b>1?b-1:0),a=1;a<b;a++)g[a-1]=arguments[a];for(var c=1;c<arguments.length;c++){var e=arguments[c];for(var f in e)d[f]=e[f]}return d}function a(g,h,i){var a=this,c={enumerable:!0};a.hasBeenReset=!1;var j="",k=!1,l=g,m=h,n=i,o=null,p="",q=!0,r="auto",s="start",t=50,u="middle",v=50,w="middle";Object.defineProperty(a,"id",f({},c,{get:function(){return j},set:function(a){j=""+a}})),Object.defineProperty(a,"pauseOnExit",f({},c,{get:function(){return k},set:function(a){k=!!a}})),Object.defineProperty(a,"startTime",f({},c,{get:function(){return l},set:function(a){if("number"!=typeof a)throw new TypeError("Start time must be set to a number.");l=a,this.hasBeenReset=!0}})),Object.defineProperty(a,"endTime",f({},c,{get:function(){return m},set:function(a){if("number"!=typeof a)throw new TypeError("End time must be set to a number.");m=a,this.hasBeenReset=!0}})),Object.defineProperty(a,"text",f({},c,{get:function(){return n},set:function(a){n=""+a,this.hasBeenReset=!0}})),Object.defineProperty(a,"region",f({},c,{get:function(){return o},set:function(a){o=a,this.hasBeenReset=!0}})),Object.defineProperty(a,"vertical",f({},c,{get:function(){return p},set:function(c){var e,a=d(b,c);if(!1===a)throw new SyntaxError("An invalid or illegal string was specified.");p=a,this.hasBeenReset=!0}})),Object.defineProperty(a,"snapToLines",f({},c,{get:function(){return q},set:function(a){q=!!a,this.hasBeenReset=!0}})),Object.defineProperty(a,"line",f({},c,{get:function(){return r},set:function(a){if("number"!=typeof a&&"auto"!==a)throw new SyntaxError("An invalid number or illegal string was specified.");r=a,this.hasBeenReset=!0}})),Object.defineProperty(a,"lineAlign",f({},c,{get:function(){return s},set:function(b){var a=e(b);if(!a)throw new SyntaxError("An invalid or illegal string was specified.");s=a,this.hasBeenReset=!0}})),Object.defineProperty(a,"position",f({},c,{get:function(){return t},set:function(a){if(a<0||a>100)throw new Error("Position must be between 0 and 100.");t=a,this.hasBeenReset=!0}})),Object.defineProperty(a,"positionAlign",f({},c,{get:function(){return u},set:function(b){var a=e(b);if(!a)throw new SyntaxError("An invalid or illegal string was specified.");u=a,this.hasBeenReset=!0}})),Object.defineProperty(a,"size",f({},c,{get:function(){return v},set:function(a){if(a<0||a>100)throw new Error("Size must be between 0 and 100.");v=a,this.hasBeenReset=!0}})),Object.defineProperty(a,"align",f({},c,{get:function(){return w},set:function(b){var a=e(b);if(!a)throw new SyntaxError("An invalid or illegal string was specified.");w=a,this.hasBeenReset=!0}})),a.displayState=void 0}return a.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},a}()},"./src/utils/vttparser.ts":/*!********************************!*\
   !*** ./src/utils/vttparser.ts ***!
   \********************************/ /*! exports provided: parseTimeStamp, fixLineBreaks, VTTParser */ function(e,b,a){"use strict";a.r(b),a.d(b,"parseTimeStamp",function(){return g}),a.d(b,"fixLineBreaks",function(){return l}),a.d(b,"VTTParser",function(){return m});var c=a(/*! ./vttcue */ "./src/utils/vttcue.ts"),f=function(){function a(){}return a.prototype.decode=function(a,b){if(!a)return"";if("string"!=typeof a)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(a))},a}();function g(c){function b(a,b,c,d){return 3600*(0|a)+60*(0|b)+(0|c)+parseFloat(d||0)}var a=c.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return a?parseFloat(a[2])>59?b(a[2],a[3],0,a[4]):b(a[1],a[2],a[3],a[4]):null}var h=function(){function b(){this.values=Object.create(null)}var a=b.prototype;return a.set=function(a,b){this.get(a)||""===b||(this.values[a]=b)},a.get=function(a,b,c){return c?this.has(a)?this.values[a]:b[c]:this.has(a)?this.values[a]:b},a.has=function(a){return a in this.values},a.alt=function(d,b,c){for(var a=0;a<c.length;++a)if(b===c[a]){this.set(d,b);break}},a.integer=function(b,a){/^-?\d+$/.test(a)&&this.set(b,parseInt(a,10))},a.percent=function(c,b){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(b)){var a=parseFloat(b);if(a>=0&&a<=100)return this.set(c,a),!0}return!1},b}();function i(c,f,g,d){var a=d?c.split(d):[c];for(var e in a)if("string"==typeof a[e]){var b=a[e].split(g);2===b.length&&f(b[0],b[1])}}var d=new c.default(0,0,""),j="middle"===d.align?"middle":"center";function k(c,f,p){var m,a,b,k,l,o=c;function n(){var a=g(c);if(null===a)throw new Error("Malformed timestamp: "+o);return c=c.replace(/^[^\sa-zA-Z-]+/,""),a}function e(){c=c.replace(/^\s+/,"")}if(e(),f.startTime=n(),e(),"-->"!==c.substr(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+o);c=c.substr(3),e(),f.endTime=n(),e(),m=c,a=f,b=new h,i(m,function(c,d){var a;switch(c){case"region":for(var e=p.length-1;e>=0;e--)if(p[e].id===d){b.set(c,p[e].region);break}break;case"vertical":b.alt(c,d,["rl","lr"]);break;case"line":a=d.split(","),b.integer(c,a[0]),b.percent(c,a[0])&&b.set("snapToLines",!1),b.alt(c,a[0],["auto"]),2===a.length&&b.alt("lineAlign",a[1],["start",j,"end"]);break;case"position":a=d.split(","),b.percent(c,a[0]),2===a.length&&b.alt("positionAlign",a[1],["start",j,"end","line-left","line-right","auto"]);break;case"size":b.percent(c,d);break;case"align":b.alt(c,d,["start",j,"end","left","right"])}},/:/,/\s/),a.region=b.get("region",null),a.vertical=b.get("vertical",""),"auto"===(k=b.get("line","auto"))&& -1===d.line&&(k=-1),a.line=k,a.lineAlign=b.get("lineAlign","start"),a.snapToLines=b.get("snapToLines",!0),a.size=b.get("size",100),a.align=b.get("align",j),"auto"===(l=b.get("position","auto"))&&50===d.position&&(l="start"===a.align||"left"===a.align?0:"end"===a.align||"right"===a.align?100:50),a.position=l}function l(a){return a.replace(/<br(?: \/)?>/gi,"\n")}var m=function(){function a(){this.state="INITIAL",this.buffer="",this.decoder=new f,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var b=a.prototype;return b.parse=function(e){var a=this;function f(){var c=a.buffer,b=0;for(c=l(c);b<c.length&&"\r"!==c[b]&&"\n"!==c[b];)++b;var d=c.substr(0,b);return"\r"===c[b]&& ++b,"\n"===c[b]&& ++b,a.buffer=c.substr(b),d}e&&(a.buffer+=a.decoder.decode(e,{stream:!0}));try{var b="";if("INITIAL"===a.state){if(!/\r\n|\n/.test(a.buffer))return this;var g=(b=f()).match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!g||!g[0])throw new Error("Malformed WebVTT signature.");a.state="HEADER"}for(var d=!1;a.buffer&&/\r\n|\n/.test(a.buffer);)switch(d?d=!1:b=f(),a.state){case"HEADER":/:/.test(b)?i(b,function(a,b){},/:/):b||(a.state="ID");continue;case"NOTE":b||(a.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(b)){a.state="NOTE";break}if(!b)continue;if(a.cue=new c.default(0,0,""),a.state="CUE",-1===b.indexOf("-->")){a.cue.id=b;continue}case"CUE":if(!a.cue){a.state="BADCUE";continue}try{k(b,a.cue,a.regionList)}catch(j){a.cue=null,a.state="BADCUE";continue}a.state="CUETEXT";continue;case"CUETEXT":var h=-1!==b.indexOf("-->");if(!b||h&&(d=!0)){a.oncue&&a.cue&&a.oncue(a.cue),a.cue=null,a.state="ID";continue}if(null===a.cue)continue;a.cue.text&&(a.cue.text+="\n"),a.cue.text+=b;continue;case"BADCUE":b||(a.state="ID")}}catch(m){"CUETEXT"===a.state&&a.cue&&a.oncue&&a.oncue(a.cue),a.cue=null,a.state="INITIAL"===a.state?"BADWEBVTT":"BADCUE"}return this},b.flush=function(){try{if((this.cue||"HEADER"===this.state)&&(this.buffer+="\n\n",this.parse()),"INITIAL"===this.state||"BADWEBVTT"===this.state)throw new Error("Malformed WebVTT signature.")}catch(a){this.onparsingerror&&this.onparsingerror(a)}return this.onflush&&this.onflush(),this},a}()},"./src/utils/webvtt-parser.ts":/*!************************************!*\
   !*** ./src/utils/webvtt-parser.ts ***!
   \************************************/ /*! exports provided: generateCueId, parseWebVTT */ function(c,b,a){"use strict";a.r(b),a.d(b,"generateCueId",function(){return l}),a.d(b,"parseWebVTT",function(){return m});var d=a(/*! ./src/polyfills/number */ "./src/polyfills/number.ts"),e=a(/*! ./vttparser */ "./src/utils/vttparser.ts"),f=a(/*! ../demux/id3 */ "./src/demux/id3.ts"),g=a(/*! ./timescale-conversion */ "./src/utils/timescale-conversion.ts"),h=a(/*! ../remux/mp4-remuxer */ "./src/remux/mp4-remuxer.ts"),i=/\r\n|\n\r|\n|\r/g,j=function(c,b,a){return void 0===a&&(a=0),c.substr(a,b.length)===b},k=function(b){for(var a=5381,c=b.length;c;)a=33*a^b.charCodeAt(--c);return(a>>>0).toString()};function l(a,b,c){return k(a.toString())+k(b.toString())+k(c)}function m(b,c,k,n,o,p,q,r){var s,a=new e.VTTParser,m=Object(f.utf8ArrayToStr)(new Uint8Array(b)).trim().replace(i,"\n").split("\n"),t=[],u=Object(g.toMpegTsClockFromTimescale)(c,k),v="00:00.000",w=0,x=0,y=!0,z=!1;a.oncue=function(a){var b=n[o],c=n.ccOffset,d=(w-u)/9e4;if(null!=b&&b.new&&(void 0!==x?c=n.ccOffset=b.start:function(a,e,f){var d,b=a[e],c=a[b.prevCC];if(!c|| !c.new&&b.new)return a.ccOffset=a.presentationOffset=b.start,void(b.new=!1);for(;null!==(d=c)&& void 0!==d&&d.new;)a.ccOffset+=b.start-c.start,b.new=!1,c=a[(b=c).prevCC];a.presentationOffset=f}(n,o,d)),d&&(c=d-n.presentationOffset),z){var g=a.endTime-a.startTime,e=Object(h.normalizePts)(9e4*(a.startTime+c-x),9e4*p)/9e4;a.startTime=e,a.endTime=e+g}var f=a.text.trim();a.text=decodeURIComponent(encodeURIComponent(f)),a.id||(a.id=l(a.startTime,a.endTime,f)),a.endTime>0&&t.push(a)},a.onparsingerror=function(a){s=a},a.onflush=function(){s?r(s):q(t)},m.forEach(function(b){if(y){if(j(b,"X-TIMESTAMP-MAP=")){y=!1,z=!0,b.substr(16).split(",").forEach(function(a){j(a,"LOCAL:")?v=a.substr(6):j(a,"MPEGTS:")&&(w=parseInt(a.substr(7)))});try{x=function(a){var b=parseInt(a.substr(-3)),c=parseInt(a.substr(-6,2)),e=parseInt(a.substr(-9,2)),f=a.length>9?parseInt(a.substr(0,a.indexOf(":"))):0;if(!(Object(d.isFiniteNumber)(b)&&Object(d.isFiniteNumber)(c)&&Object(d.isFiniteNumber)(e)&&Object(d.isFiniteNumber)(f)))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+a);return b+=1e3*c,b+=6e4*e,b+=36e5*f}(v)/1e3}catch(c){z=!1,s=c}return}""===b&&(y=!1)}a.parse(b+"\n")}),a.flush()}},"./src/utils/xhr-loader.ts":/*!*********************************!*\
   !*** ./src/utils/xhr-loader.ts ***!
   \*********************************/ /*! exports provided: default */ function(d,b,a){"use strict";a.r(b);var e=a(/*! ../utils/logger */ "./src/utils/logger.ts"),f=a(/*! ../loader/load-stats */ "./src/loader/load-stats.ts"),g=/^age:\s*[\d.]+\s*$/m,c=function(){function b(a){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=a?a.xhrSetup:null,this.stats=new f.LoadStats,this.retryDelay=0}var a=b.prototype;return a.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},a.abortInternal=function(){var a=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),a&&(a.onreadystatechange=null,a.onprogress=null,4!==a.readyState&&(this.stats.aborted=!0,a.abort()))},a.abort=function(){var a;this.abortInternal(),null!==(a=this.callbacks)&& void 0!==a&&a.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},a.load=function(b,a,c){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=b,this.config=a,this.callbacks=c,this.retryDelay=a.retryDelay,this.loadInternal()},a.loadInternal=function(){var e=this.config,b=this.context;let c=new URL(b.url);if(c.searchParams.get("token")||c.searchParams.set("token",window.__TOKEN__),c.searchParams.get("api-key")||c.searchParams.set("api-key",JSON.parse(atob(window.__CONFIG__)).sdk.apiKey),c.searchParams.get("user-id")||c.searchParams.set("user-id",window.__INITIAL_STATE__.userID),b.url=c.toString(),e){var a=this.loader=new self.XMLHttpRequest,f=this.stats;f.loading.first=0,f.loaded=0;var d=this.xhrSetup;try{if(d)try{d(a,b.url)}catch(h){a.open("GET",b.url,!0),d(a,b.url)}a.readyState||a.open("GET",b.url,!0)}catch(g){return void this.callbacks.onError({code:a.status,text:g.message},b,a)}b.rangeEnd&&a.setRequestHeader("Range","bytes="+b.rangeStart+"-"+(b.rangeEnd-1)),a.onreadystatechange=this.readystatechange.bind(this),a.onprogress=this.loadprogress.bind(this),a.responseType=b.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),e.timeout),a.send()}},a.readystatechange=function(){var c=this.context,a=this.loader,b=this.stats;if(c&&a){var g=a.readyState,f=this.config;if(!b.aborted&&g>=2){if(self.clearTimeout(this.requestTimeout),0===b.loading.first&&(b.loading.first=Math.max(self.performance.now(),b.loading.start)),4===g){a.onreadystatechange=null,a.onprogress=null;var d=a.status;if(d>=200&&d<300){if(b.loading.end=Math.max(self.performance.now(),b.loading.first),k="arraybuffer"===c.responseType?(h=a.response).byteLength:(h=a.responseText).length,b.loaded=b.total=k,!this.callbacks)return;var h,k,i=this.callbacks.onProgress;if(i&&i(b,c,h,a),!this.callbacks)return;var j={url:a.responseURL,data:h};this.callbacks.onSuccess(j,b,c,a)}else b.retry>=f.maxRetry||d>=400&&d<499?(e.logger.error(d+" while loading "+c.url),this.callbacks.onError({code:d,text:a.statusText},c,a)):(e.logger.warn(d+" while loading "+c.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,f.maxRetryDelay),b.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),f.timeout)}}},a.loadtimeout=function(){e.logger.warn("timeout while loading "+this.context.url);var a=this.callbacks;a&&(this.abortInternal(),a.onTimeout(this.stats,this.context,this.loader))},a.loadprogress=function(a){var b=this.stats;b.loaded=a.loaded,a.lengthComputable&&(b.total=a.total)},a.getCacheAge=function(){var a=null;if(this.loader&&g.test(this.loader.getAllResponseHeaders())){var b=this.loader.getResponseHeader("age");a=b?parseFloat(b):null}return a},b}();b.default=c}}).default},"object"==typeof b&&"object"==typeof c?c.exports=a():"function"==typeof define&&define.amd?define([],a):"object"==typeof b?b.Hls=a():d.Hls=a())},308:function(f,b,a){"use strict";a.r(b),a.d(b,"default",function(){return h});var c=a(166),d=a(295),e=a.n(d);function g(a,b){return(g=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a})(a,b)}var h=function(d){var a,c;function b(){return d.apply(this,arguments)||this}return c=d,(a=b).prototype=Object.create(c.prototype),a.prototype.constructor=a,g(a,c),b.prototype.getName=function(){return{name:"hlsjs"}},b.getName=function(){return{name:"hlsjs"}},b}(Object(c.a)(e.a))},80:function(c,b,a){"use strict";a.d(b,"a",function(){return e});var d=a(2);function e(c){var e=[],a=(c=Object(d.i)(c)).split("\r\n\r\n");1===a.length&&(a=c.split("\n\n"));for(var b=0;b<a.length;b++)if("WEBVTT"!==a[b]){var g=f(a[b]);g.text&&e.push(g)}return e}function f(g){var c={},a=g.split("\r\n");1===a.length&&(a=g.split("\n"));var b=1;if(a[0].indexOf(" --> ")>0&&(b=0),a.length>b+1&&a[b+1]){var e=a[b],f=e.indexOf(" --> ");f>0&&(c.begin=Object(d.g)(e.substr(0,f)),c.end=Object(d.g)(e.substr(f+5)),c.text=a.slice(b+1).join("\r\n"))}return c}},81:function(c,a,b){"use strict";function d(a){return new Promise(function(d,b){if(a.paused)return b(e("NotAllowedError",0,"play() failed."));var f=function(){a.removeEventListener("play",c),a.removeEventListener("playing",g),a.removeEventListener("pause",g),a.removeEventListener("abort",g),a.removeEventListener("error",g)},c=function(){a.addEventListener("playing",g),a.addEventListener("abort",g),a.addEventListener("error",g),a.addEventListener("pause",g)},g=function(a){if(f(),"playing"!==a.type){var c='The play() request was interrupted by a "'+a.type+'" event.';return"error"===a.type?b(e("NotSupportedError",9,c)):b(e("AbortError",20,c))}d()};a.addEventListener("play",c)})}function e(b,c,d){var a=new Error(d);return a.name=b,a.code=c,a}b.d(a,"a",function(){return d})},83:function(c,b,d){"use strict";var a=window.VTTCue;function e(a){return"string"==typeof a&& !!({start:!0,middle:!0,end:!0,left:!0,right:!0})[a.toLowerCase()]&&a.toLowerCase()}a||((a=function(b,c,d){var a=this;a.hasBeenReset=!1;var f="",g=!1,h=b,i=c,j=d,k=null,l="",m=!0,n="auto",o="start",p="auto",q=100,r="middle";Object.defineProperty(a,"id",{enumerable:!0,get:function(){return f},set:function(a){f=""+a}}),Object.defineProperty(a,"pauseOnExit",{enumerable:!0,get:function(){return g},set:function(a){g=!!a}}),Object.defineProperty(a,"startTime",{enumerable:!0,get:function(){return h},set:function(a){if("number"!=typeof a)throw new TypeError("Start time must be set to a number.");h=a,this.hasBeenReset=!0}}),Object.defineProperty(a,"endTime",{enumerable:!0,get:function(){return i},set:function(a){if("number"!=typeof a)throw new TypeError("End time must be set to a number.");i=a,this.hasBeenReset=!0}}),Object.defineProperty(a,"text",{enumerable:!0,get:function(){return j},set:function(a){j=""+a,this.hasBeenReset=!0}}),Object.defineProperty(a,"region",{enumerable:!0,get:function(){return k},set:function(a){k=a,this.hasBeenReset=!0}}),Object.defineProperty(a,"vertical",{enumerable:!0,get:function(){return l},set:function(c){var a,b="string"==typeof(a=c)&& !!({"":!0,lr:!0,rl:!0})[a.toLowerCase()]&&a.toLowerCase();if(!1===b)throw new SyntaxError("An invalid or illegal string was specified.");l=b,this.hasBeenReset=!0}}),Object.defineProperty(a,"snapToLines",{enumerable:!0,get:function(){return m},set:function(a){m=!!a,this.hasBeenReset=!0}}),Object.defineProperty(a,"line",{enumerable:!0,get:function(){return n},set:function(a){if("number"!=typeof a&&"auto"!==a)throw new SyntaxError("An invalid number or illegal string was specified.");n=a,this.hasBeenReset=!0}}),Object.defineProperty(a,"lineAlign",{enumerable:!0,get:function(){return o},set:function(b){var a=e(b);if(!a)throw new SyntaxError("An invalid or illegal string was specified.");o=a,this.hasBeenReset=!0}}),Object.defineProperty(a,"position",{enumerable:!0,get:function(){return p},set:function(a){if(a<0||a>100)throw new Error("Position must be between 0 and 100.");p=a,this.hasBeenReset=!0}}),Object.defineProperty(a,"size",{enumerable:!0,get:function(){return q},set:function(a){if(a<0||a>100)throw new Error("Size must be between 0 and 100.");q=a,this.hasBeenReset=!0}}),Object.defineProperty(a,"align",{enumerable:!0,get:function(){return r},set:function(b){var a=e(b);if(!a)throw new SyntaxError("An invalid or illegal string was specified.");r=a,this.hasBeenReset=!0}}),a.displayState=void 0}).prototype.getCueAsHTML=function(){return window.WebVTT.convertCueToDOMTree(window,this.text)}),b.a=a},85:function(c,a,b){"use strict";function d(a,b){return a!==1/0&&Math.abs(a)>=Math.max(f(b),0)}function e(a,c){var b="VOD";return a===1/0?b="LIVE":a<0&&(b=d(a,f(c))?"DVR":"LIVE"),b}function f(a){return void 0===a?120:Math.max(a,0)}b.d(a,"a",function(){return d}),b.d(a,"b",function(){return e})},87:function(c,a,b){"use strict";function d(a,b){var c=a.kind||"cc";return a.default||a.defaulttrack?"default":a._id||a.file||c+b}function e(b,c){var a=b.label||b.name||b.language;return a||(a="Unknown CC",(c+=1)>1&&(a+=" ["+c+"]")),{label:a,unknownCount:c}}b.d(a,"a",function(){return d}),b.d(a,"b",function(){return e})},88:function(c,b,a){"use strict";var d=a(83),e=a(8),f=a(27),g=a(4),h=a(80),i=a(2),j=a(1);function k(a){throw new j.q(null,a)}function l(b,c,d){b.xhr=Object(f.b)(b.file,function(f){!function(c,l,m,p){var d,f,b=c.responseXML?c.responseXML.firstChild:null;if(b)for("xml"===Object(g.b)(b)&&(b=b.nextSibling);b&&b.nodeType===b.COMMENT_NODE;)b=b.nextSibling;try{if(b&&"tt"===Object(g.b)(b)){if(!c.responseXML)throw new Error("Empty XML response");d=function(b){b||k(306007);var g=[],c=b.getElementsByTagName("p"),d=30,h=b.getElementsByTagName("tt");if(h&&h[0]){var m=parseFloat(h[0].getAttribute("ttp:frameRate")||"");isNaN(m)||(d=m)}c||k(306005),c.length||(c=b.getElementsByTagName("tt:p")).length||(c=b.getElementsByTagName("tts:p"));for(var j=0;j<c.length;j++){for(var a=c[j],n=a.getElementsByTagName("br"),l=0;l<n.length;l++){var e=n[l];e&&e.parentNode&&e.parentNode.replaceChild(b.createTextNode("\r\n"),e)}var r=a.innerHTML||a.textContent||a.text||"",o=Object(i.i)(r).replace(/>\s+</g,"><").replace(/(<\/?)tts?:/g,"$1").replace(/<br.*?\/>/g,"\r\n");if(o){var s=a.getAttribute("begin")||"",p=a.getAttribute("dur")||"",q=a.getAttribute("end")||"",f={begin:Object(i.g)(s,d),text:o};q?f.end=Object(i.g)(q,d):p&&(f.end=(f.begin||0)+Object(i.g)(p,d)),g.push(f)}}return g.length||k(306005),g}(c.responseXML),f=n(d),delete l.xhr,m(f)}else{var o=c.responseText;o.indexOf("WEBVTT")>=0?a.e(19).then((function(b){return a(168).default}).bind(null,a)).catch(Object(e.c)(301131)).then(function(b){var a=new b(window);f=[],a.oncue=function(a){f.push(a)},a.onflush=function(){delete l.xhr,m(f)},a.parse(o)}).catch(function(a){delete l.xhr,p(Object(j.z)(null,j.c,a))}):(d=Object(h.a)(o),f=n(d),delete l.xhr,m(f))}}catch(q){delete l.xhr,p(Object(j.z)(null,j.c,q))}}(f,b,c,d)},function(b,c,e,a){d(Object(j.y)(a,j.c))})}function m(a){a&&a.forEach(function(b){var a=b.xhr;a&&(a.onload=null,a.onreadystatechange=null,a.onerror=null,"abort"in a&&a.abort()),delete b.xhr})}function n(a){return a.map(function(a){return new d.a(a.begin,a.end,a.text)})}a.d(b,"b",function(){return l}),a.d(b,"a",function(){return m})}}])